!function(){function e(t,c,n){return(e="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,c){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(c):r.value}})(t,c,n||t)}function t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function n(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var c,n=a(e);if(t){var i=a(this).constructor;c=Reflect.construct(n,arguments,i)}else c=n.apply(this,arguments);return r(this,c)}}function r(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?i(e):t}function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||d(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){var c;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(c=d(e))||t&&e&&"number"==typeof e.length){c&&(e=c);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){c=e[Symbol.iterator]()},n:function(){var e=c.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==c.return||c.return()}finally{if(o)throw i}}}}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var c=[],n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done)&&(c.push(a.value),!t||c.length!==t);n=!0);}catch(l){r=!0,i=l}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return c}(e,t)||d(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){if(e){if("string"==typeof e)return u(e,t);var c=Object.prototype.toString.call(e).slice(8,-1);return"Object"===c&&e.constructor&&(c=e.constructor.name),"Map"===c||"Set"===c?Array.from(e):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var c=0,n=new Array(t);c<t;c++)n[c]=e[c];return n}function f(e,t,c){return t in e?Object.defineProperty(e,t,{value:c,enumerable:!0,configurable:!0,writable:!0}):e[t]=c,e}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var c=0;c<t.length;c++){var n=t[c];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t,c){return t&&p(e.prototype,t),c&&p(e,c),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{ymA1:function(c,r,d){"use strict";d.r(r),d.d(r,"AddManualPaymentDialogComponent",function(){return k}),d.d(r,"CancelOrderDialogComponent",function(){return W}),d.d(r,"FulfillOrderDialogComponent",function(){return U}),d.d(r,"FulfillmentCardComponent",function(){return Ce}),d.d(r,"FulfillmentDetailComponent",function(){return le}),d.d(r,"FulfillmentStateLabelComponent",function(){return Y}),d.d(r,"LineFulfillmentComponent",function(){return we}),d.d(r,"LineRefundsComponent",function(){return je}),d.d(r,"ModificationDetailComponent",function(){return Ee}),d.d(r,"OrderCustomFieldsCardComponent",function(){return ze}),d.d(r,"OrderDetailComponent",function(){return Xn}),d.d(r,"OrderEditorComponent",function(){return wr}),d.d(r,"OrderEditResultType",function(){return $n}),d.d(r,"OrderEditsPreviewDialogComponent",function(){return Yn}),d.d(r,"OrderHistoryComponent",function(){return an}),d.d(r,"OrderListComponent",function(){return zr}),d.d(r,"OrderPaymentCardComponent",function(){return Tn}),d.d(r,"NODE_HEIGHT",function(){return vt}),d.d(r,"OrderProcessEdgeComponent",function(){return Qt}),d.d(r,"OrderProcessGraphComponent",function(){return St}),d.d(r,"OrderProcessNodeComponent",function(){return Ct}),d.d(r,"OrderProcessGraphDialogComponent",function(){return kt}),d.d(r,"OrderStateSelectDialogComponent",function(){return pt}),d.d(r,"OrderTableComponent",function(){return vc}),d.d(r,"PaymentDetailComponent",function(){return Ic}),d.d(r,"PaymentStateLabelComponent",function(){return sn}),d.d(r,"RefundOrderDialogComponent",function(){return Ht}),d.d(r,"RefundStateLabelComponent",function(){return un}),d.d(r,"SettleRefundDialogComponent",function(){return Gt}),d.d(r,"SimpleItemListComponent",function(){return ee}),d.d(r,"OrderModule",function(){return Jr}),d.d(r,"orderRoutes",function(){return Gr}),d.d(r,"orderBreadcrumb",function(){return Yr}),d.d(r,"modifyingOrderBreadcrumb",function(){return Zr}),d.d(r,"OrderTransitionService",function(){return mt}),d.d(r,"OrderResolver",function(){return Br});var u=d("3Pt+"),p=d("t9nd"),h=d("fXoL"),b=d("xUfP"),v=d("1XD6"),y=d("ZOsW"),C=d("Bzlx"),O=d("jHbs"),Q=d("sYmb"),I=d("ofXK"),T=d("ZFbG");function S(e,t){1&e&&(h.Vc(0),h.sc(1,"translate")),2&e&&h.Wc(h.tc(1,1,"order.add-payment-to-order"))}function P(e,t){if(1&e){var c=h.ic();h.hc(0,"button",7),h.pc("click",function(){return h.Lc(c),h.rc().cancel()}),h.Vc(1),h.sc(2,"translate"),h.gc(),h.hc(3,"button",8),h.pc("click",function(){return h.Lc(c),h.rc().submit()}),h.Vc(4),h.sc(5,"translate"),h.sc(6,"localeCurrency"),h.gc()}if(2&e){var n=h.rc();h.Qb(1),h.Wc(h.tc(2,4,"common.cancel")),h.Qb(2),h.yc("disabled",n.form.invalid||n.form.pristine),h.Qb(1),h.Yc(" ",h.tc(5,6,"order.add-payment")," (",h.uc(6,8,n.outstandingAmount,n.currencyCode),") ")}}var k=function(){function e(t){g(this,e),this.dataService=t,this.form=new u.i({method:new u.f("",u.C.required),transactionId:new u.f("",u.C.required)})}return m(e,[{key:"ngOnInit",value:function(){this.paymentMethods$=this.dataService.settings.getPaymentMethods(999).mapSingle(function(e){return e.paymentMethods.items})}},{key:"submit",value:function(){var e=this.form.value;this.resolveWith({method:e.method,transactionId:e.transactionId})}},{key:"cancel",value:function(){this.resolveWith()}}]),e}();k.\u0275fac=function(e){return new(e||k)(h.bc(p.s))},k.\u0275cmp=h.Vb({type:k,selectors:[["vdr-add-manual-payment-dialog"]],decls:10,vars:11,consts:[["vdrDialogTitle",""],[3,"formGroup"],["for","method",3,"label"],["bindLabel","code","autofocus","","bindValue","code","formControlName","method",3,"items","addTag"],["for","transactionId",3,"label"],["id","transactionId","type","text","formControlName","transactionId"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(h.Tc(0,S,2,3,"ng-template",0),h.hc(1,"form",1),h.hc(2,"vdr-form-field",2),h.sc(3,"translate"),h.cc(4,"ng-select",3),h.sc(5,"async"),h.gc(),h.hc(6,"vdr-form-field",4),h.sc(7,"translate"),h.cc(8,"input",5),h.gc(),h.gc(),h.Tc(9,P,7,11,"ng-template",6)),2&e&&(h.Qb(1),h.yc("formGroup",t.form),h.Qb(1),h.yc("label",h.tc(3,5,"order.payment-method")),h.Qb(2),h.yc("items",h.tc(5,7,t.paymentMethods$))("addTag",!0),h.Qb(2),h.yc("label",h.tc(7,9,"order.transaction-id")))},directives:[b.a,u.E,u.q,u.j,v.a,y.a,u.p,u.h,C.a,u.b,O.a],pipes:[Q.d,I.b,T.a],styles:[".ng-select[_ngcontent-%COMP%]{min-width:100%}"],changeDetection:0});var M=d("OxKu"),V=d("8MG2"),x=d("PPsv");function F(e,t){1&e&&(h.Vc(0),h.sc(1,"translate")),2&e&&h.Wc(h.tc(1,1,"order.cancel-order"))}function w(e,t){if(1&e){var c=h.ic();h.hc(0,"input",18),h.pc("ngModelChange",function(e){h.Lc(c);var t=h.rc().$implicit;return h.rc().lineQuantities[t.id]=e}),h.gc()}if(2&e){var n=h.rc().$implicit,r=h.rc();h.yc("ngModel",r.lineQuantities[n.id])("max",n.quantity)}}function _(e,t){if(1&e&&h.Vc(0),2&e){var c=h.rc().$implicit;h.Wc(c.quantity)}}function L(e,t){if(1&e&&(h.hc(0,"tr",9),h.hc(1,"td",10),h.cc(2,"img",11),h.sc(3,"assetPreview"),h.gc(),h.hc(4,"td",12),h.Vc(5),h.gc(),h.hc(6,"td",13),h.Vc(7),h.gc(),h.hc(8,"td",14),h.Vc(9),h.gc(),h.hc(10,"td",14),h.Vc(11),h.sc(12,"localeCurrency"),h.gc(),h.hc(13,"td",15),h.Tc(14,w,1,2,"input",16),h.Tc(15,_,1,1,"ng-template",null,17,h.Uc),h.gc(),h.gc()),2&e){var c=t.$implicit,n=h.Ic(16),r=h.rc();h.Tb("is-cancelled",0===c.quantity),h.Qb(2),h.yc("src",h.uc(3,9,c.featuredAsset,"tiny"),h.Nc),h.Qb(3),h.Wc(c.productVariant.name),h.Qb(2),h.Wc(c.productVariant.sku),h.Qb(2),h.Wc(c.quantity),h.Qb(2),h.Xc(" ",h.uc(12,12,c.unitPriceWithTax,r.order.currencyCode)," "),h.Qb(3),h.yc("ngIf",c.quantity>0&&!r.order.active)("ngIfElse",n)}}function A(e,t){1&e&&(h.fc(0),h.Vc(1),h.sc(2,"translate"),h.ec()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.cancel-selected-items")," "))}function j(e,t){1&e&&(h.fc(0),h.Vc(1),h.sc(2,"translate"),h.ec()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.cancel-order")," "))}function D(e,t){if(1&e){var c=h.ic();h.hc(0,"button",19),h.pc("click",function(){return h.Lc(c),h.rc().cancel()}),h.Vc(1),h.sc(2,"translate"),h.gc(),h.hc(3,"button",20),h.pc("click",function(){return h.Lc(c),h.rc().select()}),h.Tc(4,A,3,3,"ng-container",21),h.Tc(5,j,3,3,"ng-container",21),h.gc()}if(2&e){var n=h.rc();h.Qb(1),h.Wc(h.tc(2,4,"common.cancel")),h.Qb(2),h.yc("disabled",!n.reason||!n.order.active&&0===n.selectionCount),h.Qb(1),h.yc("ngIf",!n.order.active),h.Qb(1),h.yc("ngIf",n.order.active)}}var W=function(){function e(t){var c=this;g(this,e),this.i18nService=t,this.lineQuantities={},this.reasons=[Object(M.a)("order.cancel-reason-customer-request"),Object(M.a)("order.cancel-reason-not-available")],this.reasons=this.reasons.map(function(e){return c.i18nService.translate(e)})}return m(e,[{key:"selectionCount",get:function(){return Object.values(this.lineQuantities).reduce(function(e,t){return e+t},0)}},{key:"ngOnInit",value:function(){this.lineQuantities=this.order.lines.reduce(function(e,t){return Object.assign(Object.assign({},e),f({},t.id,0))},{})}},{key:"select",value:function(){this.resolveWith({orderId:this.order.id,lines:this.getLineInputs(),reason:this.reason})}},{key:"cancel",value:function(){this.resolveWith()}},{key:"getLineInputs",value:function(){if(!this.order.active)return Object.entries(this.lineQuantities).map(function(e){var t=s(e,2);return{orderLineId:t[0],quantity:t[1]}}).filter(function(e){return 0<e.quantity})}}]),e}();W.\u0275fac=function(e){return new(e||W)(h.bc(p.z))},W.\u0275cmp=h.Vb({type:W,selectors:[["vdr-cancel-order-dialog"]],decls:29,vars:22,consts:[["vdrDialogTitle",""],[1,"fulfillment-wrapper"],[1,"order-lines"],[1,"table"],["class","order-line",3,"is-cancelled",4,"ngFor","ngForOf"],[1,"cancellation-details"],[1,"clr-control-label"],["bindLabel","name","autofocus","","bindValue","id",3,"items","addTag","ngModel","ngModelChange"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[1,"align-middle","fulfil"],["type","number","min","0",3,"ngModel","max","ngModelChange",4,"ngIf","ngIfElse"],["nonEditable",""],["type","number","min","0",3,"ngModel","max","ngModelChange"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf"]],template:function(e,t){1&e&&(h.Tc(0,F,2,3,"ng-template",0),h.hc(1,"div",1),h.hc(2,"div",2),h.hc(3,"table",3),h.hc(4,"thead"),h.hc(5,"tr"),h.cc(6,"th"),h.hc(7,"th"),h.Vc(8),h.sc(9,"translate"),h.gc(),h.hc(10,"th"),h.Vc(11),h.sc(12,"translate"),h.gc(),h.hc(13,"th"),h.Vc(14),h.sc(15,"translate"),h.gc(),h.hc(16,"th"),h.Vc(17),h.sc(18,"translate"),h.gc(),h.hc(19,"th"),h.Vc(20),h.sc(21,"translate"),h.gc(),h.gc(),h.gc(),h.Tc(22,L,17,15,"tr",4),h.gc(),h.gc(),h.hc(23,"div",5),h.hc(24,"label",6),h.Vc(25),h.sc(26,"translate"),h.gc(),h.hc(27,"ng-select",7),h.pc("ngModelChange",function(e){return t.reason=e}),h.gc(),h.gc(),h.gc(),h.Tc(28,D,6,6,"ng-template",8)),2&e&&(h.Qb(8),h.Wc(h.tc(9,10,"order.product-name")),h.Qb(3),h.Wc(h.tc(12,12,"order.product-sku")),h.Qb(3),h.Wc(h.tc(15,14,"order.quantity")),h.Qb(3),h.Wc(h.tc(18,16,"order.unit-price")),h.Qb(3),h.Wc(h.tc(21,18,"order.cancel")),h.Qb(2),h.yc("ngForOf",t.order.lines),h.Qb(3),h.Wc(h.tc(26,20,"order.cancellation-reason")),h.Qb(2),h.yc("items",t.reasons)("addTag",!0)("ngModel",t.reason))},directives:[b.a,I.n,V.u,y.a,u.p,u.s,O.a,I.o,C.a,u.v,u.b],pipes:[Q.d,x.a,T.a],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}.fulfillment-wrapper[_ngcontent-%COMP%]{flex:1}@media screen and (min-width:768px){.fulfillment-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row}}@media screen and (min-width:768px){.fulfillment-wrapper[_ngcontent-%COMP%]   .cancellation-details[_ngcontent-%COMP%]{margin-top:0;margin-left:24px;width:250px}}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-lines[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-lines[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.fulfillment-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}.fulfillment-wrapper[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}"],changeDetection:0});var N=d("qqSn"),R=d("7xiD");function E(e,t){1&e&&(h.Vc(0),h.sc(1,"translate")),2&e&&h.Wc(h.tc(1,1,"order.fulfill-order"))}function X(e,t){if(1&e&&(h.cc(0,"img",17),h.sc(1,"assetPreview")),2&e){var c=h.rc().$implicit;h.yc("src",h.uc(1,1,c.featuredAsset,"tiny"),h.Nc)}}function $(e,t){if(1&e){var c=h.ic();h.hc(0,"input",18),h.pc("ngModelChange",function(e){h.Lc(c);var t=h.rc().$implicit;return h.rc().fulfillmentQuantities[t.id].fulfillCount=e}),h.gc()}if(2&e){var n=h.rc().$implicit,r=h.rc();h.yc("disabled",0===r.getUnfulfilledCount(n))("ngModel",r.fulfillmentQuantities[n.id].fulfillCount)("max",r.fulfillmentQuantities[n.id].max)}}function q(e,t){if(1&e&&(h.hc(0,"tr",9),h.hc(1,"td",10),h.Tc(2,X,2,4,"img",11),h.gc(),h.hc(3,"td",12),h.Vc(4),h.gc(),h.hc(5,"td",13),h.Vc(6),h.gc(),h.hc(7,"td",14),h.Vc(8),h.gc(),h.hc(9,"td",14),h.Vc(10),h.gc(),h.hc(11,"td",15),h.Tc(12,$,1,3,"input",16),h.gc(),h.gc()),2&e){var c=t.$implicit,n=h.rc();h.Tb("ignore",0===n.getUnfulfilledCount(c)),h.Qb(2),h.yc("ngIf",c.featuredAsset),h.Qb(2),h.Wc(c.productVariant.name),h.Qb(2),h.Wc(c.productVariant.sku),h.Qb(2),h.Wc(n.getUnfulfilledCount(c)),h.Qb(2),h.Wc(c.productVariant.stockOnHand),h.Qb(2),h.yc("ngIf",n.fulfillmentQuantities[c.id])}}function H(e,t){if(1&e){var c=h.ic();h.hc(0,"button",19),h.pc("click",function(){return h.Lc(c),h.rc().cancel()}),h.Vc(1),h.sc(2,"translate"),h.gc(),h.hc(3,"button",20),h.pc("click",function(){return h.Lc(c),h.rc().select()}),h.Vc(4),h.sc(5,"translate"),h.gc()}if(2&e){var n=h.rc();h.Qb(1),h.Wc(h.tc(2,3,"common.cancel")),h.Qb(2),h.yc("disabled",!n.canSubmit()),h.Qb(1),h.Xc(" ",h.tc(5,5,"order.create-fulfillment")," ")}}var U=function(){function e(t,c){g(this,e),this.dataService=t,this.changeDetector=c,this.fulfillmentHandlerControl=new u.f,this.fulfillmentQuantities={}}return m(e,[{key:"ngOnInit",value:function(){var e=this;this.dataService.settings.getGlobalSettings().single$.subscribe(function(t){var c=t.globalSettings;e.fulfillmentQuantities=e.order.lines.reduce(function(t,n){var r=e.getFulfillableCount(n,c.trackInventory);return Object.assign(Object.assign({},t),f({},n.id,{fulfillCount:r,max:r}))},{}),e.changeDetector.markForCheck()}),this.dataService.shippingMethod.getShippingMethodOperations().mapSingle(function(e){return e.fulfillmentHandlers}).subscribe(function(t){e.fulfillmentHandlerDef=t.find(function(t){var c,n;return t.code===(null===(n=null===(c=e.order.shippingLines[0])||void 0===c?void 0:c.shippingMethod)||void 0===n?void 0:n.fulfillmentHandlerCode)})||t[0],e.fulfillmentHandler=Object(p.M)(e.fulfillmentHandlerDef),e.fulfillmentHandlerControl.patchValue(e.fulfillmentHandler),e.changeDetector.markForCheck()})}},{key:"getFulfillableCount",value:function(e,t){var c=e.productVariant,n=c.trackInventory,r=c.stockOnHand,i=n===p.w.INHERIT?t:n===p.w.TRUE,a=this.getUnfulfilledCount(e);return i?Math.min(a,r):a}},{key:"getUnfulfilledCount",value:function(e){var t=e.items.reduce(function(e,t){return e+(t.fulfillment?1:0)},0);return e.quantity-t}},{key:"canSubmit",value:function(){var e=Object.values(this.fulfillmentQuantities).reduce(function(e,t){return e+t.fulfillCount},0);return Object(p.N)(this.fulfillmentHandlerDef,this.fulfillmentHandlerControl.value)&&this.fulfillmentHandlerControl.valid&&0<e}},{key:"select",value:function(){var e=Object.entries(this.fulfillmentQuantities).map(function(e){var t=s(e,2);return{orderLineId:t[0],quantity:t[1].fulfillCount}});this.resolveWith({lines:e,handler:Object(p.Z)(this.fulfillmentHandler,this.fulfillmentHandlerControl.value)})}},{key:"cancel",value:function(){this.resolveWith()}}]),e}();U.\u0275fac=function(e){return new(e||U)(h.bc(p.s),h.bc(h.j))},U.\u0275cmp=h.Vb({type:U,selectors:[["vdr-fulfill-order-dialog"]],decls:34,vars:29,consts:[["vdrDialogTitle",""],[1,"fulfillment-wrapper"],[1,"order-table"],[1,"table"],["class","order-line",3,"ignore",4,"ngFor","ngForOf"],[1,"shipping-details"],[3,"address"],[3,"operationDefinition","operation","formControl","removable"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[1,"align-middle","fulfil"],["type","number","min","0",3,"disabled","ngModel","max","ngModelChange",4,"ngIf"],[3,"src"],["type","number","min","0",3,"disabled","ngModel","max","ngModelChange"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(h.Tc(0,E,2,3,"ng-template",0),h.hc(1,"div",1),h.hc(2,"div",2),h.hc(3,"table",3),h.hc(4,"thead"),h.hc(5,"tr"),h.cc(6,"th"),h.hc(7,"th"),h.Vc(8),h.sc(9,"translate"),h.gc(),h.hc(10,"th"),h.Vc(11),h.sc(12,"translate"),h.gc(),h.hc(13,"th"),h.Vc(14),h.sc(15,"translate"),h.gc(),h.hc(16,"th"),h.Vc(17),h.sc(18,"translate"),h.gc(),h.hc(19,"th"),h.Vc(20),h.sc(21,"translate"),h.gc(),h.gc(),h.gc(),h.Tc(22,q,13,8,"tr",4),h.gc(),h.gc(),h.hc(23,"div",5),h.cc(24,"vdr-formatted-address",6),h.hc(25,"h6"),h.Vc(26),h.sc(27,"translate"),h.gc(),h.Vc(28),h.hc(29,"strong"),h.Vc(30),h.sc(31,"localeCurrency"),h.gc(),h.cc(32,"vdr-configurable-input",7),h.gc(),h.gc(),h.Tc(33,H,6,7,"ng-template",8)),2&e&&(h.Qb(8),h.Wc(h.tc(9,14,"order.product-name")),h.Qb(3),h.Wc(h.tc(12,16,"order.product-sku")),h.Qb(3),h.Wc(h.tc(15,18,"order.unfulfilled")),h.Qb(3),h.Wc(h.tc(18,20,"catalog.stock-on-hand")),h.Qb(3),h.Wc(h.tc(21,22,"order.fulfill")),h.Qb(2),h.yc("ngForOf",t.order.lines),h.Qb(2),h.yc("address",t.order.shippingAddress),h.Qb(2),h.Wc(h.tc(27,24,"order.shipping-method")),h.Qb(2),h.Xc(" ",null==t.order.shippingLines[0]||null==t.order.shippingLines[0].shippingMethod?null:t.order.shippingLines[0].shippingMethod.name," "),h.Qb(2),h.Wc(h.uc(31,26,t.order.shipping,t.order.currencyCode)),h.Qb(2),h.yc("operationDefinition",t.fulfillmentHandlerDef)("operation",t.fulfillmentHandler)("formControl",t.fulfillmentHandlerControl)("removable",!1))},directives:[b.a,I.n,N.a,R.a,u.p,u.g,O.a,I.o,C.a,u.v,u.b,u.s],pipes:[Q.d,T.a,x.a],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}.fulfillment-wrapper[_ngcontent-%COMP%]{flex:1}@media screen and (min-width:768px){.fulfillment-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row}}.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]{margin-top:24px}@media screen and (min-width:768px){.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]{margin-top:0;margin-left:24px;width:250px}}.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]   clr-input-container[_ngcontent-%COMP%]{margin-top:24px}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.fulfillment-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}"],changeDetection:0});var z=d("2/wi"),B=d("ocEb");function G(e,t){1&e&&h.cc(0,"clr-icon",2)}var Y=function(){function e(){g(this,e)}return m(e,[{key:"chipColorType",get:function(){switch(this.state){case"Pending":case"Shipped":return"warning";case"Delivered":return"success";case"Cancelled":return"error"}}}]),e}();Y.\u0275fac=function(e){return new(e||Y)},Y.\u0275cmp=h.Vb({type:Y,selectors:[["vdr-fulfillment-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(e,t){1&e&&(h.hc(0,"vdr-chip",0),h.sc(1,"translate"),h.Tc(2,G,1,0,"clr-icon",1),h.Vc(3),h.sc(4,"translate"),h.sc(5,"stateI18nToken"),h.gc()),2&e&&(h.yc("title",h.tc(1,4,"order.payment-state"))("colorType",t.chipColorType),h.Qb(2),h.yc("ngIf","Delivered"===t.state),h.Qb(1),h.Xc(" ",h.tc(4,6,h.tc(5,8,t.state)),"\n"))},directives:[z.a,I.o,V.o],pipes:[Q.d,B.a],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0});var Z=d("cOim"),J=d("0MpJ");function K(e,t){if(1&e&&(h.hc(0,"li",2),h.hc(1,"div",3),h.Vc(2),h.gc(),h.cc(3,"clr-icon",4),h.Vc(4),h.gc()),2&e){var c=t.$implicit;h.yc("title",c.name),h.Qb(2),h.Wc(c.quantity),h.Qb(2),h.Xc(" ",c.name," ")}}var ee=function e(){g(this,e)};ee.\u0275fac=function(e){return new(e||ee)},ee.\u0275cmp=h.Vb({type:ee,selectors:[["vdr-simple-item-list"]],inputs:{items:"items"},decls:3,vars:1,consts:[[1,"items-list"],[3,"title",4,"ngFor","ngForOf"],[3,"title"],[1,"quantity"],["shape","times","size","12"]],template:function(e,t){1&e&&(h.hc(0,"div",0),h.hc(1,"ul"),h.Tc(2,K,5,3,"li",1),h.gc(),h.gc()),2&e&&(h.Qb(2),h.yc("ngForOf",t.items))},directives:[I.n,V.o],styles:[".items-list[_ngcontent-%COMP%]{font-size:12px}.items-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin-top:6px;list-style-type:none;margin-left:2px}.items-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{line-height:14px;text-overflow:ellipsis;overflow:hidden}.items-list[_ngcontent-%COMP%]   .quantity[_ngcontent-%COMP%]{min-width:16px;display:inline-block}"],changeDetection:0});var te=d("2zLM"),ce=d("HMPB");function ne(e,t){if(1&e&&(h.hc(0,"vdr-labeled-data",0),h.sc(1,"translate"),h.Vc(2),h.gc()),2&e){var c=h.rc();h.yc("label",h.tc(1,2,"order.tracking-code")),h.Qb(2),h.Xc(" ",null==c.fulfillment?null:c.fulfillment.trackingCode,"\n")}}var re=function(e){return{object:e}};function ie(e,t){if(1&e&&h.cc(0,"vdr-object-tree",6),2&e){var c=h.rc().$implicit;h.yc("value",h.Cc(1,re,c.value))}}function ae(e,t){if(1&e&&h.Vc(0),2&e){var c=h.rc().$implicit;h.Xc(" ",c.value," ")}}function oe(e,t){if(1&e&&(h.fc(0),h.hc(1,"vdr-labeled-data",0),h.Tc(2,ie,1,3,"vdr-object-tree",4),h.Tc(3,ae,1,1,"ng-template",null,5,h.Uc),h.gc(),h.ec()),2&e){var c=t.$implicit,n=h.Ic(4),r=h.rc();h.Qb(1),h.yc("label",c.key),h.Qb(1),h.yc("ngIf",r.customFieldIsObject(c.value))("ngIfElse",n)}}var le=function(){function e(){g(this,e),this.customFields=[]}return m(e,[{key:"ngOnChanges",value:function(e){this.customFields=this.getCustomFields()}},{key:"fulfillment",get:function(){var e=this;return this.order.fulfillments&&this.order.fulfillments.find(function(t){return t.id===e.fulfillmentId})}},{key:"items",get:function(){var e,t,c=new Map,n=null===(e=this.fulfillment)||void 0===e?void 0:e.orderItems.map(function(e){return e.id}),r=l(this.order.lines);try{for(r.s();!(t=r.n()).done;){var i,a=t.value,o=l(a.items);try{for(o.s();!(i=o.n()).done;){var d=i.value;if(null==n?void 0:n.includes(d.id)){var u=c.get(a.productVariant.name);null!=u?c.set(a.productVariant.name,u+1):c.set(a.productVariant.name,1)}}}catch(f){o.e(f)}finally{o.f()}}}catch(f){r.e(f)}finally{r.f()}return Array.from(c.entries()).map(function(e){var t=s(e,2);return{name:t[0],quantity:t[1]}})}},{key:"getCustomFields",value:function(){var e=this.fulfillment.customFields;return e?Object.entries(e).filter(function(e){return"__typename"!==s(e,1)[0]}).map(function(e){var t=s(e,2),c=t[0],n=t[1];return{key:c,value:Array.isArray(n)||Object(Z.isObject)(n)?n:n.toString()}}):[]}},{key:"customFieldIsObject",value:function(e){return Array.isArray(e)||Object(Z.isObject)(e)}}]),e}();le.\u0275fac=function(e){return new(e||le)},le.\u0275cmp=h.Vb({type:le,selectors:[["vdr-fulfillment-detail"]],inputs:{fulfillmentId:"fulfillmentId",order:"order"},features:[h.Ob],decls:12,vars:17,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"items"],[4,"ngFor","ngForOf"],[3,"value",4,"ngIf","ngIfElse"],["primitive",""],[3,"value"]],template:function(e,t){1&e&&(h.hc(0,"vdr-labeled-data",0),h.sc(1,"translate"),h.Vc(2),h.sc(3,"localeDate"),h.gc(),h.hc(4,"vdr-labeled-data",0),h.sc(5,"translate"),h.Vc(6),h.gc(),h.Tc(7,ne,3,4,"vdr-labeled-data",1),h.hc(8,"vdr-labeled-data",0),h.sc(9,"translate"),h.cc(10,"vdr-simple-item-list",2),h.gc(),h.Tc(11,oe,5,3,"ng-container",3)),2&e&&(h.yc("label",h.tc(1,8,"common.created-at")),h.Qb(2),h.Xc(" ",h.uc(3,10,null==t.fulfillment?null:t.fulfillment.createdAt,"medium"),"\n"),h.Qb(2),h.yc("label",h.tc(5,13,"order.fulfillment-method")),h.Qb(2),h.Xc(" ",null==t.fulfillment?null:t.fulfillment.method,"\n"),h.Qb(1),h.yc("ngIf",null==t.fulfillment?null:t.fulfillment.trackingCode),h.Qb(1),h.yc("label",h.tc(9,15,"order.contents")),h.Qb(2),h.yc("items",t.items),h.Qb(1),h.yc("ngForOf",t.customFields))},directives:[J.a,I.o,ee,I.n,te.a],pipes:[Q.d,ce.a],styles:[""],changeDetection:0});var se=d("zzDm"),de=d("eBFp"),ue=d("IKcI"),fe=d("EFLa");function ge(e,t){if(1&e&&h.cc(0,"vdr-fulfillment-detail",7),2&e){var c=h.rc();h.yc("fulfillmentId",null==c.fulfillment?null:c.fulfillment.id)("order",c.order)}}var pe=function(e){return{state:e}};function me(e,t){if(1&e){var c=h.ic();h.fc(0),h.hc(1,"button",14),h.pc("click",function(){h.Lc(c);var e=t.ngIf;return h.rc(2).transitionState.emit(e)}),h.Vc(2),h.sc(3,"translate"),h.sc(4,"translate"),h.sc(5,"stateI18nToken"),h.gc(),h.ec()}if(2&e){var n=t.ngIf;h.Qb(2),h.Xc(" ",h.uc(3,1,"order.set-fulfillment-state",h.Cc(8,pe,h.tc(4,4,h.tc(5,6,n))))," ")}}function he(e,t){if(1&e&&(h.fc(0),h.cc(1,"clr-icon",18),h.Vc(2),h.sc(3,"translate"),h.sc(4,"translate"),h.sc(5,"stateI18nToken"),h.ec()),2&e){var c=h.rc().$implicit;h.Qb(2),h.Xc(" ",h.uc(3,1,"order.transition-to-state",h.Cc(8,pe,h.tc(4,4,h.tc(5,6,c))))," ")}}function be(e,t){1&e&&(h.cc(0,"clr-icon",19),h.Vc(1),h.sc(2,"translate")),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.cancel-fulfillment")," "))}function ve(e,t){if(1&e){var c=h.ic();h.fc(0),h.hc(1,"button",15),h.pc("click",function(){h.Lc(c);var e=t.$implicit;return h.rc(2).transitionState.emit(e)}),h.Tc(2,he,6,10,"ng-container",16),h.Tc(3,be,3,3,"ng-template",null,17,h.Uc),h.gc(),h.ec()}if(2&e){var n=t.$implicit,r=h.Ic(4);h.Qb(2),h.yc("ngIf","Cancelled"!==n)("ngIfElse",r)}}function ye(e,t){if(1&e&&(h.hc(0,"div",8),h.Tc(1,me,6,10,"ng-container",9),h.hc(2,"vdr-dropdown"),h.hc(3,"button",10),h.cc(4,"clr-icon",11),h.gc(),h.hc(5,"vdr-dropdown-menu",12),h.Tc(6,ve,5,2,"ng-container",13),h.gc(),h.gc(),h.gc()),2&e){var c=h.rc();h.Qb(1),h.yc("ngIf",c.nextSuggestedState()),h.Qb(5),h.yc("ngForOf",c.nextOtherStates())}}var Ce=function(){function e(){g(this,e),this.transitionState=new h.t}return m(e,[{key:"nextSuggestedState",value:function(){var e;if(this.fulfillment){var t=this.fulfillment.nextStates,c=function(e){return t.includes(e)?e:t[0]};switch(null===(e=this.fulfillment)||void 0===e?void 0:e.state){case"Pending":return c("Shipped");case"Shipped":return c("Delivered");default:return t.find(function(e){return"Cancelled"!==e})}}}},{key:"nextOtherStates",value:function(){if(!this.fulfillment)return[];var e=this.nextSuggestedState();return this.fulfillment.nextStates.filter(function(t){return t!==e})}}]),e}();function Oe(e,t){1&e&&h.cc(0,"clr-icon",9)}function Qe(e,t){1&e&&h.cc(0,"clr-icon",10)}function Ie(e,t){1&e&&h.cc(0,"clr-icon",11)}function Te(e,t){1&e&&(h.hc(0,"label",12),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.line-fulfillment-all")," "))}Ce.\u0275fac=function(e){return new(e||Ce)},Ce.\u0275cmp=h.Vb({type:Ce,selectors:[["vdr-fulfillment-card"]],inputs:{fulfillment:"fulfillment",order:"order"},outputs:{transitionState:"transitionState"},decls:10,vars:6,consts:[[1,"card"],[1,"card-header","fulfillment-header"],[1,"fulfillment-state"],[3,"state"],[1,"card-block"],[3,"fulfillmentId","order",4,"ngIf"],["class","card-footer",4,"ngIf"],[3,"fulfillmentId","order"],[1,"card-footer"],[4,"ngIf"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm","btn-primary",3,"click"],["type","button","vdrDropdownItem","",1,"btn",3,"click"],[4,"ngIf","ngIfElse"],["cancel",""],["shape","step-forward-2"],["shape","error-standard",1,"is-error"]],template:function(e,t){1&e&&(h.hc(0,"div",0),h.hc(1,"div",1),h.hc(2,"div"),h.Vc(3),h.sc(4,"translate"),h.gc(),h.hc(5,"div",2),h.cc(6,"vdr-fulfillment-state-label",3),h.gc(),h.gc(),h.hc(7,"div",4),h.Tc(8,ge,1,2,"vdr-fulfillment-detail",5),h.gc(),h.Tc(9,ye,7,2,"div",6),h.gc()),2&e&&(h.Qb(3),h.Wc(h.tc(4,4,"order.fulfillment")),h.Qb(3),h.yc("state",null==t.fulfillment?null:t.fulfillment.state),h.Qb(2),h.yc("ngIf",!!t.fulfillment),h.Qb(1),h.yc("ngIf",null==t.fulfillment?null:t.fulfillment.nextStates.length))},directives:[Y,I.o,le,se.a,de.a,V.o,ue.a,I.n,fe.a],pipes:[Q.d,B.a],styles:[".fulfillment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}"],changeDetection:0});var Se=function(e,t){return{total:e,count:t}};function Pe(e,t){if(1&e&&(h.hc(0,"label",12),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e){var c=h.rc(2);h.Qb(1),h.Xc(" ",h.uc(2,1,"order.line-fulfillment-partial",h.Dc(4,Se,c.line.quantity,c.fulfilledCount))," ")}}function ke(e,t){1&e&&(h.hc(0,"label",12),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.line-fulfillment-none")," "))}function Me(e,t){if(1&e&&(h.hc(0,"vdr-labeled-data",15),h.sc(1,"translate"),h.Vc(2),h.gc()),2&e){var c=h.rc().$implicit;h.yc("label",h.tc(1,2,"order.tracking-code")),h.Qb(2),h.Xc(" ",c.fulfillment.trackingCode," ")}}var Ve=function(e){return{count:e}};function xe(e,t){if(1&e&&(h.hc(0,"div",13),h.hc(1,"div",14),h.Vc(2),h.sc(3,"translate"),h.sc(4,"translate"),h.gc(),h.hc(5,"vdr-labeled-data",15),h.sc(6,"translate"),h.Vc(7),h.sc(8,"localeDate"),h.gc(),h.hc(9,"vdr-labeled-data",15),h.sc(10,"translate"),h.Vc(11),h.gc(),h.Tc(12,Me,3,4,"vdr-labeled-data",16),h.gc()),2&e){var c=t.$implicit;h.Qb(2),h.Zc(" ",h.tc(3,8,"order.fulfillment")," #",c.fulfillment.id," (",h.uc(4,10,"order.item-count",h.Cc(20,Ve,c.count)),") "),h.Qb(3),h.yc("label",h.tc(6,13,"common.created-at")),h.Qb(2),h.Xc(" ",h.uc(8,15,c.fulfillment.createdAt,"medium")," "),h.Qb(2),h.yc("label",h.tc(10,18,"order.fulfillment-method")),h.Qb(2),h.Xc(" ",c.fulfillment.method," "),h.Qb(1),h.yc("ngIf",c.fulfillment.trackingCode)}}function Fe(e,t){if(1&e&&(h.hc(0,"vdr-dropdown",1),h.hc(1,"button",2),h.Tc(2,Oe,1,0,"clr-icon",3),h.Tc(3,Qe,1,0,"clr-icon",4),h.Tc(4,Ie,1,0,"clr-icon",5),h.gc(),h.hc(5,"vdr-dropdown-menu",6),h.Tc(6,Te,3,3,"label",7),h.Tc(7,Pe,3,7,"label",7),h.Tc(8,ke,3,3,"label",7),h.Tc(9,xe,13,22,"div",8),h.gc(),h.gc()),2&e){var c=h.rc();h.Qb(2),h.yc("ngIf","full"===c.fulfillmentStatus),h.Qb(1),h.yc("ngIf","partial"===c.fulfillmentStatus),h.Qb(1),h.yc("ngIf","none"===c.fulfillmentStatus),h.Qb(2),h.yc("ngIf","full"===c.fulfillmentStatus),h.Qb(1),h.yc("ngIf","partial"===c.fulfillmentStatus),h.Qb(1),h.yc("ngIf","none"===c.fulfillmentStatus),h.Qb(1),h.yc("ngForOf",c.fulfillments)}}var we=function(){function e(){g(this,e),this.fulfilledCount=0,this.fulfillments=[]}return m(e,[{key:"ngOnChanges",value:function(e){this.line&&(this.fulfilledCount=this.getDeliveredCount(this.line),this.fulfillmentStatus=this.getFulfillmentStatus(this.fulfilledCount,this.line.items.length),this.fulfillments=this.getFulfillments(this.line))}},{key:"getDeliveredCount",value:function(e){return e.items.reduce(function(e,t){return e+(t.fulfillment?1:0)},0)}},{key:"getFulfillmentStatus",value:function(e,t){return e===t?"full":0<e&&e<t?"partial":"none"}},{key:"getFulfillments",value:function(e){var t,c={},n=l(e.items);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.fulfillment&&(void 0===c[r.fulfillment.id]?c[r.fulfillment.id]=1:c[r.fulfillment.id]++)}}catch(a){n.e(a)}finally{n.f()}var i=e.items.reduce(function(e,t){return t.fulfillment?[].concat(o(e),[t.fulfillment]):e},[]);return Object.entries(c).map(function(e){var t=s(e,2),c=t[0];return{count:t[1],fulfillment:i.find(function(e){return e.id===c})}})}}]),e}();we.\u0275fac=function(e){return new(e||we)},we.\u0275cmp=h.Vb({type:we,selectors:[["vdr-line-fulfillment"]],inputs:{line:"line",orderState:"orderState"},features:[h.Ob],decls:1,vars:1,consts:[["class","search-settings-menu",4,"ngIf"],[1,"search-settings-menu"],["type","button","vdrDropdownTrigger","",1,"icon-button"],["class","item-fulfilled","shape","check-circle",4,"ngIf"],["class","item-partially-fulfilled","shape","check-circle",4,"ngIf"],["class","item-not-fulfilled","shape","exclamation-circle",4,"ngIf"],["vdrPosition","bottom-right"],["class","dropdown-header",4,"ngIf"],["class","fulfillment-detail",4,"ngFor","ngForOf"],["shape","check-circle",1,"item-fulfilled"],["shape","check-circle",1,"item-partially-fulfilled"],["shape","exclamation-circle",1,"item-not-fulfilled"],[1,"dropdown-header"],[1,"fulfillment-detail"],[1,"fulfillment-title"],[3,"label"],[3,"label",4,"ngIf"]],template:function(e,t){1&e&&h.Tc(0,Fe,10,7,"vdr-dropdown",0),2&e&&h.yc("ngIf",t.fulfilledCount||"PartiallyDelivered"===t.orderState)},directives:[I.o,se.a,de.a,ue.a,I.n,V.o,V.u,J.a],pipes:[Q.d,ce.a],styles:[".item-fulfilled[_ngcontent-%COMP%]{color:var(--color-success-500)}.item-partially-fulfilled[_ngcontent-%COMP%]{color:var(--color-warning-500)}.item-not-fulfilled[_ngcontent-%COMP%]{color:var(--color-error-500)}.fulfillment-detail[_ngcontent-%COMP%]{margin:6px 12px}.fulfillment-detail[_ngcontent-%COMP%]:not(:last-of-type){border-bottom:1px dashed var(--color-component-border-200)}"],changeDetection:0});var _e=d("cH1L"),Le=function(e){return{count:e}};function Ae(e,t){if(1&e&&(h.hc(0,"span",1),h.sc(1,"translate"),h.cc(2,"clr-icon",2),h.gc()),2&e){var c=h.rc();h.yc("title",h.uc(1,1,"order.refunded-count",h.Cc(4,Le,c.getRefundedCount())))}}var je=function(){function e(){g(this,e)}return m(e,[{key:"getRefundedCount",value:function(){var e,t,c=null!==(t=null===(e=this.payments)||void 0===e?void 0:e.reduce(function(e,t){return[].concat(o(e),o(t.refunds))},[]))&&void 0!==t?t:[];return this.line.items.filter(function(e){if(null===e.refundId&&!e.cancelled)return!1;if(e.refundId){var t=c.find(function(t){return t.id===e.refundId});return"Failed"!==(null==t?void 0:t.state)}return!1}).length}}]),e}();function De(e,t){if(1&e&&(h.hc(0,"vdr-labeled-data",0),h.sc(1,"translate"),h.Vc(2),h.gc()),2&e){var c=h.rc();h.yc("label",h.tc(1,2,"order.note")),h.Qb(2),h.Wc(c.modification.note)}}function We(e,t){if(1&e&&(h.hc(0,"vdr-labeled-data",0),h.sc(1,"translate"),h.Vc(2),h.sc(3,"localeCurrency"),h.gc()),2&e){var c=t.$implicit,n=h.rc(),r=null;h.yc("label",h.tc(1,3,"order.surcharges")),h.Qb(2),h.Yc(" ",null==(r=n.getSurcharge(c.id))?null:r.description," ",h.uc(3,5,null==(r=n.getSurcharge(c.id))?null:r.priceWithTax,n.order.currencyCode),"")}}function Ne(e,t){if(1&e&&(h.hc(0,"vdr-labeled-data",0),h.sc(1,"translate"),h.cc(2,"vdr-simple-item-list",3),h.gc()),2&e){var c=h.rc();h.yc("label",h.tc(1,2,"order.added-items")),h.Qb(2),h.yc("items",c.getAddedItems())}}function Re(e,t){if(1&e&&(h.hc(0,"vdr-labeled-data",0),h.sc(1,"translate"),h.cc(2,"vdr-simple-item-list",3),h.gc()),2&e){var c=h.rc();h.yc("label",h.tc(1,2,"order.removed-items")),h.Qb(2),h.yc("items",c.getRemovedItems())}}je.\u0275fac=function(e){return new(e||je)},je.\u0275cmp=h.Vb({type:je,selectors:[["vdr-line-refunds"]],inputs:{line:"line",payments:"payments"},decls:1,vars:1,consts:[[3,"title",4,"ngIf"],[3,"title"],["shape","redo","dir","down",1,"is-solid"]],template:function(e,t){1&e&&h.Tc(0,Ae,3,6,"span",0),2&e&&h.yc("ngIf",t.getRefundedCount())},directives:[I.o,V.o,_e.b],pipes:[Q.d],styles:["[_nghost-%COMP%]{color:var(--color-error-500)}"],changeDetection:0});var Ee=function(){function e(){g(this,e),this.addedItems=new Map,this.removedItems=new Map}return m(e,[{key:"ngOnChanges",value:function(){var e=this.getModifiedLines(),t=e.added,c=e.removed;this.addedItems=t,this.removedItems=c}},{key:"getSurcharge",value:function(e){return this.order.surcharges.find(function(t){return t.id===e})}},{key:"getAddedItems",value:function(){return o(this.addedItems.entries()).map(function(e){var t=s(e,2),c=t[0],n=t[1];return{name:c.productVariant.name,quantity:n}})}},{key:"getRemovedItems",value:function(){return o(this.removedItems.entries()).map(function(e){var t=s(e,2),c=t[0],n=t[1];return{name:c.productVariant.name,quantity:n}})}},{key:"getModifiedLines",value:function(){var e,t,c,n=new Map,r=new Map,i=l(this.modification.orderItems||[]);try{for(i.s();!(c=i.n()).done;){var a=c.value,o=this.getOrderLineAndItem(a.id);if(o){var s=o.line;if(o.item.cancelled){var d=null!==(e=r.get(s))&&void 0!==e?e:0;r.set(s,d+1)}else{var u=null!==(t=n.get(s))&&void 0!==t?t:0;n.set(s,u+1)}}}}catch(f){i.e(f)}finally{i.f()}return{added:n,removed:r}}},{key:"getOrderLineAndItem",value:function(e){var t,c=l(this.order.lines);try{for(c.s();!(t=c.n()).done;){var n=t.value,r=n.items.find(function(t){return t.id===e});if(r)return{line:n,item:r}}}catch(i){c.e(i)}finally{c.f()}}}]),e}();Ee.\u0275fac=function(e){return new(e||Ee)},Ee.\u0275cmp=h.Vb({type:Ee,selectors:[["vdr-modification-detail"]],inputs:{order:"order",modification:"modification"},features:[h.Ob],decls:7,vars:8,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"label",4,"ngFor","ngForOf"],[3,"items"]],template:function(e,t){1&e&&(h.hc(0,"vdr-labeled-data",0),h.sc(1,"translate"),h.Vc(2),h.gc(),h.Tc(3,De,3,4,"vdr-labeled-data",1),h.Tc(4,We,4,8,"vdr-labeled-data",2),h.Tc(5,Ne,3,4,"vdr-labeled-data",1),h.Tc(6,Re,3,4,"vdr-labeled-data",1)),2&e&&(h.yc("label",h.tc(1,6,"common.ID")),h.Qb(2),h.Wc(t.modification.id),h.Qb(1),h.yc("ngIf",t.modification.note),h.Qb(1),h.yc("ngForOf",t.modification.surcharges),h.Qb(1),h.yc("ngIf",t.getAddedItems().length),h.Qb(1),h.yc("ngIf",t.getRemovedItems().length))},directives:[J.a,I.o,I.n,ee],pipes:[Q.d,T.a],styles:[""],changeDetection:0});var Xe=d("Lbhx");function $e(e,t){if(1&e&&(h.fc(0),h.cc(1,"vdr-custom-field-control",9),h.ec()),2&e){var c=t.$implicit,n=h.rc(2);h.Qb(1),h.yc("customFieldsFormGroup",n.customFieldForm)("compact",!0)("readonly",c.readonly||!n.editable)("customField",c)}}function qe(e,t){if(1&e){var c=h.ic();h.hc(0,"button",10),h.pc("click",function(){return h.Lc(c),h.rc(2).editable=!0}),h.cc(1,"clr-icon",11),h.Vc(2),h.sc(3,"translate"),h.gc()}2&e&&(h.Qb(2),h.Xc(" ",h.tc(3,1,"common.edit")," "))}function He(e,t){if(1&e){var c=h.ic();h.hc(0,"button",12),h.pc("click",function(){return h.Lc(c),h.rc(2).onUpdateClick()}),h.cc(1,"clr-icon",13),h.Vc(2),h.sc(3,"translate"),h.gc()}if(2&e){var n=h.rc(2);h.yc("disabled",n.customFieldForm.pristine||n.customFieldForm.invalid),h.Qb(2),h.Xc(" ",h.tc(3,2,"common.update")," ")}}function Ue(e,t){if(1&e&&(h.hc(0,"div",1),h.hc(1,"div",2),h.Vc(2),h.sc(3,"translate"),h.gc(),h.hc(4,"div",3),h.hc(5,"div",4),h.Tc(6,$e,2,4,"ng-container",5),h.gc(),h.gc(),h.hc(7,"div",6),h.Tc(8,qe,4,3,"button",7),h.Tc(9,He,4,4,"button",8),h.gc(),h.gc()),2&e){var c=h.rc();h.Qb(2),h.Xc(" ",h.tc(3,6,"common.custom-fields")," "),h.Qb(3),h.Tb("editable",c.editable),h.Qb(1),h.yc("ngForOf",c.customFieldsConfig),h.Qb(2),h.yc("ngIf",!c.editable),h.Qb(1),h.yc("ngIf",c.editable)}}var ze=function(){function e(t){g(this,e),this.formBuilder=t,this.customFieldsConfig=[],this.customFieldValues={},this.updateClick=new h.t,this.editable=!1}return m(e,[{key:"ngOnInit",value:function(){this.customFieldForm=this.formBuilder.group({});var e,t=l(this.customFieldsConfig);try{for(t.s();!(e=t.n()).done;){var c=e.value;this.customFieldForm.addControl(c.name,this.formBuilder.control(this.customFieldValues[c.name]))}}catch(n){t.e(n)}finally{t.f()}}},{key:"onUpdateClick",value:function(){this.updateClick.emit(this.customFieldForm.value),this.customFieldForm.markAsPristine(),this.editable=!1}}]),e}();ze.\u0275fac=function(e){return new(e||ze)(h.bc(u.e))},ze.\u0275cmp=h.Vb({type:ze,selectors:[["vdr-order-custom-fields-card"]],inputs:{customFieldsConfig:"customFieldsConfig",customFieldValues:"customFieldValues"},outputs:{updateClick:"updateClick"},decls:1,vars:1,consts:[["class","card",4,"ngIf"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"card-text","custom-field-form"],[4,"ngFor","ngForOf"],[1,"card-footer"],["class","btn btn-sm btn-secondary",3,"click",4,"ngIf"],["class","btn btn-sm btn-primary",3,"disabled","click",4,"ngIf"],["entityName","Order",3,"customFieldsFormGroup","compact","readonly","customField"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","pencil"],[1,"btn","btn-sm","btn-primary",3,"disabled","click"],["shape","check"]],template:function(e,t){1&e&&h.Tc(0,Ue,10,8,"div",0),2&e&&h.yc("ngIf",t.customFieldsConfig.length)},directives:[I.o,I.n,Xe.a,V.o],pipes:[Q.d],styles:["vdr-custom-field-control[_ngcontent-%COMP%]{margin-bottom:6px;display:block}.custom-field-form[_ngcontent-%COMP%]     .clr-control-label{color:var(--color-grey-400)}.custom-field-form.editable[_ngcontent-%COMP%]     .clr-control-label{color:inherit}"],changeDetection:0});var Be=d("78Ut"),Ge=d("XNiG"),Ye=d("EY2u"),Ze=d("LRne"),Je=d("VRyK"),Ke=d("IzEk"),et=d("JX91"),tt=d("eIep"),ct=d("lJxs"),nt=d("CqXF"),rt=d("JIr8"),it=d("zx2A"),at=function(){function e(t,c){g(this,e),this.notifier=t,this.source=c}return m(e,[{key:"call",value:function(e,t){return t.subscribe(new ot(e,this.notifier,this.source))}}]),e}(),ot=function(c){t(i,c);var r=n(i);function i(e,t,c){var n;return g(this,i),(n=r.call(this,e)).notifier=t,n.source=c,n}return m(i,[{key:"error",value:function(t){if(!this.isStopped){var c=this.errors,n=this.retries,r=this.retriesSubscription;if(n)this.errors=void 0,this.retriesSubscription=void 0;else{c=new Ge.a;try{n=(0,this.notifier)(c)}catch(o){return e(a(i.prototype),"error",this).call(this,o)}r=Object(it.c)(n,new it.a(this))}this._unsubscribeAndRecycle(),this.errors=c,this.retries=n,this.retriesSubscription=r,c.next(t)}}},{key:"_unsubscribe",value:function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0}},{key:"notifyNext",value:function(){var e=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=e,this.source.subscribe(this)}}]),i}(it.b),lt=d("3E0/");function st(e,t){1&e&&(h.Vc(0),h.sc(1,"translate")),2&e&&h.Wc(h.tc(1,1,"order.select-state"))}function dt(e,t){if(1&e&&(h.hc(0,"option",4),h.Vc(1),h.sc(2,"translate"),h.sc(3,"stateI18nToken"),h.gc()),2&e){var c=t.$implicit;h.yc("value",c),h.Qb(1),h.Xc(" ",h.tc(2,2,h.tc(3,4,c))," ")}}function ut(e,t){if(1&e){var c=h.ic();h.hc(0,"button",7),h.pc("click",function(){return h.Lc(c),h.rc(2).cancel()}),h.Vc(1),h.sc(2,"translate"),h.gc()}2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"common.cancel")," "))}var ft=function(e){return{state:e}};function gt(e,t){if(1&e){var c=h.ic();h.Tc(0,ut,3,3,"button",5),h.hc(1,"button",6),h.pc("click",function(){return h.Lc(c),h.rc().select()}),h.Vc(2),h.sc(3,"translate"),h.sc(4,"translate"),h.sc(5,"stateI18nToken"),h.gc()}if(2&e){var n=h.rc();h.yc("ngIf",n.cancellable),h.Qb(1),h.yc("disabled",!n.selectedState),h.Qb(1),h.Xc(" ",h.uc(3,3,"order.transition-to-state",h.Cc(10,ft,h.tc(4,6,h.tc(5,8,n.selectedState))))," ")}}var pt=function(){function e(){g(this,e),this.nextStates=[],this.message="",this.selectedState=""}return m(e,[{key:"select",value:function(){this.selectedState&&this.resolveWith(this.selectedState)}},{key:"cancel",value:function(){this.resolveWith()}}]),e}();pt.\u0275fac=function(e){return new(e||pt)},pt.\u0275cmp=h.Vb({type:pt,selectors:[["vdr-order-state-select-dialog"]],decls:8,vars:5,consts:[["vdrDialogTitle",""],["clrSelect","","name","state",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["vdrDialogButtons",""],[3,"value"],["type","submit","class","btn btn-secondary",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],["type","submit",1,"btn","btn-secondary",3,"click"]],template:function(e,t){1&e&&(h.Tc(0,st,2,3,"ng-template",0),h.hc(1,"p"),h.Vc(2),h.sc(3,"translate"),h.gc(),h.hc(4,"clr-select-container"),h.hc(5,"select",1),h.pc("ngModelChange",function(e){return t.selectedState=e}),h.Tc(6,dt,4,6,"option",2),h.gc(),h.gc(),h.Tc(7,gt,6,12,"ng-template",3)),2&e&&(h.Qb(2),h.Wc(h.tc(3,3,t.message)),h.Qb(3),h.yc("ngModel",t.selectedState),h.Qb(1),h.yc("ngForOf",t.nextStates))},directives:[b.a,V.B,C.a,u.A,V.A,u.p,u.s,I.n,O.a,u.u,u.D,I.o],pipes:[Q.d,B.a],styles:[""],changeDetection:0});var mt=function(){function e(t,c,n,r){g(this,e),this.dataService=t,this.modalService=c,this.notificationService=n,this.i18nService=r}return m(e,[{key:"transitionToPreModifyingState",value:function(e,t){var c=this;return this.getPreModifyingState(e).pipe(Object(tt.a)(function(n){var r={orderId:e,nextStates:t,message:c.i18nService.translate(Object(M.a)("order.unable-to-transition-to-state-try-another"),{state:n}),cancellable:!1,retry:10};return n?c.transitionToStateOrThrow(e,n).pipe(Object(rt.a)(function(e){return c.manuallyTransitionToState(r)})):c.manuallyTransitionToState(r)}))}},{key:"manuallyTransitionToState",value:function(e){var t,c=this;return this.modalService.fromComponent(pt,{locals:{nextStates:e.nextStates,cancellable:e.cancellable,message:e.message},closable:!1,size:"md"}).pipe(Object(tt.a)(function(t){if(t)return c.transitionToStateOrThrow(e.orderId,t);if(e.cancellable)return Ye.a;throw new Error("An order state must be selected")}),(t=function(t){return t.pipe(Object(lt.a)(2e3),Object(Ke.a)(e.retry))},function(e){return e.lift(new at(t,e))}))}},{key:"getPreModifyingState",value:function(e){return this.dataService.order.getOrderHistory(e,{filter:{type:{eq:p.y.ORDER_STATE_TRANSITION}},sort:{createdAt:p.L.DESC}}).mapSingle(function(e){return e.order}).pipe(Object(ct.a)(function(e){var t=null==e?void 0:e.history.items.find(function(e){return"Modifying"===e.data.to});return t?t.data.from:void 0}))}},{key:"transitionToStateOrThrow",value:function(e,t){var c=this;return this.dataService.order.transitionToState(e,t).pipe(Object(ct.a)(function(e){var t=e.transitionOrderToState;switch(null==t?void 0:t.__typename){case"Order":return null==t?void 0:t.state;case"OrderStateTransitionError":throw c.notificationService.error(null==t?void 0:t.transitionError),new Error(null==t?void 0:t.transitionError)}}))}}]),e}();mt.\u0275fac=function(e){return new(e||mt)(h.lc(p.s),h.lc(p.F),h.lc(p.G),h.lc(p.z))},mt.\u0275prov=h.Xb({token:mt,factory:mt.\u0275fac,providedIn:"root"});var ht=d("2Vo4"),bt=d("Kj3r"),vt=72;function yt(e,t){if(1&e&&(h.hc(0,"div",3),h.cc(1,"div",4),h.cc(2,"clr-icon",5),h.hc(3,"div",6),h.Vc(4),h.sc(5,"translate"),h.sc(6,"stateI18nToken"),h.gc(),h.gc()),2&e){var c=h.rc();h.Qb(4),h.Xc(" ",h.tc(5,1,h.tc(6,3,c.cancelledState))," ")}}var Ct=function(){function e(t){g(this,e),this.elementRef=t,this.active$=new ht.a(!1),this.activeTarget$=new ht.a(!1),this.isCancellable=!1,this.cancelledState="Cancelled"}return m(e,[{key:"ngOnChanges",value:function(e){this.isCancellable=!!this.node.to.find(function(e){return"Cancelled"===e.name}),e.active&&this.active$.next(this.active)}},{key:"getPos",value:function(){var e,t,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"top";this.elementRef.nativeElement.getBoundingClientRect();var n=null!==(t=null===(e=this.elementRef.nativeElement.querySelector(".node"))||void 0===e?void 0:e.getBoundingClientRect().height)&&void 0!==t?t:0;return{x:10,y:this.index*vt+("bottom"===c?n:0)}}},{key:"getStyle",value:function(){var e=this.getPos();return{"top.px":e.y,"left.px":e.x}}}]),e}();Ct.\u0275fac=function(e){return new(e||Ct)(h.bc(h.r))},Ct.\u0275cmp=h.Vb({type:Ct,selectors:[["vdr-order-process-node"]],inputs:{node:"node",index:"index",active:"active"},features:[h.Ob],decls:8,vars:15,consts:[[1,"node-wrapper",3,"ngStyle"],[1,"node"],["class","cancelled-wrapper",4,"ngIf"],[1,"cancelled-wrapper"],[1,"cancelled-edge"],["shape","dot-circle"],[1,"cancelled-node"]],template:function(e,t){1&e&&(h.hc(0,"div",0),h.sc(1,"async"),h.hc(2,"div",1),h.sc(3,"async"),h.Vc(4),h.sc(5,"translate"),h.sc(6,"stateI18nToken"),h.gc(),h.Tc(7,yt,7,5,"div",2),h.gc()),2&e&&(h.Tb("active",h.tc(1,7,t.active$)),h.yc("ngStyle",t.getStyle()),h.Qb(2),h.Tb("active-target",h.tc(3,9,t.activeTarget$)),h.Qb(2),h.Xc(" ",h.tc(5,11,h.tc(6,13,t.node.name))," "),h.Qb(3),h.yc("ngIf",t.isCancellable))},directives:[I.p,I.o,V.o],pipes:[I.b,Q.d,B.a],styles:["[_nghost-%COMP%]{display:block}.node-wrapper[_ngcontent-%COMP%]{position:absolute;z-index:1;display:flex;align-items:center}.node[_ngcontent-%COMP%]{display:inline-block;border:2px solid var(--color-component-border-200);border-radius:3px;padding:3px 6px;z-index:1;background-color:var(--color-component-bg-100);opacity:.7;transition:opacity .2s,background-color .2s,color .2s;cursor:default}.node.active-target[_ngcontent-%COMP%]{border-color:var(--color-primary-500);opacity:.9}.cancelled-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;color:var(--color-grey-300);transition:color .2s,opacity .2s;opacity:.7}.cancelled-edge[_ngcontent-%COMP%]{width:48px;height:2px;background-color:var(--color-component-bg-300);transition:background-color .2s}clr-icon[_ngcontent-%COMP%]{margin-left:-1px}.cancelled-node[_ngcontent-%COMP%]{margin-left:6px}.active[_ngcontent-%COMP%]   .cancelled-wrapper[_ngcontent-%COMP%]{opacity:1}.active[_ngcontent-%COMP%]   .node[_ngcontent-%COMP%]{opacity:1;background-color:var(--color-primary-600);border-color:var(--color-primary-600);color:var(--color-primary-100)}.active[_ngcontent-%COMP%]   .cancelled-wrapper[_ngcontent-%COMP%]{color:var(--color-error-500)}.active[_ngcontent-%COMP%]   .cancelled-edge[_ngcontent-%COMP%]{background-color:var(--color-error-500)}"],changeDetection:0});var Ot=d("vkgz"),Qt=function(){function e(){g(this,e)}return m(e,[{key:"ngOnInit",value:function(){var e=this;this.active$=this.from.active$.asObservable().pipe(Object(Ot.a)(function(t){return e.to.activeTarget$.next(t)}))}},{key:"getStyle",value:function(){var e=this.from.index<this.to.index?"down":"up",t=this.from.getPos("down"===e?"bottom":"top"),c=this.to.getPos("down"===e?"top":"bottom"),n=Math.abs(t.x-c.x),r=Math.abs(t.y-c.y),i=Math.sqrt(Math.pow(n,2)+Math.pow(r,2));return Object.assign({"top.px":t.y,"left.px":t.x+("down"===e?10:40)+12*this.index,"height.px":i,"width.px":1},"up"===e?{transform:"rotateZ(180deg)","transform-origin":"top"}:{})}}]),e}();function It(e,t){if(1&e){var c=h.ic();h.fc(0),h.hc(1,"vdr-order-process-node",1),h.pc("mouseenter",function(){h.Lc(c);var e=t.$implicit;return h.rc().onMouseOver(e.name)})("mouseleave",function(){return h.Lc(c),h.rc().onMouseOut()}),h.sc(2,"async"),h.gc(),h.ec()}if(2&e){var n=t.$implicit,r=t.index,i=h.rc();h.Qb(1),h.yc("node",n)("index",r)("active",h.tc(2,3,i.activeState$)===n.name)}}function Tt(e,t){if(1&e&&(h.fc(0),h.cc(1,"vdr-order-process-edge",2),h.ec()),2&e){var c=t.$implicit;h.Qb(1),h.yc("from",c.from)("to",c.to)("index",c.index)}}Qt.\u0275fac=function(e){return new(e||Qt)},Qt.\u0275cmp=h.Vb({type:Qt,selectors:[["vdr-order-process-edge"]],inputs:{from:"from",to:"to",index:"index"},decls:3,vars:7,consts:[[1,"edge",3,"ngStyle"],["shape","arrow","flip","vertical",1,"arrow"]],template:function(e,t){1&e&&(h.hc(0,"div",0),h.sc(1,"async"),h.cc(2,"clr-icon",1),h.gc()),2&e&&(h.Tb("active",h.tc(1,5,t.active$)),h.yc("ngStyle",t.getStyle()),h.Rb("data-from",t.from.node.name)("data-to",t.to.node.name))},directives:[I.p,V.o],pipes:[I.b],styles:[".edge[_ngcontent-%COMP%]{position:absolute;border:1px solid var(--color-component-border-200);background-color:var(--color-component-bg-300);opacity:.3;transition:border .2s,opacity .2s,background-color .2s}.edge.active[_ngcontent-%COMP%]{border-color:var(--color-primary-500);background-color:var(--color-primary-500);opacity:1}.edge.active[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{color:var(--color-primary-500)}.edge[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{position:absolute;bottom:-4px;left:-8px;color:var(--color-grey-300)}"],changeDetection:0});var St=function(){function e(t){g(this,e),this.changeDetector=t,this.setActiveState$=new ht.a(void 0),this.nodes=[],this.edges=[]}return m(e,[{key:"outerHeight",get:function(){return this.nodes.length*vt}},{key:"ngOnInit",value:function(){this.setActiveState$.next(this.initialState),this.activeState$=this.setActiveState$.pipe(Object(bt.a)(150))}},{key:"ngOnChanges",value:function(e){this.populateNodes()}},{key:"ngAfterViewInit",value:function(){var e=this;setTimeout(function(){return e.populateEdges()})}},{key:"onMouseOver",value:function(e){this.setActiveState$.next(e)}},{key:"onMouseOut",value:function(){this.setActiveState$.next(this.initialState)}},{key:"getNodeFor",value:function(e){if(this.nodeComponents)return this.nodeComponents.find(function(t){return t.node.name===e})}},{key:"populateNodes",value:function(){var e,t,c,n=this,r=new Map,i=l(this.states);try{for(i.s();!(c=i.n()).done;){var a=c.value;r.set(a.name,{name:a.name,to:[]})}}catch(g){i.e(g)}finally{i.f()}var d,u=l(r.entries());try{var f=function(){var c,i=s(d.value,2),a=i[0],o=i[1],u=l(null!==(t=null===(e=n.states.find(function(e){return e.name===a}))||void 0===e?void 0:e.to)&&void 0!==t?t:[]);try{for(u.s();!(c=u.n()).done;){var f=c.value,p=r.get(f);p&&o.to.push(p)}}catch(g){u.e(g)}finally{u.f()}};for(u.s();!(d=u.n()).done;)f()}catch(g){u.e(g)}finally{u.f()}this.nodes=o(r.values()).filter(function(e){return"Cancelled"!==e.name})}},{key:"populateEdges",value:function(){var e,t=l(this.nodes);try{for(t.s();!(e=t.n()).done;){var c,n=e.value,r=this.getNodeFor(n.name),i=0,a=l(n.to);try{for(a.s();!(c=a.n()).done;){var s=c.value,d=this.getNodeFor(s.name);r&&d&&r!==d&&(this.edges.push({to:d,from:r,index:i}),i++)}}catch(u){a.e(u)}finally{a.f()}}}catch(u){t.e(u)}finally{t.f()}this.edges=o(this.edges),this.changeDetector.markForCheck()}}]),e}();function Pt(e,t){1&e&&(h.Vc(0),h.sc(1,"translate")),2&e&&h.Wc(h.tc(1,1,"order.order-state-diagram"))}St.\u0275fac=function(e){return new(e||St)(h.bc(h.j))},St.\u0275cmp=h.Vb({type:St,selectors:[["vdr-order-process-graph"]],viewQuery:function(e,t){var c;(1&e&&h.ad(Ct,1),2&e)&&(h.Hc(c=h.qc())&&(t.nodeComponents=c))},hostVars:2,hostBindings:function(e,t){2&e&&h.Qc("height",t.outerHeight,"px")},inputs:{states:"states",initialState:"initialState"},features:[h.Ob],decls:2,vars:2,consts:[[4,"ngFor","ngForOf"],[3,"node","index","active","mouseenter","mouseleave"],[3,"from","to","index"]],template:function(e,t){1&e&&(h.Tc(0,It,3,5,"ng-container",0),h.Tc(1,Tt,2,3,"ng-container",0)),2&e&&(h.yc("ngForOf",t.nodes),h.Qb(1),h.yc("ngForOf",t.edges))},directives:[I.n,Ct,Qt],pipes:[I.b],styles:["[_nghost-%COMP%]{display:block;border:1px #ff69b4;margin:20px;padding:12px;position:relative}.state-row[_ngcontent-%COMP%]{display:flex}"],changeDetection:0});var kt=function(){function e(t){g(this,e),this.serverConfigService=t,this.states=[]}return m(e,[{key:"ngOnInit",value:function(){this.states=this.serverConfigService.getOrderProcessStates()}}]),e}();kt.\u0275fac=function(e){return new(e||kt)(h.bc(p.I))},kt.\u0275cmp=h.Vb({type:kt,selectors:[["vdr-order-process-graph-dialog"]],decls:2,vars:2,consts:[["vdrDialogTitle",""],[3,"states","initialState"]],template:function(e,t){1&e&&(h.Tc(0,Pt,2,3,"ng-template",0),h.cc(1,"vdr-order-process-graph",1)),2&e&&(h.Qb(1),h.yc("states",t.states)("initialState",t.activeState))},directives:[b.a,St],pipes:[Q.d],styles:[""],changeDetection:0});var Mt=d("hmHg");function Vt(e,t){1&e&&(h.Vc(0),h.sc(1,"translate")),2&e&&h.Wc(h.tc(1,1,"order.refund-and-cancel-order"))}function xt(e,t){if(1&e&&(h.hc(0,"div",36),h.Vc(1),h.hc(2,"div",37),h.Vc(3),h.sc(4,"currency"),h.sc(5,"number"),h.gc(),h.gc()),2&e){var c=t.$implicit,n=h.rc(3).$implicit,r=h.rc();h.Qb(1),h.Xc(" ",c.description," "),h.Qb(2),h.Xc(" ",h.uc(4,2,h.uc(5,5,c.amount/100/n.quantity,"1.0-2"),r.order.currencyCode)," ")}}function Ft(e,t){if(1&e&&(h.hc(0,"vdr-dropdown"),h.hc(1,"div",32),h.hc(2,"button",33),h.cc(3,"clr-icon",34),h.gc(),h.gc(),h.hc(4,"vdr-dropdown-menu"),h.Tc(5,xt,6,8,"div",35),h.gc(),h.gc()),2&e){var c=h.rc().ngIf;h.Qb(5),h.yc("ngForOf",c)}}function wt(e,t){if(1&e&&(h.fc(0),h.Tc(1,Ft,6,1,"vdr-dropdown",26),h.ec()),2&e){var c=t.ngIf;h.Qb(1),h.yc("ngIf",c.length)}}function _t(e,t){if(1&e){var c=h.ic();h.hc(0,"input",38),h.pc("ngModelChange",function(e){h.Lc(c);var t=h.rc().$implicit;return h.rc().lineQuantities[t.id].quantity=e})("input",function(){h.Lc(c);var e=h.rc().$implicit,t=h.rc();return t.handleZeroQuantity(t.lineQuantities[e.id])}),h.gc()}if(2&e){var n=h.rc().$implicit,r=h.rc();h.yc("ngModel",r.lineQuantities[n.id].quantity)("max",n.quantity)}}function Lt(e,t){if(1&e){var c=h.ic();h.hc(0,"input",39),h.pc("ngModelChange",function(e){h.Lc(c);var t=h.rc().$implicit;return h.rc().lineQuantities[t.id].refund=e}),h.gc()}if(2&e){var n=h.rc().$implicit,r=h.rc();h.yc("disabled",0===r.lineQuantities[n.id].quantity)("ngModel",r.lineQuantities[n.id].refund)}}function At(e,t){if(1&e){var c=h.ic();h.hc(0,"input",39),h.pc("ngModelChange",function(e){h.Lc(c);var t=h.rc().$implicit;return h.rc().lineQuantities[t.id].cancel=e}),h.gc()}if(2&e){var n=h.rc().$implicit,r=h.rc();h.yc("disabled",0===r.lineQuantities[n.id].quantity)("ngModel",r.lineQuantities[n.id].cancel)}}function jt(e,t){if(1&e&&(h.hc(0,"tr",18),h.hc(1,"td",19),h.cc(2,"img",20),h.sc(3,"assetPreview"),h.gc(),h.hc(4,"td",21),h.Vc(5),h.gc(),h.hc(6,"td",22),h.Vc(7),h.gc(),h.hc(8,"td",23),h.Vc(9),h.cc(10,"vdr-line-refunds",24),h.gc(),h.hc(11,"td",23),h.Vc(12),h.sc(13,"localeCurrency"),h.gc(),h.hc(14,"td",23),h.hc(15,"div",25),h.Vc(16),h.sc(17,"localeCurrency"),h.Tc(18,wt,2,1,"ng-container",26),h.gc(),h.gc(),h.hc(19,"td",27),h.Tc(20,_t,1,2,"input",28),h.gc(),h.hc(21,"td",29),h.hc(22,"div",30),h.Tc(23,Lt,1,2,"input",31),h.gc(),h.gc(),h.hc(24,"td",29),h.hc(25,"div",30),h.Tc(26,At,1,2,"input",31),h.gc(),h.gc(),h.gc()),2&e){var c=t.$implicit,n=h.rc();h.Qb(2),h.yc("src",h.uc(3,12,c.featuredAsset,"tiny"),h.Nc),h.Qb(3),h.Wc(c.productVariant.name),h.Qb(2),h.Wc(c.productVariant.sku),h.Qb(2),h.Xc(" ",c.quantity," "),h.Qb(1),h.yc("line",c)("payments",n.order.payments),h.Qb(2),h.Xc(" ",h.uc(13,15,c.unitPriceWithTax,n.order.currencyCode)," "),h.Qb(4),h.Xc(" ",h.uc(17,18,c.proratedUnitPriceWithTax,n.order.currencyCode)," "),h.Qb(2),h.yc("ngIf",c.discounts),h.Qb(2),h.yc("ngIf",n.lineCanBeRefundedOrCancelled(c)),h.Qb(3),h.yc("ngIf",n.lineCanBeRefundedOrCancelled(c)),h.Qb(3),h.yc("ngIf",n.lineCanBeRefundedOrCancelled(c))}}function Dt(e,t){if(1&e&&(h.hc(0,"option",40),h.Vc(1),h.sc(2,"localeCurrency"),h.gc()),2&e){var c=t.$implicit,n=h.rc();h.yc("ngValue",c)("disabled","Settled"!==c.state),h.Qb(1),h.Zc(" #",c.id," ",c.method,": ",h.uc(2,5,c.amount,n.order.currencyCode)," ")}}var Wt=function(e,t){return{min:e,max:t}};function Nt(e,t){if(1&e&&(h.hc(0,"div",41),h.Vc(1),h.sc(2,"translate"),h.sc(3,"currency"),h.sc(4,"localeCurrency"),h.gc()),2&e){var c=h.rc();h.Qb(1),h.Xc(" ",h.uc(2,1,"order.refund-total-error",h.Dc(10,Wt,h.uc(3,4,0,c.order.currencyCode),h.uc(4,7,c.settledPaymentsTotal,c.order.currencyCode)))," ")}}function Rt(e,t){1&e&&(h.hc(0,"div",42),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.refund-total-warning")," "))}var Et=function(e){return{amount:e}};function Xt(e,t){if(1&e&&(h.fc(0),h.Vc(1),h.sc(2,"translate"),h.sc(3,"localeCurrency"),h.ec()),2&e){var c=h.rc(2);h.Qb(1),h.Xc(" ",h.uc(2,1,"order.refund-with-amount",h.Cc(7,Et,h.uc(3,4,c.refundTotal,c.order.currencyCode)))," ")}}function $t(e,t){1&e&&(h.Vc(0),h.sc(1,"translate")),2&e&&h.Xc(" ",h.tc(1,1,"order.cancel-selected-items")," ")}function qt(e,t){if(1&e){var c=h.ic();h.hc(0,"button",43),h.pc("click",function(){return h.Lc(c),h.rc().cancel()}),h.Vc(1),h.sc(2,"translate"),h.gc(),h.hc(3,"button",44),h.pc("click",function(){return h.Lc(c),h.rc().select()}),h.Tc(4,Xt,4,9,"ng-container",45),h.Tc(5,$t,2,3,"ng-template",null,46,h.Uc),h.gc()}if(2&e){var n=h.Ic(6),r=h.rc();h.Qb(1),h.Wc(h.tc(2,4,"common.cancel")),h.Qb(2),h.yc("disabled",!r.canSubmit()),h.Qb(1),h.yc("ngIf",r.isRefunding())("ngIfElse",n)}}var Ht=function(){function e(t){var c=this;g(this,e),this.i18nService=t,this.lineQuantities={},this.refundShipping=!1,this.adjustment=0,this.reasons=[Object(M.a)("order.refund-reason-customer-request"),Object(M.a)("order.refund-reason-not-available")],this.reasons=this.reasons.map(function(e){return c.i18nService.translate(e)})}return m(e,[{key:"refundTotal",get:function(){var e=this;return this.order.lines.reduce(function(t,c){var n=e.lineQuantities[c.id],r=n.refund&&n.quantity||0;return t+c.proratedUnitPriceWithTax*r},0)+(this.refundShipping?this.order.shippingWithTax:0)+this.adjustment}},{key:"settledPaymentsTotal",get:function(){return this.settledPayments.map(function(e){return e.amount-Object(Z.summate)(e.refunds.filter(function(e){return"Failed"!==e.state}),"total")}).reduce(function(e,t){return e+t},0)}},{key:"lineCanBeRefundedOrCancelled",value:function(e){var t,c,n=null!==(c=null===(t=this.order.payments)||void 0===t?void 0:t.reduce(function(e,t){return[].concat(o(e),o(t.refunds))},[]))&&void 0!==c?c:[];return 0<e.items.filter(function(e){if(e.cancelled)return!1;if(null==e.refundId)return!0;var t=n.find(function(t){return t.id===e.refundId});return"Failed"===(null==t?void 0:t.state)}).length}},{key:"ngOnInit",value:function(){this.lineQuantities=this.order.lines.reduce(function(e,t){return Object.assign(Object.assign({},e),f({},t.id,{quantity:0,refund:!1,cancel:!1}))},{}),this.settledPayments=(this.order.payments||[]).filter(function(e){return"Settled"===e.state}),this.settledPayments.length&&(this.selectedPayment=this.settledPayments[0])}},{key:"handleZeroQuantity",value:function(e){0===(null==e?void 0:e.quantity)&&(e.cancel=!1,e.refund=!1)}},{key:"isRefunding",value:function(){return Object.values(this.lineQuantities).reduce(function(e,t){return e||0<t.quantity&&t.refund},!1)}},{key:"isCancelling",value:function(){return Object.values(this.lineQuantities).reduce(function(e,t){return e||0<t.quantity&&t.cancel},!1)}},{key:"canSubmit",value:function(){return this.isRefunding()?!!(this.selectedPayment&&this.reason&&0<this.refundTotal&&this.refundTotal<=this.settledPaymentsTotal):!!this.isCancelling()&&!!this.reason}},{key:"select",value:function(){var e=this.selectedPayment;if(e){var t=this.getOrderLineInput(function(e){return e.refund}),c=this.getOrderLineInput(function(e){return e.cancel});this.resolveWith({refund:{lines:t,reason:this.reason,shipping:this.refundShipping?this.order.shipping:0,adjustment:this.adjustment,paymentId:e.id},cancel:{lines:c,orderId:this.order.id,reason:this.reason}})}}},{key:"cancel",value:function(){this.resolveWith()}},{key:"getOrderLineInput",value:function(e){return Object.entries(this.lineQuantities).filter(function(t){var c=s(t,2),n=(c[0],c[1]);return 0<n.quantity&&e(n)}).map(function(e){var t=s(e,2);return{orderLineId:t[0],quantity:t[1].quantity}})}}]),e}();function Ut(e,t){1&e&&(h.Vc(0),h.sc(1,"translate")),2&e&&h.Wc(h.tc(1,1,"order.settle-refund"))}function zt(e,t){if(1&e){var c=h.ic();h.hc(0,"button",4),h.pc("click",function(){return h.Lc(c),h.rc().cancel()}),h.Vc(1),h.sc(2,"translate"),h.gc(),h.hc(3,"button",5),h.pc("click",function(){return h.Lc(c),h.rc().submit()}),h.Vc(4),h.sc(5,"translate"),h.gc()}if(2&e){var n=h.rc();h.Qb(1),h.Wc(h.tc(2,3,"common.cancel")),h.Qb(2),h.yc("disabled",!n.transactionId),h.Qb(1),h.Xc(" ",h.tc(5,5,"order.settle-refund")," ")}}Ht.\u0275fac=function(e){return new(e||Ht)(h.bc(p.z))},Ht.\u0275cmp=h.Vb({type:Ht,selectors:[["vdr-refund-order-dialog"]],decls:69,vars:74,consts:[["vdrDialogTitle",""],[1,"refund-wrapper"],[1,"order-table"],[1,"table"],["class","order-line",4,"ngFor","ngForOf"],[1,"refund-details","mt4"],[1,"clr-control-label"],["bindLabel","name","autofocus","","bindValue","id",3,"disabled","items","placeholder","addTag","ngModel","ngModelChange"],["clrSelect","","name","options",3,"ngModel","disabled","ngModelChange"],[3,"ngValue","disabled",4,"ngFor","ngForOf"],["type","checkbox","clrCheckbox","",3,"ngModel","disabled","ngModelChange"],["clrInput","",3,"disabled","currencyCode","ngModel","ngModelChange"],[1,"totals"],[1,"order-total"],[1,"refund-total"],["class","refund-total-error",4,"ngIf"],["class","refund-total-warning",4,"ngIf"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[3,"line","payments"],[1,"prorated-wrapper"],[4,"ngIf"],[1,"align-middle","fulfil"],["type","number","min","0",3,"ngModel","max","ngModelChange","input",4,"ngIf"],[1,"align-middle"],[1,"cancel-checkbox-wrapper"],["type","checkbox","clrCheckbox","",3,"disabled","ngModel","ngModelChange",4,"ngIf"],["vdrDropdownTrigger","",1,"promotions-label"],[1,"icon-button"],["shape","info"],["class","line-promotion",4,"ngFor","ngForOf"],[1,"line-promotion"],[1,"promotion-amount"],["type","number","min","0",3,"ngModel","max","ngModelChange","input"],["type","checkbox","clrCheckbox","",3,"disabled","ngModel","ngModelChange"],[3,"ngValue","disabled"],[1,"refund-total-error"],[1,"refund-total-warning"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf","ngIfElse"],["cancelling",""]],template:function(e,t){1&e&&(h.Tc(0,Vt,2,3,"ng-template",0),h.hc(1,"div",1),h.hc(2,"div",2),h.hc(3,"table",3),h.hc(4,"thead"),h.hc(5,"tr"),h.cc(6,"th"),h.hc(7,"th"),h.Vc(8),h.sc(9,"translate"),h.gc(),h.hc(10,"th"),h.Vc(11),h.sc(12,"translate"),h.gc(),h.hc(13,"th"),h.Vc(14),h.sc(15,"translate"),h.gc(),h.hc(16,"th"),h.Vc(17),h.sc(18,"translate"),h.gc(),h.hc(19,"th"),h.Vc(20),h.sc(21,"translate"),h.gc(),h.hc(22,"th"),h.Vc(23),h.sc(24,"translate"),h.gc(),h.hc(25,"th"),h.Vc(26),h.sc(27,"translate"),h.gc(),h.hc(28,"th"),h.Vc(29),h.sc(30,"translate"),h.gc(),h.gc(),h.gc(),h.Tc(31,jt,27,21,"tr",4),h.gc(),h.gc(),h.hc(32,"div",5),h.hc(33,"div"),h.hc(34,"label",6),h.Vc(35),h.sc(36,"translate"),h.gc(),h.hc(37,"ng-select",7),h.pc("ngModelChange",function(e){return t.reason=e}),h.sc(38,"translate"),h.gc(),h.gc(),h.hc(39,"div"),h.hc(40,"clr-select-container"),h.hc(41,"label"),h.Vc(42),h.sc(43,"translate"),h.gc(),h.hc(44,"select",8),h.pc("ngModelChange",function(e){return t.selectedPayment=e}),h.Tc(45,Dt,3,8,"option",9),h.gc(),h.gc(),h.hc(46,"clr-checkbox-wrapper"),h.hc(47,"input",10),h.pc("ngModelChange",function(e){return t.refundShipping=e}),h.gc(),h.hc(48,"label"),h.Vc(49),h.sc(50,"translate"),h.sc(51,"localeCurrency"),h.gc(),h.gc(),h.hc(52,"clr-input-container"),h.hc(53,"label"),h.Vc(54),h.sc(55,"translate"),h.gc(),h.hc(56,"vdr-currency-input",11),h.pc("ngModelChange",function(e){return t.adjustment=e}),h.gc(),h.gc(),h.hc(57,"div",12),h.hc(58,"div",13),h.Vc(59),h.sc(60,"translate"),h.sc(61,"localeCurrency"),h.gc(),h.hc(62,"div",14),h.Vc(63),h.sc(64,"translate"),h.sc(65,"localeCurrency"),h.gc(),h.Tc(66,Nt,5,13,"div",15),h.Tc(67,Rt,3,3,"div",16),h.gc(),h.gc(),h.gc(),h.gc(),h.Tc(68,qt,7,6,"ng-template",17)),2&e&&(h.Qb(8),h.Wc(h.tc(9,35,"order.product-name")),h.Qb(3),h.Wc(h.tc(12,37,"order.product-sku")),h.Qb(3),h.Wc(h.tc(15,39,"order.quantity")),h.Qb(3),h.Wc(h.tc(18,41,"order.unit-price")),h.Qb(3),h.Wc(h.tc(21,43,"order.prorated-unit-price")),h.Qb(3),h.Wc(h.tc(24,45,"order.quantity")),h.Qb(3),h.Wc(h.tc(27,47,"order.refund")),h.Qb(3),h.Wc(h.tc(30,49,"order.cancel")),h.Qb(2),h.yc("ngForOf",t.order.lines),h.Qb(4),h.Wc(h.tc(36,51,"order.refund-cancellation-reason")),h.Qb(2),h.yc("disabled",!t.isRefunding()&&!t.isCancelling())("items",t.reasons)("placeholder",h.tc(38,53,"order.refund-cancellation-reason-required"))("addTag",!0)("ngModel",t.reason),h.Qb(5),h.Wc(h.tc(43,55,"order.payment-to-refund")),h.Qb(2),h.yc("ngModel",t.selectedPayment)("disabled",!t.isRefunding()),h.Qb(1),h.yc("ngForOf",t.settledPayments),h.Qb(2),h.yc("ngModel",t.refundShipping)("disabled",!t.isRefunding()),h.Qb(2),h.Yc(" ",h.tc(50,57,"order.refund-shipping")," (",h.uc(51,59,t.order.shipping,t.order.currencyCode),") "),h.Qb(5),h.Wc(h.tc(55,62,"order.refund-adjustment")),h.Qb(2),h.yc("disabled",!t.isRefunding())("currencyCode",t.order.currencyCode)("ngModel",t.adjustment),h.Qb(1),h.Tb("disabled",!t.isRefunding()),h.Qb(2),h.Yc(" ",h.tc(60,64,"order.payment-amount"),": ",h.uc(61,66,t.selectedPayment.amount,t.order.currencyCode)," "),h.Qb(4),h.Yc(" ",h.tc(64,69,"order.refund-total"),": ",h.uc(65,71,t.refundTotal,t.order.currencyCode)," "),h.Qb(3),h.yc("ngIf",t.refundTotal<0||t.settledPaymentsTotal<t.refundTotal),h.Qb(1),h.yc("ngIf",t.selectedPayment.amount<t.refundTotal))},directives:[b.a,I.n,V.u,y.a,u.p,u.s,V.B,C.a,u.A,V.A,V.k,u.a,V.i,V.t,Mt.a,V.s,I.o,O.a,je,se.a,de.a,V.o,ue.a,u.v,u.b,u.u,u.D],pipes:[Q.d,T.a,x.a,I.d,I.f],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}.refund-wrapper[_ngcontent-%COMP%]{flex:1;flex-direction:column}.refund-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.refund-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.refund-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}.cancel-checkbox-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}clr-checkbox-wrapper[_ngcontent-%COMP%]{margin-top:12px;margin-bottom:12px;display:block}.refund-details[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.totals[_ngcontent-%COMP%]{margin-top:48px}.totals[_ngcontent-%COMP%]   .refund-total[_ngcontent-%COMP%]{font-size:18px}.totals[_ngcontent-%COMP%]   .refund-total-error[_ngcontent-%COMP%]{color:var(--color-error-500)}.totals[_ngcontent-%COMP%]   .refund-total-warning[_ngcontent-%COMP%]{color:var(--color-warning-600);max-width:250px}.totals.disabled[_ngcontent-%COMP%]{color:var(--color-grey-300)}.prorated-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center}.line-promotion[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:12px;padding:3px 6px}.line-promotion[_ngcontent-%COMP%]   .promotion-amount[_ngcontent-%COMP%]{margin-left:12px}"],changeDetection:0});var Bt=function(e){return{method:e}},Gt=function(){function e(){g(this,e),this.transactionId=""}return m(e,[{key:"submit",value:function(){this.resolveWith(this.transactionId)}},{key:"cancel",value:function(){this.resolveWith()}}]),e}();Gt.\u0275fac=function(e){return new(e||Gt)},Gt.\u0275cmp=h.Vb({type:Gt,selectors:[["vdr-settle-refund-dialog"]],decls:10,vars:10,consts:[["vdrDialogTitle",""],[1,"instruction"],["clrInput","","name","transactionId",3,"ngModel","ngModelChange"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(h.Tc(0,Ut,2,3,"ng-template",0),h.hc(1,"p",1),h.Vc(2),h.sc(3,"translate"),h.gc(),h.hc(4,"clr-input-container"),h.hc(5,"label"),h.Vc(6),h.sc(7,"translate"),h.gc(),h.hc(8,"input",2),h.pc("ngModelChange",function(e){return t.transactionId=e}),h.gc(),h.gc(),h.Tc(9,zt,6,7,"ng-template",3)),2&e&&(h.Qb(2),h.Xc(" ",h.uc(3,3,"order.settle-refund-manual-instructions",h.Cc(8,Bt,t.refund.method)),"\n"),h.Qb(4),h.Wc(h.tc(7,6,"order.transaction-id")),h.Qb(2),h.yc("ngModel",t.transactionId))},directives:[b.a,V.t,V.u,C.a,u.b,V.s,u.p,u.s,O.a],pipes:[Q.d],styles:["[_nghost-%COMP%]{padding-bottom:32px}.instruction[_ngcontent-%COMP%]{margin-top:0;margin-bottom:24px}"],changeDetection:0});var Yt=d("tyNb"),Zt=d("uEVm"),Jt=d("iszU"),Kt=d("R2pz"),ec=d("nqNv"),tc=d("t4Ah");function cc(e,t){if(1&e&&(h.cc(0,"img",23),h.sc(1,"assetPreview")),2&e){var c=h.rc().$implicit;h.yc("src",h.uc(1,1,c.featuredAsset,"tiny"),h.Nc)}}function nc(e,t){if(1&e&&(h.hc(0,"div",26),h.hc(1,"a",27),h.Vc(2),h.gc(),h.hc(3,"div",28),h.Vc(4),h.sc(5,"localeCurrency"),h.hc(6,"div",8),h.sc(7,"translate"),h.Vc(8),h.sc(9,"localeCurrency"),h.gc(),h.gc(),h.gc()),2&e){var c=t.$implicit,n=h.rc(4);h.Qb(1),h.yc("routerLink",n.getPromotionLink(c)),h.Qb(1),h.Wc(c.description),h.Qb(2),h.Xc(" ",h.uc(5,5,c.amountWithTax,n.order.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(7,8,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(9,10,c.amount,n.order.currencyCode)," ")}}function rc(e,t){if(1&e&&(h.hc(0,"vdr-dropdown"),h.hc(1,"div",24),h.Vc(2),h.sc(3,"translate"),h.gc(),h.hc(4,"vdr-dropdown-menu"),h.Tc(5,nc,10,13,"div",25),h.gc(),h.gc()),2&e){var c=h.rc().ngIf;h.Qb(2),h.Xc(" ",h.tc(3,2,"order.promotions-applied")," "),h.Qb(3),h.yc("ngForOf",c)}}function ic(e,t){if(1&e&&(h.fc(0),h.Tc(1,rc,6,4,"vdr-dropdown",22),h.ec()),2&e){var c=t.ngIf;h.Qb(1),h.yc("ngIf",c.length)}}function ac(e,t){if(1&e&&(h.hc(0,"span",37),h.Vc(1),h.gc()),2&e){var c=h.rc().$implicit;h.yc("title",c.value),h.Qb(1),h.Wc(c.value)}}function oc(e,t){1&e&&h.cc(0,"clr-icon",39)}function lc(e,t){1&e&&h.cc(0,"clr-icon",40)}function sc(e,t){if(1&e&&(h.Tc(0,oc,1,0,"ng-template",38),h.Tc(1,lc,1,0,"ng-template",38)),2&e){var c=h.rc().$implicit;h.yc("ngIf",!0===c.value),h.Qb(1),h.yc("ngIf",!1===c.value)}}function dc(e,t){if(1&e&&h.Vc(0),2&e){var c=h.rc().$implicit;h.Xc(" ",c.value," ")}}function uc(e,t){if(1&e&&(h.hc(0,"div",32),h.hc(1,"vdr-labeled-data",33),h.sc(2,"customFieldLabel"),h.hc(3,"div",34),h.Tc(4,ac,2,2,"ng-template",35),h.Tc(5,sc,2,2,"ng-template",35),h.Tc(6,dc,1,1,"ng-template",36),h.gc(),h.gc(),h.gc()),2&e){var c=t.$implicit;h.Qb(1),h.yc("label",h.tc(2,4,c.config)),h.Qb(2),h.yc("ngSwitch",c.config.type),h.Qb(1),h.yc("ngSwitchCase","datetime"),h.Qb(1),h.yc("ngSwitchCase","boolean")}}function fc(e,t){if(1&e&&(h.hc(0,"tr"),h.hc(1,"td",29),h.hc(2,"div",30),h.Tc(3,uc,7,6,"div",31),h.gc(),h.gc(),h.gc()),2&e){var c=h.rc().ngIf;h.Qb(3),h.yc("ngForOf",c)}}function gc(e,t){if(1&e&&(h.fc(0),h.Tc(1,fc,4,1,"tr",22),h.ec()),2&e){var c=t.ngIf;h.Qb(1),h.yc("ngIf",c.length)}}function pc(e,t){if(1&e&&(h.fc(0),h.hc(1,"tr",12),h.hc(2,"td",13),h.Tc(3,cc,2,4,"img",14),h.gc(),h.hc(4,"td",15),h.Vc(5),h.gc(),h.hc(6,"td",16),h.Vc(7),h.gc(),h.hc(8,"td",17),h.Vc(9),h.sc(10,"localeCurrency"),h.hc(11,"div",8),h.sc(12,"translate"),h.Vc(13),h.sc(14,"localeCurrency"),h.gc(),h.gc(),h.hc(15,"td",18),h.Vc(16),h.cc(17,"vdr-line-refunds",19),h.cc(18,"vdr-line-fulfillment",20),h.gc(),h.hc(19,"td",21),h.Vc(20),h.sc(21,"localeCurrency"),h.hc(22,"div",8),h.sc(23,"translate"),h.Vc(24),h.sc(25,"localeCurrency"),h.gc(),h.Tc(26,ic,2,1,"ng-container",22),h.gc(),h.gc(),h.Tc(27,gc,2,1,"ng-container",22),h.ec()),2&e){var c=t.$implicit,n=h.rc();h.Qb(1),h.Tb("is-cancelled",0===c.quantity),h.Qb(2),h.yc("ngIf",c.featuredAsset),h.Qb(2),h.Wc(c.productVariant.name),h.Qb(2),h.Wc(c.productVariant.sku),h.Qb(2),h.Xc(" ",h.uc(10,18,c.unitPriceWithTax,n.order.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(12,21,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(14,23,c.unitPrice,n.order.currencyCode)," "),h.Qb(3),h.Xc(" ",c.quantity," "),h.Qb(1),h.yc("line",c)("payments",n.order.payments),h.Qb(1),h.yc("line",c)("orderState",n.order.state),h.Qb(2),h.Xc(" ",h.uc(21,26,c.linePriceWithTax,n.order.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(23,29,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(25,31,c.linePrice,n.order.currencyCode)," "),h.Qb(2),h.yc("ngIf",n.getLineDiscounts(c)),h.Qb(1),h.yc("ngIf",n.getLineCustomFields(c))}}function mc(e,t){if(1&e&&(h.hc(0,"tr",41),h.hc(1,"td",42),h.Vc(2),h.gc(),h.hc(3,"td",16),h.Vc(4),h.gc(),h.cc(5,"td",43),h.hc(6,"td",21),h.Vc(7),h.sc(8,"localeCurrency"),h.hc(9,"div",8),h.sc(10,"translate"),h.Vc(11),h.sc(12,"localeCurrency"),h.gc(),h.gc(),h.gc()),2&e){var c=t.$implicit,n=h.rc();h.Qb(2),h.Wc(c.description),h.Qb(2),h.Wc(c.sku),h.Qb(3),h.Xc(" ",h.uc(8,5,c.priceWithTax,n.order.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(10,8,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(12,10,c.price,n.order.currencyCode)," ")}}function hc(e,t){if(1&e&&(h.hc(0,"vdr-chip"),h.Vc(1),h.gc()),2&e){var c=t.ngIf;h.Qb(1),h.Wc(c)}}function bc(e,t){if(1&e&&(h.hc(0,"tr",44),h.hc(1,"td",45),h.hc(2,"a",46),h.Vc(3),h.gc(),h.Tc(4,hc,2,1,"vdr-chip",22),h.gc(),h.hc(5,"td",7),h.Vc(6),h.sc(7,"localeCurrency"),h.hc(8,"div",8),h.sc(9,"translate"),h.Vc(10),h.sc(11,"localeCurrency"),h.gc(),h.gc(),h.gc()),2&e){var c=t.$implicit,n=h.rc();h.Qb(2),h.yc("routerLink",n.getPromotionLink(c)),h.Qb(1),h.Wc(c.description),h.Qb(1),h.yc("ngIf",n.getCouponCodeForAdjustment(n.order,c)),h.Qb(2),h.Xc(" ",h.uc(7,6,c.amountWithTax,n.order.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(9,9,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(11,11,c.amount,n.order.currencyCode)," ")}}var vc=function(){function e(){g(this,e),this.orderLineCustomFieldsVisible=!1}return m(e,[{key:"visibleOrderLineCustomFields",get:function(){return this.orderLineCustomFieldsVisible?this.orderLineCustomFields:[]}},{key:"showElided",get:function(){return!this.orderLineCustomFieldsVisible&&0<this.orderLineCustomFields.length}},{key:"ngOnInit",value:function(){this.orderLineCustomFieldsVisible=this.orderLineCustomFields.length<2}},{key:"toggleOrderLineCustomFields",value:function(){this.orderLineCustomFieldsVisible=!this.orderLineCustomFieldsVisible}},{key:"getLineDiscounts",value:function(e){return e.discounts.filter(function(e){return e.type===p.c.PROMOTION})}},{key:"getLineCustomFields",value:function(e){var t=this;return this.orderLineCustomFields.map(function(t){return{config:t,value:e.customFields[t.name]}}).filter(function(e){return!!t.orderLineCustomFieldsVisible||null!=e.value})}},{key:"getPromotionLink",value:function(e){return["/marketing","promotions",e.adjustmentSource.split(":")[1]]}},{key:"getCouponCodeForAdjustment",value:function(e,t){var c=t.adjustmentSource.split(":")[1],n=e.promotions.find(function(e){return e.id===c});if(n)return n.couponCode||void 0}}]),e}();vc.\u0275fac=function(e){return new(e||vc)},vc.\u0275cmp=h.Vb({type:vc,selectors:[["vdr-order-table"]],inputs:{order:"order",orderLineCustomFields:"orderLineCustomFields"},decls:61,vars:61,consts:[[1,"order-table","table"],[4,"ngFor","ngForOf"],["class","surcharge",4,"ngFor","ngForOf"],["class","order-adjustment",4,"ngFor","ngForOf"],[1,"sub-total"],[1,"left","clr-align-middle"],["colspan","4"],[1,"clr-align-middle"],[1,"net-price",3,"title"],[1,"shipping"],["colspan","3"],[1,"total"],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","unit-price"],[1,"align-middle","quantity"],[3,"line","payments"],[3,"line","orderState"],[1,"align-middle","total"],[4,"ngIf"],[3,"src"],["vdrDropdownTrigger","",1,"promotions-label"],["class","line-promotion",4,"ngFor","ngForOf"],[1,"line-promotion"],[1,"promotion-name",3,"routerLink"],[1,"promotion-amount"],["colspan","6",1,"custom-fields-row"],[1,"order-line-custom-fields"],["class","custom-field",4,"ngFor","ngForOf"],[1,"custom-field"],[3,"label"],[1,"mt2",3,"ngSwitch"],[3,"ngSwitchCase"],["ngSwitchDefault",""],[3,"title"],[3,"ngIf"],["shape","check"],["shape","times"],[1,"surcharge"],["colspan","2",1,"align-middle","name","left"],["colspan","2",1,"align-middle"],[1,"order-adjustment"],["colspan","5",1,"left","clr-align-middle"],[3,"routerLink"]],template:function(e,t){1&e&&(h.hc(0,"table",0),h.hc(1,"thead"),h.hc(2,"tr"),h.cc(3,"th"),h.hc(4,"th"),h.Vc(5),h.sc(6,"translate"),h.gc(),h.hc(7,"th"),h.Vc(8),h.sc(9,"translate"),h.gc(),h.hc(10,"th"),h.Vc(11),h.sc(12,"translate"),h.gc(),h.hc(13,"th"),h.Vc(14),h.sc(15,"translate"),h.gc(),h.hc(16,"th"),h.Vc(17),h.sc(18,"translate"),h.gc(),h.gc(),h.gc(),h.hc(19,"tbody"),h.Tc(20,pc,28,34,"ng-container",1),h.Tc(21,mc,13,13,"tr",2),h.Tc(22,bc,12,14,"tr",3),h.hc(23,"tr",4),h.hc(24,"td",5),h.Vc(25),h.sc(26,"translate"),h.gc(),h.cc(27,"td",6),h.hc(28,"td",7),h.Vc(29),h.sc(30,"localeCurrency"),h.hc(31,"div",8),h.sc(32,"translate"),h.Vc(33),h.sc(34,"localeCurrency"),h.gc(),h.gc(),h.gc(),h.hc(35,"tr",9),h.hc(36,"td",5),h.Vc(37),h.sc(38,"translate"),h.gc(),h.hc(39,"td",7),h.Vc(40),h.gc(),h.cc(41,"td",10),h.hc(42,"td",7),h.Vc(43),h.sc(44,"localeCurrency"),h.hc(45,"div",8),h.sc(46,"translate"),h.Vc(47),h.sc(48,"localeCurrency"),h.gc(),h.gc(),h.gc(),h.hc(49,"tr",11),h.hc(50,"td",5),h.Vc(51),h.sc(52,"translate"),h.gc(),h.cc(53,"td",6),h.hc(54,"td",7),h.Vc(55),h.sc(56,"localeCurrency"),h.hc(57,"div",8),h.sc(58,"translate"),h.Vc(59),h.sc(60,"localeCurrency"),h.gc(),h.gc(),h.gc(),h.gc(),h.gc()),2&e&&(h.Qb(5),h.Wc(h.tc(6,21,"order.product-name")),h.Qb(3),h.Wc(h.tc(9,23,"order.product-sku")),h.Qb(3),h.Wc(h.tc(12,25,"order.unit-price")),h.Qb(3),h.Wc(h.tc(15,27,"order.quantity")),h.Qb(3),h.Wc(h.tc(18,29,"order.total")),h.Qb(3),h.yc("ngForOf",t.order.lines),h.Qb(1),h.yc("ngForOf",t.order.surcharges),h.Qb(1),h.yc("ngForOf",t.order.discounts),h.Qb(3),h.Wc(h.tc(26,31,"order.sub-total")),h.Qb(4),h.Xc(" ",h.uc(30,33,t.order.subTotalWithTax,t.order.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(32,36,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(34,38,t.order.subTotal,t.order.currencyCode)," "),h.Qb(4),h.Wc(h.tc(38,41,"order.shipping")),h.Qb(3),h.Wc(null==t.order.shippingLines[0]||null==t.order.shippingLines[0].shippingMethod?null:t.order.shippingLines[0].shippingMethod.name),h.Qb(3),h.Xc(" ",h.uc(44,43,t.order.shippingWithTax,t.order.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(46,46,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(48,48,t.order.shipping,t.order.currencyCode)," "),h.Qb(4),h.Wc(h.tc(52,51,"order.total")),h.Qb(4),h.Xc(" ",h.uc(56,53,t.order.totalWithTax,t.order.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(58,56,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(60,58,t.order.total,t.order.currencyCode)," "))},directives:[I.n,I.o,je,we,se.a,de.a,ue.a,Yt.h,J.a,I.q,I.r,I.s,V.o,z.a],pipes:[Q.d,T.a,x.a,tc.a],styles:[".order-table[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}.order-table[_ngcontent-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700}.order-table[_ngcontent-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-right:18px}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%], .order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px}.order-table[_ngcontent-%COMP%]   .promotions-label[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted var(--color-text-200);text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}  .line-promotion{display:flex;justify-content:space-between;padding:6px 12px}  .line-promotion .promotion-amount{margin-left:12px}  .line-promotion .net-price{font-size:11px;color:var(--color-text-300)}"],changeDetection:0});var yc=d("yW18"),Cc=d("u1bq");function Oc(e,t){if(1&e&&(h.hc(0,"vdr-labeled-data",0),h.sc(1,"translate"),h.Vc(2),h.gc()),2&e){var c=h.rc();h.yc("label",h.tc(1,2,"order.error-message")),h.Qb(2),h.Xc(" ",c.payment.errorMessage,"\n")}}function Qc(e,t){if(1&e&&(h.hc(0,"vdr-labeled-data",0),h.sc(1,"translate"),h.Vc(2),h.gc()),2&e){var c=h.rc();h.yc("label",h.tc(1,2,"order.transaction-id")),h.Qb(2),h.Xc(" ",c.payment.transactionId,"\n")}}var Ic=function e(){g(this,e)};Ic.\u0275fac=function(e){return new(e||Ic)},Ic.\u0275cmp=h.Vb({type:Ic,selectors:[["vdr-payment-detail"]],inputs:{payment:"payment",currencyCode:"currencyCode"},decls:12,vars:17,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"value"]],template:function(e,t){1&e&&(h.hc(0,"vdr-labeled-data",0),h.sc(1,"translate"),h.Vc(2),h.gc(),h.hc(3,"vdr-labeled-data",0),h.sc(4,"translate"),h.Vc(5),h.sc(6,"localeCurrency"),h.gc(),h.Tc(7,Oc,3,4,"vdr-labeled-data",1),h.Tc(8,Qc,3,4,"vdr-labeled-data",1),h.hc(9,"vdr-labeled-data",0),h.sc(10,"translate"),h.cc(11,"vdr-object-tree",2),h.gc()),2&e&&(h.yc("label",h.tc(1,8,"order.payment-method")),h.Qb(2),h.Xc(" ",t.payment.method,"\n"),h.Qb(1),h.yc("label",h.tc(4,10,"order.amount")),h.Qb(2),h.Xc(" ",h.uc(6,12,t.payment.amount,t.currencyCode),"\n"),h.Qb(2),h.yc("ngIf",t.payment.errorMessage),h.Qb(1),h.yc("ngIf",t.payment.transactionId),h.Qb(1),h.yc("label",h.tc(10,15,"order.payment-metadata")),h.Qb(2),h.yc("value",t.payment.metadata))},directives:[J.a,I.o,te.a],pipes:[Q.d,T.a],styles:[""],changeDetection:0});var Tc=d("V0to");function Sc(e,t){1&e&&(h.hc(0,"span",12),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.note-only-visible-to-administrators")," "))}function Pc(e,t){1&e&&(h.hc(0,"span",13),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.note-visible-to-customer")," "))}function kc(e,t){1&e&&(h.hc(0,"div",11),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.history-order-fulfilled")," "))}function Mc(e,t){1&e&&(h.hc(0,"div",11),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.history-order-cancelled")," "))}var Vc=function(e,t){return{from:e,to:t}};function xc(e,t){if(1&e&&(h.Vc(0),h.sc(1,"translate")),2&e){var c=h.rc(2).$implicit;h.Xc(" ",h.uc(1,1,"order.history-order-transition",h.Dc(4,Vc,c.data.from,c.data.to))," ")}}function Fc(e,t){if(1&e&&(h.fc(0),h.Tc(1,kc,3,3,"div",17),h.Tc(2,Mc,3,3,"div",17),h.Tc(3,xc,2,7,"ng-template",18),h.ec()),2&e){var c=h.rc().$implicit;h.Qb(1),h.yc("ngIf","Delivered"===c.data.to),h.Qb(1),h.yc("ngIf","Cancelled"===c.data.to),h.Qb(1),h.yc("ngIf","Cancelled"!==c.data.to&&"Delivered"!==c.data.to)}}function wc(e,t){1&e&&(h.hc(0,"vdr-chip",23),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Wc(h.tc(2,1,"order.modification-settled")))}function _c(e,t){1&e&&(h.hc(0,"vdr-chip",24),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Wc(h.tc(2,1,"order.modification-not-settled")))}function Lc(e,t){if(1&e&&(h.fc(0),h.Vc(1),h.sc(2,"translate"),h.hc(3,"strong"),h.Vc(4),h.sc(5,"localeCurrency"),h.gc(),h.Tc(6,wc,3,3,"vdr-chip",20),h.Tc(7,_c,3,3,"vdr-chip",21),h.hc(8,"vdr-history-entry-detail"),h.cc(9,"vdr-modification-detail",22),h.gc(),h.ec()),2&e){var c=t.ngIf,n=h.rc(3);h.Qb(1),h.Xc(" ",h.tc(2,6,"order.modify-order-price-difference"),": "),h.Qb(3),h.Wc(h.uc(5,8,c.priceChange,n.order.currencyCode)),h.Qb(2),h.yc("ngIf",c.isSettled),h.Qb(1),h.yc("ngIf",!c.isSettled),h.Qb(2),h.yc("order",n.order)("modification",c)}}function Ac(e,t){if(1&e&&(h.fc(0),h.hc(1,"div",11),h.Vc(2),h.sc(3,"translate"),h.gc(),h.Tc(4,Lc,10,11,"ng-container",19),h.ec()),2&e){var c=h.rc().$implicit,n=h.rc();h.Qb(2),h.Xc(" ",h.tc(3,2,"order.history-order-modified")," "),h.Qb(2),h.yc("ngIf",n.getModification(c.data.modificationId))}}function jc(e,t){if(1&e&&(h.hc(0,"vdr-history-entry-detail"),h.cc(1,"vdr-payment-detail",27),h.gc()),2&e){var c=t.ngIf,n=h.rc(4);h.Qb(1),h.yc("payment",c)("currencyCode",n.order.currencyCode)}}function Dc(e,t){if(1&e&&(h.fc(0),h.hc(1,"div",11),h.Vc(2),h.sc(3,"translate"),h.gc(),h.Vc(4),h.sc(5,"translate"),h.Tc(6,jc,2,2,"vdr-history-entry-detail",19),h.ec()),2&e){var c,n=h.rc(2).$implicit,r=h.rc();h.Qb(2),h.Xc(" ",h.tc(3,4,"order.history-payment-settled")," "),h.Qb(2),h.Yc(" ",h.tc(5,6,"order.transaction-id"),": ",null==(c=r.getPayment(n))?null:c.transactionId," "),h.Qb(2),h.yc("ngIf",r.getPayment(n))}}var Wc=function(e,t,c){return{from:e,to:t,id:c}};function Nc(e,t){if(1&e&&(h.Vc(0),h.sc(1,"translate")),2&e){var c,n=h.rc(2).$implicit,r=h.rc();h.Xc(" ",h.uc(1,1,"order.history-payment-transition",h.Ec(4,Wc,n.data.from,n.data.to,null==(c=r.getPayment(n))?null:c.transactionId))," ")}}function Rc(e,t){if(1&e&&(h.fc(0),h.Tc(1,Dc,7,8,"ng-container",25),h.Tc(2,Nc,2,8,"ng-template",null,26,h.Uc),h.ec()),2&e){var c=h.Ic(3),n=h.rc().$implicit;h.Qb(1),h.yc("ngIf","Settled"===n.data.to)("ngIfElse",c)}}function Ec(e,t){if(1&e&&(h.fc(0),h.Vc(1),h.sc(2,"translate"),h.ec()),2&e){var c=h.rc().$implicit;h.Qb(1),h.Xc(" ",h.uc(2,1,"order.history-refund-transition",h.Ec(4,Wc,c.data.from,c.data.to,c.data.refundId))," ")}}function Xc(e,t){if(1&e&&(h.hc(0,"vdr-history-entry-detail"),h.hc(1,"vdr-labeled-data",28),h.sc(2,"translate"),h.Vc(3),h.gc(),h.hc(4,"vdr-labeled-data",28),h.sc(5,"translate"),h.cc(6,"vdr-simple-item-list",29),h.gc(),h.gc()),2&e){var c=t.ngIf,n=h.rc(2).$implicit;h.Qb(1),h.yc("label",h.tc(2,4,"order.cancellation-reason")),h.Qb(2),h.Xc(" ",n.data.reason," "),h.Qb(1),h.yc("label",h.tc(5,6,"order.contents")),h.Qb(2),h.yc("items",c)}}var $c=function(e){return{count:e}};function qc(e,t){if(1&e&&(h.fc(0),h.Vc(1),h.sc(2,"translate"),h.Tc(3,Xc,7,8,"vdr-history-entry-detail",19),h.ec()),2&e){var c=h.rc().$implicit,n=h.rc();h.Qb(1),h.Xc(" ",h.uc(2,2,"order.history-items-cancelled",h.Cc(5,$c,c.data.orderItemIds.length))," "),h.Qb(2),h.yc("ngIf",n.getCancelledItems(c))}}function Hc(e,t){if(1&e&&(h.hc(0,"vdr-history-entry-detail"),h.cc(1,"vdr-fulfillment-detail",30),h.gc()),2&e){var c=t.ngIf,n=h.rc(3);h.Qb(1),h.yc("fulfillmentId",c.id)("order",n.order)}}function Uc(e,t){if(1&e&&(h.fc(0),h.Vc(1),h.sc(2,"translate"),h.Tc(3,Hc,2,2,"vdr-history-entry-detail",19),h.ec()),2&e){var c=h.rc().$implicit,n=h.rc();h.Qb(1),h.Xc(" ",h.tc(2,2,"order.history-fulfillment-created")," "),h.Qb(2),h.yc("ngIf",n.getFulfillment(c))}}function zc(e,t){if(1&e&&(h.fc(0),h.hc(1,"div",11),h.Vc(2),h.sc(3,"translate"),h.gc(),h.Vc(4),h.sc(5,"translate"),h.ec()),2&e){var c,n=h.rc(2).$implicit,r=h.rc();h.Qb(2),h.Xc(" ",h.tc(3,3,"order.history-fulfillment-delivered")," "),h.Qb(2),h.Yc(" ",h.tc(5,5,"order.tracking-code"),": ",null==(c=r.getFulfillment(n))?null:c.trackingCode," ")}}function Bc(e,t){if(1&e&&(h.fc(0),h.hc(1,"div",11),h.Vc(2),h.sc(3,"translate"),h.gc(),h.Vc(4),h.sc(5,"translate"),h.ec()),2&e){var c,n=h.rc(2).$implicit,r=h.rc();h.Qb(2),h.Xc(" ",h.tc(3,3,"order.history-fulfillment-shipped")," "),h.Qb(2),h.Yc(" ",h.tc(5,5,"order.tracking-code"),": ",null==(c=r.getFulfillment(n))?null:c.trackingCode," ")}}function Gc(e,t){if(1&e&&(h.fc(0),h.Vc(1),h.sc(2,"translate"),h.ec()),2&e){var c=h.rc(2).$implicit;h.Qb(1),h.Xc(" ",h.uc(2,1,"order.history-fulfillment-transition",h.Dc(4,Vc,c.data.from,c.data.to))," ")}}function Yc(e,t){if(1&e&&(h.hc(0,"vdr-history-entry-detail"),h.cc(1,"vdr-fulfillment-detail",30),h.gc()),2&e){var c=t.ngIf,n=h.rc(3);h.Qb(1),h.yc("fulfillmentId",c.id)("order",n.order)}}function Zc(e,t){if(1&e&&(h.fc(0),h.Tc(1,zc,6,7,"ng-container",19),h.Tc(2,Bc,6,7,"ng-container",19),h.Tc(3,Gc,3,7,"ng-container",19),h.Tc(4,Yc,2,2,"vdr-history-entry-detail",19),h.ec()),2&e){var c=h.rc().$implicit,n=h.rc();h.Qb(1),h.yc("ngIf","Delivered"===c.data.to),h.Qb(1),h.yc("ngIf","Shipped"===c.data.to),h.Qb(1),h.yc("ngIf","Delivered"!==c.data.to&&"Shipped"!==c.data.to),h.Qb(1),h.yc("ngIf",n.getFulfillment(c))}}function Jc(e,t){1&e&&(h.hc(0,"span",43),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Wc(h.tc(2,1,"common.public")))}function Kc(e,t){1&e&&(h.hc(0,"span",44),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Wc(h.tc(2,1,"common.private")))}function en(e,t){if(1&e){var c=h.ic();h.fc(0),h.hc(1,"div",31),h.hc(2,"div",32),h.Tc(3,Jc,3,3,"span",33),h.Tc(4,Kc,3,3,"span",34),h.Vc(5),h.gc(),h.cc(6,"div",35),h.hc(7,"vdr-dropdown"),h.hc(8,"button",36),h.cc(9,"clr-icon",37),h.gc(),h.hc(10,"vdr-dropdown-menu",38),h.hc(11,"button",39),h.pc("click",function(){h.Lc(c);var e=h.rc().$implicit;return h.rc().updateNote.emit(e)}),h.sc(12,"hasPermission"),h.cc(13,"clr-icon",40),h.Vc(14),h.sc(15,"translate"),h.gc(),h.cc(16,"div",41),h.hc(17,"button",39),h.pc("click",function(){h.Lc(c);var e=h.rc().$implicit;return h.rc().deleteNote.emit(e)}),h.sc(18,"hasPermission"),h.cc(19,"clr-icon",42),h.Vc(20),h.sc(21,"translate"),h.gc(),h.gc(),h.gc(),h.gc(),h.ec()}if(2&e){var n=h.rc().$implicit;h.Qb(3),h.yc("ngIf",n.isPublic),h.Qb(1),h.yc("ngIf",!n.isPublic),h.Qb(1),h.Xc(" ",n.data.note," "),h.Qb(6),h.yc("disabled",!h.tc(12,7,"UpdateOrder")),h.Qb(3),h.Xc(" ",h.tc(15,9,"common.edit")," "),h.Qb(3),h.yc("disabled",!h.tc(18,11,"UpdateOrder")),h.Qb(3),h.Xc(" ",h.tc(21,13,"common.delete")," ")}}var tn=function(e){return["/marketing","promotions",e]};function cn(e,t){if(1&e&&(h.fc(0),h.Vc(1),h.sc(2,"translate"),h.hc(3,"vdr-chip"),h.hc(4,"a",45),h.Vc(5),h.gc(),h.gc(),h.ec()),2&e){var c=h.rc().$implicit;h.Qb(1),h.Xc(" ",h.tc(2,3,"order.history-coupon-code-applied"),": "),h.Qb(3),h.yc("routerLink",h.Cc(5,tn,c.data.promotionId)),h.Qb(1),h.Wc(c.data.couponCode)}}function nn(e,t){if(1&e&&(h.fc(0),h.Vc(1),h.sc(2,"translate"),h.hc(3,"vdr-chip"),h.hc(4,"span",46),h.Vc(5),h.gc(),h.gc(),h.ec()),2&e){var c=h.rc().$implicit;h.Qb(1),h.Xc(" ",h.tc(2,2,"order.history-coupon-code-removed"),": "),h.Qb(4),h.Wc(c.data.couponCode)}}function rn(e,t){if(1&e){var c=h.ic();h.hc(0,"vdr-timeline-entry",14),h.pc("expandClick",function(){h.Lc(c);var e=h.rc();return e.expanded=!e.expanded}),h.fc(1,15),h.Tc(2,Fc,4,3,"ng-container",16),h.Tc(3,Ac,5,4,"ng-container",16),h.Tc(4,Rc,4,2,"ng-container",16),h.Tc(5,Ec,3,8,"ng-container",16),h.Tc(6,qc,4,7,"ng-container",16),h.Tc(7,Uc,4,4,"ng-container",16),h.Tc(8,Zc,5,4,"ng-container",16),h.Tc(9,en,22,15,"ng-container",16),h.Tc(10,cn,6,7,"ng-container",16),h.Tc(11,nn,6,4,"ng-container",16),h.ec(),h.gc()}if(2&e){var n=t.$implicit,r=h.rc();h.yc("displayType",r.getDisplayType(n))("iconShape",r.getTimelineIcon(n))("createdAt",n.createdAt)("name",r.getName(n))("featured",r.isFeatured(n))("collapsed",!r.expanded&&!r.isFeatured(n)),h.Qb(1),h.yc("ngSwitch",n.type),h.Qb(1),h.yc("ngSwitchCase",r.type.ORDER_STATE_TRANSITION),h.Qb(1),h.yc("ngSwitchCase",r.type.ORDER_MODIFIED),h.Qb(1),h.yc("ngSwitchCase",r.type.ORDER_PAYMENT_TRANSITION),h.Qb(1),h.yc("ngSwitchCase",r.type.ORDER_REFUND_TRANSITION),h.Qb(1),h.yc("ngSwitchCase",r.type.ORDER_CANCELLATION),h.Qb(1),h.yc("ngSwitchCase",r.type.ORDER_FULFILLMENT),h.Qb(1),h.yc("ngSwitchCase",r.type.ORDER_FULFILLMENT_TRANSITION),h.Qb(1),h.yc("ngSwitchCase",r.type.ORDER_NOTE),h.Qb(1),h.yc("ngSwitchCase",r.type.ORDER_COUPON_APPLIED),h.Qb(1),h.yc("ngSwitchCase",r.type.ORDER_COUPON_REMOVED)}}var an=function(){function e(){g(this,e),this.addNote=new h.t,this.updateNote=new h.t,this.deleteNote=new h.t,this.note="",this.noteIsPrivate=!0,this.expanded=!1,this.type=p.y}return m(e,[{key:"getDisplayType",value:function(e){if(e.type===p.y.ORDER_STATE_TRANSITION){if("Delivered"===e.data.to)return"success";if("Cancelled"===e.data.to)return"error"}return e.type===p.y.ORDER_FULFILLMENT_TRANSITION&&"Delivered"===e.data.to?"success":e.type!==p.y.ORDER_PAYMENT_TRANSITION||"Declined"!==e.data.to&&"Cancelled"!==e.data.to?e.type===p.y.ORDER_CANCELLATION?"error":e.type===p.y.ORDER_REFUND_TRANSITION?"warning":"default":"error"}},{key:"getTimelineIcon",value:function(e){if(e.type===p.y.ORDER_STATE_TRANSITION){if("Delivered"===e.data.to)return["success-standard","is-solid"];if("Cancelled"===e.data.to)return"ban"}if(e.type===p.y.ORDER_PAYMENT_TRANSITION&&"Settled"===e.data.to)return"credit-card";if(e.type===p.y.ORDER_NOTE)return"note";if(e.type===p.y.ORDER_MODIFIED)return"pencil";if(e.type===p.y.ORDER_FULFILLMENT_TRANSITION){if("Shipped"===e.data.to)return"truck";if("Delivered"===e.data.to)return"truck"}}},{key:"isFeatured",value:function(e){switch(e.type){case p.y.ORDER_STATE_TRANSITION:return"Delivered"===e.data.to||"Cancelled"===e.data.to||"Settled"===e.data.to;case p.y.ORDER_PAYMENT_TRANSITION:return"Settled"===e.data.to||"Cancelled"===e.data.to;case p.y.ORDER_FULFILLMENT_TRANSITION:return"Delivered"===e.data.to||"Shipped"===e.data.to;case p.y.ORDER_NOTE:case p.y.ORDER_MODIFIED:return!0;default:return!1}}},{key:"getFulfillment",value:function(e){if((e.type===p.y.ORDER_FULFILLMENT||e.type===p.y.ORDER_FULFILLMENT_TRANSITION)&&this.order.fulfillments)return this.order.fulfillments.find(function(t){return t.id===e.data.fulfillmentId})}},{key:"getPayment",value:function(e){if(e.type===p.y.ORDER_PAYMENT_TRANSITION&&this.order.payments)return this.order.payments.find(function(t){return t.id===e.data.paymentId})}},{key:"getCancelledItems",value:function(e){var t,c=new Map,n=e.data.orderItemIds,r=l(this.order.lines);try{for(r.s();!(t=r.n()).done;){var i,a=t.value,o=l(a.items);try{for(o.s();!(i=o.n()).done;){var d=i.value;if(n.includes(d.id)){var u=c.get(a.productVariant.name);null!=u?c.set(a.productVariant.name,u+1):c.set(a.productVariant.name,1)}}}catch(f){o.e(f)}finally{o.f()}}}catch(f){r.e(f)}finally{r.f()}return Array.from(c.entries()).map(function(e){var t=s(e,2);return{name:t[0],quantity:t[1]}})}},{key:"getModification",value:function(e){return this.order.modifications.find(function(t){return t.id===e})}},{key:"getName",value:function(e){var t=e.administrator;if(t)return"".concat(t.firstName," ").concat(t.lastName);var c=this.order.customer;return c?"".concat(c.firstName," ").concat(c.lastName):""}},{key:"addNoteToOrder",value:function(){this.addNote.emit({note:this.note,isPublic:!this.noteIsPrivate}),this.note="",this.noteIsPrivate=!0}}]),e}();an.\u0275fac=function(e){return new(e||an)},an.\u0275cmp=h.Vb({type:an,selectors:[["vdr-order-history"]],inputs:{order:"order",history:"history"},outputs:{addNote:"addNote",updateNote:"updateNote",deleteNote:"deleteNote"},decls:23,vars:24,consts:[[1,"entry-list"],["iconShape","note","displayType","muted",3,"featured"],[1,"note-entry"],["name","note",1,"note",3,"ngModel","ngModelChange"],[1,"btn","btn-secondary",3,"disabled","click"],[1,"visibility-select"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],["class","private",4,"ngIf"],["class","public",4,"ngIf"],[3,"displayType","iconShape","createdAt","name","featured","collapsed","expandClick",4,"ngFor","ngForOf"],[3,"isLast","createdAt","featured"],[1,"title"],[1,"private"],[1,"public"],[3,"displayType","iconShape","createdAt","name","featured","collapsed","expandClick"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","title",4,"ngIf"],[3,"ngIf"],[4,"ngIf"],["colorType","success",4,"ngIf"],["colorType","error",4,"ngIf"],[3,"order","modification"],["colorType","success"],["colorType","error"],[4,"ngIf","ngIfElse"],["regularPaymentTransition",""],[3,"payment","currencyCode"],[3,"label"],[3,"items"],[3,"fulfillmentId","order"],[1,"flex"],[1,"note-text"],["class","note-visibility public",4,"ngIf"],["class","note-visibility private",4,"ngIf"],[1,"flex-spacer"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["vdrDropdownItem","",1,"button",3,"disabled","click"],["shape","edit"],[1,"dropdown-divider"],["shape","trash",1,"is-danger"],[1,"note-visibility","public"],[1,"note-visibility","private"],[3,"routerLink"],[1,"cancelled-coupon-code"]],template:function(e,t){1&e&&(h.hc(0,"h4"),h.Vc(1),h.sc(2,"translate"),h.gc(),h.hc(3,"div",0),h.hc(4,"vdr-timeline-entry",1),h.hc(5,"div",2),h.hc(6,"textarea",3),h.pc("ngModelChange",function(e){return t.note=e}),h.gc(),h.hc(7,"button",4),h.pc("click",function(){return t.addNoteToOrder()}),h.Vc(8),h.sc(9,"translate"),h.gc(),h.gc(),h.hc(10,"div",5),h.hc(11,"clr-checkbox-wrapper"),h.hc(12,"input",6),h.pc("ngModelChange",function(e){return t.noteIsPrivate=e}),h.gc(),h.hc(13,"label"),h.Vc(14),h.sc(15,"translate"),h.gc(),h.gc(),h.Tc(16,Sc,3,3,"span",7),h.Tc(17,Pc,3,3,"span",8),h.gc(),h.gc(),h.Tc(18,rn,12,17,"vdr-timeline-entry",9),h.hc(19,"vdr-timeline-entry",10),h.hc(20,"div",11),h.Vc(21),h.sc(22,"translate"),h.gc(),h.gc(),h.gc()),2&e&&(h.Qb(1),h.Wc(h.tc(2,16,"order.order-history")),h.Qb(2),h.Tb("expanded",t.expanded),h.Qb(1),h.yc("featured",!0),h.Qb(2),h.yc("ngModel",t.note),h.Qb(1),h.yc("disabled",!t.note),h.Qb(1),h.Xc(" ",h.tc(9,18,"common.add-note")," "),h.Qb(4),h.yc("ngModel",t.noteIsPrivate),h.Qb(2),h.Wc(h.tc(15,20,"order.note-is-private")),h.Qb(2),h.yc("ngIf",t.noteIsPrivate),h.Qb(1),h.yc("ngIf",!t.noteIsPrivate),h.Qb(1),h.yc("ngForOf",t.history),h.Qb(1),h.yc("isLast",!0)("createdAt",t.order.createdAt)("featured",!0),h.Qb(2),h.Xc(" ",h.tc(22,22,"order.history-order-created")," "))},directives:[yc.a,C.a,u.b,u.p,u.s,V.k,u.a,V.i,V.u,I.o,I.n,I.q,I.r,Cc.a,Ee,z.a,Ic,J.a,ee,le,se.a,de.a,V.o,ue.a,fe.a,Yt.h],pipes:[Q.d,T.a,Tc.a],styles:["[_nghost-%COMP%]{margin-top:48px;display:block}.entry-list[_ngcontent-%COMP%]{margin-top:24px;margin-left:24px;margin-right:12px}.note-entry[_ngcontent-%COMP%]{display:flex;align-items:center}.note-entry[_ngcontent-%COMP%]   .note[_ngcontent-%COMP%]{flex:1}.note-entry[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0}.visibility-select[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:baseline}.visibility-select[_ngcontent-%COMP%]   .public[_ngcontent-%COMP%]{color:var(--color-warning-500)}.visibility-select[_ngcontent-%COMP%]   .private[_ngcontent-%COMP%]{color:var(--color-success-500)}textarea.note[_ngcontent-%COMP%]{flex:1;height:36px;border-radius:3px;margin-right:6px}.note-text[_ngcontent-%COMP%]{color:var(--color-grey-800);white-space:pre-wrap}.cancelled-coupon-code[_ngcontent-%COMP%]{text-decoration:line-through}.note-visibility[_ngcontent-%COMP%]{text-transform:lowercase}.note-visibility.public[_ngcontent-%COMP%]{color:var(--color-warning-500)}.note-visibility.private[_ngcontent-%COMP%]{color:var(--color-success-500)}"],changeDetection:0});var on=d("dBS1");function ln(e,t){1&e&&h.cc(0,"clr-icon",2)}var sn=function(){function e(){g(this,e)}return m(e,[{key:"chipColorType",get:function(){switch(this.state){case"Authorized":return"warning";case"Settled":return"success";case"Declined":case"Cancelled":return"error"}}}]),e}();function dn(e,t){1&e&&h.cc(0,"clr-icon",2)}sn.\u0275fac=function(e){return new(e||sn)},sn.\u0275cmp=h.Vb({type:sn,selectors:[["vdr-payment-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(e,t){1&e&&(h.hc(0,"vdr-chip",0),h.sc(1,"translate"),h.Tc(2,ln,1,0,"clr-icon",1),h.Vc(3),h.sc(4,"translate"),h.sc(5,"stateI18nToken"),h.gc()),2&e&&(h.yc("title",h.tc(1,4,"order.payment-state"))("colorType",t.chipColorType),h.Qb(2),h.yc("ngIf","Settled"===t.state),h.Qb(1),h.Xc(" ",h.tc(4,6,h.tc(5,8,t.state)),"\n"))},directives:[z.a,I.o,V.o],pipes:[Q.d,B.a],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0});var un=function(){function e(){g(this,e)}return m(e,[{key:"chipColorType",get:function(){switch(this.state){case"Pending":return"warning";case"Settled":return"success";case"Failed":return"error"}}}]),e}();function fn(e,t){if(1&e&&(h.fc(0),h.Vc(1),h.ec()),2&e){var c=h.rc();h.Qb(1),h.Xc("#",c.payment.transactionId,"")}}function gn(e,t){if(1&e&&(h.hc(0,"vdr-labeled-data",11),h.sc(1,"translate"),h.Vc(2),h.gc()),2&e){var c=h.rc().$implicit;h.yc("label",h.tc(1,2,"order.transaction-id")),h.Qb(2),h.Xc(" ",c.transactionId," ")}}function pn(e,t){if(1&e&&(h.hc(0,"vdr-labeled-data",11),h.sc(1,"translate"),h.Vc(2),h.gc()),2&e){var c=h.rc().$implicit;h.yc("label",h.tc(1,2,"order.refund-reason")),h.Qb(2),h.Xc(" ",c.reason," ")}}function mn(e,t){if(1&e&&(h.hc(0,"vdr-labeled-data",11),h.sc(1,"translate"),h.cc(2,"vdr-object-tree",13),h.gc()),2&e){var c=h.rc().$implicit;h.yc("label",h.tc(1,2,"order.refund-metadata")),h.Qb(2),h.yc("value",c.metadata)}}function hn(e,t){if(1&e){var c=h.ic();h.hc(0,"div",14),h.hc(1,"button",15),h.pc("click",function(){h.Lc(c);var e=h.rc().$implicit;return h.rc().settleRefund.emit(e)}),h.Vc(2),h.sc(3,"translate"),h.gc(),h.gc()}2&e&&(h.Qb(2),h.Xc(" ",h.tc(3,1,"order.settle-refund")," "))}function bn(e,t){if(1&e&&(h.fc(0),h.hc(1,"div",1),h.cc(2,"clr-icon",9),h.Vc(3),h.sc(4,"translate"),h.cc(5,"div",10),h.cc(6,"vdr-refund-state-label",4),h.gc(),h.hc(7,"div",5),h.hc(8,"vdr-labeled-data",11),h.sc(9,"translate"),h.Vc(10),h.sc(11,"localeDate"),h.gc(),h.hc(12,"vdr-labeled-data",11),h.sc(13,"translate"),h.Vc(14),h.sc(15,"localeCurrency"),h.gc(),h.Tc(16,gn,3,4,"vdr-labeled-data",12),h.Tc(17,pn,3,4,"vdr-labeled-data",12),h.Tc(18,mn,3,4,"vdr-labeled-data",12),h.gc(),h.Tc(19,hn,4,3,"div",8),h.ec()),2&e){var c=t.$implicit,n=h.rc();h.Qb(3),h.Yc(" ",h.tc(4,11,"order.refund")," #",c.id," "),h.Qb(3),h.yc("state",c.state),h.Qb(2),h.yc("label",h.tc(9,13,"common.created-at")),h.Qb(2),h.Xc(" ",h.uc(11,15,c.createdAt,"medium")," "),h.Qb(2),h.yc("label",h.tc(13,18,"order.refund-total")),h.Qb(2),h.Xc(" ",h.uc(15,20,c.total,n.currencyCode)," "),h.Qb(2),h.yc("ngIf",c.transactionId),h.Qb(1),h.yc("ngIf",c.reason),h.Qb(1),h.yc("ngIf",n.refundHasMetadata(c)),h.Qb(1),h.yc("ngIf","Pending"===c.state)}}function vn(e,t){if(1&e){var c=h.ic();h.hc(0,"button",15),h.pc("click",function(){h.Lc(c);var e=h.rc(2);return e.settlePayment.emit(e.payment)}),h.Vc(1),h.sc(2,"translate"),h.gc()}2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.settle-payment")," "))}un.\u0275fac=function(e){return new(e||un)},un.\u0275cmp=h.Vb({type:un,selectors:[["vdr-refund-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(e,t){1&e&&(h.hc(0,"vdr-chip",0),h.sc(1,"translate"),h.Tc(2,dn,1,0,"clr-icon",1),h.Vc(3),h.sc(4,"translate"),h.sc(5,"stateI18nToken"),h.gc()),2&e&&(h.yc("title",h.tc(1,4,"order.payment-state"))("colorType",t.chipColorType),h.Qb(2),h.yc("ngIf","Settled"===t.state),h.Qb(1),h.Xc(" ",h.tc(4,6,h.tc(5,8,t.state)),"\n"))},directives:[z.a,I.o,V.o],pipes:[Q.d,B.a],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0});var yn=function(e){return{state:e}};function Cn(e,t){if(1&e&&(h.fc(0),h.cc(1,"clr-icon",23),h.Vc(2),h.sc(3,"translate"),h.sc(4,"translate"),h.sc(5,"stateI18nToken"),h.ec()),2&e){var c=h.rc().$implicit;h.Qb(2),h.Xc(" ",h.uc(3,1,"order.transition-to-state",h.Cc(8,yn,h.tc(4,4,h.tc(5,6,c))))," ")}}function On(e,t){1&e&&(h.cc(0,"clr-icon",24),h.Vc(1),h.sc(2,"translate")),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.cancel-payment")," "))}function Qn(e,t){if(1&e){var c=h.ic();h.fc(0),h.hc(1,"button",20),h.pc("click",function(){h.Lc(c);var e=t.$implicit,n=h.rc(2);return n.transitionPaymentState.emit({payment:n.payment,state:e})}),h.Tc(2,Cn,6,10,"ng-container",21),h.Tc(3,On,3,3,"ng-template",null,22,h.Uc),h.gc(),h.ec()}if(2&e){var n=t.$implicit,r=h.Ic(4);h.Qb(2),h.yc("ngIf","Cancelled"!==n)("ngIfElse",r)}}function In(e,t){if(1&e&&(h.hc(0,"div",14),h.Tc(1,vn,3,3,"button",16),h.hc(2,"vdr-dropdown"),h.hc(3,"button",17),h.cc(4,"clr-icon",18),h.gc(),h.hc(5,"vdr-dropdown-menu",19),h.Tc(6,Qn,5,2,"ng-container",7),h.gc(),h.gc(),h.gc()),2&e){var c=h.rc();h.Qb(1),h.yc("ngIf",c.payment.nextStates.includes("Settled")),h.Qb(5),h.yc("ngForOf",c.nextOtherStates())}}var Tn=function(){function e(){g(this,e),this.settlePayment=new h.t,this.transitionPaymentState=new h.t,this.settleRefund=new h.t}return m(e,[{key:"refundHasMetadata",value:function(e){return!!e&&Object.keys(e.metadata).length>0}},{key:"nextOtherStates",value:function(){return this.payment?this.payment.nextStates.filter(function(e){return"Settled"!==e}):[]}}]),e}();function Sn(e,t){if(1&e){var c=h.ic();h.hc(0,"button",16),h.pc("click",function(){h.Lc(c);var e=h.rc().ngIf;return h.rc().addManualPayment(e)}),h.Vc(1),h.sc(2,"translate"),h.sc(3,"localeCurrency"),h.gc()}if(2&e){var n=h.rc().ngIf,r=h.rc();h.Qb(1),h.Yc(" ",h.tc(2,2,"order.add-payment-to-order")," (",h.uc(3,4,r.outstandingPaymentAmount(n),n.currencyCode),") ")}}function Pn(e,t){if(1&e){var c=h.ic();h.hc(0,"button",16),h.pc("click",function(){return h.Lc(c),h.rc(2).transitionToState("ArrangingAdditionalPayment")}),h.Vc(1),h.sc(2,"translate"),h.gc()}2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.arrange-additional-payment")," "))}function kn(e,t){if(1&e){var c=h.ic();h.fc(0),h.hc(1,"button",14),h.pc("click",function(){return h.Lc(c),h.rc(2).transitionToModifying()}),h.cc(2,"clr-icon",17),h.Vc(3),h.sc(4,"translate"),h.gc(),h.cc(5,"div",13),h.ec()}2&e&&(h.Qb(3),h.Xc(" ",h.tc(4,1,"order.modify-order")," "))}function Mn(e,t){1&e&&(h.fc(0),h.Vc(1),h.sc(2,"translate"),h.ec()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.refund-and-cancel-order")," "))}function Vn(e,t){1&e&&(h.Vc(0),h.sc(1,"translate")),2&e&&h.Xc(" ",h.tc(1,1,"order.cancel-order")," ")}function xn(e,t){if(1&e){var c=h.ic();h.hc(0,"button",14),h.pc("click",function(){h.Lc(c);var e=h.rc().ngIf;return h.rc().cancelOrRefund(e)}),h.cc(1,"clr-icon",18),h.Tc(2,Mn,3,3,"ng-container",19),h.Tc(3,Vn,2,3,"ng-template",null,20,h.Uc),h.gc()}if(2&e){var n=h.Ic(4),r=h.rc().ngIf,i=h.rc();h.Qb(2),h.yc("ngIf",i.orderHasSettledPayments(r))("ngIfElse",n)}}Tn.\u0275fac=function(e){return new(e||Tn)},Tn.\u0275cmp=h.Vb({type:Tn,selectors:[["vdr-order-payment-card"]],inputs:{payment:"payment",currencyCode:"currencyCode"},outputs:{settlePayment:"settlePayment",transitionPaymentState:"transitionPaymentState",settleRefund:"settleRefund"},decls:12,vars:9,consts:[[1,"card"],[1,"card-header","payment-header"],[4,"ngIf"],[1,"payment-state"],[3,"state"],[1,"card-block"],[3,"payment","currencyCode"],[4,"ngFor","ngForOf"],["class","card-footer",4,"ngIf"],["shape","redo","dir","down",1,"refund-icon"],[1,"clr-flex-fill"],[3,"label"],[3,"label",4,"ngIf"],[3,"value"],[1,"card-footer"],[1,"btn","btn-sm","btn-primary",3,"click"],["class","btn btn-sm btn-primary",3,"click",4,"ngIf"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"btn",3,"click"],[4,"ngIf","ngIfElse"],["cancel",""],["shape","step-forward-2"],["shape","error-standard",1,"is-error"]],template:function(e,t){1&e&&(h.hc(0,"div",0),h.hc(1,"div",1),h.hc(2,"div"),h.Vc(3),h.sc(4,"translate"),h.Tc(5,fn,2,1,"ng-container",2),h.gc(),h.hc(6,"div",3),h.cc(7,"vdr-payment-state-label",4),h.gc(),h.gc(),h.hc(8,"div",5),h.cc(9,"vdr-payment-detail",6),h.gc(),h.Tc(10,bn,20,23,"ng-container",7),h.Tc(11,In,7,2,"div",8),h.gc()),2&e&&(h.Qb(3),h.Xc(" ",h.tc(4,7,"order.payment")," "),h.Qb(2),h.yc("ngIf",t.payment.transactionId),h.Qb(2),h.yc("state",t.payment.state),h.Qb(2),h.yc("payment",t.payment)("currencyCode",t.currencyCode),h.Qb(1),h.yc("ngForOf",t.payment.refunds),h.Qb(1),h.yc("ngIf",t.payment.nextStates.length))},directives:[I.o,sn,Ic,I.n,V.o,_e.b,un,J.a,te.a,se.a,de.a,ue.a,fe.a],pipes:[Q.d,ce.a,T.a,B.a],styles:[".payment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.refund-icon[_ngcontent-%COMP%]{margin-right:6px;color:var(--color-grey-400)}.card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}"],changeDetection:0});var Fn=function(e){return{state:e}};function wn(e,t){if(1&e){var c=h.ic();h.hc(0,"button",14),h.pc("click",function(){h.Lc(c);var e=t.$implicit;return h.rc(3).transitionToState(e)}),h.cc(1,"clr-icon",22),h.Vc(2),h.sc(3,"translate"),h.sc(4,"translate"),h.sc(5,"stateI18nToken"),h.gc()}if(2&e){var n=t.$implicit;h.Qb(2),h.Xc(" ",h.uc(3,1,"order.transition-to-state",h.Cc(8,Fn,h.tc(4,4,h.tc(5,6,n))))," ")}}function _n(e,t){if(1&e&&(h.fc(0),h.cc(1,"div",13),h.Tc(2,wn,6,10,"button",21),h.sc(3,"async"),h.ec()),2&e){var c=h.rc(2);h.Qb(2),h.yc("ngForOf",h.tc(3,1,c.nextStates$))}}function Ln(e,t){if(1&e){var c=h.ic();h.hc(0,"vdr-action-bar"),h.hc(1,"vdr-ab-left"),h.hc(2,"div",1),h.cc(3,"vdr-entity-info",2),h.sc(4,"async"),h.hc(5,"vdr-order-state-label",3),h.hc(6,"button",4),h.pc("click",function(){return h.Lc(c),h.rc().openStateDiagram()}),h.sc(7,"translate"),h.cc(8,"clr-icon",5),h.gc(),h.gc(),h.gc(),h.gc(),h.hc(9,"vdr-ab-right"),h.cc(10,"vdr-action-bar-items",6),h.Tc(11,Sn,4,7,"button",7),h.Tc(12,Pn,3,3,"button",7),h.hc(13,"button",8),h.pc("click",function(){return h.Lc(c),h.rc().fulfillOrder()}),h.Vc(14),h.sc(15,"translate"),h.gc(),h.hc(16,"vdr-dropdown"),h.hc(17,"button",9),h.cc(18,"clr-icon",10),h.gc(),h.hc(19,"vdr-dropdown-menu",11),h.Tc(20,kn,6,3,"ng-container",0),h.Tc(21,xn,5,2,"button",12),h.Tc(22,_n,4,3,"ng-container",0),h.sc(23,"async"),h.cc(24,"div",13),h.hc(25,"button",14),h.pc("click",function(){h.Lc(c);var e=t.ngIf;return h.rc().manuallyTransitionToState(e)}),h.cc(26,"clr-icon",15),h.Vc(27),h.sc(28,"translate"),h.gc(),h.gc(),h.gc(),h.gc(),h.gc()}if(2&e){var n,r=t.ngIf,i=h.rc();h.Qb(3),h.yc("entity",h.tc(4,11,i.entity$)),h.Qb(2),h.yc("state",r.state),h.Qb(1),h.yc("title",h.tc(7,13,"order.order-state-diagram")),h.Qb(5),h.yc("ngIf","ArrangingAdditionalPayment"===r.state&&(i.hasUnsettledModifications(r)||0<i.outstandingPaymentAmount(r))),h.Qb(1),h.yc("ngIf","ArrangingAdditionalPayment"!==r.state&&0<i.outstandingPaymentAmount(r)),h.Qb(1),h.yc("disabled",!i.canAddFulfillment(r)),h.Qb(1),h.Xc(" ",h.tc(15,15,"order.fulfill-order")," "),h.Qb(6),h.yc("ngIf",r.nextStates.includes("Modifying")),h.Qb(1),h.yc("ngIf",r.nextStates.includes("Cancelled")),h.Qb(1),h.yc("ngIf",null==(n=h.tc(23,17,i.nextStates$))?null:n.length),h.Qb(5),h.Xc(" ",h.tc(28,19,"order.manually-transition-to-state")," ")}}function An(e,t){if(1&e&&(h.hc(0,"tr"),h.hc(1,"td"),h.Vc(2),h.gc(),h.hc(3,"td"),h.Vc(4),h.sc(5,"percent"),h.gc(),h.hc(6,"td"),h.Vc(7),h.sc(8,"localeCurrency"),h.gc(),h.hc(9,"td"),h.Vc(10),h.sc(11,"localeCurrency"),h.gc(),h.gc()),2&e){var c=t.$implicit,n=h.rc().ngIf;h.Qb(2),h.Wc(c.description),h.Qb(2),h.Wc(h.tc(5,4,c.taxRate/100)),h.Qb(3),h.Wc(h.uc(8,6,c.taxBase,n.currencyCode)),h.Qb(3),h.Wc(h.uc(11,9,c.taxTotal,n.currencyCode))}}function jn(e,t){1&e&&(h.hc(0,"h6"),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.shipping-address")," "))}function Dn(e,t){1&e&&(h.hc(0,"h6"),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.billing-address")," "))}function Wn(e,t){if(1&e){var c=h.ic();h.hc(0,"vdr-order-payment-card",38),h.pc("settlePayment",function(e){return h.Lc(c),h.rc(3).settlePayment(e)})("transitionPaymentState",function(e){return h.Lc(c),h.rc(3).transitionPaymentState(e)})("settleRefund",function(e){return h.Lc(c),h.rc(3).settleRefund(e)}),h.gc()}if(2&e){var n=t.$implicit,r=h.rc(2).ngIf;h.yc("currencyCode",r.currencyCode)("payment",n)}}function Nn(e,t){if(1&e&&(h.fc(0),h.Tc(1,Wn,1,2,"vdr-order-payment-card",37),h.ec()),2&e){var c=h.rc().ngIf;h.Qb(1),h.yc("ngForOf",c.payments)}}function Rn(e,t){if(1&e){var c=h.ic();h.fc(0),h.hc(1,"vdr-fulfillment-card",39),h.pc("transitionState",function(e){h.Lc(c);var n=t.$implicit;return h.rc(2).transitionFulfillment(n.id,e)}),h.gc(),h.ec()}if(2&e){var n=t.$implicit,r=h.rc().ngIf;h.Qb(1),h.yc("fulfillment",n)("order",r)}}function En(e,t){if(1&e){var c=h.ic();h.hc(0,"div"),h.hc(1,"div",23),h.hc(2,"div",24),h.cc(3,"vdr-order-table",25),h.hc(4,"h4"),h.Vc(5),h.sc(6,"translate"),h.gc(),h.hc(7,"table",26),h.hc(8,"thead"),h.hc(9,"tr"),h.hc(10,"th"),h.Vc(11),h.sc(12,"translate"),h.gc(),h.hc(13,"th"),h.Vc(14),h.sc(15,"translate"),h.gc(),h.hc(16,"th"),h.Vc(17),h.sc(18,"translate"),h.gc(),h.hc(19,"th"),h.Vc(20),h.sc(21,"translate"),h.gc(),h.gc(),h.gc(),h.hc(22,"tbody"),h.Tc(23,An,12,12,"tr",27),h.gc(),h.gc(),h.hc(24,"vdr-order-history",28),h.pc("addNote",function(e){return h.Lc(c),h.rc().addNote(e)})("updateNote",function(e){return h.Lc(c),h.rc().updateNote(e)})("deleteNote",function(e){return h.Lc(c),h.rc().deleteNote(e)}),h.sc(25,"async"),h.gc(),h.gc(),h.hc(26,"div",29),h.hc(27,"vdr-order-custom-fields-card",30),h.pc("updateClick",function(e){return h.Lc(c),h.rc().updateCustomFields(e)}),h.gc(),h.hc(28,"div",31),h.hc(29,"div",32),h.Vc(30),h.sc(31,"translate"),h.gc(),h.hc(32,"div",33),h.hc(33,"div",34),h.cc(34,"vdr-customer-label",35),h.Tc(35,jn,3,3,"h6",0),h.cc(36,"vdr-formatted-address",36),h.Tc(37,Dn,3,3,"h6",0),h.cc(38,"vdr-formatted-address",36),h.gc(),h.gc(),h.gc(),h.Tc(39,Nn,2,1,"ng-container",0),h.Tc(40,Rn,2,2,"ng-container",27),h.gc(),h.gc(),h.gc()}if(2&e){var n=t.ngIf,r=h.rc();h.Qb(3),h.yc("order",n)("orderLineCustomFields",r.orderLineCustomFields),h.Qb(2),h.Wc(h.tc(6,20,"order.tax-summary")),h.Qb(6),h.Wc(h.tc(12,22,"common.description")),h.Qb(3),h.Wc(h.tc(15,24,"order.tax-rate")),h.Qb(3),h.Wc(h.tc(18,26,"order.tax-base")),h.Qb(3),h.Wc(h.tc(21,28,"order.tax-total")),h.Qb(3),h.yc("ngForOf",n.taxSummary),h.Qb(1),h.yc("order",n)("history",h.tc(25,30,r.history$)),h.Qb(3),h.yc("customFieldsConfig",r.customFields)("customFieldValues",n.customFields),h.Qb(3),h.Xc(" ",h.tc(31,32,"order.customer")," "),h.Qb(4),h.yc("customer",n.customer),h.Qb(1),h.yc("ngIf",r.getOrderAddressLines(n.shippingAddress).length),h.Qb(1),h.yc("address",n.shippingAddress),h.Qb(1),h.yc("ngIf",r.getOrderAddressLines(n.billingAddress).length),h.Qb(1),h.yc("address",n.billingAddress),h.Qb(1),h.yc("ngIf",n.payments&&n.payments.length),h.Qb(1),h.yc("ngForOf",n.fulfillments)}}var Xn=function(e){t(r,e);var c=n(r);function r(e,t,n,i,a,o,l,s){var d;return g(this,r),(d=c.call(this,t,e,n,a)).changeDetector=i,d.dataService=a,d.notificationService=o,d.modalService=l,d.orderTransitionService=s,d.detailForm=new u.i({}),d.fetchHistory=new Ge.a,d.defaultStates=["AddingItems","ArrangingPayment","PaymentAuthorized","PaymentSettled","PartiallyShipped","Shipped","PartiallyDelivered","Delivered","Cancelled","Modifying","ArrangingAdditionalPayment"],d}return m(r,[{key:"ngOnInit",value:function(){var e=this;this.init(),this.entity$.pipe(Object(Ke.a)(1)).subscribe(function(t){"Modifying"===t.state&&e.router.navigate(["./","modify"],{relativeTo:e.route})}),this.customFields=this.getCustomFieldConfig("Order"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.history$=this.fetchHistory.pipe(Object(et.a)(null),Object(tt.a)(function(){return e.dataService.order.getOrderHistory(e.id,{sort:{createdAt:p.L.DESC}}).mapStream(function(e){var t;return null===(t=e.order)||void 0===t?void 0:t.history.items})})),this.nextStates$=this.entity$.pipe(Object(ct.a)(function(t){return e.defaultStates.includes(t.state)?t.nextStates.filter(function(t){return!e.defaultStates.includes(t)}):t.nextStates}))}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"openStateDiagram",value:function(){var e=this;this.entity$.pipe(Object(Ke.a)(1),Object(tt.a)(function(t){return e.modalService.fromComponent(kt,{closable:!0,locals:{activeState:t.state}})})).subscribe()}},{key:"transitionToState",value:function(e){var t=this;this.dataService.order.transitionToState(this.id,e).subscribe(function(c){var n=c.transitionOrderToState;switch(null==n?void 0:n.__typename){case"Order":t.notificationService.success(Object(M.a)("order.transitioned-to-state-success"),{state:e}),t.fetchHistory.next();break;case"OrderStateTransitionError":t.notificationService.error(n.transitionError)}})}},{key:"manuallyTransitionToState",value:function(e){this.orderTransitionService.manuallyTransitionToState({orderId:e.id,nextStates:e.nextStates,cancellable:!0,message:Object(M.a)("order.manually-transition-to-state-message"),retry:0}).subscribe()}},{key:"transitionToModifying",value:function(){var e=this;this.dataService.order.transitionToState(this.id,"Modifying").subscribe(function(t){var c=t.transitionOrderToState;switch(null==c?void 0:c.__typename){case"Order":e.router.navigate(["./modify"],{relativeTo:e.route});break;case"OrderStateTransitionError":e.notificationService.error(c.transitionError)}})}},{key:"updateCustomFields",value:function(e){var t=this;this.dataService.order.updateOrderCustomFields({id:this.id,customFields:e}).subscribe(function(){t.notificationService.success(Object(M.a)("common.notify-update-success"),{entity:"Order"})})}},{key:"getOrderAddressLines",value:function(e){return e?Object.values(e).filter(function(e){return"OrderAddress"!==e}).filter(function(e){return!!e}):[]}},{key:"settlePayment",value:function(e){var t=this;this.dataService.order.settlePayment(e.id).subscribe(function(e){var c=e.settlePayment;switch(c.__typename){case"Payment":"Settled"===c.state?t.notificationService.success(Object(M.a)("order.settle-payment-success")):t.notificationService.error(Object(M.a)("order.settle-payment-error")),t.dataService.order.getOrder(t.id).single$.subscribe(),t.fetchHistory.next();break;case"OrderStateTransitionError":case"PaymentStateTransitionError":case"SettlePaymentError":t.notificationService.error(c.message)}})}},{key:"transitionPaymentState",value:function(e){var t=this,c=e.payment,n=e.state;this.dataService.order.transitionPaymentToState(c.id,n).subscribe(function(e){var c=e.transitionPaymentToState;switch(c.__typename){case"Payment":t.notificationService.success(Object(M.a)("order.transitioned-payment-to-state-success"),{state:n}),t.dataService.order.getOrder(t.id).single$.subscribe(),t.fetchHistory.next();break;case"PaymentStateTransitionError":t.notificationService.error(c.message)}})}},{key:"canAddFulfillment",value:function(e){return!e.lines.reduce(function(e,t){return[].concat(o(e),o(t.items))},[]).every(function(e){return!!e.fulfillment})&&!this.hasUnsettledModifications(e)&&0===this.outstandingPaymentAmount(e)&&(e.nextStates.includes("Shipped")||e.nextStates.includes("PartiallyShipped")||e.nextStates.includes("Delivered"))}},{key:"hasUnsettledModifications",value:function(e){return 0<e.modifications.filter(function(e){return!e.isSettled}).length}},{key:"getOutstandingModificationAmount",value:function(e){return Object(Z.summate)(e.modifications.filter(function(e){return!e.isSettled}),"priceChange")}},{key:"outstandingPaymentAmount",value:function(e){var t,c,n=null!==(c=null===(t=e.payments)||void 0===t?void 0:t.filter(function(e){return"Cancelled"!==e.state&&"Declined"!==e.state&&"Error"!==e.state}).map(function(e){return Object(Be.pick)(e,["amount"])}))&&void 0!==c?c:[],r=Object(Z.summate)(n,"amount");return e.totalWithTax-r}},{key:"addManualPayment",value:function(e){var t=this;this.modalService.fromComponent(k,{closable:!0,locals:{outstandingAmount:this.outstandingPaymentAmount(e),currencyCode:e.currencyCode}}).pipe(Object(tt.a)(function(e){return e?t.dataService.order.addManualPaymentToOrder({orderId:t.id,transactionId:e.transactionId,method:e.method,metadata:e.metadata||{}}):Ye.a}),Object(tt.a)(function(c){var n=c.addManualPaymentToOrder;switch(n.__typename){case"Order":return t.notificationService.success(Object(M.a)("order.add-payment-to-order-success")),t.orderTransitionService.transitionToPreModifyingState(e.id,e.nextStates);case"ManualPaymentStateError":return t.notificationService.error(n.message),Ye.a;default:return Ye.a}})).subscribe(function(e){e&&t.refetchOrder({result:e})})}},{key:"fulfillOrder",value:function(){var e=this;this.entity$.pipe(Object(Ke.a)(1),Object(tt.a)(function(t){return e.modalService.fromComponent(U,{size:"xl",locals:{order:t}})}),Object(tt.a)(function(t){return t?e.dataService.order.createFulfillment(t):Object(Ze.a)(void 0)}),Object(tt.a)(function(t){return e.refetchOrder(t).pipe(Object(nt.a)(t))})).subscribe(function(t){if(t)switch(t.addFulfillmentToOrder.__typename){case"Fulfillment":e.notificationService.success(Object(M.a)("order.create-fulfillment-success"));break;case"EmptyOrderLineSelectionError":case"InsufficientStockOnHandError":case"ItemsAlreadyFulfilledError":e.notificationService.error(t.addFulfillmentToOrder.message)}})}},{key:"transitionFulfillment",value:function(e,t){var c=this;this.dataService.order.transitionFulfillmentToState(e,t).pipe(Object(tt.a)(function(e){return c.refetchOrder(e)})).subscribe(function(){c.notificationService.success(Object(M.a)("order.successfully-updated-fulfillment"))})}},{key:"cancelOrRefund",value:function(e){var t=this.orderHasSettledPayments(e);"PaymentAuthorized"!==e.state&&!0!==e.active&&t?this.refundOrder(e):this.cancelOrder(e)}},{key:"settleRefund",value:function(e){var t=this;this.modalService.fromComponent(Gt,{size:"md",locals:{refund:e}}).pipe(Object(tt.a)(function(c){return c?t.dataService.order.settleRefund({transactionId:c,id:e.id},t.id):Object(Ze.a)(void 0)})).subscribe(function(e){e&&t.notificationService.success(Object(M.a)("order.settle-refund-success"))})}},{key:"addNote",value:function(e){var t=this,c=e.note,n=e.isPublic;this.dataService.order.addNoteToOrder({id:this.id,note:c,isPublic:n}).pipe(Object(tt.a)(function(e){return t.refetchOrder(e)})).subscribe(function(e){t.notificationService.success(Object(M.a)("common.notify-create-success"),{entity:"Note"})})}},{key:"updateNote",value:function(e){var t=this;this.modalService.fromComponent(p.u,{closable:!0,locals:{displayPrivacyControls:!0,note:e.data.note,noteIsPrivate:!e.isPublic}}).pipe(Object(tt.a)(function(c){return c?t.dataService.order.updateOrderNote({noteId:e.id,isPublic:!c.isPrivate,note:c.note}):Ye.a})).subscribe(function(e){t.fetchHistory.next(),t.notificationService.success(Object(M.a)("common.notify-update-success"),{entity:"Note"})})}},{key:"deleteNote",value:function(e){var t=this;return this.modalService.dialog({title:Object(M.a)("common.confirm-delete-note"),body:e.data.note,buttons:[{type:"secondary",label:Object(M.a)("common.cancel")},{type:"danger",label:Object(M.a)("common.delete"),returnValue:!0}]}).pipe(Object(tt.a)(function(c){return c?t.dataService.order.deleteOrderNote(e.id):Ye.a})).subscribe(function(){t.fetchHistory.next(),t.notificationService.success(Object(M.a)("common.notify-delete-success"),{entity:"Note"})})}},{key:"orderHasSettledPayments",value:function(e){var t;return!!(null===(t=e.payments)||void 0===t?void 0:t.find(function(e){return"Settled"===e.state}))}},{key:"cancelOrder",value:function(e){var t=this;this.modalService.fromComponent(W,{size:"xl",locals:{order:e}}).pipe(Object(tt.a)(function(e){return e?t.dataService.order.cancelOrder(e):Object(Ze.a)(void 0)}),Object(tt.a)(function(e){return t.refetchOrder(e)})).subscribe(function(e){e&&t.notificationService.success(Object(M.a)("order.cancelled-order-success"))})}},{key:"refundOrder",value:function(e){var t=this;this.modalService.fromComponent(Ht,{size:"xl",locals:{order:e}}).pipe(Object(tt.a)(function(e){var c;if(!e)return Object(Ze.a)(void 0);var n=[];return e.refund.lines.length&&n.push(t.dataService.order.refundOrder(e.refund).pipe(Object(ct.a)(function(e){return e.refundOrder}))),(null===(c=e.cancel.lines)||void 0===c?void 0:c.length)&&n.push(t.dataService.order.cancelOrder(e.cancel).pipe(Object(ct.a)(function(e){return e.cancelOrder}))),Object(Je.a).apply(void 0,n)})).subscribe(function(e){if(e)switch(e.__typename){case"Order":t.refetchOrder(e).subscribe(),t.notificationService.success(Object(M.a)("order.cancelled-order-success"));break;case"Refund":t.refetchOrder(e).subscribe(),"Failed"===e.state?t.notificationService.error(Object(M.a)("order.refund-order-failed")):t.notificationService.success(Object(M.a)("order.refund-order-success"));break;case"QuantityTooGreatError":case"MultipleOrderError":case"OrderStateTransitionError":case"CancelActiveOrderError":case"EmptyOrderLineSelectionError":case"AlreadyRefundedError":case"NothingToRefundError":case"PaymentOrderMismatchError":case"RefundOrderStateError":case"RefundStateTransitionError":t.notificationService.error(e.message)}})}},{key:"refetchOrder",value:function(e){return this.fetchHistory.next(),e?this.dataService.order.getOrder(this.id).single$:Object(Ze.a)(void 0)}},{key:"setFormValues",value:function(e){}}]),r}(p.l);Xn.\u0275fac=function(e){return new(e||Xn)(h.bc(Yt.e),h.bc(Yt.a),h.bc(p.I),h.bc(h.j),h.bc(p.s),h.bc(p.G),h.bc(p.F),h.bc(mt))},Xn.\u0275cmp=h.Vb({type:Xn,selectors:[["vdr-order-detail"]],features:[h.Nb],decls:4,vars:6,consts:[[4,"ngIf"],[1,"flex","clr-align-items-center"],[3,"entity"],[3,"state"],[1,"icon-button",3,"title","click"],["shape","list"],["locationId","order-detail"],["class","btn btn-primary",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","class","btn","vdrDropdownItem","",3,"click",4,"ngIf"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",1,"btn",3,"click"],["shape","step-forward-2",1,"is-warning"],[1,"btn","btn-primary",3,"click"],["shape","pencil"],["shape","error-standard",1,"is-error"],[4,"ngIf","ngIfElse"],["cancelOnly",""],["type","button","class","btn","vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["shape","step-forward-2"],[1,"clr-row"],[1,"clr-col-lg-8"],[3,"order","orderLineCustomFields"],[1,"table"],[4,"ngFor","ngForOf"],[3,"order","history","addNote","updateNote","deleteNote"],[1,"clr-col-lg-4","order-cards"],[3,"customFieldsConfig","customFieldValues","updateClick"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"card-text"],[3,"customer"],[3,"address"],[3,"currencyCode","payment","settlePayment","transitionPaymentState","settleRefund",4,"ngFor","ngForOf"],[3,"currencyCode","payment","settlePayment","transitionPaymentState","settleRefund"],[3,"fulfillment","order","transitionState"]],template:function(e,t){1&e&&(h.Tc(0,Ln,29,21,"vdr-action-bar",0),h.sc(1,"async"),h.Tc(2,En,41,34,"div",0),h.sc(3,"async")),2&e&&(h.yc("ngIf",h.tc(1,2,t.entity$)),h.Qb(2),h.yc("ngIf",h.tc(3,4,t.entity$)))},directives:[I.o,Zt.a,Zt.b,Jt.a,Kt.a,V.o,Zt.c,ec.a,se.a,de.a,ue.a,fe.a,I.n,vc,an,ze,on.a,N.a,Tn,Ce],pipes:[I.b,Q.d,T.a,B.a,I.v],styles:[".shipping-address[_ngcontent-%COMP%]{list-style-type:none;line-height:1.3em}.order-cards[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin-top:6px;color:var(--color-text-200)}"],changeDetection:0});var $n,qn=d("1G5W"),Hn=d("UXun");function Un(e,t){1&e&&(h.Vc(0),h.sc(1,"translate")),2&e&&h.Wc(h.tc(1,1,"order.confirm-modifications"))}function zn(e,t){if(1&e&&(h.hc(0,"option",9),h.Vc(1),h.sc(2,"localeCurrency"),h.gc()),2&e){var c=t.$implicit,n=h.rc(2);h.yc("ngValue",c),h.Qb(1),h.Zc(" #",c.id," ",c.method,": ",h.uc(2,4,c.amount,n.order.currencyCode)," ")}}function Bn(e,t){if(1&e){var c=h.ic();h.hc(0,"div"),h.hc(1,"clr-select-container"),h.hc(2,"label"),h.Vc(3),h.sc(4,"translate"),h.gc(),h.hc(5,"select",5),h.pc("ngModelChange",function(e){return h.Lc(c),h.rc().selectedPayment=e}),h.Tc(6,zn,3,7,"option",6),h.gc(),h.gc(),h.hc(7,"label",7),h.Vc(8),h.sc(9,"translate"),h.gc(),h.hc(10,"textarea",8),h.pc("ngModelChange",function(e){return h.Lc(c),h.rc().refundNote=e}),h.gc(),h.gc()}if(2&e){var n=h.rc();h.Qb(3),h.Wc(h.tc(4,5,"order.payment-to-refund")),h.Qb(2),h.yc("ngModel",n.selectedPayment),h.Qb(1),h.yc("ngForOf",n.order.payments),h.Qb(2),h.Wc(h.tc(9,7,"order.refund-cancellation-reason")),h.Qb(2),h.yc("ngModel",n.refundNote)}}function Gn(e,t){if(1&e){var c=h.ic();h.hc(0,"button",10),h.pc("click",function(){return h.Lc(c),h.rc().cancel()}),h.Vc(1),h.sc(2,"translate"),h.gc(),h.hc(3,"button",11),h.pc("click",function(){return h.Lc(c),h.rc().submit()}),h.Vc(4),h.sc(5,"translate"),h.gc()}if(2&e){var n=h.rc();h.Qb(1),h.Wc(h.tc(2,3,"common.cancel")),h.Qb(2),h.yc("disabled",n.priceDifference<0&&!n.selectedPayment),h.Qb(1),h.Xc(" ",h.tc(5,5,"common.confirm")," ")}}!function(e){e[e.Refund=0]="Refund",e[e.Payment=1]="Payment",e[e.PriceUnchanged=2]="PriceUnchanged",e[e.Cancel=3]="Cancel"}($n||($n={}));var Yn=function(){function e(){g(this,e)}return m(e,[{key:"priceDifference",get:function(){return this.order.totalWithTax-this.originalTotalWithTax}},{key:"ngOnInit",value:function(){this.refundNote=this.modifyOrderInput.note||""}},{key:"cancel",value:function(){this.resolveWith({result:$n.Cancel})}},{key:"submit",value:function(){0<this.priceDifference?this.resolveWith({result:$n.Payment}):this.priceDifference<0?this.resolveWith({result:$n.Refund,refundPaymentId:this.selectedPayment.id,refundNote:this.refundNote}):this.resolveWith({result:$n.PriceUnchanged})}}]),e}();Yn.\u0275fac=function(e){return new(e||Yn)},Yn.\u0275cmp=h.Vb({type:Yn,selectors:[["vdr-order-edits-preview-dialog"]],decls:10,vars:10,consts:[["vdrDialogTitle",""],[3,"order","orderLineCustomFields"],[1,"h4"],[4,"ngIf"],["vdrDialogButtons",""],["clrSelect","","name","options",3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"clr-control-label"],["name","refundNote","clrTextarea","","required","",3,"ngModel","ngModelChange"],[3,"ngValue"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(h.Tc(0,Un,2,3,"ng-template",0),h.cc(1,"vdr-order-table",1),h.hc(2,"h4",2),h.Vc(3),h.sc(4,"translate"),h.hc(5,"strong"),h.Vc(6),h.sc(7,"localeCurrency"),h.gc(),h.gc(),h.Tc(8,Bn,11,9,"div",3),h.Tc(9,Gn,6,7,"ng-template",4)),2&e&&(h.Qb(1),h.yc("order",t.order)("orderLineCustomFields",t.orderLineCustomFields),h.Qb(2),h.Xc(" ",h.tc(4,5,"order.modify-order-price-difference"),": "),h.Qb(3),h.Wc(h.uc(7,7,t.priceDifference,t.order.currencyCode)),h.Qb(2),h.yc("ngIf",t.priceDifference<0))},directives:[b.a,vc,I.o,O.a,V.B,V.u,C.a,u.A,V.A,u.p,u.s,I.n,u.b,V.H,u.z,u.u,u.D],pipes:[Q.d,T.a],styles:[""],changeDetection:0});var Zn=d("c+KD"),Jn=d("VhYM"),Kn=d("4ALk");function er(e,t){if(1&e){var c=h.ic();h.hc(0,"vdr-action-bar"),h.hc(1,"vdr-ab-left"),h.hc(2,"div",1),h.cc(3,"vdr-entity-info",2),h.sc(4,"async"),h.cc(5,"vdr-order-state-label",3),h.gc(),h.gc(),h.hc(6,"vdr-ab-right"),h.hc(7,"button",4),h.pc("click",function(){h.Lc(c);var e=t.ngIf;return h.rc().transitionToPriorState(e)}),h.Vc(8),h.sc(9,"translate"),h.gc(),h.gc(),h.gc()}if(2&e){var n=t.ngIf,r=h.rc();h.Qb(3),h.yc("entity",h.tc(4,3,r.entity$)),h.Qb(2),h.yc("state",n.state),h.Qb(3),h.Xc(" ",h.tc(9,5,"order.cancel-modification")," ")}}function tr(e,t){1&e&&(h.hc(0,"th"),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Wc(h.tc(2,1,"common.custom-fields")))}function cr(e,t){if(1&e&&(h.cc(0,"img",41),h.sc(1,"assetPreview")),2&e){var c=h.rc().$implicit;h.yc("src",h.uc(1,1,c.featuredAsset,"tiny"),h.Nc)}}var nr=function(e){return[e]};function rr(e,t){if(1&e&&(h.fc(0),h.cc(1,"vdr-custom-field-control",44),h.ec()),2&e){var c=t.$implicit,n=h.rc(2).index,r=h.rc(2);h.Qb(1),h.yc("customField",c)("customFieldsFormGroup",r.orderLineCustomFieldsFormArray.get(h.Cc(3,nr,n)))("compact",!0)}}function ir(e,t){if(1&e&&(h.hc(0,"td",42),h.Tc(1,rr,2,5,"ng-container",43),h.gc()),2&e){var c=h.rc(3);h.Qb(1),h.yc("ngForOf",c.orderLineCustomFields)}}function ar(e,t){if(1&e){var c=h.ic();h.hc(0,"tr",29),h.hc(1,"td",30),h.Tc(2,cr,2,4,"img",31),h.gc(),h.hc(3,"td",32),h.Vc(4),h.gc(),h.hc(5,"td",33),h.Vc(6),h.gc(),h.hc(7,"td",34),h.Vc(8),h.sc(9,"localeCurrency"),h.hc(10,"div",16),h.sc(11,"translate"),h.Vc(12),h.sc(13,"localeCurrency"),h.gc(),h.gc(),h.hc(14,"td",35),h.hc(15,"input",36),h.pc("input",function(e){h.Lc(c);var n=t.$implicit;return h.rc(2).updateLineQuantity(n,e.target.value)}),h.gc(),h.cc(16,"vdr-line-refunds",37),h.cc(17,"vdr-line-fulfillment",38),h.gc(),h.Tc(18,ir,2,1,"td",39),h.hc(19,"td",40),h.Vc(20),h.sc(21,"localeCurrency"),h.hc(22,"div",16),h.sc(23,"translate"),h.Vc(24),h.sc(25,"localeCurrency"),h.gc(),h.gc(),h.gc()}if(2&e){var n=t.$implicit,r=h.rc().ngIf,i=h.rc();h.Tb("is-cancelled",0===n.quantity)("modified",i.isLineModified(n)),h.Qb(2),h.yc("ngIf",n.featuredAsset),h.Qb(2),h.Wc(n.productVariant.name),h.Qb(2),h.Wc(n.productVariant.sku),h.Qb(2),h.Xc(" ",h.uc(9,19,n.unitPriceWithTax,r.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(11,22,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(13,24,n.unitPrice,r.currencyCode)," "),h.Qb(3),h.yc("value",n.quantity),h.Qb(1),h.yc("line",n)("payments",r.payments),h.Qb(1),h.yc("line",n)("orderState",r.state),h.Qb(1),h.yc("ngIf",i.orderLineCustomFields.length),h.Qb(2),h.Xc(" ",h.uc(21,27,n.linePriceWithTax,r.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(23,30,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(25,32,n.linePrice,r.currencyCode)," ")}}function or(e,t){if(1&e&&(h.cc(0,"img",41),h.sc(1,"assetPreview")),2&e){var c=h.rc().$implicit;h.yc("src",h.uc(1,1,c.productAsset,"tiny"),h.Nc)}}function lr(e,t){if(1&e&&(h.fc(0),h.cc(1,"vdr-custom-field-control",44),h.ec()),2&e){var c=t.$implicit,n=h.rc(2).index,r=h.rc(2);h.Qb(1),h.yc("customField",c)("customFieldsFormGroup",r.addItemCustomFieldsFormArray.get(h.Cc(3,nr,n)))("compact",!0)}}function sr(e,t){if(1&e&&(h.hc(0,"td",42),h.Tc(1,lr,2,5,"ng-container",43),h.gc()),2&e){var c=h.rc(3);h.Qb(1),h.yc("ngForOf",c.orderLineCustomFields)}}function dr(e,t){if(1&e){var c=h.ic();h.hc(0,"tr",45),h.hc(1,"td",30),h.Tc(2,or,2,4,"img",31),h.gc(),h.hc(3,"td",32),h.Vc(4),h.gc(),h.hc(5,"td",33),h.Vc(6),h.gc(),h.hc(7,"td",34),h.Vc(8),h.sc(9,"localeCurrency"),h.hc(10,"div",16),h.sc(11,"translate"),h.Vc(12),h.sc(13,"localeCurrency"),h.gc(),h.gc(),h.hc(14,"td",35),h.hc(15,"input",36),h.pc("input",function(e){h.Lc(c);var n=t.$implicit;return h.rc(2).updateAddedItemQuantity(n,e.target.value)}),h.gc(),h.hc(16,"button",46),h.pc("click",function(){h.Lc(c);var e=t.index;return h.rc(2).removeAddedItem(e)}),h.cc(17,"clr-icon",47),h.gc(),h.gc(),h.Tc(18,sr,2,1,"td",39),h.hc(19,"td",40),h.Vc(20),h.sc(21,"currency"),h.hc(22,"div",16),h.sc(23,"translate"),h.Vc(24),h.sc(25,"currency"),h.gc(),h.gc(),h.gc()}if(2&e){var n=t.$implicit,r=h.rc().ngIf,i=h.rc();h.Qb(2),h.yc("ngIf",n.productAsset),h.Qb(2),h.Wc(n.productVariantName),h.Qb(2),h.Wc(n.sku),h.Qb(2),h.Xc(" ",h.uc(9,11,n.priceWithTax,r.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(11,14,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(13,16,n.price,r.currencyCode)," "),h.Qb(3),h.yc("value",n.quantity),h.Qb(3),h.yc("ngIf",i.orderLineCustomFields.length),h.Qb(2),h.Xc(" ",h.uc(21,19,n.priceWithTax*n.quantity/100,r.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(23,22,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(25,24,n.price*n.quantity/100,r.currencyCode)," ")}}function ur(e,t){1&e&&h.cc(0,"td")}function fr(e,t){if(1&e&&(h.hc(0,"tr",48),h.hc(1,"td",49),h.Vc(2),h.gc(),h.hc(3,"td",33),h.Vc(4),h.gc(),h.cc(5,"td",50),h.cc(6,"td"),h.Tc(7,ur,1,0,"td",0),h.hc(8,"td",40),h.Vc(9),h.sc(10,"localeCurrency"),h.hc(11,"div",16),h.sc(12,"translate"),h.Vc(13),h.sc(14,"localeCurrency"),h.gc(),h.gc(),h.gc()),2&e){var c=t.$implicit,n=h.rc().ngIf,r=h.rc();h.Qb(2),h.Wc(c.description),h.Qb(2),h.Wc(c.sku),h.Qb(3),h.yc("ngIf",r.orderLineCustomFields.length),h.Qb(2),h.Xc(" ",h.uc(10,6,c.priceWithTax,n.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(12,9,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(14,11,c.price,n.currencyCode)," ")}}function gr(e,t){1&e&&h.cc(0,"td")}function pr(e,t){if(1&e&&(h.fc(0),h.Vc(1),h.sc(2,"localeCurrency"),h.hc(3,"div",16),h.sc(4,"translate"),h.Vc(5),h.sc(6,"localeCurrency"),h.gc(),h.ec()),2&e){var c=t.ngIf,n=h.rc(2).ngIf;h.Qb(1),h.Xc(" ",h.uc(2,3,c.priceWithTax,n.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(4,6,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(6,8,c.price,n.currencyCode)," ")}}function mr(e,t){if(1&e){var c=h.ic();h.hc(0,"tr",51),h.hc(1,"td",49),h.Vc(2),h.hc(3,"button",46),h.pc("click",function(){h.Lc(c);var e=t.index;return h.rc(2).removeSurcharge(e)}),h.cc(4,"clr-icon",47),h.gc(),h.gc(),h.hc(5,"td",33),h.Vc(6),h.gc(),h.cc(7,"td",50),h.cc(8,"td"),h.Tc(9,gr,1,0,"td",0),h.hc(10,"td",40),h.Tc(11,pr,7,11,"ng-container",0),h.gc(),h.gc()}if(2&e){var n=t.$implicit,r=h.rc(2);h.Qb(2),h.Xc(" ",n.description," "),h.Qb(4),h.Wc(n.sku),h.Qb(3),h.yc("ngIf",r.orderLineCustomFields.length),h.Qb(2),h.yc("ngIf",r.getSurchargePrices(n))}}function hr(e,t){1&e&&h.cc(0,"td")}function br(e,t){if(1&e&&(h.cc(0,"img",58),h.sc(1,"assetPreview")),2&e){var c=t.ngIf;h.yc("src",h.uc(1,1,c,"tiny"),h.Nc)}}function vr(e,t){if(1&e&&(h.hc(0,"div",55),h.Tc(1,br,2,4,"img",56),h.hc(2,"div"),h.hc(3,"strong",57),h.Vc(4),h.gc(),h.hc(5,"small"),h.Vc(6),h.gc(),h.hc(7,"div"),h.Vc(8),h.sc(9,"localeCurrency"),h.gc(),h.gc(),h.gc()),2&e){var c=h.rc(2).ngIf,n=h.rc();h.Qb(1),h.yc("ngIf",n.addItemSelectedVariant.productAsset),h.Qb(3),h.Wc(n.addItemSelectedVariant.productVariantName),h.Qb(2),h.Wc(n.addItemSelectedVariant.sku),h.Qb(2),h.Xc(" ",h.uc(9,4,n.getSelectedItemPrice(n.addItemSelectedVariant),c.currencyCode)," ")}}function yr(e,t){if(1&e&&(h.fc(0),h.cc(1,"vdr-custom-field-control",59),h.ec()),2&e){var c=t.$implicit,n=h.rc(3);h.Qb(1),h.yc("readonly",!n.addItemSelectedVariant)("customField",c)("customFieldsFormGroup",n.addItemCustomFieldsForm)("compact",!0)}}function Cr(e,t){if(1&e){var c=h.ic();h.hc(0,"clr-accordion-content"),h.hc(1,"vdr-product-selector",52),h.pc("productSelected",function(e){return h.Lc(c),h.rc(2).addItemSelectedVariant=e}),h.gc(),h.Tc(2,vr,10,7,"div",53),h.Tc(3,yr,2,4,"ng-container",43),h.hc(4,"button",54),h.pc("click",function(){h.Lc(c);var e=h.rc(2);return e.addItemToOrder(e.addItemSelectedVariant)}),h.Vc(5),h.sc(6,"translate"),h.gc(),h.gc()}if(2&e){var n=h.rc(2);h.Qb(2),h.yc("ngIf",n.addItemSelectedVariant),h.Qb(1),h.yc("ngForOf",n.orderLineCustomFields),h.Qb(1),h.yc("disabled",!n.addItemSelectedVariant||n.addItemCustomFieldsForm.invalid),h.Qb(1),h.Xc(" ",h.tc(6,4,"order.add-item-to-order")," ")}}var Or=function(e){return{rate:e}};function Qr(e,t){if(1&e){var c=h.ic();h.hc(0,"clr-accordion-content"),h.hc(1,"form",60),h.pc("submit",function(){h.Lc(c);var e=h.rc(2);return e.addSurcharge(e.surchargeForm.value)}),h.hc(2,"vdr-form-field",61),h.sc(3,"translate"),h.cc(4,"input",62),h.gc(),h.hc(5,"vdr-form-field",63),h.sc(6,"translate"),h.cc(7,"input",64),h.gc(),h.hc(8,"vdr-form-field",65),h.sc(9,"translate"),h.cc(10,"vdr-currency-input",66),h.gc(),h.hc(11,"vdr-form-field",67),h.sc(12,"translate"),h.cc(13,"input",68),h.gc(),h.hc(14,"vdr-form-field",69),h.sc(15,"translate"),h.hc(16,"vdr-affixed-input",70),h.cc(17,"input",71),h.gc(),h.gc(),h.hc(18,"vdr-form-field",72),h.sc(19,"translate"),h.cc(20,"input",73),h.gc(),h.hc(21,"button",74),h.Vc(22),h.sc(23,"translate"),h.gc(),h.gc(),h.gc()}if(2&e){var n,r=h.rc().ngIf,i=h.rc(),a=null;h.Qb(1),h.yc("formGroup",i.surchargeForm),h.Qb(1),h.yc("label",h.tc(3,10,"common.description")),h.Qb(3),h.yc("label",h.tc(6,12,"order.product-sku")),h.Qb(3),h.yc("label",h.tc(9,14,"common.price")),h.Qb(2),h.yc("currencyCode",r.currencyCode),h.Qb(1),h.yc("label",h.uc(12,16,"catalog.price-includes-tax-at",h.Cc(25,Or,null==(n=i.surchargeForm.get("taxRate"))?null:n.value))),h.Qb(3),h.yc("label",h.tc(15,19,"order.tax-rate")),h.Qb(4),h.yc("label",h.tc(19,21,"order.tax-description")),h.Qb(3),h.yc("disabled",i.surchargeForm.invalid||i.surchargeForm.pristine||0===(null==(a=i.surchargeForm.get("price"))?null:a.value)),h.Qb(1),h.Xc(" ",h.tc(23,23,"order.add-surcharge")," ")}}function Ir(e,t){if(1&e&&(h.hc(0,"clr-accordion-content"),h.cc(1,"vdr-address-form",75),h.sc(2,"async"),h.gc()),2&e){var c=h.rc(2);h.Qb(1),h.yc("formGroup",c.shippingAddressForm)("availableCountries",h.tc(2,3,c.availableCountries$))("customFields",c.addressCustomFields)}}function Tr(e,t){if(1&e&&(h.hc(0,"clr-accordion-content"),h.cc(1,"vdr-address-form",75),h.sc(2,"async"),h.gc()),2&e){var c=h.rc(2);h.Qb(1),h.yc("formGroup",c.billingAddressForm)("availableCountries",h.tc(2,3,c.availableCountries$))("customFields",c.addressCustomFields)}}var Sr=function(e){return{count:e}};function Pr(e,t){if(1&e&&(h.hc(0,"li"),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e){var c=h.rc(2);h.Qb(1),h.Xc(" ",h.uc(2,1,"order.modification-adding-items",h.Cc(4,Sr,null==c.modifyOrderInput.addItems?null:c.modifyOrderInput.addItems.length))," ")}}function kr(e,t){if(1&e&&(h.hc(0,"li"),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e){var c=h.rc(2);h.Qb(1),h.Xc(" ",h.uc(2,1,"order.modification-adjusting-lines",h.Cc(4,Sr,null==c.modifyOrderInput.adjustOrderLines?null:c.modifyOrderInput.adjustOrderLines.length))," ")}}function Mr(e,t){if(1&e&&(h.hc(0,"li"),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e){var c=h.rc(2);h.Qb(1),h.Xc(" ",h.uc(2,1,"order.modification-adding-surcharges",h.Cc(4,Sr,null==c.modifyOrderInput.surcharges?null:c.modifyOrderInput.surcharges.length))," ")}}function Vr(e,t){1&e&&(h.hc(0,"li"),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.modification-updating-shipping-address")," "))}function xr(e,t){1&e&&(h.hc(0,"li"),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.modification-updating-billing-address")," "))}function Fr(e,t){if(1&e){var c=h.ic();h.hc(0,"div"),h.hc(1,"div",5),h.hc(2,"div",6),h.hc(3,"table",7),h.hc(4,"thead"),h.hc(5,"tr"),h.cc(6,"th"),h.hc(7,"th"),h.Vc(8),h.sc(9,"translate"),h.gc(),h.hc(10,"th"),h.Vc(11),h.sc(12,"translate"),h.gc(),h.hc(13,"th"),h.Vc(14),h.sc(15,"translate"),h.gc(),h.hc(16,"th"),h.Vc(17),h.sc(18,"translate"),h.gc(),h.Tc(19,tr,3,3,"th",0),h.hc(20,"th"),h.Vc(21),h.sc(22,"translate"),h.gc(),h.gc(),h.gc(),h.hc(23,"tbody"),h.Tc(24,ar,26,35,"tr",8),h.Tc(25,dr,26,27,"tr",9),h.Tc(26,fr,15,14,"tr",10),h.Tc(27,mr,12,4,"tr",11),h.hc(28,"tr",12),h.hc(29,"td",13),h.Vc(30),h.sc(31,"translate"),h.gc(),h.hc(32,"td",14),h.Vc(33),h.gc(),h.cc(34,"td",15),h.Tc(35,hr,1,0,"td",0),h.hc(36,"td",14),h.Vc(37),h.sc(38,"localeCurrency"),h.hc(39,"div",16),h.sc(40,"translate"),h.Vc(41),h.sc(42,"localeCurrency"),h.gc(),h.gc(),h.gc(),h.gc(),h.gc(),h.hc(43,"h4",17),h.Vc(44),h.sc(45,"translate"),h.gc(),h.hc(46,"clr-accordion"),h.hc(47,"clr-accordion-panel"),h.hc(48,"clr-accordion-title"),h.Vc(49),h.sc(50,"translate"),h.gc(),h.Tc(51,Cr,7,6,"clr-accordion-content",18),h.gc(),h.hc(52,"clr-accordion-panel"),h.hc(53,"clr-accordion-title"),h.Vc(54),h.sc(55,"translate"),h.gc(),h.Tc(56,Qr,24,27,"clr-accordion-content",18),h.gc(),h.hc(57,"clr-accordion-panel"),h.hc(58,"clr-accordion-title"),h.Vc(59),h.sc(60,"translate"),h.gc(),h.Tc(61,Ir,3,5,"clr-accordion-content",18),h.gc(),h.hc(62,"clr-accordion-panel"),h.hc(63,"clr-accordion-title"),h.Vc(64),h.sc(65,"translate"),h.gc(),h.Tc(66,Tr,3,5,"clr-accordion-content",18),h.gc(),h.gc(),h.gc(),h.hc(67,"div",19),h.hc(68,"div",20),h.hc(69,"div",21),h.Vc(70),h.sc(71,"translate"),h.gc(),h.hc(72,"div",22),h.hc(73,"ul"),h.Tc(74,Pr,3,6,"li",0),h.Tc(75,kr,3,6,"li",0),h.Tc(76,Mr,3,6,"li",0),h.Tc(77,Vr,3,3,"li",0),h.Tc(78,xr,3,3,"li",0),h.gc(),h.gc(),h.hc(79,"div",22),h.hc(80,"label",23),h.Vc(81),h.sc(82,"translate"),h.gc(),h.hc(83,"textarea",24),h.pc("ngModelChange",function(e){return h.Lc(c),h.rc().note=e}),h.gc(),h.hc(84,"clr-checkbox-wrapper",25),h.hc(85,"input",26),h.pc("ngModelChange",function(e){return h.Lc(c),h.rc().recalculateShipping=e}),h.gc(),h.hc(86,"label"),h.Vc(87),h.sc(88,"translate"),h.gc(),h.gc(),h.gc(),h.hc(89,"div",27),h.hc(90,"button",28),h.pc("click",function(){h.Lc(c);var e=t.ngIf;return h.rc().previewAndModify(e)}),h.Vc(91),h.sc(92,"translate"),h.gc(),h.gc(),h.gc(),h.gc(),h.gc(),h.gc()}if(2&e){var n=t.ngIf,r=h.rc();h.Qb(8),h.Wc(h.tc(9,34,"order.product-name")),h.Qb(3),h.Wc(h.tc(12,36,"order.product-sku")),h.Qb(3),h.Wc(h.tc(15,38,"order.unit-price")),h.Qb(3),h.Wc(h.tc(18,40,"order.quantity")),h.Qb(2),h.yc("ngIf",r.orderLineCustomFields.length),h.Qb(2),h.Wc(h.tc(22,42,"order.total")),h.Qb(3),h.yc("ngForOf",n.lines),h.Qb(1),h.yc("ngForOf",r.addedLines)("ngForTrackBy",r.trackByProductVariantId),h.Qb(1),h.yc("ngForOf",n.surcharges),h.Qb(1),h.yc("ngForOf",r.modifyOrderInput.surcharges),h.Qb(3),h.Wc(h.tc(31,44,"order.shipping")),h.Qb(3),h.Wc(null==n.shippingLines[0]||null==n.shippingLines[0].shippingMethod?null:n.shippingLines[0].shippingMethod.name),h.Qb(2),h.yc("ngIf",r.orderLineCustomFields.length),h.Qb(2),h.Xc(" ",h.uc(38,46,n.shippingWithTax,n.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(40,49,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(42,51,n.shipping,n.currencyCode)," "),h.Qb(3),h.Wc(h.tc(45,54,"order.modifications")),h.Qb(5),h.Wc(h.tc(50,56,"order.add-item-to-order")),h.Qb(5),h.Wc(h.tc(55,58,"order.add-surcharge")),h.Qb(5),h.Wc(h.tc(60,60,"order.edit-shipping-address")),h.Qb(5),h.Wc(h.tc(65,62,"order.edit-billing-address")),h.Qb(6),h.Xc(" ",h.tc(71,64,"order.modification-summary")," "),h.Qb(4),h.yc("ngIf",null==r.modifyOrderInput.addItems?null:r.modifyOrderInput.addItems.length),h.Qb(1),h.yc("ngIf",null==r.modifyOrderInput.adjustOrderLines?null:r.modifyOrderInput.adjustOrderLines.length),h.Qb(1),h.yc("ngIf",null==r.modifyOrderInput.surcharges?null:r.modifyOrderInput.surcharges.length),h.Qb(1),h.yc("ngIf",r.shippingAddressForm.dirty),h.Qb(1),h.yc("ngIf",r.billingAddressForm.dirty),h.Qb(3),h.Wc(h.tc(82,66,"order.note")),h.Qb(2),h.yc("ngModel",r.note),h.Qb(2),h.yc("ngModel",r.recalculateShipping),h.Qb(2),h.Wc(h.tc(88,68,"order.modification-recalculate-shipping")),h.Qb(3),h.yc("disabled",!r.canPreviewChanges()),h.Qb(1),h.Xc(" ",h.tc(92,70,"order.preview-changes")," ")}}var wr=function(e){t(r,e);var c=n(r);function r(e,t,n,i,a,o,l,s){var d;return g(this,r),(d=c.call(this,t,e,n,a)).changeDetector=i,d.dataService=a,d.notificationService=o,d.modalService=l,d.orderTransitionService=s,d.detailForm=new u.i({}),d.modifyOrderInput={dryRun:!0,orderId:"",addItems:[],adjustOrderLines:[],surcharges:[],note:"",updateShippingAddress:{},updateBillingAddress:{}},d.note="",d.recalculateShipping=!0,d.addedVariants=new Map,d}return m(r,[{key:"addedLines",get:function(){var e=this,t=function(e){return"SinglePrice"===e.__typename?e.value:0};return(this.modifyOrderInput.addItems||[]).map(function(c){var n=e.addedVariants.get(c.productVariantId);if(n)return Object.assign(Object.assign({},n),{price:t(n.price),priceWithTax:t(n.priceWithTax),quantity:c.quantity})}).filter(Z.notNullOrUndefined)}},{key:"ngOnInit",value:function(){var e=this;this.init(),this.addressCustomFields=this.getCustomFieldConfig("Address"),this.modifyOrderInput.orderId=this.route.snapshot.paramMap.get("id"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.entity$.pipe(Object(qn.a)(this.destroy$)).subscribe(function(t){var c,n,r,i,a,o,s,d,f,g,p,m,h,b,v,y,C,O;e.surchargeForm=new u.i({description:new u.f("",u.C.required),sku:new u.f(""),price:new u.f(0,u.C.required),priceIncludesTax:new u.f(!0),taxRate:new u.f(0),taxDescription:new u.f("")}),e.shippingAddressForm||(e.shippingAddressForm=new u.i({fullName:new u.f(null===(c=t.shippingAddress)||void 0===c?void 0:c.fullName),company:new u.f(null===(n=t.shippingAddress)||void 0===n?void 0:n.company),streetLine1:new u.f(null===(r=t.shippingAddress)||void 0===r?void 0:r.streetLine1),streetLine2:new u.f(null===(i=t.shippingAddress)||void 0===i?void 0:i.streetLine2),city:new u.f(null===(a=t.shippingAddress)||void 0===a?void 0:a.city),province:new u.f(null===(o=t.shippingAddress)||void 0===o?void 0:o.province),postalCode:new u.f(null===(s=t.shippingAddress)||void 0===s?void 0:s.postalCode),countryCode:new u.f(null===(d=t.shippingAddress)||void 0===d?void 0:d.countryCode),phoneNumber:new u.f(null===(f=t.shippingAddress)||void 0===f?void 0:f.phoneNumber)})),e.billingAddressForm||(e.billingAddressForm=new u.i({fullName:new u.f(null===(g=t.billingAddress)||void 0===g?void 0:g.fullName),company:new u.f(null===(p=t.billingAddress)||void 0===p?void 0:p.company),streetLine1:new u.f(null===(m=t.billingAddress)||void 0===m?void 0:m.streetLine1),streetLine2:new u.f(null===(h=t.billingAddress)||void 0===h?void 0:h.streetLine2),city:new u.f(null===(b=t.billingAddress)||void 0===b?void 0:b.city),province:new u.f(null===(v=t.billingAddress)||void 0===v?void 0:v.province),postalCode:new u.f(null===(y=t.billingAddress)||void 0===y?void 0:y.postalCode),countryCode:new u.f(null===(C=t.billingAddress)||void 0===C?void 0:C.countryCode),phoneNumber:new u.f(null===(O=t.billingAddress)||void 0===O?void 0:O.phoneNumber)})),e.orderLineCustomFieldsFormArray=new u.c([]);var Q,I=l(t.lines);try{var T=function(){var t,c=Q.value,n=new u.i({}),r=l(e.orderLineCustomFields);try{for(r.s();!(t=r.n()).done;){var i=t.value.name;n.addControl(i,new u.f(c.customFields[i]))}}catch(a){r.e(a)}finally{r.f()}n.valueChanges.pipe(Object(qn.a)(e.destroy$)).subscribe(function(t){var n=e.modifyOrderInput.adjustOrderLines.find(function(e){return e.orderLineId===c.id});n||(n={orderLineId:c.id,quantity:c.quantity},e.modifyOrderInput.adjustOrderLines.push(n)),e.orderLineCustomFields.length&&(n.customFields=t)}),e.orderLineCustomFieldsFormArray.push(n)};for(I.s();!(Q=I.n()).done;)T()}catch(S){I.e(S)}finally{I.f()}}),this.addItemCustomFieldsFormArray=new u.c([]),this.addItemCustomFieldsForm=new u.i({});var t,c=l(this.orderLineCustomFields);try{for(c.s();!(t=c.n()).done;){var n=t.value;this.addItemCustomFieldsForm.addControl(n.name,new u.f)}}catch(r){c.e(r)}finally{c.f()}this.availableCountries$=this.dataService.settings.getAvailableCountries().mapSingle(function(e){return e.countries.items}).pipe(Object(Hn.a)(1)),this.dataService.order.getOrderHistory(this.id,{take:1,sort:{createdAt:p.L.DESC},filter:{type:{eq:p.y.ORDER_STATE_TRANSITION}}}).single$.subscribe(function(t){var c=t.order;e.previousState=null==c?void 0:c.history.items[0].data.from})}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"transitionToPriorState",value:function(e){var t=this;this.orderTransitionService.transitionToPreModifyingState(e.id,e.nextStates).subscribe(function(e){t.router.navigate([".."],{relativeTo:t.route})})}},{key:"canPreviewChanges",value:function(){var e=this.modifyOrderInput,t=e.addItems,c=e.adjustOrderLines,n=e.surcharges;return!!(null==t?void 0:t.length)||!!(null==n?void 0:n.length)||!!(null==c?void 0:c.length)||this.shippingAddressForm.dirty&&this.shippingAddressForm.valid||this.billingAddressForm.dirty&&this.billingAddressForm.valid}},{key:"isLineModified",value:function(e){var t;return!!(null===(t=this.modifyOrderInput.adjustOrderLines)||void 0===t?void 0:t.find(function(t){return t.orderLineId===e.id&&t.quantity!==e.quantity}))}},{key:"updateLineQuantity",value:function(e,t){var c=this.modifyOrderInput.adjustOrderLines,n=null==c?void 0:c.find(function(t){return t.orderLineId===e.id});n&&+t===e.quantity&&(null==c||c.splice(null==c?void 0:c.indexOf(n),1)),n||(n={orderLineId:e.id,quantity:+t},null==c||c.push(n)),n.quantity=+t}},{key:"updateAddedItemQuantity",value:function(e,t){var c,n=null===(c=this.modifyOrderInput.addItems)||void 0===c?void 0:c.find(function(t){return t.productVariantId===e.productVariantId});n&&(n.quantity=+t)}},{key:"trackByProductVariantId",value:function(e,t){return t.productVariantId}},{key:"getSelectedItemPrice",value:function(e){switch(null==e?void 0:e.priceWithTax.__typename){case"SinglePrice":return e.priceWithTax.value;default:return 0}}},{key:"addItemToOrder",value:function(e){var t,c,n=this;if(e){var r=this.orderLineCustomFields.length?this.addItemCustomFieldsForm.value:void 0,i=null===(t=this.modifyOrderInput.addItems)||void 0===t?void 0:t.find(function(t){return n.isMatchingAddItemRow(t,e,r)});if(i?i.quantity++:(i={productVariantId:e.productVariantId,quantity:1},r&&(i.customFields=r),null===(c=this.modifyOrderInput.addItems)||void 0===c||c.push(i)),r){for(var a=new u.i({}),o=0,l=Object.entries(r);o<l.length;o++){var d=s(l[o],2),f=d[0],g=d[1];a.addControl(f,new u.f(g))}this.addItemCustomFieldsFormArray.push(a),a.valueChanges.pipe(Object(qn.a)(this.destroy$)).subscribe(function(e){i&&(i.customFields=e)})}this.addItemCustomFieldsForm.reset({}),this.addItemSelectedVariant=void 0,this.addedVariants.set(e.productVariantId,e)}}},{key:"isMatchingAddItemRow",value:function(e,t,c){return e.productVariantId===t.productVariantId&&JSON.stringify(e.customFields)===JSON.stringify(c)}},{key:"removeAddedItem",value:function(e){this.modifyOrderInput.addItems.splice(e,1),-1<e&&this.addItemCustomFieldsFormArray.removeAt(e)}},{key:"getSurchargePrices",value:function(e){var t=e.priceIncludesTax?e.price:Math.round(e.price*((100+(e.taxRate||0))/100));return{price:e.priceIncludesTax?Math.round(e.price/((100+(e.taxRate||0))/100)):e.price,priceWithTax:t}}},{key:"addSurcharge",value:function(e){var t;null===(t=this.modifyOrderInput.surcharges)||void 0===t||t.push(e),this.surchargeForm.reset({price:0,priceIncludesTax:!0,taxRate:0})}},{key:"removeSurcharge",value:function(e){var t;null===(t=this.modifyOrderInput.surcharges)||void 0===t||t.splice(e,1)}},{key:"previewAndModify",value:function(e){var t,c=this,n=Object.assign(Object.assign(Object.assign(Object.assign({},this.modifyOrderInput),this.billingAddressForm.dirty?{updateBillingAddress:this.billingAddressForm.value}:{}),this.shippingAddressForm.dirty?{updateShippingAddress:this.shippingAddressForm.value}:{}),{dryRun:!0,note:null!==(t=this.note)&&void 0!==t?t:"",options:{recalculateShipping:this.recalculateShipping}}),r=e.totalWithTax;this.dataService.order.modifyOrder(n).pipe(Object(tt.a)(function(e){var t=e.modifyOrder;switch(t.__typename){case"Order":return c.modalService.fromComponent(Yn,{size:"xl",closable:!1,locals:{originalTotalWithTax:r,order:t,orderLineCustomFields:c.orderLineCustomFields,modifyOrderInput:n}});case"InsufficientStockError":case"NegativeQuantityError":case"NoChangesSpecifiedError":case"OrderLimitError":case"OrderModificationStateError":case"PaymentMethodMissingError":case"RefundPaymentIdMissingError":return c.notificationService.error(t.message),Object(Ze.a)(!1);case null:case void 0:return Object(Ze.a)(!1);default:Object(Z.assertNever)(t)}}),Object(tt.a)(function(t){if(t&&t.result!==$n.Cancel){var i=Object.assign(Object.assign({},n),{dryRun:!1});return t.result===$n.Refund&&(i.refund={paymentId:t.refundPaymentId,reason:t.refundNote}),c.dataService.order.modifyOrder(i).pipe(Object(tt.a)(function(t){var n=t.modifyOrder;if("Order"===n.__typename){var i=0<n.totalWithTax-r?"ArrangingAdditionalPayment":c.previousState;return c.dataService.order.transitionToState(e.id,i).pipe(Object(nt.a)(!0))}return c.notificationService.error(n.message),Ye.a}))}return c.dataService.order.getOrder(c.id).mapSingle(function(){return!1})})).subscribe(function(e){e&&c.router.navigate(["../"],{relativeTo:c.route})})}},{key:"setFormValues",value:function(e,t){}}]),r}(p.l);wr.\u0275fac=function(e){return new(e||wr)(h.bc(Yt.e),h.bc(Yt.a),h.bc(p.I),h.bc(h.j),h.bc(p.s),h.bc(p.G),h.bc(p.F),h.bc(mt))},wr.\u0275cmp=h.Vb({type:wr,selectors:[["vdr-order-editor"]],features:[h.Nb],decls:4,vars:6,consts:[[4,"ngIf"],[1,"flex","clr-align-items-center"],[3,"entity"],[3,"state"],[1,"btn","btn-secondary",3,"click"],[1,"clr-row"],[1,"clr-col-lg-8"],[1,"order-table","table"],["class","order-line",3,"is-cancelled","modified",4,"ngFor","ngForOf"],["class","modified",4,"ngFor","ngForOf","ngForTrackBy"],["class","surcharge",4,"ngFor","ngForOf"],["class","surcharge modified",4,"ngFor","ngForOf"],[1,"shipping"],[1,"left","clr-align-middle"],[1,"clr-align-middle"],["colspan","3"],[1,"net-price",3,"title"],[1,"mb2"],[4,"clrIfExpanded"],[1,"clr-col-lg-4","order-cards"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"clr-control-label"],["name","note","clrTextarea","","required","",3,"ngModel","ngModelChange"],[1,""],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],[1,"card-footer"],[1,"btn","btn-primary",3,"disabled","click"],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","unit-price"],[1,"align-middle","quantity"],["type","number","min","0",3,"value","input"],[3,"line","payments"],[3,"line","orderState"],["class","order-line-custom-field align-middle",4,"ngIf"],[1,"align-middle","total"],[3,"src"],[1,"order-line-custom-field","align-middle"],[4,"ngFor","ngForOf"],["entityName","OrderLine",3,"customField","customFieldsFormGroup","compact"],[1,"modified"],[1,"icon-button",3,"click"],["shape","trash"],[1,"surcharge"],["colspan","2",1,"align-middle","name","left"],[1,"align-middle"],[1,"surcharge","modified"],[1,"mb4",3,"productSelected"],["class","flex mb4",4,"ngIf"],[1,"btn","btn-secondary",3,"disabled","click"],[1,"flex","mb4"],["class","mr4",3,"src",4,"ngIf"],[1,"mr4"],[1,"mr4",3,"src"],["entityName","OrderLine",3,"readonly","customField","customFieldsFormGroup","compact"],[3,"formGroup","submit"],["for","description",3,"label"],["id","description","type","text","formControlName","description"],["for","sku",3,"label"],["id","sku","type","text","formControlName","sku"],["for","price",3,"label"],["id","price","formControlName","price",3,"currencyCode"],["for","priceIncludesTax",3,"label"],["id","priceIncludesTax","type","checkbox","clrCheckbox","","formControlName","priceIncludesTax"],["for","taxRate",3,"label"],["suffix","%"],["id","taxRate","type","number","min","0","max","100","formControlName","taxRate"],["for","taxDescription",3,"label"],["id","taxDescription","type","text","formControlName","taxDescription"],[1,"btn","btn-secondary",3,"disabled"],[3,"formGroup","availableCountries","customFields"]],template:function(e,t){1&e&&(h.Tc(0,er,10,7,"vdr-action-bar",0),h.sc(1,"async"),h.Tc(2,Fr,93,72,"div",0),h.sc(3,"async")),2&e&&(h.yc("ngIf",h.tc(1,2,t.entity$)),h.Qb(2),h.yc("ngIf",h.tc(3,4,t.entity$)))},directives:[I.o,Zt.a,Zt.b,Jt.a,Kt.a,Zt.c,I.n,V.l,V.b,V.O,V.d,V.N,V.e,V.Q,V.q,V.u,C.a,u.b,V.H,u.z,u.p,u.s,V.k,u.a,V.i,je,we,Xe.a,V.o,V.c,Zn.a,u.E,u.q,u.j,v.a,u.h,Mt.a,Jn.a,u.v,Kn.a],pipes:[I.b,Q.d,T.a,x.a,I.d],styles:[".order-table[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}.order-table[_ngcontent-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700}.order-table[_ngcontent-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-right:18px}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%], .order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px}.order-table[_ngcontent-%COMP%]   .promotions-label[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted var(--color-text-200);text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}.order-table[_ngcontent-%COMP%]   tr.modified[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-warning-100)}"],changeDetection:0});var _r=d("/uUt"),Lr=d("pLZG"),Ar=d("tBhK"),jr=d("CotX"),Dr=d("r2d8"),Wr=d("ef/U"),Nr=d("uHMJ");function Rr(e,t){if(1&e){var c=h.ic();h.hc(0,"button",18),h.pc("click",function(){h.Lc(c);var e=t.$implicit;return h.rc(2).selectFilterPreset(e.name)}),h.Vc(1),h.sc(2,"translate"),h.gc()}if(2&e){var n=t.$implicit,r=h.rc().ngIf;h.Tb("btn-primary",r===n.name),h.Qb(1),h.Xc(" ",h.tc(2,3,n.label)," ")}}function Er(e,t){if(1&e){var c=h.ic();h.hc(0,"div",16),h.Tc(1,Rr,3,5,"button",17),h.hc(2,"button",18),h.pc("click",function(){return h.Lc(c),h.rc().selectFilterPreset("custom")}),h.Vc(3),h.sc(4,"translate"),h.cc(5,"clr-icon",19),h.gc(),h.gc()}if(2&e){var n=t.ngIf,r=h.rc();h.Qb(1),h.yc("ngForOf",r.filterPresets),h.Qb(1),h.Tb("btn-primary","custom"===n),h.Qb(1),h.Xc(" ",h.tc(4,4,"order.filter-custom")," ")}}function Xr(e,t){if(1&e&&(h.Vc(0),h.sc(1,"translate"),h.sc(2,"stateI18nToken")),2&e){var c=t.item;h.Wc(h.tc(1,1,h.tc(2,3,c)))}}function $r(e,t){if(1&e&&(h.hc(0,"span",20),h.Vc(1),h.sc(2,"translate"),h.sc(3,"stateI18nToken"),h.gc(),h.hc(4,"span",21),h.pc("click",function(){var e=t.item;return(0,t.clear)(e)}),h.Vc(5,"\xd7"),h.gc()),2&e){var c=t.item;h.Qb(1),h.Xc(" ",h.tc(2,1,h.tc(3,3,c)),"")}}var qr=function(e){return["./",e,"modify"]},Hr=function(e){return["./",e]};function Ur(e,t){if(1&e&&(h.hc(0,"td",22),h.Vc(1),h.gc(),h.hc(2,"td",22),h.cc(3,"vdr-customer-label",23),h.gc(),h.hc(4,"td",22),h.cc(5,"vdr-order-state-label",24),h.gc(),h.hc(6,"td",22),h.Vc(7),h.sc(8,"localeCurrency"),h.gc(),h.hc(9,"td",22),h.Vc(10),h.sc(11,"timeAgo"),h.gc(),h.hc(12,"td",22),h.Vc(13),h.sc(14,"localeDate"),h.gc(),h.hc(15,"td",22),h.Vc(16),h.gc(),h.hc(17,"td",25),h.cc(18,"vdr-table-row-action",26),h.sc(19,"translate"),h.gc()),2&e){var c=t.item,n=h.rc();h.Qb(1),h.Wc(c.code),h.Qb(2),h.yc("customer",c.customer),h.Qb(2),h.yc("state",c.state),h.Qb(2),h.Wc(h.uc(8,9,c.total,c.currencyCode)),h.Qb(3),h.Wc(h.tc(11,12,c.updatedAt)),h.Qb(3),h.Wc(h.uc(14,14,c.orderPlacedAt,"medium")),h.Qb(3),h.Wc(n.getShippingNames(c)),h.Qb(2),h.yc("label",h.tc(19,17,"common.open"))("linkTo","Modifying"===c.state?h.Cc(19,qr,c.id):h.Cc(21,Hr,c.id))}}var zr=function(c){t(o,c);var r=n(o);function o(t,c,n,l,s){var d,f;g(this,o),(f=r.call(this,l,s)).serverConfigService=t,f.dataService=c,f.localStorageService=n,f.searchOrderCodeControl=new u.f(""),f.searchLastNameControl=new u.f(""),f.orderStates=f.serverConfigService.getOrderProcessStates().map(function(e){return e.name}),f.filterPresets=[{name:"open",label:Object(M.a)("order.filter-preset-open"),config:{active:!1,states:f.orderStates.filter(function(e){return"Delivered"!==e&&"Cancelled"!==e&&"Shipped"!==e})}},{name:"shipped",label:Object(M.a)("order.filter-preset-shipped"),config:{active:!1,states:["Shipped"]}},{name:"completed",label:Object(M.a)("order.filter-preset-completed"),config:{active:!1,states:["Delivered","Cancelled"]}},{name:"active",label:Object(M.a)("order.filter-preset-active"),config:{active:!0}}],e((d=i(f),a(o.prototype)),"setQueryFn",d).call(d,function(e,t){return f.dataService.order.getOrders({take:e,skip:t}).refetchOnChannelChange()},function(e){return e.orders},function(e,t){return f.createQueryOptions(e,t,f.searchOrderCodeControl.value,f.searchLastNameControl.value,f.route.snapshot.queryParamMap.get("filter")||"open")});var p=f.localStorageService.get("orderListLastCustomFilters");return p&&f.setQueryParam(p,{replaceUrl:!0}),f}return m(o,[{key:"ngOnInit",value:function(){var t,c=this;e(a(o.prototype),"ngOnInit",this).call(this),this.activePreset$=this.route.queryParamMap.pipe(Object(ct.a)(function(e){return e.get("filter")||"open"}),Object(_r.a)());var n=Object(Je.a)(this.searchOrderCodeControl.valueChanges,this.searchLastNameControl.valueChanges).pipe(Object(Lr.a)(function(e){return 2<e.length||0===e.length}),Object(bt.a)(250));Object(Je.a)(n,this.route.queryParamMap).pipe(Object(qn.a)(this.destroy$)).subscribe(function(e){c.refresh()});var r=this.route.snapshot.queryParamMap;this.customFilterForm=new u.i({states:new u.f(null!==(t=r.getAll("states"))&&void 0!==t?t:[]),placedAtStart:new u.f(r.get("placedAtStart")),placedAtEnd:new u.f(r.get("placedAtEnd"))})}},{key:"selectFilterPreset",value:function(e){var t,c=null!==(t=this.localStorageService.get("orderListLastCustomFilters"))&&void 0!==t?t:{},n="custom"===e?c:{states:void 0,placedAtStart:void 0,placedAtEnd:void 0};this.setQueryParam(Object.assign({filter:e,page:1},n),{replaceUrl:!0})}},{key:"applyCustomFilters",value:function(){var e=this.customFilterForm.value,t={states:e.states,placedAtStart:e.placedAtStart,placedAtEnd:e.placedAtEnd};this.setQueryParam(Object.assign({filter:"custom"},t)),this.customFilterForm.markAsPristine(),this.localStorageService.set("orderListLastCustomFilters",t)}},{key:"createQueryOptions",value:function(e,t,c,n,r){var i,a=this.filterPresets.find(function(e){return e.name===r}),o={};if(a)null!=a.config.active&&(o.active={eq:a.config.active}),a.config.states&&(o.state={in:a.config.states});else if("custom"===r){var l=this.route.snapshot.queryParamMap,s=null!==(i=l.getAll("states"))&&void 0!==i?i:[],d=l.get("placedAtStart"),u=l.get("placedAtEnd");s.length&&(o.state={in:s}),d&&u?o.orderPlacedAt={between:{start:d,end:u}}:d?o.orderPlacedAt={after:d}:u&&(o.orderPlacedAt={before:u})}return n&&(o.customerLastName={contains:n}),c&&(o.code={contains:c}),{options:{skip:e,take:t,filter:Object.assign({},null!=o?o:{}),sort:{updatedAt:p.L.DESC}}}}},{key:"getShippingNames",value:function(e){return e.shippingLines.length?e.shippingLines.map(function(e){return e.shippingMethod.name}).join(", "):""}}]),o}(p.n);zr.\u0275fac=function(e){return new(e||zr)(h.bc(p.I),h.bc(p.s),h.bc(p.D),h.bc(Yt.e),h.bc(Yt.a))},zr.\u0275cmp=h.Vb({type:zr,selectors:[["vdr-order-list"]],features:[h.Nb],decls:62,vars:67,consts:[[1,"search-form"],["class","btn-group btn-outline-primary",4,"ngIf"],["type","text","name","searchTerm",1,"search-input",3,"formControl","placeholder"],[1,"custom-filters"],[3,"formGroup"],[1,"flex","align-center"],["appendTo","body","formControlName","states",3,"items","addTag","multiple","placeholder","clearable","searchable"],["ng-option-tmp",""],["ng-label-tmp",""],[1,"btn","btn-secondary",3,"disabled","click"],["shape","filter"],[1,"flex"],["formControlName","placedAtStart"],["formControlName","placedAtEnd"],["locationId","order-list"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"btn-group","btn-outline-primary"],["class","btn",3,"btn-primary","click",4,"ngFor","ngForOf"],[1,"btn",3,"click"],["shape","angle down"],[1,"ng-value-label"],["aria-hidden","true",1,"ng-value-icon","right",3,"click"],[1,"left","align-middle"],[3,"customer"],[3,"state"],[1,"right","align-middle"],["iconShape","shopping-cart",3,"label","linkTo"]],template:function(e,t){1&e&&(h.hc(0,"vdr-action-bar"),h.hc(1,"vdr-ab-left"),h.hc(2,"div",0),h.Tc(3,Er,6,6,"div",1),h.sc(4,"async"),h.cc(5,"input",2),h.sc(6,"translate"),h.cc(7,"input",2),h.sc(8,"translate"),h.gc(),h.hc(9,"div",3),h.sc(10,"async"),h.hc(11,"form",4),h.hc(12,"div",5),h.hc(13,"ng-select",6),h.sc(14,"translate"),h.Tc(15,Xr,3,5,"ng-template",7),h.Tc(16,$r,6,5,"ng-template",8),h.gc(),h.hc(17,"button",9),h.pc("click",function(){return t.applyCustomFilters()}),h.Vc(18),h.sc(19,"translate"),h.cc(20,"clr-icon",10),h.gc(),h.gc(),h.hc(21,"div",11),h.hc(22,"div"),h.hc(23,"label"),h.Vc(24),h.sc(25,"translate"),h.gc(),h.cc(26,"vdr-datetime-picker",12),h.gc(),h.hc(27,"div"),h.hc(28,"label"),h.Vc(29),h.sc(30,"translate"),h.gc(),h.cc(31,"vdr-datetime-picker",13),h.gc(),h.gc(),h.gc(),h.gc(),h.gc(),h.hc(32,"vdr-ab-right"),h.cc(33,"vdr-action-bar-items",14),h.gc(),h.gc(),h.hc(34,"vdr-data-table",15),h.pc("pageChange",function(e){return t.setPageNumber(e)})("itemsPerPageChange",function(e){return t.setItemsPerPage(e)}),h.sc(35,"async"),h.sc(36,"async"),h.sc(37,"async"),h.sc(38,"async"),h.hc(39,"vdr-dt-column"),h.Vc(40),h.sc(41,"translate"),h.gc(),h.hc(42,"vdr-dt-column"),h.Vc(43),h.sc(44,"translate"),h.gc(),h.hc(45,"vdr-dt-column"),h.Vc(46),h.sc(47,"translate"),h.gc(),h.hc(48,"vdr-dt-column"),h.Vc(49),h.sc(50,"translate"),h.gc(),h.hc(51,"vdr-dt-column"),h.Vc(52),h.sc(53,"translate"),h.gc(),h.hc(54,"vdr-dt-column"),h.Vc(55),h.sc(56,"translate"),h.gc(),h.hc(57,"vdr-dt-column"),h.Vc(58),h.sc(59,"translate"),h.gc(),h.cc(60,"vdr-dt-column"),h.Tc(61,Ur,20,23,"ng-template"),h.gc()),2&e&&(h.Qb(3),h.yc("ngIf",h.tc(4,29,t.activePreset$)),h.Qb(2),h.yc("formControl",t.searchOrderCodeControl)("placeholder",h.tc(6,31,"order.search-by-order-code")),h.Qb(2),h.yc("formControl",t.searchLastNameControl)("placeholder",h.tc(8,33,"order.search-by-customer-last-name")),h.Qb(2),h.Tb("expanded","custom"===h.tc(10,35,t.activePreset$)),h.Qb(2),h.yc("formGroup",t.customFilterForm),h.Qb(2),h.yc("items",t.orderStates)("addTag",!1)("multiple",!0)("placeholder",h.tc(14,37,"state.all-orders"))("clearable",!0)("searchable",!1),h.Qb(4),h.yc("disabled",t.customFilterForm.pristine),h.Qb(1),h.Xc(" ",h.tc(19,39,"order.apply-filters")," "),h.Qb(6),h.Wc(h.tc(25,41,"order.placed-at-start")),h.Qb(5),h.Wc(h.tc(30,43,"order.placed-at-end")),h.Qb(5),h.yc("items",h.tc(35,45,t.items$))("itemsPerPage",h.tc(36,47,t.itemsPerPage$))("totalItems",h.tc(37,49,t.totalItems$))("currentPage",h.tc(38,51,t.currentPage$)),h.Qb(6),h.Wc(h.tc(41,53,"common.code")),h.Qb(3),h.Wc(h.tc(44,55,"order.customer")),h.Qb(3),h.Wc(h.tc(47,57,"order.state")),h.Qb(3),h.Wc(h.tc(50,59,"order.total")),h.Qb(3),h.Wc(h.tc(53,61,"common.updated-at")),h.Qb(3),h.Wc(h.tc(56,63,"order.placed-at")),h.Qb(3),h.Wc(h.tc(59,65,"order.shipping")))},directives:[Zt.a,Zt.b,I.o,C.a,u.b,u.p,u.g,u.E,u.q,u.j,y.a,u.h,y.d,y.e,V.o,V.u,Ar.a,Zt.c,ec.a,jr.a,Dr.a,I.n,on.a,Kt.a,Wr.a],pipes:[I.b,Q.d,B.a,T.a,Nr.a,ce.a],styles:[".search-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:baseline;width:100%;margin-bottom:6px}@media screen and (min-width:768px){.search-form[_ngcontent-%COMP%]{flex-direction:row}}.search-input[_ngcontent-%COMP%]{margin-left:6px;margin-top:6px;min-width:300px}.custom-filters[_ngcontent-%COMP%]{overflow:hidden;max-height:0;padding-bottom:6px}.custom-filters.expanded[_ngcontent-%COMP%]{max-height:none}.custom-filters[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.custom-filters[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%}ng-select[_ngcontent-%COMP%]{flex:1;min-width:200px}ng-select[_ngcontent-%COMP%], ng-select[_ngcontent-%COMP%]     .ng-select-container{height:36px}"],changeDetection:0});var Br=function(e){t(r,e);var c=n(r);function r(e,t){return g(this,r),c.call(this,e,{__typename:"Order",id:"",code:"",createdAt:"",updatedAt:"",total:0},function(e){return t.order.getOrder(e).mapStream(function(e){return e.order})})}return r}(p.m);Br.\u0275fac=function(e){return new(e||Br)(h.lc(Yt.e),h.lc(p.s))},Br.\u0275prov=h.Xb({token:Br,factory:Br.\u0275fac,providedIn:"root"});var Gr=[{path:"",component:zr,data:{breadcrumb:Object(M.a)("breadcrumb.orders")}},{path:":id",component:Xn,resolve:Object(p.O)(Br),canDeactivate:[p.o],data:{breadcrumb:Yr}},{path:":id/modify",component:wr,resolve:Object(p.O)(Br),data:{breadcrumb:Zr}}];function Yr(e,t){return Object(p.Q)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.orders",getName:function(e){return e.code},route:""})}function Zr(e,t){return Yr(e,t).pipe(Object(ct.a)(function(e){var t=e.slice();return t[0].link[0]="../",t[1].link[0]="../orders",t.concat({label:Object(M.a)("breadcrumb.modifying"),link:[""]})}))}var Jr=function e(){g(this,e)};Jr.\u0275fac=function(e){return new(e||Jr)},Jr.\u0275mod=h.Zb({type:Jr}),Jr.\u0275inj=h.Yb({imports:[[p.J,Yt.i.forChild(Gr)]]})}}])}();
//# sourceMappingURL=11-es5.fb4b1a5cb8de0af4e61a.js.map
(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"633s":function(t,e,c){"use strict";c.r(e),c.d(e,"CatalogModule",function(){return Ii}),c.d(e,"catalogRoutes",function(){return Qn}),c.d(e,"productBreadcrumb",function(){return jn}),c.d(e,"productVariantEditorBreadcrumb",function(){return Mn}),c.d(e,"facetBreadcrumb",function(){return wn}),c.d(e,"collectionBreadcrumb",function(){return Sn}),c.d(e,"assetBreadcrumb",function(){return Dn}),c.d(e,"ApplyFacetDialogComponent",function(){return _e}),c.d(e,"AssetDetailComponent",function(){return v}),c.d(e,"AssetListComponent",function(){return $}),c.d(e,"AssignProductsToChannelDialogComponent",function(){return cc}),c.d(e,"CollectionContentsComponent",function(){return Y}),c.d(e,"CollectionDetailComponent",function(){return ft}),c.d(e,"CollectionListComponent",function(){return xt}),c.d(e,"arrayToTree",function(){return yt}),c.d(e,"CollectionTreeNodeComponent",function(){return Jn}),c.d(e,"CollectionTreeComponent",function(){return Ot}),c.d(e,"FacetDetailComponent",function(){return ae}),c.d(e,"FacetListComponent",function(){return Ce}),c.d(e,"GenerateProductVariantsComponent",function(){return oa}),c.d(e,"OPTION_VALUE_INPUT_VALUE_ACCESSOR",function(){return rn}),c.d(e,"OptionValueInputComponent",function(){return sn}),c.d(e,"ProductAssetsComponent",function(){return Pa}),c.d(e,"ProductDetailComponent",function(){return jc}),c.d(e,"ProductListComponent",function(){return tn}),c.d(e,"ProductSearchInputComponent",function(){return Ec}),c.d(e,"GeneratedVariant",function(){return Pn}),c.d(e,"ProductVariantsEditorComponent",function(){return Fn}),c.d(e,"ProductVariantsListComponent",function(){return di}),c.d(e,"ProductVariantsTableComponent",function(){return Ci}),c.d(e,"UpdateProductOptionDialogComponent",function(){return ja}),c.d(e,"VariantPriceDetailComponent",function(){return Aa}),c.d(e,"ProductDetailService",function(){return Me}),c.d(e,"replaceLast",function(){return je}),c.d(e,"AssetResolver",function(){return In}),c.d(e,"CollectionResolver",function(){return Vn}),c.d(e,"FacetResolver",function(){return kn}),c.d(e,"ProductResolver",function(){return xn}),c.d(e,"ProductVariantsResolver",function(){return Tn});var n=c("tyNb"),a=c("t9nd"),i=c("OxKu"),o=c("lJxs"),r=c("3Pt+"),s=c("fXoL"),l=c("uEVm"),d=c("iszU"),u=c("nqNv"),p=c("W7hW"),g=c("CzUH"),h=c("ofXK"),m=c("sYmb");function f(t,e){if(1&t){const t=s.ic();s.hc(0,"button",4),s.pc("click",function(){s.Lc(t);return s.rc().save()}),s.Vc(1),s.sc(2,"translate"),s.gc()}if(2&t){const t=s.rc();s.yc("disabled",t.detailForm.invalid||t.detailForm.pristine),s.Qb(1),s.Xc(" ",s.tc(2,2,"common.update")," ")}}const b=function(){return["UpdateCatalog","UpdateAsset"]};class v extends a.l{constructor(t,e,c,n,a,i){super(e,t,c,a),this.notificationService=n,this.dataService=a,this.formBuilder=i,this.detailForm=new r.i({}),this.customFields=this.getCustomFieldConfig("Asset")}ngOnInit(){this.detailForm=new r.i({name:new r.f(""),tags:new r.f([]),customFields:this.formBuilder.group(this.customFields.reduce((t,e)=>Object.assign(Object.assign({},t),{[e.name]:""}),{}))}),this.init()}ngOnDestroy(){this.destroy()}onAssetChange(t){var e,c;null===(e=this.detailForm.get("name"))||void 0===e||e.setValue(t.name),null===(c=this.detailForm.get("tags"))||void 0===c||c.setValue(t.tags),this.detailForm.markAsDirty()}save(){this.dataService.product.updateAsset({id:this.id,name:this.detailForm.value.name,tags:this.detailForm.value.tags,customFields:this.detailForm.value.customFields}).subscribe(()=>{this.notificationService.success(Object(i.a)("common.notify-update-success"),{entity:"Asset"})},t=>{this.notificationService.error(Object(i.a)("common.notify-update-error"),{entity:"Asset"})})}setFormValues(t,e){var c,n;if(null===(c=this.detailForm.get("name"))||void 0===c||c.setValue(t.name),null===(n=this.detailForm.get("tags"))||void 0===n||n.setValue(t.tags),this.customFields.length){const e=this.detailForm.get("customFields");for(const c of this.customFields){const n=c.name,a=t.customFields[n],i=e.get(n);i&&i.patchValue(a)}}}}v.\u0275fac=function(t){return new(t||v)(s.bc(n.e),s.bc(n.a),s.bc(a.I),s.bc(a.G),s.bc(a.s),s.bc(r.e))},v.\u0275cmp=s.Vb({type:v,selectors:[["vdr-asset-detail"]],features:[s.Nb],decls:9,vars:11,consts:[[3,"entity"],["locationId","asset-detail"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[3,"asset","editable","customFields","customFieldsForm","assetChange"],[1,"btn","btn-primary",3,"disabled","click"]],template:function(t,e){1&t&&(s.hc(0,"vdr-action-bar"),s.hc(1,"vdr-ab-left"),s.cc(2,"vdr-entity-info",0),s.sc(3,"async"),s.gc(),s.hc(4,"vdr-ab-right"),s.cc(5,"vdr-action-bar-items",1),s.Tc(6,f,3,4,"button",2),s.gc(),s.gc(),s.hc(7,"vdr-asset-preview",3),s.pc("assetChange",function(t){return e.onAssetChange(t)}),s.sc(8,"async"),s.gc()),2&t&&(s.Qb(2),s.yc("entity",s.tc(3,6,e.entity$)),s.Qb(4),s.yc("vdrIfPermissions",s.Bc(10,b)),s.Qb(1),s.yc("asset",s.tc(8,8,e.entity$))("editable",!0)("customFields",e.customFields)("customFieldsForm",e.detailForm.get("customFields")))},directives:[l.a,l.b,d.a,l.c,u.a,p.a,g.a],pipes:[h.b,m.d],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}"],changeDetection:0});var y=c("2Vo4"),C=c("itXk"),O=c("EY2u"),P=c("Kj3r"),F=c("1G5W"),I=c("nYR2"),V=c("eIep"),k=c("NMPB"),x=c("z15R"),T=c("EA9K"),Q=c("ClhI"),j=c("ZKZR"),M=c("oOf3"),w=c("V0to");const S=function(){return{}},D=function(){return["DeleteCatalog","DeleteAsset"]};class $ extends a.n{constructor(t,e,c,n,i){super(n,i),this.notificationService=t,this.modalService=e,this.dataService=c,this.searchTerm$=new y.a(void 0),this.filterByTags$=new y.a(void 0),this.uploading=!1,super.setQueryFn((...t)=>this.dataService.product.getAssetList(...t),t=>t.assets,(t,e)=>{var c;const n=this.searchTerm$.value,i=null===(c=this.filterByTags$.value)||void 0===c?void 0:c.map(t=>t.value);return{options:Object.assign(Object.assign({skip:t,take:e},n?{filter:{name:{contains:n}}}:{}),{sort:{createdAt:a.L.DESC},tags:i,tagsOperator:a.E.AND})}},{take:25,skip:0})}ngOnInit(){super.ngOnInit(),this.paginationConfig$=Object(C.a)(this.itemsPerPage$,this.currentPage$,this.totalItems$).pipe(Object(o.a)(([t,e,c])=>({itemsPerPage:t,currentPage:e,totalItems:c}))),this.searchTerm$.pipe(Object(P.a)(250),Object(F.a)(this.destroy$)).subscribe(()=>this.refresh()),this.filterByTags$.pipe(Object(F.a)(this.destroy$)).subscribe(()=>this.refresh()),this.allTags$=this.dataService.product.getTagList().mapStream(t=>t.tags.items)}filesSelected(t){t.length&&(this.uploading=!0,this.dataService.product.createAssets(t).pipe(Object(I.a)(()=>this.uploading=!1)).subscribe(({createAssets:t})=>{let e=0;for(const c of t)switch(c.__typename){case"Asset":e++;break;case"MimeTypeError":this.notificationService.error(c.message)}0<e&&(super.refresh(),this.notificationService.success(Object(i.a)("asset.notify-create-assets-success"),{count:e}))}))}deleteAssets(t){this.showModalAndDelete(t.map(t=>t.id)).pipe(Object(V.a)(e=>e.result===a.t.DELETED?[!0]:this.showModalAndDelete(t.map(t=>t.id),e.message||"").pipe(Object(o.a)(t=>t.result===a.t.DELETED)))).subscribe(()=>{this.notificationService.success(Object(i.a)("common.notify-delete-success"),{entity:"Assets"}),this.refresh()},t=>{this.notificationService.error(Object(i.a)("common.notify-delete-error"),{entity:"Assets"})})}showModalAndDelete(t,e){return this.modalService.dialog({title:Object(i.a)("catalog.confirm-delete-assets"),translationVars:{count:t.length},body:e,buttons:[{type:"secondary",label:Object(i.a)("common.cancel")},{type:"danger",label:Object(i.a)("common.delete"),returnValue:!0}]}).pipe(Object(V.a)(c=>c?this.dataService.product.deleteAssets(t,!!e):O.a),Object(o.a)(t=>t.deleteAssets))}}$.\u0275fac=function(t){return new(t||$)(s.bc(a.G),s.bc(a.F),s.bc(a.s),s.bc(n.e),s.bc(n.a))},$.\u0275cmp=s.Vb({type:$,selectors:[["vdr-asset-list"]],features:[s.Nb],decls:19,vars:31,consts:[[3,"grow"],[1,"pr4","mt1",3,"tags","searchTermChange","tagsChange"],["locationId","asset-list"],["dropZoneTarget",".content-area",3,"uploading","selectFiles"],[3,"assets","multiSelect","canDelete","deleteAssets"],[1,"paging-controls"],[3,"itemsPerPage","itemsPerPageChange"],[3,"currentPage","itemsPerPage","totalItems","pageChange"]],template:function(t,e){1&t&&(s.hc(0,"vdr-action-bar"),s.hc(1,"vdr-ab-left",0),s.hc(2,"vdr-asset-search-input",1),s.pc("searchTermChange",function(t){return e.searchTerm$.next(t)})("tagsChange",function(t){return e.filterByTags$.next(t)}),s.sc(3,"async"),s.gc(),s.gc(),s.hc(4,"vdr-ab-right"),s.cc(5,"vdr-action-bar-items",2),s.hc(6,"vdr-asset-file-input",3),s.pc("selectFiles",function(t){return e.filesSelected(t)}),s.gc(),s.gc(),s.gc(),s.hc(7,"vdr-asset-gallery",4),s.pc("deleteAssets",function(t){return e.deleteAssets(t)}),s.sc(8,"paginate"),s.sc(9,"async"),s.sc(10,"async"),s.sc(11,"hasPermission"),s.gc(),s.hc(12,"div",5),s.hc(13,"vdr-items-per-page-controls",6),s.pc("itemsPerPageChange",function(t){return e.setItemsPerPage(t)}),s.sc(14,"async"),s.gc(),s.hc(15,"vdr-pagination-controls",7),s.pc("pageChange",function(t){return e.setPageNumber(t)}),s.sc(16,"async"),s.sc(17,"async"),s.sc(18,"async"),s.gc(),s.gc()),2&t&&(s.Qb(1),s.yc("grow",!0),s.Qb(1),s.yc("tags",s.tc(3,10,e.allTags$)),s.Qb(4),s.yc("uploading",e.uploading),s.Qb(1),s.yc("assets",s.uc(8,12,s.tc(9,15,e.items$),s.tc(10,17,e.paginationConfig$)||s.Bc(29,S)))("multiSelect",!0)("canDelete",s.tc(11,19,s.Bc(30,D))),s.Qb(6),s.yc("itemsPerPage",s.tc(14,21,e.itemsPerPage$)),s.Qb(2),s.yc("currentPage",s.tc(16,23,e.currentPage$))("itemsPerPage",s.tc(17,25,e.itemsPerPage$))("totalItems",s.tc(18,27,e.totalItems$)))},directives:[l.a,l.b,k.a,l.c,u.a,x.a,T.a,Q.a,j.a],pipes:[h.b,M.b,w.a],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}vdr-asset-gallery[_ngcontent-%COMP%]{flex:1}.paging-controls[_ngcontent-%COMP%]{padding-top:6px;border-top:1px solid var(--color-component-border-100);display:flex;justify-content:space-between}.search-input[_ngcontent-%COMP%]{margin-top:6px;min-width:300px}"]});var A=c("Mb15"),_=c("IzEk"),L=c("5+tZ"),N=c("XNiG"),G=c("LRne"),E=c("JX91"),W=c("/uUt"),U=c("vkgz"),B=c("Bzlx"),X=c("CotX"),R=c("ef/U");function H(t,e){1&t&&s.dc(0)}const z=function(){return{tab:"variants"}},q=function(t,e){return["/catalog/products",t,e]};function K(t,e){if(1&t&&(s.hc(0,"td",5),s.Vc(1),s.gc(),s.hc(2,"td",6),s.cc(3,"vdr-table-row-action",7),s.sc(4,"translate"),s.gc()),2&t){const t=e.item;s.Qb(1),s.Wc(t.name),s.Qb(2),s.yc("label",s.tc(4,3,"common.edit"))("linkTo",s.Dc(6,q,t.productId,s.Bc(5,z)))}}const Z=function(t){return{$implicit:t}};class Y{constructor(t,e,c){this.route=t,this.router=e,this.dataService=c,this.filterTermControl=new r.f(""),this.collectionIdChange$=new y.a(""),this.refresh$=new y.a(!0),this.destroy$=new N.a}ngOnInit(){this.contentsCurrentPage$=this.route.paramMap.pipe(Object(o.a)(t=>t.get("contentsPage")),Object(o.a)(t=>t?+t:1),Object(E.a)(1),Object(W.a)()),this.contentsItemsPerPage$=this.route.paramMap.pipe(Object(o.a)(t=>t.get("contentsPerPage")),Object(o.a)(t=>t?+t:10),Object(E.a)(10),Object(W.a)());const t=this.filterTermControl.valueChanges.pipe(Object(P.a)(250),Object(U.a)(()=>this.setContentsPageNumber(1)),Object(E.a)("")),e=Object(C.a)(this.collectionIdChange$,this.contentsCurrentPage$,this.contentsItemsPerPage$,t,this.refresh$).pipe(Object(F.a)(this.destroy$),Object(V.a)(([t,e,c,n])=>{const a=c,i=(e-1)*c;return t?this.dataService.collection.getCollectionContents(t,a,i,n).mapSingle(t=>t.collection):Object(G.a)(null)}));this.contents$=e.pipe(Object(o.a)(t=>t?t.productVariants.items:[])),this.contentsTotalItems$=e.pipe(Object(o.a)(t=>t?t.productVariants.totalItems:0))}ngOnChanges(t){"collectionId"in t&&this.collectionIdChange$.next(t.collectionId.currentValue)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setContentsPageNumber(t){this.setParam("contentsPage",t)}setContentsItemsPerPage(t){this.setParam("contentsPerPage",t)}refresh(){this.refresh$.next(!0)}setParam(t,e){this.router.navigate(["./",Object.assign(Object.assign({},this.route.snapshot.params),{[t]:e})],{relativeTo:this.route,queryParamsHandling:"merge"})}}Y.\u0275fac=function(t){return new(t||Y)(s.bc(n.a),s.bc(n.e),s.bc(a.s))},Y.\u0275cmp=s.Vb({type:Y,selectors:[["vdr-collection-contents"]],contentQueries:function(t,e,c){if(1&t&&s.Ub(c,s.ab,3),2&t){let t;s.Hc(t=s.qc())&&(e.headerTemplate=t.first)}},inputs:{collectionId:"collectionId"},features:[s.Ob],decls:12,vars:22,consts:[[1,"contents-header"],[1,"header-title-row"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["type","text",3,"placeholder","formControl"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"left","align-middle"],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"]],template:function(t,e){1&t&&(s.hc(0,"div",0),s.hc(1,"div",1),s.Tc(2,H,1,0,"ng-container",2),s.sc(3,"async"),s.gc(),s.cc(4,"input",3),s.sc(5,"translate"),s.gc(),s.hc(6,"vdr-data-table",4),s.pc("pageChange",function(t){return e.setContentsPageNumber(t)})("itemsPerPageChange",function(t){return e.setContentsItemsPerPage(t)}),s.sc(7,"async"),s.sc(8,"async"),s.sc(9,"async"),s.sc(10,"async"),s.Tc(11,K,5,9,"ng-template"),s.gc()),2&t&&(s.Qb(2),s.yc("ngTemplateOutlet",e.headerTemplate)("ngTemplateOutletContext",s.Cc(20,Z,s.tc(3,8,e.contentsTotalItems$))),s.Qb(2),s.yc("placeholder",s.tc(5,10,"catalog.filter-by-name"))("formControl",e.filterTermControl),s.Qb(2),s.yc("items",s.tc(7,12,e.contents$))("itemsPerPage",s.tc(8,14,e.contentsItemsPerPage$))("totalItems",s.tc(9,16,e.contentsTotalItems$))("currentPage",s.tc(10,18,e.contentsCurrentPage$)))},directives:[h.t,B.a,r.b,r.p,r.g,X.a,R.a],pipes:[h.b,m.d],styles:[".contents-header[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);position:sticky;top:0;padding:6px;z-index:1;border-bottom:1px solid var(--color-component-border-200)}.contents-header[_ngcontent-%COMP%]   .header-title-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.contents-header[_ngcontent-%COMP%]   .clr-input[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]     table{margin-top:-1px}"],changeDetection:0});const J=["collectionContents"];function tt(t,e){if(1&t){const t=s.ic();s.hc(0,"button",6),s.pc("click",function(){s.Lc(t);return s.rc().create()}),s.Vc(1),s.sc(2,"translate"),s.gc()}if(2&t){const t=s.rc();s.yc("disabled",t.detailForm.invalid||t.detailForm.pristine),s.Qb(1),s.Xc(" ",s.tc(2,2,"common.create")," ")}}function et(t,e){if(1&t){const t=s.ic();s.hc(0,"button",6),s.pc("click",function(){s.Lc(t);return s.rc(2).save()}),s.Vc(1),s.sc(2,"translate"),s.gc()}if(2&t){const t=s.rc(2);s.yc("disabled",(t.detailForm.invalid||t.detailForm.pristine)&&!t.assetsChanged()),s.Qb(1),s.Xc(" ",s.tc(2,2,"common.update")," ")}}function ct(t,e){if(1&t&&s.Tc(0,et,3,4,"button",7),2&t){const t=s.rc();s.yc("vdrIfPermissions",t.updatePermission)}}function nt(t,e){1&t&&(s.fc(0),s.Vc(1),s.sc(2,"translate"),s.ec()),2&t&&(s.Qb(1),s.Wc(s.tc(2,1,"catalog.public")))}function at(t,e){1&t&&(s.Vc(0),s.sc(1,"translate")),2&t&&s.Wc(s.tc(1,1,"catalog.private"))}const it=function(){return["customFields"]};function ot(t,e){if(1&t&&s.cc(0,"vdr-custom-field-control",31),2&t){const t=s.rc().$implicit,e=s.rc(3);s.yc("customFieldsFormGroup",e.detailForm.get(s.Bc(2,it)))("customField",t)}}function rt(t,e){if(1&t&&(s.fc(0),s.Tc(1,ot,1,3,"vdr-custom-field-control",30),s.ec()),2&t){const t=e.$implicit,c=s.rc(3);s.Qb(1),s.yc("ngIf",c.customFieldIsSet(t.name))}}function st(t,e){if(1&t&&(s.hc(0,"section",29),s.hc(1,"label"),s.Vc(2),s.sc(3,"translate"),s.gc(),s.Tc(4,rt,2,1,"ng-container",25),s.gc()),2&t){const t=s.rc(2);s.Qb(2),s.Wc(s.tc(3,2,"common.custom-fields")),s.Qb(2),s.yc("ngForOf",t.customFields)}}function lt(t,e){if(1&t){const t=s.ic();s.fc(0),s.hc(1,"vdr-configurable-input",32),s.pc("remove",function(e){s.Lc(t);return s.rc(2).removeFilter(e)}),s.sc(2,"hasPermission"),s.gc(),s.ec()}if(2&t){const t=e.$implicit,c=e.index,n=s.rc(2);s.Qb(1),s.yc("operation",t)("operationDefinition",n.getFilterDefinition(t))("formControlName",c)("readonly",!s.tc(2,4,n.updatePermission))}}function dt(t,e){if(1&t){const t=s.ic();s.hc(0,"button",37),s.pc("click",function(){s.Lc(t);const c=e.$implicit;return s.rc(3).addFilter(c)}),s.Vc(1),s.gc()}if(2&t){const t=e.$implicit;s.Qb(1),s.Xc(" ",t.description," ")}}function ut(t,e){if(1&t&&(s.hc(0,"div"),s.hc(1,"vdr-dropdown"),s.hc(2,"button",33),s.cc(3,"clr-icon",34),s.Vc(4),s.sc(5,"translate"),s.gc(),s.hc(6,"vdr-dropdown-menu",35),s.Tc(7,dt,2,1,"button",36),s.gc(),s.gc(),s.gc()),2&t){const t=s.rc(2);s.Qb(4),s.Xc(" ",s.tc(5,2,"marketing.add-condition")," "),s.Qb(3),s.yc("ngForOf",t.allFilters)}}const pt=function(t){return{count:t}};function gt(t,e){if(1&t&&(s.hc(0,"div",38),s.Vc(1),s.sc(2,"translate"),s.sc(3,"translate"),s.gc()),2&t){const t=e.$implicit;s.Qb(1),s.Yc(" ",s.tc(2,2,"catalog.collection-contents")," (",s.uc(3,4,"common.results-count",s.Cc(7,pt,t)),") ")}}const ht=function(t){return{pattern:t}};function mt(t,e){if(1&t){const t=s.ic();s.hc(0,"form",8),s.hc(1,"div",9),s.hc(2,"div",10),s.hc(3,"vdr-form-field",11),s.sc(4,"translate"),s.hc(5,"clr-toggle-wrapper"),s.cc(6,"input",12),s.sc(7,"hasPermission"),s.hc(8,"label",13),s.Tc(9,nt,3,3,"ng-container",14),s.Tc(10,at,2,3,"ng-template",null,15,s.Uc),s.gc(),s.gc(),s.gc(),s.hc(12,"vdr-form-field",16),s.sc(13,"translate"),s.hc(14,"input",17),s.pc("input",function(e){s.Lc(t);return s.rc().updateSlug(e.target.value)}),s.sc(15,"hasPermission"),s.gc(),s.gc(),s.hc(16,"vdr-form-field",18),s.sc(17,"translate"),s.sc(18,"translate"),s.cc(19,"input",19),s.sc(20,"hasPermission"),s.gc(),s.cc(21,"vdr-rich-text-editor",20),s.sc(22,"hasPermission"),s.sc(23,"translate"),s.Tc(24,st,5,4,"section",21),s.gc(),s.hc(25,"div",22),s.hc(26,"vdr-product-assets",23),s.pc("change",function(e){s.Lc(t);return s.rc().assetChanges=e}),s.gc(),s.gc(),s.gc(),s.hc(27,"div",24),s.hc(28,"div",10),s.hc(29,"label"),s.Vc(30),s.sc(31,"translate"),s.gc(),s.Tc(32,lt,3,6,"ng-container",25),s.Tc(33,ut,8,4,"div",26),s.gc(),s.hc(34,"div",10),s.hc(35,"vdr-collection-contents",27,28),s.Tc(37,gt,4,9,"ng-template"),s.gc(),s.gc(),s.gc(),s.gc()}if(2&t){const t=e.ngIf,c=s.Ic(11),n=s.rc();s.yc("formGroup",n.detailForm),s.Qb(3),s.yc("label",s.tc(4,19,"catalog.visibility")),s.Qb(3),s.yc("vdrDisabled",!s.tc(7,21,n.updatePermission)),s.Qb(3),s.yc("ngIf",n.detailForm.value.visible)("ngIfElse",c),s.Qb(3),s.yc("label",s.tc(13,23,"common.name")),s.Qb(2),s.yc("readonly",!s.tc(15,25,n.updatePermission)),s.Qb(2),s.yc("label",s.tc(17,27,"catalog.slug"))("errors",s.Cc(39,ht,s.tc(18,29,"catalog.slug-pattern-error"))),s.Qb(3),s.yc("readonly",!s.tc(20,31,n.updatePermission)),s.Qb(2),s.yc("readonly",!s.tc(22,33,n.updatePermission))("label",s.tc(23,35,"common.description")),s.Qb(3),s.yc("ngIf",n.customFields.length),s.Qb(2),s.yc("assets",t.assets)("featuredAsset",t.featuredAsset),s.Qb(4),s.Wc(s.tc(31,37,"catalog.filters")),s.Qb(2),s.yc("ngForOf",n.filters),s.Qb(1),s.yc("vdrIfPermissions",n.updatePermission),s.Qb(2),s.yc("collectionId",n.id)}}class ft extends a.l{constructor(t,e,c,n,i,o,s,l){super(e,t,c,i),this.changeDetector=n,this.dataService=i,this.formBuilder=o,this.notificationService=s,this.modalService=l,this.assetChanges={},this.filters=[],this.allFilters=[],this.updatePermission=[a.H.UpdateCatalog,a.H.UpdateCollection],this.customFields=this.getCustomFieldConfig("Collection"),this.detailForm=this.formBuilder.group({name:["",r.C.required],slug:"",description:"",visible:!1,filters:this.formBuilder.array([]),customFields:this.formBuilder.group(this.customFields.reduce((t,e)=>Object.assign(Object.assign({},t),{[e.name]:""}),{}))})}ngOnInit(){this.init(),this.dataService.collection.getCollectionFilters().single$.subscribe(t=>{this.allFilters=t.collectionFilters})}ngOnDestroy(){this.destroy()}getFilterDefinition(t){return this.allFilters.find(e=>e.code===t.code)}customFieldIsSet(t){return!!this.detailForm.get(["customFields",t])}assetsChanged(){return!!Object.values(this.assetChanges).length}updateSlug(t){Object(C.a)(this.entity$,this.languageCode$).pipe(Object(_.a)(1)).subscribe(([e,c])=>{const n=this.detailForm.get(["slug"]),i=Object(a.S)(e,c),o=!i||!i.slug;n&&n.pristine&&o&&n.setValue(Object(A.normalizeString)(`${t}`,"-"))})}addFilter(t){const e=this.detailForm.get("filters");if(-1===e.value.findIndex(e=>e.code===t.code)){const c=t.args.reduce((t,e)=>Object.assign(Object.assign({},t),{[e.name]:Object(a.V)(e.value)}),{});e.push(this.formBuilder.control({code:t.code,args:c})),this.filters.push({code:t.code,args:t.args.map(t=>({name:t.name,value:Object(a.V)(t.value)}))})}}removeFilter(t){const e=this.detailForm.get("filters"),c=e.value.findIndex(e=>e.code===t.code);-1!==c&&(e.removeAt(c),this.filters.splice(c,1))}create(){this.detailForm.dirty&&Object(C.a)(this.entity$,this.languageCode$).pipe(Object(_.a)(1),Object(L.a)(([t,e])=>{const c=this.getUpdatedCollection(t,this.detailForm,e),n=this.route.snapshot.paramMap.get("parentId");return n&&(c.parentId=n),this.dataService.collection.createCollection(c)})).subscribe(t=>{this.notificationService.success(Object(i.a)("common.notify-create-success"),{entity:"Collection"}),this.assetChanges={},this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.router.navigate(["../",t.createCollection.id],{relativeTo:this.route})},t=>{this.notificationService.error(Object(i.a)("common.notify-create-error"),{entity:"Collection"})})}save(){Object(C.a)(this.entity$,this.languageCode$).pipe(Object(_.a)(1),Object(L.a)(([t,e])=>{const c=this.getUpdatedCollection(t,this.detailForm,e);return this.dataService.collection.updateCollection(c)})).subscribe(()=>{this.assetChanges={},this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success(Object(i.a)("common.notify-update-success"),{entity:"Collection"}),this.contentsComponent.refresh()},t=>{this.notificationService.error(Object(i.a)("common.notify-update-error"),{entity:"Collection"})})}canDeactivate(){return super.canDeactivate()&&!this.assetChanges.assets&&!this.assetChanges.featuredAsset}setFormValues(t,e){const c=Object(a.S)(t,e);if(this.detailForm.patchValue({name:c?c.name:"",slug:c?c.slug:"",description:c?c.description:"",visible:!t.isPrivate}),t.filters.forEach(t=>this.addFilter(t)),this.customFields.length){const e=this.detailForm.get(["customFields"]);for(const n of this.customFields){const a=n.name,i="localeString"===n.type?c.customFields[a]:t.customFields[a],o=e.get(a);o&&o.patchValue(i)}}}getUpdatedCollection(t,e,c){var n,i;const o=Object(a.P)({translatable:t,updatedFields:e.value,customFieldConfig:this.customFields,languageCode:c,defaultTranslation:{languageCode:c,name:t.name||"",slug:t.slug||"",description:t.description||""}});return Object.assign(Object.assign({},o),{assetIds:null===(n=this.assetChanges.assets)||void 0===n?void 0:n.map(t=>t.id),featuredAssetId:null===(i=this.assetChanges.featuredAsset)||void 0===i?void 0:i.id,isPrivate:!e.value.visible,filters:this.mapOperationsToInputs(this.filters,this.detailForm.value.filters)})}mapOperationsToInputs(t,e){return t.map((t,c)=>({code:t.code,arguments:Object.values(e[c].args).map((e,c)=>({name:t.args[c].name,value:Object(a.R)(e)}))}))}}ft.\u0275fac=function(t){return new(t||ft)(s.bc(n.e),s.bc(n.a),s.bc(a.I),s.bc(s.j),s.bc(a.s),s.bc(r.e),s.bc(a.G),s.bc(a.F))},ft.\u0275cmp=s.Vb({type:ft,selectors:[["vdr-collection-detail"]],viewQuery:function(t,e){if(1&t&&s.ad(J,1),2&t){let t;s.Hc(t=s.qc())&&(e.contentsComponent=t.first)}},features:[s.Nb],decls:16,vars:19,consts:[[3,"entity"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","collection-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup"],[1,"clr-row"],[1,"clr-col"],["for","visibility",3,"label"],["type","checkbox","clrToggle","","formControlName","visible","id","visibility",3,"vdrDisabled"],[1,"visible-toggle"],[4,"ngIf","ngIfElse"],["private",""],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],["for","slug",3,"label","errors"],["id","slug","type","text","formControlName","slug","pattern","[a-z0-9_-]+",3,"readonly"],["formControlName","description",3,"readonly","label"],["formGroupName","customFields",4,"ngIf"],[1,"clr-col-md-auto"],[3,"assets","featuredAsset","change"],["formArrayName","filters",1,"clr-row"],[4,"ngFor","ngForOf"],[4,"vdrIfPermissions"],[3,"collectionId"],["collectionContents",""],["formGroupName","customFields"],["entityName","Collection",3,"customFieldsFormGroup","customField",4,"ngIf"],["entityName","Collection",3,"customFieldsFormGroup","customField"],[3,"operation","operationDefinition","formControlName","readonly","remove"],["vdrDropdownTrigger","",1,"btn","btn-outline"],["shape","plus"],["vdrPosition","bottom-left"],["type","button","vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["type","button","vdrDropdownItem","",3,"click"],[1,"contents-title"]],template:function(t,e){if(1&t&&(s.hc(0,"vdr-action-bar"),s.hc(1,"vdr-ab-left"),s.cc(2,"vdr-entity-info",0),s.sc(3,"async"),s.hc(4,"vdr-language-selector",1),s.pc("languageCodeChange",function(t){return e.setLanguage(t)}),s.sc(5,"async"),s.sc(6,"async"),s.sc(7,"async"),s.gc(),s.gc(),s.hc(8,"vdr-ab-right"),s.cc(9,"vdr-action-bar-items",2),s.Tc(10,tt,3,4,"button",3),s.sc(11,"async"),s.Tc(12,ct,1,1,"ng-template",null,4,s.Uc),s.gc(),s.gc(),s.Tc(14,mt,38,41,"form",5),s.sc(15,"async")),2&t){const t=s.Ic(13);s.Qb(2),s.yc("entity",s.tc(3,7,e.entity$)),s.Qb(2),s.yc("disabled",s.tc(5,9,e.isNew$))("availableLanguageCodes",s.tc(6,11,e.availableLanguages$))("currentLanguageCode",s.tc(7,13,e.languageCode$)),s.Qb(6),s.yc("ngIf",s.tc(11,15,e.isNew$))("ngIfElse",t),s.Qb(4),s.yc("ngIf",s.tc(15,17,e.entity$))}},styles:[".visible-toggle[_ngcontent-%COMP%]{margin-top:-3px!important}"],changeDetection:0});var bt=c("UXun"),vt=c("8MG2");function yt(t,e){var c,n;const a=[],i={},o=function(t){const e=new Map;function c(t){e.set(t.id,t),t.children.forEach(c)}t&&c(t);return e}(e);for(const r of t)i[r.id]=Object.assign(Object.assign({},r),{children:[]});for(const r of t.map(t=>t.id))if(i.hasOwnProperty(r)){const t=i[r];t.expanded=null!==(n=null===(c=o.get(r))||void 0===c?void 0:c.expanded)&&void 0!==n&&n;const e=t.parent;if(!e)continue;!i[e.id]?a.push(t):i[e.id]?i[e.id].children.push(t):i[e.id]={children:[t]}}return{id:a.length?a[0].parent.id:void 0,children:a}}function Ct(t,e){if(1&t&&s.cc(0,"vdr-collection-tree-node",1),2&t){const t=s.rc();s.yc("expandAll",t.expandAll)("collectionTree",t.collectionTree)("activeCollectionId",t.activeCollectionId)}}class Ot{constructor(){this.expandAll=!1,this.rearrange=new s.t,this.deleteCollection=new s.t}ngOnChanges(t){"collections"in t&&this.collections&&(this.collectionTree=yt(this.collections,this.collectionTree))}onDrop(t){const e=t.item.data,c=t.container.data.id;if(null==c)throw new Error("Could not determine the ID of the root Collection");this.rearrange.emit({collectionId:e.id,parentId:c,index:t.currentIndex})}onMove(t){this.rearrange.emit(t)}onDelete(t){this.deleteCollection.emit(t)}isRootNode(t){return!t.hasOwnProperty("parent")}}Ot.\u0275fac=function(t){return new(t||Ot)},Ot.\u0275cmp=s.Vb({type:Ot,selectors:[["vdr-collection-tree"]],inputs:{collections:"collections",activeCollectionId:"activeCollectionId",expandAll:"expandAll"},outputs:{rearrange:"rearrange",deleteCollection:"deleteCollection"},features:[s.Ob],decls:1,vars:1,consts:[["cdkDropListGroup","",3,"expandAll","collectionTree","activeCollectionId",4,"ngIf"],["cdkDropListGroup","",3,"expandAll","collectionTree","activeCollectionId"]],template:function(t,e){1&t&&s.Tc(0,Ct,1,3,"vdr-collection-tree-node",0),2&t&&s.yc("ngIf",e.collectionTree)},styles:[""],changeDetection:0});const Pt=function(){return["./create"]};function Ft(t,e){1&t&&(s.hc(0,"a",8),s.cc(1,"clr-icon",9),s.Vc(2),s.sc(3,"translate"),s.gc()),2&t&&(s.yc("routerLink",s.Bc(4,Pt)),s.Qb(2),s.Xc(" ",s.tc(3,2,"catalog.create-new-collection")," "))}const It=function(t){return{count:t}};function Vt(t,e){if(1&t){const t=s.ic();s.hc(0,"div",10),s.Vc(1),s.sc(2,"async"),s.sc(3,"translate"),s.gc(),s.hc(4,"button",11),s.pc("click",function(){s.Lc(t);return s.rc().closeContents()}),s.cc(5,"clr-icon",12),s.gc()}if(2&t){const t=e.$implicit,c=s.rc();s.Qb(1),s.Yc(" ",s.tc(2,2,c.activeCollectionTitle$)," (",s.uc(3,4,"common.results-count",s.Cc(7,It,t)),") ")}}const kt=function(){return["CreateCatalog","CreateCollection"]};class xt{constructor(t,e,c,n,a){this.dataService=t,this.notificationService=e,this.modalService=c,this.router=n,this.route=a,this.expandAll=!1}ngOnInit(){this.queryResult=this.dataService.collection.getCollections(1e3,0).refetchOnChannelChange(),this.items$=this.queryResult.mapStream(t=>t.collections.items).pipe(Object(bt.a)(1)),this.activeCollectionId$=this.route.paramMap.pipe(Object(o.a)(t=>t.get("contents")),Object(W.a)()),this.activeCollectionTitle$=Object(C.a)(this.activeCollectionId$,this.items$).pipe(Object(o.a)(([t,e])=>{if(t){const c=e.find(e=>e.id===t);return c?c.name:""}return""}))}ngOnDestroy(){this.queryResult.completed$.next()}onRearrange(t){this.dataService.collection.moveCollection([t]).subscribe({next:()=>{this.notificationService.success(Object(i.a)("common.notify-saved-changes")),this.refresh()},error:t=>{this.notificationService.error(Object(i.a)("common.notify-save-changes-error"))}})}deleteCollection(t){this.items$.pipe(Object(_.a)(1),Object(o.a)(e=>-1<e.findIndex(e=>e.parent&&e.parent.id===t)),Object(V.a)(t=>this.modalService.dialog({title:Object(i.a)("catalog.confirm-delete-collection"),body:t?Object(i.a)("catalog.confirm-delete-collection-and-children-body"):void 0,buttons:[{type:"secondary",label:Object(i.a)("common.cancel")},{type:"danger",label:Object(i.a)("common.delete"),returnValue:!0}]})),Object(V.a)(e=>e?this.dataService.collection.deleteCollection(t):O.a)).subscribe(()=>{this.notificationService.success(Object(i.a)("common.notify-delete-success"),{entity:"Collection"}),this.refresh()},t=>{this.notificationService.error(Object(i.a)("common.notify-delete-error"),{entity:"Collection"})})}closeContents(){const t=Object.assign({},this.route.snapshot.params);delete t.contents,this.router.navigate(["./",t],{relativeTo:this.route,queryParamsHandling:"preserve"})}refresh(){this.queryResult.ref.refetch()}}xt.\u0275fac=function(t){return new(t||xt)(s.bc(a.s),s.bc(a.G),s.bc(a.F),s.bc(n.e),s.bc(n.a))},xt.\u0275cmp=s.Vb({type:xt,selectors:[["vdr-collection-list"]],decls:19,vars:20,consts:[[1,"expand-all-toggle","ml3"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],["locationId","collection-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[1,"collection-wrapper"],[3,"collections","activeCollectionId","expandAll","rearrange","deleteCollection"],[1,"collection-contents"],[3,"collectionId"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"collection-title"],["type","button",1,"close-button",3,"click"],["shape","close"]],template:function(t,e){1&t&&(s.hc(0,"vdr-action-bar"),s.hc(1,"vdr-ab-left"),s.hc(2,"clr-checkbox-wrapper",0),s.hc(3,"input",1),s.pc("ngModelChange",function(t){return e.expandAll=t}),s.gc(),s.hc(4,"label"),s.Vc(5),s.sc(6,"translate"),s.gc(),s.gc(),s.gc(),s.hc(7,"vdr-ab-right"),s.cc(8,"vdr-action-bar-items",2),s.Tc(9,Ft,4,5,"a",3),s.gc(),s.gc(),s.hc(10,"div",4),s.hc(11,"vdr-collection-tree",5),s.pc("rearrange",function(t){return e.onRearrange(t)})("deleteCollection",function(t){return e.deleteCollection(t)}),s.sc(12,"async"),s.sc(13,"async"),s.gc(),s.hc(14,"div",6),s.sc(15,"async"),s.hc(16,"vdr-collection-contents",7),s.sc(17,"async"),s.Tc(18,Vt,6,9,"ng-template"),s.gc(),s.gc(),s.gc()),2&t&&(s.Qb(3),s.yc("ngModel",e.expandAll),s.Qb(2),s.Wc(s.tc(6,9,"catalog.expand-all-collections")),s.Qb(4),s.yc("vdrIfPermissions",s.Bc(19,kt)),s.Qb(2),s.yc("collections",s.tc(12,11,e.items$))("activeCollectionId",s.tc(13,13,e.activeCollectionId$))("expandAll",e.expandAll),s.Qb(3),s.Tb("expanded",s.tc(15,15,e.activeCollectionId$)),s.Qb(2),s.yc("collectionId",s.tc(17,17,e.activeCollectionId$)))},directives:[l.a,l.b,vt.k,B.a,r.a,vt.i,r.p,r.s,vt.u,l.c,u.a,p.a,Ot,Y,n.h,vt.o],pipes:[m.d,h.b],styles:["[_nghost-%COMP%]{height:100%;display:flex;flex-direction:column}.expand-all-toggle[_ngcontent-%COMP%]{display:block;margin-top:14px}.collection-wrapper[_ngcontent-%COMP%]{display:flex;height:calc(100% - 50px)}.collection-wrapper[_ngcontent-%COMP%]   vdr-collection-tree[_ngcontent-%COMP%]{flex:1;height:100%;overflow:auto}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents[_ngcontent-%COMP%]{height:100%;width:0;opacity:0;visibility:hidden;overflow:auto;transition:width .3s,opacity .2s .3s,visibility 0s .3s}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents.expanded[_ngcontent-%COMP%]{width:30vw;visibility:visible;opacity:1;padding-left:12px}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{margin:0;background:none;border:none;cursor:pointer}.paging-controls[_ngcontent-%COMP%]{padding-top:6px;border-top:1px solid var(--color-component-border-100);display:flex;justify-content:space-between}"],changeDetection:0});var Tt=c("cOim"),Qt=c("cp0P"),jt=c("CqXF"),Mt=c("40ut"),wt=c("1XD6"),St=c("Fh+9"),Dt=c("Lbhx"),$t=c("zzDm"),At=c("eBFp"),_t=c("IKcI"),Lt=c("EFLa");function Nt(t,e){if(1&t){const t=s.ic();s.hc(0,"button",6),s.pc("click",function(){s.Lc(t);return s.rc().create()}),s.Vc(1),s.sc(2,"translate"),s.gc()}if(2&t){const t=s.rc();s.yc("disabled",t.detailForm.invalid||t.detailForm.pristine),s.Qb(1),s.Xc(" ",s.tc(2,2,"common.create")," ")}}function Gt(t,e){if(1&t){const t=s.ic();s.hc(0,"button",6),s.pc("click",function(){s.Lc(t);return s.rc(2).save()}),s.Vc(1),s.sc(2,"translate"),s.gc()}if(2&t){const t=s.rc(2);s.yc("disabled",t.detailForm.invalid||t.detailForm.pristine),s.Qb(1),s.Xc(" ",s.tc(2,2,"common.update")," ")}}function Et(t,e){if(1&t&&s.Tc(0,Gt,3,4,"button",7),2&t){const t=s.rc();s.yc("vdrIfPermissions",t.updatePermission)}}function Wt(t,e){1&t&&(s.fc(0),s.Vc(1),s.sc(2,"translate"),s.ec()),2&t&&(s.Qb(1),s.Wc(s.tc(2,1,"catalog.public")))}function Ut(t,e){1&t&&(s.Vc(0),s.sc(1,"translate")),2&t&&s.Wc(s.tc(1,1,"catalog.private"))}const Bt=function(){return["facet","customFields"]};function Xt(t,e){if(1&t&&s.cc(0,"vdr-custom-field-control",24),2&t){const t=s.rc().$implicit,e=s.rc(3);s.yc("customFieldsFormGroup",e.detailForm.get(s.Bc(2,Bt)))("customField",t)}}function Rt(t,e){if(1&t&&(s.fc(0),s.Tc(1,Xt,1,3,"vdr-custom-field-control",23),s.ec()),2&t){const t=e.$implicit,c=s.rc(3);s.Qb(1),s.yc("ngIf",c.customFieldIsSet(t.name))}}function Ht(t,e){if(1&t&&(s.hc(0,"section",21),s.hc(1,"label"),s.Vc(2),s.sc(3,"translate"),s.gc(),s.Tc(4,Rt,2,1,"ng-container",22),s.gc()),2&t){const t=s.rc(2);s.Qb(2),s.Wc(s.tc(3,2,"common.custom-fields")),s.Qb(2),s.yc("ngForOf",t.customFields)}}function zt(t,e){if(1&t&&(s.fc(0),s.hc(1,"th"),s.Vc(2),s.gc(),s.ec()),2&t){const t=e.$implicit;s.Qb(2),s.Wc(t.name)}}const qt=function(t){return["values",t,"customFields"]};function Kt(t,e){if(1&t&&s.cc(0,"vdr-custom-field-control",40),2&t){const t=s.rc().$implicit,e=s.rc().index,c=s.rc(4);s.yc("showLabel",!1)("customFieldsFormGroup",c.detailForm.get(s.Cc(3,qt,e)))("customField",t)}}function Zt(t,e){if(1&t&&(s.fc(0),s.hc(1,"td",31),s.Tc(2,Kt,1,5,"vdr-custom-field-control",39),s.gc(),s.ec()),2&t){const t=e.$implicit,c=s.rc().index,n=s.rc(4);s.Qb(2),s.yc("ngIf",n.customValueFieldIsSet(c,t.name))}}function Yt(t,e){if(1&t){const t=s.ic();s.hc(0,"tr",30),s.hc(1,"td",31),s.cc(2,"vdr-entity-info",0),s.gc(),s.hc(3,"td",31),s.hc(4,"input",32),s.pc("input",function(c){s.Lc(t);const n=e.index,a=s.rc(3).ngIf;return s.rc().updateValueCode(null==a.values[n]?null:a.values[n].code,c.target.value,n)}),s.sc(5,"hasPermission"),s.gc(),s.gc(),s.hc(6,"td",31),s.cc(7,"input",33),s.gc(),s.Tc(8,Zt,3,1,"ng-container",22),s.hc(9,"td",31),s.hc(10,"vdr-dropdown"),s.hc(11,"button",34),s.Vc(12),s.sc(13,"translate"),s.cc(14,"clr-icon",35),s.gc(),s.hc(15,"vdr-dropdown-menu",36),s.hc(16,"button",37),s.pc("click",function(){s.Lc(t);const c=e.index,n=s.rc(3).ngIf;return s.rc().deleteFacetValue(null==n.values[c]?null:n.values[c].id,c)}),s.sc(17,"hasPermission"),s.cc(18,"clr-icon",38),s.Vc(19),s.sc(20,"translate"),s.gc(),s.gc(),s.gc(),s.gc(),s.gc()}if(2&t){const t=e.$implicit,c=e.index,n=s.rc(4);s.yc("formGroupName",c),s.Qb(2),s.yc("entity",t),s.Qb(2),s.yc("readonly",!s.tc(5,7,n.updatePermission)),s.Qb(4),s.yc("ngForOf",n.customValueFields),s.Qb(4),s.Xc(" ",s.tc(13,9,"common.actions")," "),s.Qb(4),s.yc("disabled",!s.tc(17,11,n.updatePermission)),s.Qb(3),s.Xc(" ",s.tc(20,13,"common.delete")," ")}}function Jt(t,e){if(1&t&&(s.hc(0,"table",28),s.hc(1,"thead"),s.hc(2,"tr"),s.cc(3,"th"),s.hc(4,"th"),s.Vc(5),s.sc(6,"translate"),s.gc(),s.hc(7,"th"),s.Vc(8),s.sc(9,"translate"),s.gc(),s.Tc(10,zt,3,1,"ng-container",22),s.cc(11,"th"),s.gc(),s.gc(),s.hc(12,"tbody"),s.Tc(13,Yt,21,15,"tr",29),s.gc(),s.gc()),2&t){const t=s.rc(3);s.Qb(5),s.Wc(s.tc(6,4,"common.name")),s.Qb(3),s.Wc(s.tc(9,6,"common.code")),s.Qb(2),s.yc("ngForOf",t.customValueFields),s.Qb(3),s.yc("ngForOf",t.values)}}function te(t,e){if(1&t){const t=s.ic();s.hc(0,"button",41),s.pc("click",function(){s.Lc(t);return s.rc(3).addFacetValue()}),s.cc(1,"clr-icon",42),s.Vc(2),s.sc(3,"translate"),s.gc()}2&t&&(s.Qb(2),s.Xc(" ",s.tc(3,1,"catalog.add-facet-value")," "))}const ee=function(){return["CreateCatalog","CreateFacet"]};function ce(t,e){if(1&t&&(s.hc(0,"section",25),s.hc(1,"label"),s.Vc(2),s.sc(3,"translate"),s.gc(),s.Tc(4,Jt,14,8,"table",26),s.hc(5,"div"),s.Tc(6,te,4,3,"button",27),s.gc(),s.gc()),2&t){const t=s.rc(2);s.Qb(2),s.Wc(s.tc(3,3,"catalog.facet-values")),s.Qb(2),s.yc("ngIf",0<t.getValuesFormArray().length),s.Qb(2),s.yc("vdrIfPermissions",s.Bc(5,ee))}}function ne(t,e){if(1&t){const t=s.ic();s.hc(0,"form",8),s.hc(1,"section",9),s.hc(2,"vdr-form-field",10),s.sc(3,"translate"),s.hc(4,"clr-toggle-wrapper"),s.cc(5,"input",11),s.sc(6,"hasPermission"),s.hc(7,"label",12),s.Tc(8,Wt,3,3,"ng-container",13),s.Tc(9,Ut,2,3,"ng-template",null,14,s.Uc),s.gc(),s.gc(),s.gc(),s.hc(11,"vdr-form-field",15),s.sc(12,"translate"),s.hc(13,"input",16),s.pc("input",function(c){s.Lc(t);const n=e.ngIf;return s.rc().updateCode(n.code,c.target.value)}),s.sc(14,"hasPermission"),s.gc(),s.gc(),s.hc(15,"vdr-form-field",17),s.sc(16,"translate"),s.sc(17,"hasPermission"),s.cc(18,"input",18),s.sc(19,"hasPermission"),s.gc(),s.Tc(20,Ht,5,4,"section",19),s.gc(),s.Tc(21,ce,7,6,"section",20),s.sc(22,"async"),s.gc()}if(2&t){const t=s.Ic(10),e=s.rc();s.yc("formGroup",e.detailForm),s.Qb(2),s.yc("label",s.tc(3,12,"catalog.visibility")),s.Qb(3),s.yc("vdrDisabled",!s.tc(6,14,e.updatePermission)),s.Qb(3),s.yc("ngIf",e.detailForm.value.facet.visible)("ngIfElse",t),s.Qb(3),s.yc("label",s.tc(12,16,"common.name")),s.Qb(2),s.yc("readonly",!s.tc(14,18,e.updatePermission)),s.Qb(2),s.yc("label",s.tc(16,20,"common.code"))("readOnlyToggle",s.tc(17,22,e.updatePermission)),s.Qb(3),s.yc("readonly",!s.tc(19,24,e.updatePermission)),s.Qb(2),s.yc("ngIf",e.customFields.length),s.Qb(1),s.yc("ngIf",!s.tc(22,26,e.isNew$))}}class ae extends a.l{constructor(t,e,c,n,i,o,s,l){super(e,t,c,i),this.changeDetector=n,this.dataService=i,this.formBuilder=o,this.notificationService=s,this.modalService=l,this.updatePermission=[a.H.UpdateCatalog,a.H.UpdateFacet],this.customFields=this.getCustomFieldConfig("Facet"),this.customValueFields=this.getCustomFieldConfig("FacetValue"),this.detailForm=this.formBuilder.group({facet:this.formBuilder.group({code:["",r.C.required],name:"",visible:!0,customFields:this.formBuilder.group(this.customFields.reduce((t,e)=>Object.assign(Object.assign({},t),{[e.name]:""}),{}))}),values:this.formBuilder.array([])})}ngOnInit(){this.init()}ngOnDestroy(){this.destroy()}updateCode(t,e){if(!t){const t=this.detailForm.get(["facet","code"]);t&&t.pristine&&t.setValue(Object(A.normalizeString)(e,"-"))}}updateValueCode(t,e,c){if(!t){const t=this.detailForm.get(["values",c,"code"]);t&&t.pristine&&t.setValue(Object(A.normalizeString)(e,"-"))}}customFieldIsSet(t){return!!this.detailForm.get(["facet","customFields",t])}customValueFieldIsSet(t,e){return!!this.detailForm.get(["values",t,"customFields",e])}getValuesFormArray(){return this.detailForm.get("values")}addFacetValue(){const t=this.detailForm.get("values");t&&(t.insert(t.length,this.formBuilder.group({id:"",name:["",r.C.required],code:""})),this.values.push({name:"",code:""}))}create(){const t=this.detailForm.get("facet");t&&t.dirty&&Object(C.a)(this.entity$,this.languageCode$).pipe(Object(_.a)(1),Object(L.a)(([e,c])=>{const n=this.getUpdatedFacet(e,t,c);return this.dataService.facet.createFacet(n)}),Object(V.a)(t=>this.dataService.facet.getAllFacets().single$.pipe(Object(jt.a)(t)))).subscribe(t=>{this.notificationService.success(Object(i.a)("common.notify-create-success"),{entity:"Facet"}),this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.router.navigate(["../",t.createFacet.id],{relativeTo:this.route})},t=>{this.notificationService.error(Object(i.a)("common.notify-create-error"),{entity:"Facet"})})}save(){Object(C.a)(this.entity$,this.languageCode$).pipe(Object(_.a)(1),Object(L.a)(([t,e])=>{const c=this.detailForm.get("facet"),n=[];if(c&&c.dirty){const a=this.getUpdatedFacet(t,c,e);a&&n.push(this.dataService.facet.updateFacet(a))}const a=this.detailForm.get("values");if(a&&a.dirty){const c=a.controls.filter(t=>!t.value.id).map(c=>({facetId:t.id,code:c.value.code,translations:[{name:c.value.name,languageCode:e}]}));c.length&&n.push(this.dataService.facet.createFacetValues(c).pipe(Object(V.a)(()=>this.dataService.facet.getFacet(this.id).single$)));const i=this.getUpdatedFacetValues(t,a,e);i.length&&n.push(this.dataService.facet.updateFacetValues(i))}return Object(Qt.a)(n)}),Object(V.a)(()=>this.dataService.facet.getAllFacets().single$)).subscribe(()=>{this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success(Object(i.a)("common.notify-update-success"),{entity:"Facet"})},t=>{this.notificationService.error(Object(i.a)("common.notify-update-error"),{entity:"Facet"})})}deleteFacetValue(t,e){if(!t){const t=this.detailForm.get("values");return t&&t.removeAt(e),void this.values.splice(e,1)}this.showModalAndDelete(t).pipe(Object(V.a)(e=>e.result===a.t.DELETED?[!0]:this.showModalAndDelete(t,e.message||"").pipe(Object(o.a)(t=>t.result===a.t.DELETED))),Object(V.a)(t=>t?this.dataService.facet.getFacet(this.id).single$:[])).subscribe(()=>{this.notificationService.success(Object(i.a)("common.notify-delete-success"),{entity:"FacetValue"})},t=>{this.notificationService.error(Object(i.a)("common.notify-delete-error"),{entity:"FacetValue"})})}showModalAndDelete(t,e){return this.modalService.dialog({title:Object(i.a)("catalog.confirm-delete-facet-value"),body:e,buttons:[{type:"secondary",label:Object(i.a)("common.cancel")},{type:"danger",label:Object(i.a)("common.delete"),returnValue:!0}]}).pipe(Object(V.a)(c=>c?this.dataService.facet.deleteFacetValues([t],!!e):O.a),Object(o.a)(t=>t.deleteFacetValues[0]))}setFormValues(t,e){var c;const n=Object(a.S)(t,e);if(this.detailForm.patchValue({facet:{code:t.code,visible:!t.isPrivate,name:null!==(c=null==n?void 0:n.name)&&void 0!==c?c:""}}),this.customFields.length){const e=this.detailForm.get(["facet","customFields"]);for(const c of this.customFields){const a=c.name,i="localeString"===c.type?n.customFields[a]:t.customFields[a],o=e.get(a);o&&o.patchValue(i)}}const i=this.detailForm.get("values");this.values=[...t.values],t.values.forEach((t,c)=>{const n=Object(a.S)(t,e),o={id:t.id,code:t.code,name:n?n.name:""},s=i.at(c);if(s?s.setValue(o):i.insert(c,this.formBuilder.group(o)),this.customValueFields.length){let e=this.detailForm.get(["values",c,"customFields"]);if(e||(e=new r.i({}),this.detailForm.get(["values",c]).addControl("customFields",e)),e)for(const c of this.customValueFields){const a=c.name,i="localeString"===c.type?n.customFields[a]:t.customFields[a],o=e.get(a);o?o.setValue(i):e.addControl(a,new r.f(i))}}})}getUpdatedFacet(t,e,c){const n=Object(a.P)({translatable:t,updatedFields:e.value,customFieldConfig:this.customFields,languageCode:c,defaultTranslation:{languageCode:c,name:t.name||""}});return n.isPrivate=!e.value.visible,n}getUpdatedFacetValues(t,e,c){const n=t.values.filter((t,c)=>{const n=e.get(c.toString());return n&&n.dirty&&n.value.id}),o=e.controls.filter(t=>t.dirty&&t.value.id).map(t=>t.value);if(n.length!==o.length)throw new Error(Object(i.a)("error.facet-value-form-values-do-not-match"));return n.map((t,e)=>Object(a.P)({translatable:t,updatedFields:o[e],customFieldConfig:this.customValueFields,languageCode:c,defaultTranslation:{languageCode:c,name:""}})).filter(Tt.notNullOrUndefined)}}ae.\u0275fac=function(t){return new(t||ae)(s.bc(n.e),s.bc(n.a),s.bc(a.I),s.bc(s.j),s.bc(a.s),s.bc(r.e),s.bc(a.G),s.bc(a.F))},ae.\u0275cmp=s.Vb({type:ae,selectors:[["vdr-facet-detail"]],features:[s.Nb],decls:16,vars:19,consts:[[3,"entity"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","facet-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup"],["formGroupName","facet",1,"form-block"],["for","visibility",3,"label"],["type","checkbox","clrToggle","","formControlName","visible","id","visibility",3,"vdrDisabled"],[1,"visible-toggle"],[4,"ngIf","ngIfElse"],["private",""],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],["for","code",3,"label","readOnlyToggle"],["id","code","type","text","formControlName","code",3,"readonly"],["formGroupName","customFields",4,"ngIf"],["class","form-block",4,"ngIf"],["formGroupName","customFields"],[4,"ngFor","ngForOf"],["entityName","Facet",3,"customFieldsFormGroup","customField",4,"ngIf"],["entityName","Facet",3,"customFieldsFormGroup","customField"],[1,"form-block"],["class","facet-values-list table","formArrayName","values",4,"ngIf"],["type","button","class","btn btn-secondary",3,"click",4,"vdrIfPermissions"],["formArrayName","values",1,"facet-values-list","table"],["class","facet-value",3,"formGroupName",4,"ngFor","ngForOf"],[1,"facet-value",3,"formGroupName"],[1,"align-middle"],["type","text","formControlName","name",3,"readonly","input"],["type","text","formControlName","code","readonly",""],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],["entityName","FacetValue",3,"showLabel","customFieldsFormGroup","customField",4,"ngIf"],["entityName","FacetValue",3,"showLabel","customFieldsFormGroup","customField"],["type","button",1,"btn","btn-secondary",3,"click"],["shape","add"]],template:function(t,e){if(1&t&&(s.hc(0,"vdr-action-bar"),s.hc(1,"vdr-ab-left"),s.cc(2,"vdr-entity-info",0),s.sc(3,"async"),s.hc(4,"vdr-language-selector",1),s.pc("languageCodeChange",function(t){return e.setLanguage(t)}),s.sc(5,"async"),s.sc(6,"async"),s.sc(7,"async"),s.gc(),s.gc(),s.hc(8,"vdr-ab-right"),s.cc(9,"vdr-action-bar-items",2),s.Tc(10,Nt,3,4,"button",3),s.sc(11,"async"),s.Tc(12,Et,1,1,"ng-template",null,4,s.Uc),s.gc(),s.gc(),s.Tc(14,ne,23,28,"form",5),s.sc(15,"async")),2&t){const t=s.Ic(13);s.Qb(2),s.yc("entity",s.tc(3,7,e.entity$)),s.Qb(2),s.yc("disabled",s.tc(5,9,e.isNew$))("availableLanguageCodes",s.tc(6,11,e.availableLanguages$))("currentLanguageCode",s.tc(7,13,e.languageCode$)),s.Qb(6),s.yc("ngIf",s.tc(11,15,e.isNew$))("ngIfElse",t),s.Qb(4),s.yc("ngIf",s.tc(15,17,e.entity$))}},directives:[l.a,l.b,d.a,Mt.a,l.c,u.a,h.o,p.a,r.E,r.q,r.j,r.k,wt.a,vt.k,B.a,r.a,vt.i,r.p,r.h,St.a,vt.u,r.b,h.n,Dt.a,r.d,$t.a,At.a,vt.o,_t.a,Lt.a],pipes:[h.b,m.d,w.a],styles:[".visible-toggle[_ngcontent-%COMP%]{margin-top:-3px!important}"],changeDetection:0});var ie=c("r2d8"),oe=c("2/wi"),re=c("qdJt");const se=function(){return["./create"]};function le(t,e){1&t&&(s.hc(0,"a",4),s.cc(1,"clr-icon",5),s.Vc(2),s.sc(3,"translate"),s.gc()),2&t&&(s.yc("routerLink",s.Bc(4,se)),s.Qb(2),s.Xc(" ",s.tc(3,2,"catalog.create-new-facet")," "))}function de(t,e){if(1&t&&s.cc(0,"vdr-facet-value-chip",18),2&t){const t=e.$implicit;s.yc("facetValue",t)("removable",!1)("displayFacetName",!1)}}function ue(t,e){if(1&t&&(s.fc(0),s.cc(1,"clr-icon",5),s.Vc(2),s.ec()),2&t){const t=s.rc(2).item,e=s.rc();s.Qb(2),s.Xc(" ",t.values.length-e.initialLimit," ")}}function pe(t,e){1&t&&s.cc(0,"clr-icon",21)}function ge(t,e){if(1&t){const t=s.ic();s.hc(0,"button",19),s.pc("click",function(){s.Lc(t);const e=s.rc().item;return s.rc().toggleDisplayLimit(e)}),s.Tc(1,ue,3,1,"ng-container",9),s.Tc(2,pe,1,0,"ng-template",null,20,s.Uc),s.gc()}if(2&t){const t=s.Ic(3),e=s.rc().item,c=s.rc();s.Qb(1),s.yc("ngIf",(c.displayLimit[e.id]||0)<e.values.length)("ngIfElse",t)}}function he(t,e){1&t&&(s.fc(0),s.Vc(1),s.sc(2,"translate"),s.ec()),2&t&&(s.Qb(1),s.Wc(s.tc(2,1,"catalog.public")))}function me(t,e){1&t&&(s.Vc(0),s.sc(1,"translate")),2&t&&s.Wc(s.tc(1,1,"catalog.private"))}const fe=function(t){return["./",t]},be=function(){return["DeleteCatalog","DeleteFacet"]};function ve(t,e){if(1&t){const t=s.ic();s.hc(0,"td",6),s.Vc(1),s.gc(),s.hc(2,"td",6),s.Vc(3),s.gc(),s.hc(4,"td",6),s.Tc(5,de,1,3,"vdr-facet-value-chip",7),s.sc(6,"slice"),s.Tc(7,ge,4,2,"button",8),s.gc(),s.hc(8,"td",6),s.hc(9,"vdr-chip"),s.Tc(10,he,3,3,"ng-container",9),s.Tc(11,me,2,3,"ng-template",null,10,s.Uc),s.gc(),s.gc(),s.hc(13,"td",11),s.cc(14,"vdr-table-row-action",12),s.sc(15,"translate"),s.gc(),s.hc(16,"td",11),s.hc(17,"vdr-dropdown"),s.hc(18,"button",13),s.Vc(19),s.sc(20,"translate"),s.cc(21,"clr-icon",14),s.gc(),s.hc(22,"vdr-dropdown-menu",15),s.hc(23,"button",16),s.pc("click",function(){s.Lc(t);const c=e.item;return s.rc().deleteFacet(c.id)}),s.sc(24,"hasPermission"),s.cc(25,"clr-icon",17),s.Vc(26),s.sc(27,"translate"),s.gc(),s.gc(),s.gc(),s.gc()}if(2&t){const t=e.item,c=s.Ic(12),n=s.rc();s.Tb("private",t.isPrivate),s.Qb(1),s.Wc(t.code),s.Qb(1),s.Tb("private",t.isPrivate),s.Qb(1),s.Wc(t.name),s.Qb(1),s.Tb("private",t.isPrivate),s.Qb(1),s.yc("ngForOf",s.vc(6,23,t.values,0,n.displayLimit[t.id]||3)),s.Qb(2),s.yc("ngIf",t.values.length>n.initialLimit),s.Qb(1),s.Tb("private",t.isPrivate),s.Qb(2),s.yc("ngIf",!t.isPrivate)("ngIfElse",c),s.Qb(3),s.Tb("private",t.isPrivate),s.Qb(1),s.yc("label",s.tc(15,27,"common.edit"))("linkTo",s.Cc(35,fe,t.id)),s.Qb(2),s.Tb("private",t.isPrivate),s.Qb(3),s.Xc(" ",s.tc(20,29,"common.actions")," "),s.Qb(4),s.yc("disabled",!s.tc(24,31,s.Bc(37,be))),s.Qb(3),s.Xc(" ",s.tc(27,33,"common.delete")," ")}}const ye=function(){return["CreateCatalog","CreateFacet"]};class Ce extends a.n{constructor(t,e,c,n,a){super(n,a),this.dataService=t,this.modalService=e,this.notificationService=c,this.initialLimit=3,this.displayLimit={},super.setQueryFn((...t)=>this.dataService.facet.getFacets(...t).refetchOnChannelChange(),t=>t.facets)}toggleDisplayLimit(t){this.displayLimit[t.id]===t.values.length?this.displayLimit[t.id]=this.initialLimit:this.displayLimit[t.id]=t.values.length}deleteFacet(t){this.showModalAndDelete(t).pipe(Object(V.a)(e=>e.result===a.t.DELETED?[!0]:this.showModalAndDelete(t,e.message||"").pipe(Object(o.a)(t=>t.result===a.t.DELETED))),Object(V.a)(()=>this.dataService.facet.getAllFacets().single$)).subscribe(()=>{this.notificationService.success(Object(i.a)("common.notify-delete-success"),{entity:"FacetValue"}),this.refresh()},t=>{this.notificationService.error(Object(i.a)("common.notify-delete-error"),{entity:"FacetValue"})})}showModalAndDelete(t,e){return this.modalService.dialog({title:Object(i.a)("catalog.confirm-delete-facet"),body:e,buttons:[{type:"secondary",label:Object(i.a)("common.cancel")},{type:"danger",label:Object(i.a)("common.delete"),returnValue:!0}]}).pipe(Object(V.a)(c=>c?this.dataService.facet.deleteFacet(t,!!e):O.a),Object(o.a)(t=>t.deleteFacet))}}Ce.\u0275fac=function(t){return new(t||Ce)(s.bc(a.s),s.bc(a.F),s.bc(a.G),s.bc(n.e),s.bc(n.a))},Ce.\u0275cmp=s.Vb({type:Ce,selectors:[["vdr-facet-list"]],features:[s.Nb],decls:24,vars:27,consts:[["locationId","facet-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[3,"expand"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"left","align-middle"],[3,"facetValue","removable","displayFacetName",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary btn-icon",3,"click",4,"ngIf"],[4,"ngIf","ngIfElse"],["private",""],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"facetValue","removable","displayFacetName"],[1,"btn","btn-sm","btn-secondary","btn-icon",3,"click"],["collapse",""],["shape","minus"]],template:function(t,e){1&t&&(s.hc(0,"vdr-action-bar"),s.hc(1,"vdr-ab-right"),s.cc(2,"vdr-action-bar-items",0),s.Tc(3,le,4,5,"a",1),s.gc(),s.gc(),s.hc(4,"vdr-data-table",2),s.pc("pageChange",function(t){return e.setPageNumber(t)})("itemsPerPageChange",function(t){return e.setItemsPerPage(t)}),s.sc(5,"async"),s.sc(6,"async"),s.sc(7,"async"),s.sc(8,"async"),s.hc(9,"vdr-dt-column"),s.Vc(10),s.sc(11,"translate"),s.gc(),s.hc(12,"vdr-dt-column"),s.Vc(13),s.sc(14,"translate"),s.gc(),s.hc(15,"vdr-dt-column",3),s.Vc(16),s.sc(17,"translate"),s.gc(),s.hc(18,"vdr-dt-column"),s.Vc(19),s.sc(20,"translate"),s.gc(),s.cc(21,"vdr-dt-column"),s.cc(22,"vdr-dt-column"),s.Tc(23,ve,28,38,"ng-template"),s.gc()),2&t&&(s.Qb(3),s.yc("vdrIfPermissions",s.Bc(26,ye)),s.Qb(1),s.yc("items",s.tc(5,10,e.items$))("itemsPerPage",s.tc(6,12,e.itemsPerPage$))("totalItems",s.tc(7,14,e.totalItems$))("currentPage",s.tc(8,16,e.currentPage$)),s.Qb(6),s.Wc(s.tc(11,18,"common.code")),s.Qb(3),s.Wc(s.tc(14,20,"common.name")),s.Qb(2),s.yc("expand",!0),s.Qb(1),s.Wc(s.tc(17,22,"catalog.values")),s.Qb(3),s.Wc(s.tc(20,24,"catalog.visibility")))},directives:[l.a,l.c,u.a,p.a,X.a,ie.a,n.h,vt.o,h.n,h.o,oe.a,R.a,$t.a,At.a,_t.a,Lt.a,re.a],pipes:[h.b,m.d,h.x,w.a],styles:["td.private[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}"]});var Oe=c("gQU7"),Pe=c("jEaP"),Fe=c("VRyK"),Ie=c("l7GE"),Ve=c("ZUHj");function ke(...t){return e=>{let c;"function"==typeof t[t.length-1]&&(c=t.pop());const n=t;return e.lift(new xe(n,c))}}class xe{constructor(t,e){this.observables=t,this.project=e}call(t,e){return e.subscribe(new Te(t,this.observables,this.project))}}class Te extends Ie.a{constructor(t,e,c){super(t),this.observables=e,this.project=c,this.toRespond=[];const n=e.length;this.values=new Array(n);for(let a=0;a<n;a++)this.toRespond.push(a);for(let a=0;a<n;a++){let t=e[a];this.add(Object(Ve.a)(this,t,void 0,a))}}notifyNext(t,e,c){this.values[c]=e;const n=this.toRespond;if(n.length>0){const t=n.indexOf(c);-1!==t&&n.splice(t,1)}}notifyComplete(){}_next(t){if(0===this.toRespond.length){const e=[t,...this.values];this.project?this._tryProject(e):this.destination.next(e)}}_tryProject(t){let e;try{e=this.project.apply(this,t)}catch(c){return void this.destination.error(c)}this.destination.next(e)}}var Qe=c("z6cu");function je(t,e,c){if(!t)return"";const n=t.lastIndexOf(e);if(-1===n)return t;return t.substr(0,n)+t.substr(n).replace(e,c)}class Me{constructor(t){this.dataService=t}getFacets(){return this.dataService.facet.getAllFacets().mapSingle(t=>t.facets.items)}getTaxCategories(){return this.dataService.settings.getTaxCategories().mapSingle(t=>t.taxCategories).pipe(Object(bt.a)(1))}createProductWithVariants(t,e,c){const n=this.dataService.product.createProduct(t),a=e.groups.filter(t=>0<t.values.length),i=this.createProductOptionGroups(a,c);return Object(Qt.a)(n,i).pipe(Object(L.a)(([{createProduct:t},e])=>(e.length?Object(Qt.a)(e.map(e=>this.dataService.product.addOptionGroupToProduct({productId:t.id,optionGroupId:e.id}))):Object(G.a)([])).pipe(Object(o.a)(()=>({createProduct:t,optionGroups:e})))),Object(L.a)(({createProduct:t,optionGroups:n})=>{const a=e.variants.map(t=>{const e=n.length?t.optionValues.map((t,e)=>{const c=n[e].options.find(e=>e.name===t);if(!c)throw new Error(`Could not find a matching ProductOption "${t}" when creating variant`);return c.id}):[];return Object.assign(Object.assign({},t),{optionIds:e})}),i=n.map(t=>t.options).reduce((t,e)=>[...t,...e],[]);return this.createProductVariants(t,a,i,c)}))}createProductOptionGroups(t,e){return t.length?Object(Qt.a)(t.map(t=>this.dataService.product.createProductOptionGroups({code:Object(A.normalizeString)(t.name,"-"),translations:[{languageCode:e,name:t.name}],options:t.values.map(t=>({code:Object(A.normalizeString)(t,"-"),translations:[{languageCode:e,name:t}]}))}).pipe(Object(o.a)(t=>t.createProductOptionGroup)))):Object(G.a)([])}createProductVariants(t,e,c,n){const a=e.map(e=>{const a=c.length?`${t.name} ${e.optionIds.map(t=>c.find(e=>e.id===t)).filter(Tt.notNullOrUndefined).map(t=>t.name).join(" ")}`:t.name;return{productId:t.id,price:e.price,sku:e.sku,stockOnHand:e.stock,translations:[{languageCode:n,name:a}],optionIds:e.optionIds}});return this.dataService.product.createProductVariants(a).pipe(Object(o.a)(({createProductVariants:e})=>({createProductVariants:e,productId:t.id})))}updateProduct(t){var e,c,n;const{product:i,languageCode:o,autoUpdate:r,productInput:s,variantsInput:l}=t,d=[],u=l||[];if(s){d.push(this.dataService.product.updateProduct(s));const t=null===(e=Object(a.S)(i,o))||void 0===e?void 0:e.name,l=null===(c=Object(a.S)(s,o))||void 0===c?void 0:c.name;if(t&&l&&r)for(const e of i.variants){const c=(null===(n=Object(a.S)(e,o))||void 0===n?void 0:n.name)||"";let i;const r=u.find(t=>t.id===e.id);r?i=r:(i={id:e.id,translations:[{languageCode:o,name:c}]},u.push(i));const s=Object(a.S)(i,o);s&&(s.name=je(s.name,t,l))}}return u.length&&d.push(this.dataService.product.updateProductVariants(u)),Object(Qt.a)(d)}updateProductOption(t,e,c){var n,i,o;let r=Object(G.a)([]);if(t.autoUpdate){let s;const l=null===(n=Object(a.S)(t,c))||void 0===n?void 0:n.name;l||(r=Object(G.a)([]));const d=[];for(const n of e.variants)if(n.options.map(t=>t.id).includes(t.id)){s||(s=null===(i=Object(a.S)(n.options.find(e=>e.id===t.id),c))||void 0===i?void 0:i.name);const e=(null===(o=Object(a.S)(n,c))||void 0===o?void 0:o.name)||"";s&&l&&e.includes(s)&&d.push({id:n.id,translations:[{languageCode:c,name:je(e,s,l)}]})}d.length&&(r=this.dataService.product.updateProductVariants(d))}return this.dataService.product.updateProductOption(t).pipe(Object(L.a)(()=>r))}deleteProductVariant(t,e){return this.dataService.product.deleteProductVariant(t).pipe(Object(V.a)(t=>t.deleteProductVariant.result===a.t.DELETED?this.dataService.product.getProduct(e).single$:Object(Qe.a)(t.deleteProductVariant.message)))}}Me.\u0275fac=function(t){return new(t||Me)(s.lc(a.s))},Me.\u0275prov=s.Xb({token:Me,factory:Me.\u0275fac,providedIn:"root"});var we=c("xUfP"),Se=c("WlxY"),De=c("jHbs");function $e(t,e){1&t&&(s.Vc(0),s.sc(1,"translate")),2&t&&s.Wc(s.tc(1,1,"catalog.add-facets"))}function Ae(t,e){if(1&t){const t=s.ic();s.hc(0,"button",3),s.pc("click",function(){s.Lc(t);return s.rc().cancel()}),s.Vc(1),s.sc(2,"translate"),s.gc(),s.hc(3,"button",4),s.pc("click",function(){s.Lc(t);return s.rc().selectValues()}),s.Vc(4),s.sc(5,"translate"),s.gc()}if(2&t){const t=s.rc();s.Qb(1),s.Wc(s.tc(2,3,"common.cancel")),s.Qb(2),s.yc("disabled",0===t.selectedValues.length),s.Qb(1),s.Xc(" ",s.tc(5,5,"catalog.add-facets")," ")}}class _e{constructor(t){this.changeDetector=t,this.selectedValues=[]}ngAfterViewInit(){setTimeout(()=>this.selector.focus(),0)}selectValues(){this.resolveWith(this.selectedValues)}cancel(){this.resolveWith()}}_e.\u0275fac=function(t){return new(t||_e)(s.bc(s.j))},_e.\u0275cmp=s.Vb({type:_e,selectors:[["vdr-apply-facet-dialog"]],viewQuery:function(t,e){if(1&t&&s.ad(a.v,1),2&t){let t;s.Hc(t=s.qc())&&(e.selector=t.first)}},decls:3,vars:1,consts:[["vdrDialogTitle",""],[3,"facets","selectedValuesChange"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(t,e){1&t&&(s.Tc(0,$e,2,3,"ng-template",0),s.hc(1,"vdr-facet-value-selector",1),s.pc("selectedValuesChange",function(t){return e.selectedValues=t}),s.gc(),s.Tc(2,Ae,6,7,"ng-template",2)),2&t&&(s.Qb(1),s.yc("facets",e.facets))},directives:[we.a,Se.a,De.a],pipes:[m.d],styles:[""],changeDetection:0});var Le=c("D57K"),Ne=c("Cfvw"),Ge=c("39yD"),Ee=c("a1B0"),We=c("ZFbG");function Ue(t,e){1&t&&(s.fc(0),s.Vc(1),s.sc(2,"translate"),s.ec()),2&t&&(s.Qb(1),s.Wc(s.tc(2,1,"catalog.assign-variants-to-channel")))}function Be(t,e){1&t&&(s.Vc(0),s.sc(1,"translate")),2&t&&s.Wc(s.tc(1,1,"catalog.assign-products-to-channel"))}function Xe(t,e){if(1&t&&(s.Tc(0,Ue,3,3,"ng-container",12),s.Tc(1,Be,2,3,"ng-template",null,13,s.Uc)),2&t){const t=s.Ic(2),e=s.rc();s.yc("ngIf",e.isProductVariantMode)("ngIfElse",t)}}const Re=function(t){return{channel:t}};function He(t,e){if(1&t&&(s.Vc(0),s.sc(1,"translate")),2&t){const t=s.rc();s.Xc(" ",s.uc(1,1,"catalog.price-in-channel",s.Cc(4,Re,null==t.selectedChannel?null:t.selectedChannel.code))," ")}}function ze(t,e){1&t&&(s.Vc(0),s.sc(1,"translate")),2&t&&s.Xc(" ",s.tc(1,1,"catalog.no-channel-selected")," ")}function qe(t,e){if(1&t&&(s.Vc(0),s.sc(1,"localeCurrency")),2&t){const t=s.rc().$implicit,e=s.rc();s.Xc(" ",s.uc(1,1,t.pricePreview,null==e.selectedChannel?null:e.selectedChannel.currencyCode)," ")}}function Ke(t,e){1&t&&s.Vc(0," - ")}function Ze(t,e){if(1&t&&(s.hc(0,"tr"),s.hc(1,"td"),s.Vc(2),s.gc(),s.hc(3,"td"),s.Vc(4),s.sc(5,"localeCurrency"),s.gc(),s.hc(6,"td"),s.Tc(7,qe,2,4,"ng-template",8),s.Tc(8,Ke,1,0,"ng-template",null,14,s.Uc),s.gc(),s.gc()),2&t){const t=e.$implicit,c=s.Ic(9),n=s.rc();s.Qb(2),s.Wc(t.name),s.Qb(2),s.Wc(s.uc(5,4,t.price,null==n.currentChannel?null:n.currentChannel.currencyCode)),s.Qb(3),s.yc("ngIf",n.selectedChannel)("ngIfElse",c)}}const Ye=function(t){return{channelCode:t}};function Je(t,e){if(1&t&&(s.Vc(0),s.sc(1,"translate")),2&t){const t=s.rc(2);s.Xc(" ",s.uc(1,1,"catalog.assign-to-named-channel",s.Cc(4,Ye,null==t.selectedChannel?null:t.selectedChannel.code))," ")}}function tc(t,e){1&t&&(s.Vc(0),s.sc(1,"translate")),2&t&&s.Xc(" ",s.tc(1,1,"catalog.no-channel-selected")," ")}function ec(t,e){if(1&t){const t=s.ic();s.hc(0,"button",15),s.pc("click",function(){s.Lc(t);return s.rc().cancel()}),s.Vc(1),s.sc(2,"translate"),s.gc(),s.hc(3,"button",16),s.pc("click",function(){s.Lc(t);return s.rc().assign()}),s.Tc(4,Je,2,6,"ng-template",8),s.Tc(5,tc,2,3,"ng-template",null,9,s.Uc),s.gc()}if(2&t){const t=s.Ic(6),e=s.rc();s.Qb(1),s.Wc(s.tc(2,4,"common.cancel")),s.Qb(2),s.yc("disabled",!e.selectedChannel),s.Qb(1),s.yc("ngIf",e.selectedChannel)("ngIfElse",t)}}class cc{constructor(t,e){this.dataService=t,this.notificationService=e,this.priceFactorControl=new r.f(1),this.selectedChannelIdControl=new r.f}get isProductVariantMode(){return null!=this.productVariantIds}ngOnInit(){const t=this.dataService.client.userStatus().mapSingle(({userStatus:t})=>t.activeChannelId),e=this.dataService.settings.getChannels().mapSingle(t=>t.channels);Object(C.a)(t,e).subscribe(([t,e])=>{this.currentChannel=e.find(e=>e.id===t),this.availableChannels=e}),this.selectedChannelIdControl.valueChanges.subscribe(t=>{this.selectChannel(t)}),this.variantsPreview$=Object(C.a)(Object(Ne.a)(this.getTopVariants(10)),this.priceFactorControl.valueChanges.pipe(Object(E.a)(1))).pipe(Object(o.a)(([t,e])=>t.map(t=>({id:t.id,name:t.name,price:t.price,pricePreview:t.price*+e}))))}selectChannel(t){this.selectedChannel=this.availableChannels.find(e=>e.id===t[0])}assign(){const t=this.selectedChannel;t&&(this.isProductVariantMode?this.productVariantIds&&this.dataService.product.assignVariantsToChannel({channelId:t.id,productVariantIds:this.productVariantIds,priceFactor:+this.priceFactorControl.value}).subscribe(()=>{this.notificationService.success(Object(i.a)("catalog.assign-variant-to-channel-success"),{channel:t.code}),this.resolveWith(!0)}):this.dataService.product.assignProductsToChannel({channelId:t.id,productIds:this.productIds,priceFactor:+this.priceFactorControl.value}).subscribe(()=>{this.notificationService.success(Object(i.a)("catalog.assign-product-to-channel-success"),{channel:t.code}),this.resolveWith(!0)}))}cancel(){this.resolveWith()}getTopVariants(t){return Object(Le.a)(this,void 0,void 0,function*(){const e=[];for(let c=0;c<this.productIds.length&&e.length<t;c++){const t=yield this.dataService.product.getProduct(this.productIds[c]).mapSingle(({product:t})=>(t?t.variants:[]).filter(t=>{var e;return!this.isProductVariantMode||(null===(e=this.productVariantIds)||void 0===e?void 0:e.includes(t.id))})).toPromise();e.push(...t||[])}return e.slice(0,t)})}}cc.\u0275fac=function(t){return new(t||cc)(s.bc(a.s),s.bc(a.G))},cc.\u0275cmp=s.Vb({type:cc,selectors:[["vdr-assign-products-to-channel-dialog"]],decls:36,vars:32,consts:[["vdrDialogTitle",""],[1,"flex"],["clrInput","",3,"multiple","includeDefaultChannel","disableChannelIds","formControl"],[1,"flex-spacer"],["clrInput","","type","number","min","0","max","99999",3,"formControl"],[1,"channel-price-preview"],[1,"clr-control-label"],[1,"table"],[3,"ngIf","ngIfElse"],["noSelection",""],[4,"ngFor","ngForOf"],["vdrDialogButtons",""],[4,"ngIf","ngIfElse"],["productModeTitle",""],["noChannelSelected",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(t,e){if(1&t&&(s.Tc(0,Xe,3,2,"ng-template",0),s.hc(1,"div",1),s.hc(2,"clr-input-container"),s.hc(3,"label"),s.Vc(4),s.sc(5,"translate"),s.gc(),s.cc(6,"vdr-channel-assignment-control",2),s.gc(),s.cc(7,"div",3),s.hc(8,"clr-input-container"),s.hc(9,"label"),s.Vc(10),s.sc(11,"translate"),s.gc(),s.cc(12,"input",4),s.gc(),s.gc(),s.hc(13,"div",5),s.hc(14,"label",6),s.Vc(15),s.sc(16,"translate"),s.gc(),s.hc(17,"table",7),s.hc(18,"thead"),s.hc(19,"tr"),s.hc(20,"th"),s.Vc(21),s.sc(22,"translate"),s.gc(),s.hc(23,"th"),s.Vc(24),s.sc(25,"translate"),s.sc(26,"translate"),s.sc(27,"channelCodeToLabel"),s.gc(),s.hc(28,"th"),s.Tc(29,He,2,6,"ng-template",8),s.Tc(30,ze,2,3,"ng-template",null,9,s.Uc),s.gc(),s.gc(),s.gc(),s.hc(32,"tbody"),s.Tc(33,Ze,10,7,"tr",10),s.sc(34,"async"),s.gc(),s.gc(),s.gc(),s.Tc(35,ec,7,6,"ng-template",11)),2&t){const t=s.Ic(31);s.Qb(4),s.Wc(s.tc(5,13,"common.channel")),s.Qb(2),s.yc("multiple",!1)("includeDefaultChannel",!1)("disableChannelIds",e.currentChannelIds)("formControl",e.selectedChannelIdControl),s.Qb(4),s.Wc(s.tc(11,15,"catalog.price-conversion-factor")),s.Qb(2),s.yc("formControl",e.priceFactorControl),s.Qb(3),s.Wc(s.tc(16,17,"catalog.channel-price-preview")),s.Qb(6),s.Wc(s.tc(22,19,"common.name")),s.Qb(3),s.Xc(" ",s.uc(25,21,"catalog.price-in-channel",s.Cc(30,Re,s.tc(26,24,s.tc(27,26,null==e.currentChannel?null:e.currentChannel.code))))," "),s.Qb(5),s.yc("ngIf",e.selectedChannel)("ngIfElse",t),s.Qb(4),s.yc("ngForOf",s.tc(34,28,e.variantsPreview$))}},directives:[we.a,vt.t,vt.u,Ge.a,vt.s,r.p,r.g,B.a,r.v,r.b,h.o,h.n,De.a],pipes:[m.d,Ee.a,h.b,We.a],styles:["vdr-channel-assignment-control[_ngcontent-%COMP%]{min-width:200px}.channel-price-preview[_ngcontent-%COMP%]{margin-top:24px}.channel-price-preview[_ngcontent-%COMP%]   table.table[_ngcontent-%COMP%]{margin-top:6px}"],changeDetection:0});const nc=function(){return["product","enabled"]};function ac(t,e){if(1&t&&(s.hc(0,"clr-toggle-wrapper"),s.cc(1,"input",8),s.hc(2,"label"),s.Vc(3),s.sc(4,"translate"),s.gc(),s.gc()),2&t){const t=s.rc();s.Qb(1),s.yc("formControl",t.detailForm.get(s.Bc(4,nc))),s.Qb(2),s.Wc(s.tc(4,2,"common.enabled"))}}function ic(t,e){if(1&t){const t=s.ic();s.hc(0,"button",9),s.pc("click",function(){s.Lc(t);return s.rc().create()}),s.Vc(1),s.sc(2,"translate"),s.gc()}if(2&t){const t=s.rc();s.yc("disabled",t.detailForm.invalid||t.detailForm.pristine||!t.variantsToCreateAreValid()),s.Qb(1),s.Xc(" ",s.tc(2,2,"common.create")," ")}}function oc(t,e){if(1&t){const t=s.ic();s.hc(0,"button",9),s.pc("click",function(){s.Lc(t);return s.rc(2).save()}),s.Vc(1),s.sc(2,"translate"),s.gc()}if(2&t){const t=s.rc(2);s.yc("disabled",(t.detailForm.invalid||t.detailForm.pristine)&&!t.assetsChanged()&&!t.variantAssetsChanged()),s.Qb(1),s.Xc(" ",s.tc(2,2,"common.update")," ")}}const rc=function(){return["UpdateCatalog","UpdateProduct"]};function sc(t,e){1&t&&s.Tc(0,oc,3,4,"button",10),2&t&&s.yc("vdrIfPermissions",s.Bc(1,rc))}function lc(t,e){if(1&t){const t=s.ic();s.hc(0,"vdr-chip",39),s.pc("iconClick",function(){s.Lc(t);const e=s.rc().$implicit;return s.rc(5).removeFromChannel(e.id)}),s.cc(1,"vdr-channel-badge",40),s.Vc(2),s.sc(3,"channelCodeToLabel"),s.gc()}if(2&t){const t=s.rc().$implicit;s.Qb(1),s.yc("channelCode",t.code),s.Qb(1),s.Xc(" ",s.tc(3,2,t.code)," ")}}function dc(t,e){if(1&t&&(s.fc(0),s.Tc(1,lc,4,4,"vdr-chip",38),s.ec()),2&t){const t=e.$implicit,c=s.rc(5);s.Qb(1),s.yc("ngIf",!c.isDefaultChannel(t.code))}}function uc(t,e){if(1&t){const t=s.ic();s.hc(0,"vdr-form-item",33),s.sc(1,"translate"),s.hc(2,"div",34),s.Tc(3,dc,2,1,"ng-container",35),s.sc(4,"async"),s.hc(5,"button",36),s.pc("click",function(){s.Lc(t);return s.rc(4).assignToChannel()}),s.cc(6,"clr-icon",37),s.Vc(7),s.sc(8,"translate"),s.gc(),s.gc(),s.gc()}if(2&t){const t=s.rc(4);s.yc("label",s.tc(1,3,"common.channels")),s.Qb(3),s.yc("ngForOf",s.tc(4,5,t.productChannels$)),s.Qb(4),s.Xc(" ",s.tc(8,7,"catalog.assign-to-channel")," ")}}function pc(t,e){1&t&&(s.fc(0),s.Tc(1,uc,9,9,"vdr-form-item",32),s.ec())}const gc=function(){return["product","customFields"]};function hc(t,e){if(1&t&&(s.cc(0,"vdr-custom-field-control",43),s.sc(1,"hasPermission")),2&t){const t=s.rc().$implicit,e=s.rc(4);s.yc("customFieldsFormGroup",e.detailForm.get(s.Bc(5,gc)))("customField",t)("readonly",!s.tc(1,3,s.Bc(6,rc)))}}function mc(t,e){if(1&t&&(s.fc(0),s.Tc(1,hc,2,7,"vdr-custom-field-control",42),s.ec()),2&t){const t=e.$implicit,c=s.rc(4);s.Qb(1),s.yc("ngIf",c.customFieldIsSet(t.name))}}function fc(t,e){if(1&t&&(s.hc(0,"section",41),s.hc(1,"label"),s.Vc(2),s.sc(3,"translate"),s.gc(),s.Tc(4,mc,2,1,"ng-container",35),s.gc()),2&t){const t=s.rc(3);s.Qb(2),s.Wc(s.tc(3,2,"common.custom-fields")),s.Qb(2),s.yc("ngForOf",t.customFields)}}function bc(t,e){if(1&t){const t=s.ic();s.hc(0,"vdr-facet-value-chip",44),s.pc("remove",function(){s.Lc(t);const c=e.$implicit;return s.rc(3).removeProductFacetValue(c.id)}),s.sc(1,"hasPermission"),s.gc()}if(2&t){const t=e.$implicit;s.yc("facetValue",t)("removable",s.tc(1,2,s.Bc(4,rc)))}}function vc(t,e){if(1&t){const t=s.ic();s.hc(0,"button",45),s.pc("click",function(){s.Lc(t);return s.rc(3).selectProductFacetValue()}),s.cc(1,"clr-icon",46),s.Vc(2),s.sc(3,"translate"),s.gc()}2&t&&(s.Qb(2),s.Xc(" ",s.tc(3,1,"catalog.add-facets")," "))}function yc(t,e){if(1&t){const t=s.ic();s.hc(0,"div"),s.hc(1,"h4"),s.Vc(2),s.sc(3,"translate"),s.gc(),s.hc(4,"vdr-generate-product-variants",47),s.pc("variantsChange",function(e){s.Lc(t);return s.rc(3).createVariantsConfig=e}),s.gc(),s.gc()}2&t&&(s.Qb(2),s.Wc(s.tc(3,1,"catalog.product-variants")))}const Cc=function(){return["product","name"]},Oc=function(t){return{pattern:t}};function Pc(t,e){if(1&t){const t=s.ic();s.hc(0,"clr-tab-content"),s.hc(1,"div",15),s.hc(2,"div",16),s.hc(3,"section",17),s.Tc(4,pc,2,0,"ng-container",18),s.hc(5,"vdr-form-field",19),s.sc(6,"translate"),s.hc(7,"input",20),s.pc("input",function(e){s.Lc(t);return s.rc(2).updateSlug(e.target.value)}),s.sc(8,"hasPermission"),s.gc(),s.gc(),s.hc(9,"div",21),s.sc(10,"async"),s.hc(11,"clr-checkbox-wrapper"),s.cc(12,"input",22),s.hc(13,"label"),s.Vc(14),s.sc(15,"translate"),s.gc(),s.gc(),s.gc(),s.hc(16,"vdr-form-field",23),s.sc(17,"translate"),s.sc(18,"translate"),s.cc(19,"input",24),s.sc(20,"hasPermission"),s.gc(),s.cc(21,"vdr-rich-text-editor",25),s.sc(22,"hasPermission"),s.sc(23,"translate"),s.Tc(24,fc,5,4,"section",26),s.hc(25,"div",27),s.Tc(26,bc,2,5,"vdr-facet-value-chip",28),s.sc(27,"async"),s.Tc(28,vc,4,3,"button",29),s.gc(),s.gc(),s.gc(),s.hc(29,"div",30),s.hc(30,"vdr-product-assets",31),s.pc("change",function(e){s.Lc(t);return s.rc(2).assetChanges=e}),s.gc(),s.gc(),s.gc(),s.Tc(31,yc,5,3,"div",14),s.sc(32,"async"),s.gc()}if(2&t){const t=s.rc().ngIf,e=s.rc();let c=null;s.Qb(5),s.yc("label",s.tc(6,16,"catalog.product-name")),s.Qb(2),s.yc("readonly",!s.tc(8,18,s.Bc(38,rc))),s.Qb(2),s.Tb("visible",!1===s.tc(10,20,e.isNew$)&&(null==(c=e.detailForm.get(s.Bc(39,Cc)))?null:c.dirty)),s.Qb(5),s.Wc(s.tc(15,22,"catalog.auto-update-product-variant-name")),s.Qb(2),s.yc("label",s.tc(17,24,"catalog.slug"))("errors",s.Cc(40,Oc,s.tc(18,26,"catalog.slug-pattern-error"))),s.Qb(3),s.yc("readonly",!s.tc(20,28,s.Bc(42,rc))),s.Qb(2),s.yc("readonly",!s.tc(22,30,s.Bc(43,rc)))("label",s.tc(23,32,"common.description")),s.Qb(3),s.yc("ngIf",e.customFields.length),s.Qb(2),s.yc("ngForOf",s.tc(27,34,e.facetValues$)),s.Qb(2),s.yc("vdrIfPermissions",s.Bc(44,rc)),s.Qb(2),s.yc("assets",e.assetChanges.assets||t.assets)("featuredAsset",e.assetChanges.featuredAsset||t.featuredAsset),s.Qb(1),s.yc("ngIf",s.tc(32,36,e.isNew$))}}const Fc=function(){return["./","manage-variants"]};function Ic(t,e){1&t&&(s.hc(0,"a",63),s.cc(1,"clr-icon",64),s.Vc(2),s.sc(3,"translate"),s.gc()),2&t&&(s.yc("routerLink",s.Bc(4,Fc)),s.Qb(2),s.Xc(" ",s.tc(3,2,"catalog.manage-variants")," "))}function Vc(t,e){if(1&t&&(s.cc(0,"vdr-product-variants-table",65),s.sc(1,"async"),s.sc(2,"async")),2&t){const t=s.rc(3).ngIf,e=s.rc();s.yc("variants",s.tc(1,5,e.variants$))("optionGroups",t.optionGroups)("channelPriceIncludesTax",s.tc(2,7,e.channelPriceIncludesTax$))("productVariantsFormArray",e.detailForm.get("variants"))("pendingAssetChanges",e.variantAssetChanges)}}function kc(t,e){if(1&t){const t=s.ic();s.hc(0,"vdr-product-variants-list",66),s.pc("assignToChannel",function(e){s.Lc(t);return s.rc(4).assignVariantToChannel(e)})("removeFromChannel",function(e){s.Lc(t);return s.rc(4).removeVariantFromChannel(e)})("assetChange",function(e){s.Lc(t);return s.rc(4).variantAssetChange(e)})("updateProductOption",function(e){s.Lc(t);return s.rc(4).updateProductOption(e)})("selectionChange",function(e){s.Lc(t);return s.rc(4).selectedVariantIds=e})("selectFacetValueClick",function(e){s.Lc(t);return s.rc(4).selectVariantFacetValue(e)}),s.sc(1,"async"),s.sc(2,"async"),s.sc(3,"async"),s.sc(4,"async"),s.sc(5,"async"),s.gc()}if(2&t){const t=s.rc(3).ngIf,e=s.rc();s.yc("variants",s.tc(1,10,e.variants$))("channelPriceIncludesTax",s.tc(2,12,e.channelPriceIncludesTax$))("facets",s.tc(3,14,e.facets$))("optionGroups",t.optionGroups)("productVariantsFormArray",e.detailForm.get("variants"))("taxCategories",s.tc(4,16,e.taxCategories$))("customFields",e.customVariantFields)("customOptionFields",e.customOptionFields)("activeLanguage",s.tc(5,18,e.languageCode$))("pendingAssetChanges",e.variantAssetChanges)}}function xc(t,e){if(1&t){const t=s.ic();s.hc(0,"clr-tab-content"),s.hc(1,"section",48),s.hc(2,"div",49),s.hc(3,"div",50),s.hc(4,"button",51),s.pc("click",function(){s.Lc(t);return s.rc(3).variantDisplayMode="card"}),s.cc(5,"clr-icon",52),s.Vc(6),s.sc(7,"translate"),s.gc(),s.hc(8,"button",53),s.pc("click",function(){s.Lc(t);return s.rc(3).variantDisplayMode="table"}),s.cc(9,"clr-icon",54),s.Vc(10),s.sc(11,"translate"),s.gc(),s.gc(),s.hc(12,"div",55),s.cc(13,"input",56),s.sc(14,"translate"),s.hc(15,"button",57),s.pc("click",function(){s.Lc(t);return s.rc(3).filterInput.setValue("")}),s.cc(16,"clr-icon",58),s.gc(),s.gc(),s.cc(17,"div",59),s.Tc(18,Ic,4,5,"a",60),s.gc(),s.Tc(19,Vc,3,9,"vdr-product-variants-table",61),s.Tc(20,kc,6,20,"vdr-product-variants-list",62),s.gc(),s.gc()}if(2&t){const t=s.rc(3);s.Qb(4),s.Tb("btn-primary","card"===t.variantDisplayMode),s.Qb(2),s.Xc(" ",s.tc(7,11,"catalog.display-variant-cards")," "),s.Qb(2),s.Tb("btn-primary","table"===t.variantDisplayMode),s.Qb(2),s.Xc(" ",s.tc(11,13,"catalog.display-variant-table")," "),s.Qb(3),s.yc("formControl",t.filterInput)("placeholder",s.tc(14,15,"catalog.filter-by-name-or-sku")),s.Qb(5),s.yc("vdrIfPermissions",s.Bc(17,rc)),s.Qb(1),s.yc("ngIf","table"===t.variantDisplayMode),s.Qb(1),s.yc("ngIf","card"===t.variantDisplayMode)}}function Tc(t,e){if(1&t){const t=s.ic();s.hc(0,"clr-tab"),s.hc(1,"button",12),s.pc("click",function(){s.Lc(t);return s.rc(2).navigateToTab("variants")}),s.Vc(2),s.sc(3,"translate"),s.gc(),s.Tc(4,xc,21,18,"clr-tab-content",13),s.sc(5,"async"),s.gc()}if(2&t){const t=s.rc(2);s.Qb(2),s.Xc(" ",s.tc(3,2,"catalog.product-variants")," "),s.Qb(2),s.yc("clrIfActive","variants"===s.tc(5,4,t.activeTab$))}}function Qc(t,e){if(1&t){const t=s.ic();s.hc(0,"form",11),s.pc("keydown.enter",function(t){return t.preventDefault()}),s.hc(1,"clr-tabs"),s.hc(2,"clr-tab"),s.hc(3,"button",12),s.pc("click",function(){s.Lc(t);return s.rc().navigateToTab("details")}),s.Vc(4),s.sc(5,"translate"),s.gc(),s.Tc(6,Pc,33,45,"clr-tab-content",13),s.sc(7,"async"),s.gc(),s.Tc(8,Tc,6,6,"clr-tab",14),s.sc(9,"async"),s.gc(),s.gc()}if(2&t){const t=s.rc();s.yc("formGroup",t.detailForm),s.Qb(4),s.Xc(" ",s.tc(5,4,"catalog.product-details")," "),s.Qb(2),s.yc("clrIfActive","details"===s.tc(7,6,t.activeTab$)),s.Qb(2),s.yc("ngIf",!s.tc(9,8,t.isNew$))}}class jc extends a.l{constructor(t,e,c,n,a,i,o,s,l,d){super(t,e,c,s),this.productDetailService=n,this.formBuilder=a,this.modalService=i,this.notificationService=o,this.dataService=s,this.location=l,this.changeDetector=d,this.filterInput=new r.f(""),this.assetChanges={},this.variantAssetChanges={},this.selectedVariantIds=[],this.variantDisplayMode="card",this.createVariantsConfig={groups:[],variants:[]},this.customFields=this.getCustomFieldConfig("Product"),this.customVariantFields=this.getCustomFieldConfig("ProductVariant"),this.customOptionGroupFields=this.getCustomFieldConfig("ProductOptionGroup"),this.customOptionFields=this.getCustomFieldConfig("ProductOption"),this.detailForm=this.formBuilder.group({product:this.formBuilder.group({enabled:!0,name:["",r.C.required],autoUpdateVariantNames:!0,slug:"",description:"",facetValueIds:[[]],customFields:this.formBuilder.group(this.customFields.reduce((t,e)=>Object.assign(Object.assign({},t),{[e.name]:""}),{}))}),variants:this.formBuilder.array([])})}ngOnInit(){this.init(),this.product$=this.entity$;const t=this.product$.pipe(Object(o.a)(t=>t.variants)),e=this.filterInput.valueChanges.pipe(Object(E.a)(""),Object(P.a)(50),Object(bt.a)());this.variants$=Object(C.a)(t,e).pipe(Object(o.a)(([t,e])=>e?t.filter(t=>{e.toLocaleLowerCase();return t.name.toLocaleLowerCase().includes(e)||t.sku.toLocaleLowerCase().includes(e)}):t)),this.taxCategories$=this.productDetailService.getTaxCategories().pipe(Object(F.a)(this.destroy$)),this.activeTab$=this.route.paramMap.pipe(Object(o.a)(t=>t.get("tab"))),this.facets$=this.productDetailService.getFacets();const c=this.product$.pipe(Object(o.a)(t=>t.facetValues)),n=this.facets$.pipe(Object(o.a)(a.T)),i=this.getProductFormGroup().valueChanges.pipe(Object(o.a)(t=>t.facetValueIds),Object(W.a)()),r=Object(C.a)(i,c,n).pipe(Object(o.a)(([t,e,c])=>{const n=[...e,...c];return t.map(t=>n.find(e=>e.id===t)).filter(Tt.notNullOrUndefined)}));this.facetValues$=Object(Fe.a)(c,r),this.productChannels$=this.product$.pipe(Object(o.a)(t=>t.channels)),this.channelPriceIncludesTax$=this.dataService.settings.getActiveChannel("cache-first").refetchOnChannelChange().mapStream(t=>t.activeChannel.pricesIncludeTax).pipe(Object(bt.a)(1))}ngOnDestroy(){this.destroy()}navigateToTab(t){this.location.replaceState(this.router.createUrlTree(["./",Object.assign(Object.assign({},this.route.snapshot.params),{tab:t})],{queryParamsHandling:"merge",relativeTo:this.route}).toString())}isDefaultChannel(t){return t===Oe.DEFAULT_CHANNEL_CODE}assignToChannel(){this.productChannels$.pipe(Object(_.a)(1),Object(V.a)(t=>this.modalService.fromComponent(cc,{size:"lg",locals:{productIds:[this.id],currentChannelIds:t.map(t=>t.id)}}))).subscribe()}removeFromChannel(t){this.modalService.dialog({title:Object(i.a)("catalog.remove-product-from-channel"),buttons:[{type:"secondary",label:Object(i.a)("common.cancel")},{type:"danger",label:Object(i.a)("catalog.remove-from-channel"),returnValue:!0}]}).pipe(Object(V.a)(e=>e?this.dataService.product.removeProductsFromChannel({channelId:t,productIds:[this.id]}):O.a)).subscribe(()=>{this.notificationService.success(Object(i.a)("catalog.notify-remove-product-from-channel-success"))},t=>{this.notificationService.error(Object(i.a)("catalog.notify-remove-product-from-channel-error"))})}assignVariantToChannel(t){return this.modalService.fromComponent(cc,{size:"lg",locals:{productIds:[this.id],productVariantIds:[t.id],currentChannelIds:t.channels.map(t=>t.id)}}).subscribe()}removeVariantFromChannel({channelId:t,variant:e}){this.modalService.dialog({title:Object(i.a)("catalog.remove-product-variant-from-channel"),buttons:[{type:"secondary",label:Object(i.a)("common.cancel")},{type:"danger",label:Object(i.a)("catalog.remove-from-channel"),returnValue:!0}]}).pipe(Object(V.a)(c=>c?this.dataService.product.removeVariantsFromChannel({channelId:t,productVariantIds:[e.id]}):O.a)).subscribe(()=>{this.notificationService.success(Object(i.a)("catalog.notify-remove-variant-from-channel-success"))},t=>{this.notificationService.error(Object(i.a)("catalog.notify-remove-variant-from-channel-error"))})}customFieldIsSet(t){return!!this.detailForm.get(["product","customFields",t])}assetsChanged(){return!!Object.values(this.assetChanges).length}variantAssetsChanged(){return!!Object.keys(this.variantAssetChanges).length}variantAssetChange(t){this.variantAssetChanges[t.variantId]=t}updateSlug(t){Object(C.a)(this.entity$,this.languageCode$).pipe(Object(_.a)(1)).subscribe(([e,c])=>{const n=this.detailForm.get(["product","slug"]),i=Object(a.S)(e,c),o=!i||!i.slug;n&&n.pristine&&o&&n.setValue(Object(A.normalizeString)(`${t}`,"-"))})}selectProductFacetValue(){this.displayFacetValueModal().subscribe(t=>{if(t){const e=this.getProductFormGroup(),c=e.value.facetValueIds;e.patchValue({facetValueIds:Object(Pe.unique)([...c,...t])}),e.markAsDirty()}})}updateProductOption(t){Object(C.a)(this.product$,this.languageCode$).pipe(Object(_.a)(1),Object(L.a)(([e,c])=>this.productDetailService.updateProductOption(t,e,c))).subscribe(()=>{this.notificationService.success(Object(i.a)("common.notify-update-success"),{entity:"ProductOption"})},t=>{this.notificationService.error(Object(i.a)("common.notify-update-error"),{entity:"ProductOption"})})}removeProductFacetValue(t){const e=this.getProductFormGroup(),c=e.value.facetValueIds;e.patchValue({facetValueIds:c.filter(e=>e!==t)}),e.markAsDirty()}selectVariantFacetValue(t){this.displayFacetValueModal().pipe(ke(this.variants$)).subscribe(([e,c])=>{if(e){for(const n of t){const t=c.findIndex(t=>t.id===n),a=c[t],i=a?a.facetValues.map(t=>t.id):[],o=this.detailForm.get(["variants",t]);o&&(o.patchValue({facetValueIds:Object(Pe.unique)([...i,...e])}),o.markAsDirty())}this.changeDetector.markForCheck()}})}variantsToCreateAreValid(){return 0<this.createVariantsConfig.variants.length&&this.createVariantsConfig.variants.every(t=>""!==t.sku)}displayFacetValueModal(){return this.productDetailService.getFacets().pipe(Object(L.a)(t=>this.modalService.fromComponent(_e,{size:"md",closable:!0,locals:{facets:t}})),Object(o.a)(t=>t&&t.map(t=>t.id)))}create(){const t=this.getProductFormGroup();t.dirty&&Object(C.a)(this.product$,this.languageCode$).pipe(Object(_.a)(1),Object(L.a)(([e,c])=>{const n=this.getUpdatedProduct(e,t,c);return this.productDetailService.createProductWithVariants(n,this.createVariantsConfig,c)})).subscribe(({createProductVariants:t,productId:e})=>{this.notificationService.success(Object(i.a)("common.notify-create-success"),{entity:"Product"}),this.assetChanges={},this.variantAssetChanges={},this.detailForm.markAsPristine(),this.router.navigate(["../",e],{relativeTo:this.route})},t=>{console.error(t),this.notificationService.error(Object(i.a)("common.notify-create-error"),{entity:"Product"})})}save(){Object(C.a)(this.product$,this.languageCode$,this.channelPriceIncludesTax$).pipe(Object(_.a)(1),Object(L.a)(([t,e,c])=>{var n,a;const i=this.getProductFormGroup();let o,r;(i.dirty||this.assetsChanged())&&(o=this.getUpdatedProduct(t,i,e));const s=this.detailForm.get("variants");return(s&&s.dirty||this.variantAssetsChanged())&&(r=this.getUpdatedProductVariants(t,s,e,c)),this.productDetailService.updateProduct({product:t,languageCode:e,autoUpdate:null!==(a=null===(n=this.detailForm.get(["product","autoUpdateVariantNames"]))||void 0===n?void 0:n.value)&&void 0!==a&&a,productInput:o,variantsInput:r})})).subscribe(t=>{this.updateSlugAfterSave(t),this.detailForm.markAsPristine(),this.assetChanges={},this.variantAssetChanges={},this.notificationService.success(Object(i.a)("common.notify-update-success"),{entity:"Product"}),this.changeDetector.markForCheck()},t=>{this.notificationService.error(Object(i.a)("common.notify-update-error"),{entity:"Product"})})}canDeactivate(){return super.canDeactivate()&&!this.assetChanges.assets&&!this.assetChanges.featuredAsset}setFormValues(t,e){const c=Object(a.S)(t,e);if(this.detailForm.patchValue({product:{enabled:t.enabled,name:c?c.name:"",slug:c?c.slug:"",description:c?c.description:"",facetValueIds:t.facetValues.map(t=>t.id)}}),this.customFields.length){const e=this.detailForm.get(["product","customFields"]),n=c&&c.customFields||{},a=t.customFields||{};for(const t of this.customFields){const c=t.name,i="localeString"===t.type?n[c]:a[c],o=e.get(c);o&&o.patchValue(i)}}const n=this.detailForm.get("variants");t.variants.forEach((t,c)=>{const i=Object(a.S)(t,e),o=t.facetValues.map(t=>t.id),r={id:t.id,enabled:t.enabled,sku:t.sku,name:i?i.name:"",price:t.price,priceWithTax:t.priceWithTax,taxCategoryId:t.taxCategory.id,stockOnHand:t.stockOnHand,useGlobalOutOfStockThreshold:t.useGlobalOutOfStockThreshold,outOfStockThreshold:t.outOfStockThreshold,trackInventory:t.trackInventory,facetValueIds:o};let s=n.at(c);if(s?s.patchValue(r):(s=this.formBuilder.group(Object.assign(Object.assign({},r),{facetValueIds:this.formBuilder.control(o)})),n.insert(c,s)),this.customVariantFields.length){let e=s.get(["customFields"]);e||(e=this.formBuilder.group(this.customVariantFields.reduce((t,e)=>Object.assign(Object.assign({},t),{[e.name]:""}),{})),s.addControl("customFields",e));for(const c of this.customVariantFields){const n=c.name,a="localeString"===c.type?i.customFields[n]:t.customFields[n],o=e.get(n);o&&o.patchValue(a)}}})}getUpdatedProduct(t,e,c){var n,i;const o=Object(a.P)({translatable:t,updatedFields:e.value,customFieldConfig:this.customFields,languageCode:c,defaultTranslation:{languageCode:c,name:t.name||"",slug:t.slug||"",description:t.description||""}});return Object.assign(Object.assign({},o),{assetIds:null===(n=this.assetChanges.assets)||void 0===n?void 0:n.map(t=>t.id),featuredAssetId:null===(i=this.assetChanges.featuredAsset)||void 0===i?void 0:i.id,facetValueIds:e.value.facetValueIds})}getUpdatedProductVariants(t,e,c,n){const o=t.variants.filter((t,c)=>{const n=e.get(c.toString());return n&&n.dirty}),r=e.controls.filter(t=>t.dirty).map(t=>t.value);if(o.length!==r.length)throw new Error(Object(i.a)("error.product-variant-form-values-do-not-match"));return o.map((t,e)=>{var i,o;const s=r[e],l=Object(a.P)({translatable:t,updatedFields:s,customFieldConfig:this.customVariantFields,languageCode:c,defaultTranslation:{languageCode:c,name:""}});l.taxCategoryId=s.taxCategoryId,l.facetValueIds=s.facetValueIds,l.price=n?s.priceWithTax:s.price;const d=this.variantAssetChanges[t.id];return d&&(l.featuredAssetId=null===(i=d.featuredAsset)||void 0===i?void 0:i.id,l.assetIds=null===(o=d.assets)||void 0===o?void 0:o.map(t=>t.id)),l}).filter(Tt.notNullOrUndefined)}getProductFormGroup(){return this.detailForm.get("product")}updateSlugAfterSave(t){const e=t[0],c=this.detailForm.get(["product","slug"]);c&&e.hasOwnProperty("updateProduct")&&c.setValue(e.updateProduct.slug,{emitEvent:!1})}}jc.\u0275fac=function(t){return new(t||jc)(s.bc(n.a),s.bc(n.e),s.bc(a.I),s.bc(Me),s.bc(r.e),s.bc(a.F),s.bc(a.G),s.bc(a.s),s.bc(h.k),s.bc(s.j))},jc.\u0275cmp=s.Vb({type:jc,selectors:[["vdr-product-detail"]],features:[s.Nb],decls:18,vars:21,consts:[[1,"flex","clr-flex-row"],[3,"entity"],[4,"vdrIfPermissions"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","product-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup","keydown.enter",4,"ngIf"],["type","checkbox","clrToggle","","name","enabled",3,"formControl"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup","keydown.enter"],["clrTabLink","",3,"click"],[4,"clrIfActive"],[4,"ngIf"],[1,"clr-row"],[1,"clr-col"],["formGroupName","product",1,"form-block"],[4,"vdrIfMultichannel"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],[1,"auto-rename-wrapper"],["clrCheckbox","","type","checkbox","id","auto-update","formControlName","autoUpdateVariantNames"],["for","slug",3,"label","errors"],["id","slug","type","text","formControlName","slug","pattern","[a-z0-9_-]+",3,"readonly"],["formControlName","description",3,"readonly","label"],["formGroupName","customFields",4,"ngIf"],[1,"facets"],[3,"facetValue","removable","remove",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary",3,"click",4,"vdrIfPermissions"],[1,"clr-col-md-auto"],[3,"assets","featuredAsset","change"],[3,"label",4,"vdrIfDefaultChannelActive"],[3,"label"],[1,"flex","channel-assignment"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm",3,"click"],["shape","layers"],["icon","times-circle",3,"iconClick",4,"ngIf"],["icon","times-circle",3,"iconClick"],[3,"channelCode"],["formGroupName","customFields"],["entityName","Product",3,"customFieldsFormGroup","customField","readonly",4,"ngIf"],["entityName","Product",3,"customFieldsFormGroup","customField","readonly"],[3,"facetValue","removable","remove"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","plus"],[3,"variantsChange"],[1,"form-block"],[1,"view-mode"],[1,"btn-group"],[1,"btn","btn-secondary-outline",3,"click"],["shape","list"],[1,"btn",3,"click"],["shape","table"],[1,"variant-filter"],[3,"formControl","placeholder"],[1,"icon-button",3,"click"],["shape","times"],[1,"flex-spacer"],["class","btn btn-secondary edit-variants-btn",3,"routerLink",4,"vdrIfPermissions"],[3,"variants","optionGroups","channelPriceIncludesTax","productVariantsFormArray","pendingAssetChanges",4,"ngIf"],[3,"variants","channelPriceIncludesTax","facets","optionGroups","productVariantsFormArray","taxCategories","customFields","customOptionFields","activeLanguage","pendingAssetChanges","assignToChannel","removeFromChannel","assetChange","updateProductOption","selectionChange","selectFacetValueClick",4,"ngIf"],[1,"btn","btn-secondary","edit-variants-btn",3,"routerLink"],["shape","add-text"],[3,"variants","optionGroups","channelPriceIncludesTax","productVariantsFormArray","pendingAssetChanges"],[3,"variants","channelPriceIncludesTax","facets","optionGroups","productVariantsFormArray","taxCategories","customFields","customOptionFields","activeLanguage","pendingAssetChanges","assignToChannel","removeFromChannel","assetChange","updateProductOption","selectionChange","selectFacetValueClick"]],template:function(t,e){if(1&t&&(s.hc(0,"vdr-action-bar"),s.hc(1,"vdr-ab-left"),s.hc(2,"div",0),s.cc(3,"vdr-entity-info",1),s.sc(4,"async"),s.Tc(5,ac,5,5,"clr-toggle-wrapper",2),s.gc(),s.hc(6,"vdr-language-selector",3),s.pc("languageCodeChange",function(t){return e.setLanguage(t)}),s.sc(7,"async"),s.sc(8,"async"),s.sc(9,"async"),s.gc(),s.gc(),s.hc(10,"vdr-ab-right"),s.cc(11,"vdr-action-bar-items",4),s.Tc(12,ic,3,4,"button",5),s.sc(13,"async"),s.Tc(14,sc,1,2,"ng-template",null,6,s.Uc),s.gc(),s.gc(),s.Tc(16,Qc,10,10,"form",7),s.sc(17,"async")),2&t){const t=s.Ic(15);s.Qb(3),s.yc("entity",s.tc(4,8,e.entity$)),s.Qb(2),s.yc("vdrIfPermissions",s.Bc(20,rc)),s.Qb(1),s.yc("disabled",s.tc(7,10,e.isNew$))("availableLanguageCodes",s.tc(8,12,e.availableLanguages$))("currentLanguageCode",s.tc(9,14,e.languageCode$)),s.Qb(6),s.yc("ngIf",s.tc(13,16,e.isNew$))("ngIfElse",t),s.Qb(4),s.yc("ngIf",s.tc(17,18,e.product$))}},styles:["[_nghost-%COMP%]     trix-toolbar{top:24px}vdr-action-bar[_ngcontent-%COMP%]   clr-toggle-wrapper[_ngcontent-%COMP%]{margin-top:12px}.variant-filter[_ngcontent-%COMP%]{flex:1;display:flex}.variant-filter[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;max-width:none;border-radius:3px 0 0 3px!important}.variant-filter[_ngcontent-%COMP%]   .icon-button[_ngcontent-%COMP%]{border:1px solid var(--color-component-border-300);background-color:var(--color-component-bg-100);border-radius:0 3px 3px 0;border-left:none}.group-name[_ngcontent-%COMP%]{padding-right:6px}.view-mode[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center}.edit-variants-btn[_ngcontent-%COMP%]{margin-top:0}.channel-assignment[_ngcontent-%COMP%]{flex-wrap:wrap}.auto-rename-wrapper[_ngcontent-%COMP%]{overflow:hidden;max-height:0;padding-left:9.5rem;margin-bottom:0;transition:max-height .2s,margin-bottom .2s}.auto-rename-wrapper.visible[_ngcontent-%COMP%]{max-height:24px;margin-bottom:12px}"],changeDetection:0});var Mc=c("3E0/"),wc=c("ZOsW");const Sc=["selectComponent"];function Dc(t,e){if(1&t){const t=s.ic();s.hc(0,"div",6),s.pc("click",function(){s.Lc(t),s.rc(2);return s.Ic(1).selectTag()}),s.Vc(1),s.sc(2,"translate"),s.gc()}if(2&t){const t=s.rc(2),e=s.Ic(1);s.Tb("selected",t.isSearchHeaderSelected()),s.Qb(1),s.Yc(" ",s.tc(2,4,"catalog.search-for-term"),": ",e.searchTerm," ")}}function $c(t,e){if(1&t&&s.Tc(0,Dc,3,6,"div",5),2&t){s.rc();const t=s.Ic(1);s.yc("ngIf",t.searchTerm)}}function Ac(t,e){if(1&t){const t=s.ic();s.fc(0),s.hc(1,"vdr-facet-value-chip",8),s.pc("remove",function(){s.Lc(t);const e=s.rc(),c=e.item;return(0,e.clear)(c)}),s.gc(),s.ec()}if(2&t){const t=s.rc().item;s.Qb(1),s.yc("facetValue",t.facetValue)("removable",!0)}}function _c(t,e){if(1&t){const t=s.ic();s.fc(0),s.hc(1,"vdr-chip",9),s.pc("iconClick",function(){s.Lc(t);const e=s.rc(),c=e.item;return(0,e.clear)(c)}),s.Vc(2),s.gc(),s.ec()}if(2&t){const t=s.rc().item;s.Qb(1),s.yc("icon","times"),s.Qb(1),s.Xc('"',t.label,'"')}}function Lc(t,e){if(1&t&&(s.Tc(0,Ac,2,2,"ng-container",7),s.Tc(1,_c,3,2,"ng-container",7)),2&t){const t=e.item;s.yc("ngIf",t.facetValue),s.Qb(1),s.yc("ngIf",!t.facetValue)}}function Nc(t,e){if(1&t&&(s.fc(0),s.cc(1,"vdr-facet-value-chip",10),s.ec()),2&t){const t=s.rc().item;s.Qb(1),s.yc("facetValue",t.facetValue)("removable",!1)}}function Gc(t,e){if(1&t&&s.Tc(0,Nc,2,2,"ng-container",7),2&t){const t=e.item;s.yc("ngIf",t.facetValue)}}class Ec{constructor(){this.searchTermChange=new s.t,this.facetValueChange=new s.t,this.lastTerm="",this.lastFacetValueIds=[],this.filterFacetResults=(t,e)=>!!this.isFacetValueItem(e)&&(e.facetValue.name.toLowerCase().startsWith(t.toLowerCase())||e.facetValue.facet.name.toLowerCase().startsWith(t.toLowerCase())),this.isFacetValueItem=t=>"object"==typeof t&&!!t&&t.hasOwnProperty("facetValue")}setSearchTerm(t){if(t)this.selectComponent.select({label:t,value:{label:t}});else{const t=this.selectComponent.selectedItems.find(t=>!this.isFacetValueItem(t.value));t&&this.selectComponent.unselect(t)}}setFacetValues(t){const e=this.selectComponent.items;this.selectComponent.selectedItems.forEach(e=>{this.isFacetValueItem(e.value)&&!t.includes(e.value.facetValue.id)&&this.selectComponent.unselect(e)}),t.map(t=>e.find(e=>this.isFacetValueItem(e)&&e.facetValue.id===t)).filter(Tt.notNullOrUndefined).forEach(t=>{this.selectComponent.selectedItems.find(e=>{const c=e.value;return!!this.isFacetValueItem(c)&&c.facetValue.id===t.facetValue.id})||this.selectComponent.select({label:"",value:t})})}onSelectChange(t){Array.isArray(t)||(t=[t]);const e=t.find(t=>!this.isFacetValueItem(t)),c=e?e.label:"",n=t.filter(this.isFacetValueItem).map(t=>t.facetValue.id);c!==this.lastTerm&&(this.searchTermChange.emit(c),this.lastTerm=c),this.lastFacetValueIds.join(",")!==n.join(",")&&(this.facetValueChange.emit(n),this.lastFacetValueIds=n)}addTagFn(t){return{label:t}}isSearchHeaderSelected(){return-1===this.selectComponent.itemsList.markedIndex}}Ec.\u0275fac=function(t){return new(t||Ec)},Ec.\u0275cmp=s.Vb({type:Ec,selectors:[["vdr-product-search-input"]],viewQuery:function(t,e){if(1&t&&s.ad(Sc,3),2&t){let t;s.Hc(t=s.qc())&&(e.selectComponent=t.first)}},inputs:{facetValueResults:"facetValueResults"},outputs:{searchTermChange:"searchTermChange",facetValueChange:"facetValueChange"},features:[s.Pb([{provide:wc.c,useValue:a.K}])],decls:6,vars:9,consts:[[3,"addTag","placeholder","items","searchFn","hideSelected","multiple","markFirst","change"],["selectComponent",""],["ng-header-tmp",""],["ng-label-tmp",""],["ng-option-tmp",""],["class","search-header",3,"selected","click",4,"ngIf"],[1,"search-header",3,"click"],[4,"ngIf"],[3,"facetValue","removable","remove"],[3,"icon","iconClick"],[3,"facetValue","removable"]],template:function(t,e){1&t&&(s.hc(0,"ng-select",0,1),s.pc("change",function(t){return e.onSelectChange(t)}),s.sc(2,"translate"),s.Tc(3,$c,1,1,"ng-template",2),s.Tc(4,Lc,2,2,"ng-template",3),s.Tc(5,Gc,1,1,"ng-template",4),s.gc()),2&t&&s.yc("addTag",e.addTagFn)("placeholder",s.tc(2,7,"catalog.search-product-name-or-code"))("items",e.facetValueResults)("searchFn",e.filterFacetResults)("hideSelected",!0)("multiple",!0)("markFirst",!1)},directives:[wc.a,wc.f,wc.e,wc.d,h.o,re.a,oe.a],pipes:[m.d],styles:["[_nghost-%COMP%]{margin-top:6px;display:block;width:100%}[_nghost-%COMP%]     .ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-value{background:none;margin:0}[_nghost-%COMP%]     .ng-dropdown-panel-items div.ng-option:last-child{display:none}[_nghost-%COMP%]     .ng-dropdown-panel .ng-dropdown-header{border:none;padding:0}[_nghost-%COMP%]     .ng-select.ng-select-multiple .ng-select-container .ng-value-container{padding:0}[_nghost-%COMP%]     .ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-placeholder{padding-left:8px}ng-select[_ngcontent-%COMP%]{width:100%;min-width:300px;margin-right:12px}.search-header[_ngcontent-%COMP%]{padding:8px 10px;border-bottom:1px solid var(--color-component-border-100);cursor:pointer}.search-header.selected[_ngcontent-%COMP%], .search-header[_ngcontent-%COMP%]:hover{background-color:var(--color-component-bg-200)}"],changeDetection:0});var Wc=c("PPsv");const Uc=["productSearchInputComponent"],Bc=function(){return["./create"]};function Xc(t,e){1&t&&(s.hc(0,"a",13),s.cc(1,"clr-icon",14),s.hc(2,"span",15),s.Vc(3),s.sc(4,"translate"),s.gc(),s.gc()),2&t&&(s.yc("routerLink",s.Bc(4,Bc)),s.Qb(3),s.Wc(s.tc(4,2,"catalog.create-new-product")))}function Rc(t,e){if(1&t&&(s.cc(0,"img",28),s.sc(1,"assetPreview")),2&t){const t=e.ngIf;s.yc("src",s.uc(1,1,t,"tiny"),s.Nc)}}function Hc(t,e){1&t&&(s.hc(0,"div",29),s.cc(1,"clr-icon",30),s.gc())}function zc(t,e){1&t&&(s.hc(0,"vdr-chip"),s.Vc(1),s.sc(2,"translate"),s.gc()),2&t&&(s.Qb(1),s.Wc(s.tc(2,1,"common.disabled")))}const qc=function(t){return["./",t]},Kc=function(){return["DeleteCatalog","DeleteProduct"]};function Zc(t,e){if(1&t){const t=s.ic();s.hc(0,"td",16),s.hc(1,"div",17),s.Tc(2,Rc,2,4,"img",18),s.Tc(3,Hc,2,0,"ng-template",null,19,s.Uc),s.gc(),s.gc(),s.hc(5,"td",16),s.Vc(6),s.gc(),s.hc(7,"td",20),s.Tc(8,zc,3,3,"vdr-chip",21),s.gc(),s.hc(9,"td",22),s.cc(10,"vdr-table-row-action",23),s.sc(11,"translate"),s.gc(),s.hc(12,"td",22),s.hc(13,"vdr-dropdown"),s.hc(14,"button",24),s.Vc(15),s.sc(16,"translate"),s.cc(17,"clr-icon",25),s.gc(),s.hc(18,"vdr-dropdown-menu",7),s.hc(19,"button",26),s.pc("click",function(){s.Lc(t);const c=e.item;return s.rc().deleteProduct(c.productId)}),s.sc(20,"hasPermission"),s.cc(21,"clr-icon",27),s.Vc(22),s.sc(23,"translate"),s.gc(),s.gc(),s.gc(),s.gc()}if(2&t){const t=e.item,c=s.Ic(4),n=s.rc();s.Tb("disabled",!t.enabled),s.Qb(2),s.yc("ngIf",n.groupByProduct?t.productAsset:t.productVariantAsset||t.productAsset)("ngIfElse",c),s.Qb(3),s.Tb("disabled",!t.enabled),s.Qb(1),s.Xc(" ",n.groupByProduct?t.productName:t.productVariantName," "),s.Qb(1),s.Tb("disabled",!t.enabled),s.Qb(1),s.yc("ngIf",!t.enabled),s.Qb(1),s.Tb("disabled",!t.enabled),s.Qb(1),s.yc("label",s.tc(11,19,"common.edit"))("linkTo",s.Cc(27,qc,t.productId)),s.Qb(2),s.Tb("disabled",!t.enabled),s.Qb(3),s.Xc(" ",s.tc(16,21,"common.actions")," "),s.Qb(4),s.yc("disabled",!s.tc(20,23,s.Bc(29,Kc))),s.Qb(3),s.Xc(" ",s.tc(23,25,"common.delete")," ")}}const Yc=function(){return["UpdateCatalog","UpdateProduct"]},Jc=function(){return["CreateCatalog","CreateProduct"]};class tn extends a.n{constructor(t,e,c,n,i,o){super(i,o),this.dataService=t,this.modalService=e,this.notificationService=c,this.jobQueueService=n,this.searchTerm="",this.facetValueIds=[],this.groupByProduct=!0,super.setQueryFn((...t)=>this.dataService.product.searchProducts(this.searchTerm,...t).refetchOnChannelChange(),t=>t.search,(t,e)=>({input:{skip:t,take:e,term:this.searchTerm,facetValueIds:this.facetValueIds,facetValueOperator:a.E.AND,groupByProduct:this.groupByProduct}}))}ngOnInit(){super.ngOnInit(),this.facetValues$=this.result$.pipe(Object(o.a)(t=>t.search.facetValues)),this.route.queryParamMap.pipe(Object(o.a)(t=>t.get("q")),Object(F.a)(this.destroy$)).subscribe(t=>{this.productSearchInput.setSearchTerm(t)});const t=this.route.queryParamMap.pipe(Object(o.a)(t=>t.getAll("fvids")));t.pipe(Object(F.a)(this.destroy$)).subscribe(t=>{this.productSearchInput.setFacetValues(t)}),this.facetValues$.pipe(Object(_.a)(1),Object(Mc.a)(100),ke(t)).subscribe(([t,e])=>{this.productSearchInput.setFacetValues(e)})}setSearchTerm(t){this.searchTerm=t,this.setQueryParam({q:t||null,page:1}),this.refresh()}setFacetValueIds(t){this.facetValueIds=t,this.setQueryParam({fvids:t,page:1}),this.refresh()}rebuildSearchIndex(){this.dataService.product.reindex().subscribe(({reindex:t})=>{this.notificationService.info(Object(i.a)("catalog.reindexing")),this.jobQueueService.addJob(t.id,t=>{if(t.state===a.B.COMPLETED){const e=(new Intl.NumberFormat).format(t.duration||0);this.notificationService.success(Object(i.a)("catalog.reindex-successful"),{count:t.result.indexedItemCount,time:e}),this.refresh()}else this.notificationService.error(Object(i.a)("catalog.reindex-error"))})})}deleteProduct(t){this.modalService.dialog({title:Object(i.a)("catalog.confirm-delete-product"),buttons:[{type:"secondary",label:Object(i.a)("common.cancel")},{type:"danger",label:Object(i.a)("common.delete"),returnValue:!0}]}).pipe(Object(V.a)(e=>e?this.dataService.product.deleteProduct(t):O.a),Object(Mc.a)(500)).subscribe(()=>{this.notificationService.success(Object(i.a)("common.notify-delete-success"),{entity:"Product"}),this.refresh()},t=>{this.notificationService.error(Object(i.a)("common.notify-delete-error"),{entity:"Product"})})}}tn.\u0275fac=function(t){return new(t||tn)(s.bc(a.s),s.bc(a.F),s.bc(a.G),s.bc(a.A),s.bc(n.e),s.bc(n.a))},tn.\u0275cmp=s.Vb({type:tn,selectors:[["vdr-products-list"]],viewQuery:function(t,e){if(1&t&&s.ad(Uc,3),2&t){let t;s.Hc(t=s.qc())&&(e.productSearchInput=t.first)}},features:[s.Nb],decls:28,vars:29,consts:[[3,"grow"],[1,"search-form"],[3,"facetValueResults","searchTermChange","facetValueChange"],["productSearchInputComponent",""],[1,"search-settings-menu","mr3"],["type","button","vdrDropdownTrigger","",1,"icon-button"],["shape","cog"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",3,"disabled","click"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],["locationId","product-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"full-label"],[1,"left","align-middle"],[1,"image-placeholder"],[3,"src",4,"ngIf","ngIfElse"],["imagePlaceholder",""],[1,"align-middle"],[4,"ngIf"],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"src"],[1,"placeholder"],["shape","image","size","48"]],template:function(t,e){1&t&&(s.hc(0,"vdr-action-bar"),s.hc(1,"vdr-ab-left",0),s.hc(2,"div",1),s.hc(3,"vdr-product-search-input",2,3),s.pc("searchTermChange",function(t){return e.setSearchTerm(t)})("facetValueChange",function(t){return e.setFacetValueIds(t)}),s.sc(5,"async"),s.gc(),s.hc(6,"vdr-dropdown",4),s.hc(7,"button",5),s.cc(8,"clr-icon",6),s.gc(),s.hc(9,"vdr-dropdown-menu",7),s.hc(10,"button",8),s.pc("click",function(){return e.rebuildSearchIndex()}),s.sc(11,"hasPermission"),s.Vc(12),s.sc(13,"translate"),s.gc(),s.gc(),s.gc(),s.gc(),s.hc(14,"clr-checkbox-wrapper"),s.hc(15,"input",9),s.pc("ngModelChange",function(t){return e.groupByProduct=t}),s.gc(),s.hc(16,"label"),s.Vc(17),s.sc(18,"translate"),s.gc(),s.gc(),s.gc(),s.hc(19,"vdr-ab-right"),s.cc(20,"vdr-action-bar-items",10),s.Tc(21,Xc,5,5,"a",11),s.gc(),s.gc(),s.hc(22,"vdr-data-table",12),s.pc("pageChange",function(t){return e.setPageNumber(t)})("itemsPerPageChange",function(t){return e.setItemsPerPage(t)}),s.sc(23,"async"),s.sc(24,"async"),s.sc(25,"async"),s.sc(26,"async"),s.Tc(27,Zc,24,30,"ng-template"),s.gc()),2&t&&(s.Qb(1),s.yc("grow",!0),s.Qb(2),s.yc("facetValueResults",s.tc(5,11,e.facetValues$)),s.Qb(7),s.yc("disabled",!s.tc(11,13,s.Bc(27,Yc))),s.Qb(2),s.Xc(" ",s.tc(13,15,"catalog.rebuild-search-index")," "),s.Qb(3),s.yc("ngModel",e.groupByProduct),s.Qb(2),s.Wc(s.tc(18,17,"catalog.group-by-product")),s.Qb(4),s.yc("vdrIfPermissions",s.Bc(28,Jc)),s.Qb(1),s.yc("items",s.tc(23,19,e.items$))("itemsPerPage",s.tc(24,21,e.itemsPerPage$))("totalItems",s.tc(25,23,e.totalItems$))("currentPage",s.tc(26,25,e.currentPage$)))},directives:[l.a,l.b,Ec,$t.a,At.a,vt.o,_t.a,Lt.a,vt.k,B.a,r.a,vt.i,r.p,r.s,vt.u,l.c,u.a,p.a,X.a,n.h,h.o,R.a,oe.a],pipes:[h.b,w.a,m.d,Wc.a],styles:[".image-placeholder[_ngcontent-%COMP%]{width:50px;height:50px;background-color:var(--color-component-bg-200)}.image-placeholder[_ngcontent-%COMP%]   .placeholder[_ngcontent-%COMP%]{text-align:center;color:var(--color-grey-300)}.search-form[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;margin-bottom:6px}.search-input[_ngcontent-%COMP%]{min-width:300px}@media screen and (max-width:768px){.search-input[_ngcontent-%COMP%]{min-width:100px}}.search-settings-menu[_ngcontent-%COMP%]{margin:0 12px}td.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}"]});var en=c("78Ut"),cn=c("pLZG");const nn=["textArea"];function an(t,e){if(1&t){const t=s.ic();s.hc(0,"vdr-chip",6),s.pc("iconClick",function(){s.Lc(t);const c=e.$implicit;return s.rc(2).removeOption(c)}),s.Vc(1),s.gc()}if(2&t){const t=e.$implicit,c=e.last,n=s.rc(2);s.Tb("selected",c&&n.lastSelected)("locked",t.locked),s.yc("icon",t.locked?"lock":"times")("colorFrom",n.groupName),s.Qb(1),s.Xc(" ",t.name," ")}}function on(t,e){if(1&t&&(s.hc(0,"div",4),s.Tc(1,an,2,7,"vdr-chip",5),s.gc()),2&t){const t=s.rc();s.Qb(1),s.yc("ngForOf",t.options)}}const rn={provide:r.n,useExisting:Object(s.jb)(()=>sn),multi:!0};class sn{constructor(t){this.changeDetector=t,this.groupName="",this.disabled=!1,this.input="",this.isFocussed=!1,this.lastSelected=!1}registerOnChange(t){this.onChangeFn=t}registerOnTouched(t){this.onTouchFn=t}setDisabledState(t){this.disabled=t,this.changeDetector.markForCheck()}writeValue(t){this.options=t||[]}focus(){this.textArea.nativeElement.focus()}removeOption(t){t.locked||(this.options=this.options.filter(e=>e.name!==t.name),this.onChangeFn(this.options))}handleKey(t){switch(t.key){case",":case"Enter":this.addOptionValue(),t.preventDefault();break;case"Backspace":this.lastSelected?(this.removeLastOption(),this.lastSelected=!1):""===this.input&&(this.lastSelected=!0);break;default:this.lastSelected=!1}}handleBlur(){this.isFocussed=!1,this.addOptionValue()}addOptionValue(){this.options=Object(Pe.unique)([...this.options,...this.parseInputIntoOptions(this.input)]),this.input="",this.onChangeFn(this.options)}parseInputIntoOptions(t){return t.split(/[,\n]/).map(t=>t.trim()).filter(t=>""!==t).map(t=>({name:t,locked:!1}))}removeLastOption(){this.options[this.options.length-1].locked||(this.options=this.options.slice(0,this.options.length-1))}}sn.\u0275fac=function(t){return new(t||sn)(s.bc(s.j))},sn.\u0275cmp=s.Vb({type:sn,selectors:[["vdr-option-value-input"]],viewQuery:function(t,e){if(1&t&&s.ad(nn,3),2&t){let t;s.Hc(t=s.qc())&&(e.textArea=t.first)}},inputs:{groupName:"groupName"},features:[s.Pb([rn])],decls:4,vars:5,consts:[[1,"input-wrapper",3,"click"],["class","chips",4,"ngIf"],[3,"ngModel","disabled","keyup","focus","blur","ngModelChange"],["textArea",""],[1,"chips"],[3,"icon","selected","locked","colorFrom","iconClick",4,"ngFor","ngForOf"],[3,"icon","colorFrom","iconClick"]],template:function(t,e){if(1&t){const t=s.ic();s.hc(0,"div",0),s.pc("click",function(){s.Lc(t);return s.Ic(3).focus()}),s.Tc(1,on,2,1,"div",1),s.hc(2,"textarea",2,3),s.pc("keyup",function(t){return e.handleKey(t)})("focus",function(){return e.isFocussed=!0})("blur",function(){return e.handleBlur()})("ngModelChange",function(t){return e.input=t}),s.gc(),s.gc()}2&t&&(s.Tb("focus",e.isFocussed),s.Qb(1),s.yc("ngIf",0<e.options.length),s.Qb(1),s.yc("ngModel",e.input)("disabled",e.disabled))},directives:[h.o,B.a,r.b,r.p,r.s,h.n,oe.a],styles:[".input-wrapper[_ngcontent-%COMP%]{background-color:#fff;border-radius:3px!important;border:1px solid var(--color-grey-300)!important;cursor:text}.input-wrapper.focus[_ngcontent-%COMP%]{border-color:var(--color-primary-500)!important;box-shadow:0 0 1px 1px var(--color-primary-100)}.input-wrapper[_ngcontent-%COMP%]   .chips[_ngcontent-%COMP%]{padding:5px}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border:none;width:100%;height:24px;margin-top:3px;padding:0 6px}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:disabled{background-color:var(--color-component-bg-100)}vdr-chip[_ngcontent-%COMP%]     .wrapper{margin:0 3px}vdr-chip.locked[_ngcontent-%COMP%]{opacity:.8}vdr-chip.selected[_ngcontent-%COMP%]     .wrapper{border-color:var(--color-warning-500)!important;box-shadow:0 0 1px 1px var(--color-warning-400);opacity:.6}"]});var ln=c("hmHg");function dn(t,e){if(1&t){const t=s.ic();s.hc(0,"div",6),s.hc(1,"div",7),s.hc(2,"label"),s.Vc(3),s.sc(4,"translate"),s.gc(),s.hc(5,"input",8),s.pc("ngModelChange",function(t){return e.$implicit.name=t}),s.gc(),s.gc(),s.hc(6,"div",9),s.hc(7,"label"),s.Vc(8),s.sc(9,"translate"),s.gc(),s.hc(10,"vdr-option-value-input",10,11),s.pc("ngModelChange",function(t){return e.$implicit.values=t})("ngModelChange",function(){s.Lc(t);return s.rc().generateVariants()}),s.gc(),s.gc(),s.gc()}if(2&t){const t=e.$implicit;s.Qb(3),s.Wc(s.tc(4,7,"catalog.option")),s.Qb(2),s.yc("ngModel",t.name)("readonly",!t.isNew),s.Qb(3),s.Wc(s.tc(9,9,"catalog.option-values")),s.Qb(2),s.yc("ngModel",t.values)("groupName",t.name)("disabled",""===t.name)}}function un(t,e){if(1&t){const t=s.ic();s.hc(0,"button",12),s.pc("click",function(){s.Lc(t);return s.rc().addOption()}),s.cc(1,"clr-icon",13),s.Vc(2),s.sc(3,"translate"),s.gc()}2&t&&(s.Qb(2),s.Xc(" ",s.tc(3,1,"catalog.add-option"),"\n"))}function pn(t,e){if(1&t){const t=s.ic();s.hc(0,"input",16),s.pc("ngModelChange",function(e){s.Lc(t);return s.rc().$implicit.enabled=e})("ngModelChange",function(){s.Lc(t);return s.rc(2).formValueChanged=!0}),s.gc()}if(2&t){const t=s.rc().$implicit;s.yc("ngModel",t.enabled)}}function gn(t,e){if(1&t){const t=s.ic();s.hc(0,"clr-input-container"),s.hc(1,"input",17),s.pc("ngModelChange",function(e){s.Lc(t);return s.rc().$implicit.sku=e})("ngModelChange",function(){s.Lc(t);const e=s.rc().$implicit;return s.rc().onFormChanged(e)}),s.sc(2,"translate"),s.gc(),s.gc()}if(2&t){const t=s.rc().$implicit;s.Qb(1),s.yc("ngModel",t.sku)("placeholder",s.tc(2,2,"catalog.sku"))}}function hn(t,e){if(1&t&&(s.hc(0,"span"),s.Vc(1),s.gc()),2&t){const t=s.rc().$implicit;s.Qb(1),s.Wc(t.sku)}}function mn(t,e){if(1&t){const t=s.ic();s.hc(0,"clr-input-container"),s.hc(1,"vdr-currency-input",18),s.pc("ngModelChange",function(e){s.Lc(t);return s.rc().$implicit.price=e})("ngModelChange",function(){s.Lc(t);const e=s.rc().$implicit;return s.rc().onFormChanged(e)}),s.gc(),s.gc()}if(2&t){const t=s.rc().$implicit,e=s.rc();s.Qb(1),s.yc("ngModel",t.price)("currencyCode",e.currencyCode)}}function fn(t,e){if(1&t&&(s.hc(0,"span"),s.Vc(1),s.sc(2,"localeCurrency"),s.gc()),2&t){const t=s.rc().$implicit,e=s.rc();s.Qb(1),s.Wc(s.uc(2,1,t.price,e.currencyCode))}}function bn(t,e){if(1&t){const t=s.ic();s.hc(0,"clr-input-container"),s.hc(1,"input",19),s.pc("ngModelChange",function(e){s.Lc(t);return s.rc().$implicit.stock=e})("ngModelChange",function(){s.Lc(t);const e=s.rc().$implicit;return s.rc().onFormChanged(e)}),s.gc(),s.gc()}if(2&t){const t=s.rc().$implicit;s.Qb(1),s.yc("ngModel",t.stock)}}function vn(t,e){if(1&t&&(s.hc(0,"span"),s.Vc(1),s.gc()),2&t){const t=s.rc().$implicit;s.Qb(1),s.Wc(t.stock)}}function yn(t,e){if(1&t){const t=s.ic();s.hc(0,"vdr-dropdown"),s.hc(1,"button",20),s.cc(2,"clr-icon",21),s.gc(),s.hc(3,"vdr-dropdown-menu",22),s.hc(4,"button",23),s.pc("click",function(){s.Lc(t);const c=e.ngIf;return s.rc(2).deleteVariant(c)}),s.cc(5,"clr-icon",24),s.Vc(6),s.sc(7,"translate"),s.gc(),s.gc(),s.gc()}2&t&&(s.Qb(6),s.Xc(" ",s.tc(7,1,"common.delete")," "))}function Cn(t,e){if(1&t&&(s.hc(0,"tr"),s.hc(1,"td"),s.Tc(2,pn,1,1,"input",14),s.gc(),s.hc(3,"td"),s.Vc(4),s.sc(5,"translate"),s.gc(),s.hc(6,"td"),s.Tc(7,gn,3,4,"clr-input-container",15),s.Tc(8,hn,2,1,"span",15),s.gc(),s.hc(9,"td"),s.Tc(10,mn,2,2,"clr-input-container",15),s.Tc(11,fn,3,4,"span",15),s.gc(),s.hc(12,"td"),s.Tc(13,bn,2,1,"clr-input-container",15),s.Tc(14,vn,2,1,"span",15),s.gc(),s.hc(15,"td"),s.Tc(16,yn,8,3,"vdr-dropdown",15),s.gc(),s.gc()),2&t){const t=e.$implicit,c=s.rc();s.Tb("disabled",!t.enabled||t.existing),s.Qb(2),s.yc("ngIf",!t.existing),s.Qb(2),s.Xc(" ",s.tc(5,11,c.getVariantName(t))," "),s.Qb(3),s.yc("ngIf",!t.existing),s.Qb(1),s.yc("ngIf",t.existing),s.Qb(2),s.yc("ngIf",!t.existing),s.Qb(1),s.yc("ngIf",t.existing),s.Qb(2),s.yc("ngIf",!t.existing),s.Qb(1),s.yc("ngIf",t.existing),s.Qb(2),s.yc("ngIf",t.productVariantId)}}const On=function(t){return{count:t}};class Pn{constructor(t){for(const e of Object.keys(t))this[e]=t[e]}}class Fn{constructor(t,e,c,n,a){this.route=t,this.dataService=e,this.productDetailService=c,this.notificationService=n,this.modalService=a,this.formValueChanged=!1,this.generatedVariants=[]}ngOnInit(){this.initOptionsAndVariants(),this.languageCode=this.route.snapshot.paramMap.get("lang")||Object(a.X)(),this.dataService.settings.getActiveChannel().single$.subscribe(t=>{this.currencyCode=t.activeChannel.currencyCode})}onFormChanged(t){this.formValueChanged=!0,t.enabled=!0}canDeactivate(){return!this.formValueChanged}getVariantsToAdd(){return this.generatedVariants.filter(t=>!t.existing&&t.enabled)}getVariantName(t){return 0===t.options.length?Object(i.a)("catalog.default-variant"):t.options.map(t=>t.name).join(" ")}addOption(){this.optionGroups.push({isNew:!0,name:"",values:[]})}generateVariants(){const t=this.optionGroups.map(t=>t.values),e=this.generatedVariants,c=(t,c,n)=>{var a,i,o;const r=this.getVariantPrototype(c,e);return new Pn({enabled:!1,existing:!!n,productVariantId:null==n?void 0:n.id,isDefault:t,options:c,price:null!==(a=null==n?void 0:n.price)&&void 0!==a?a:r.price,sku:null!==(i=null==n?void 0:n.sku)&&void 0!==i?i:r.sku,stock:null!==(o=null==n?void 0:n.stockOnHand)&&void 0!==o?o:r.stock})};this.generatedVariants=t.length?Object(Tt.generateAllCombinations)(t).map(t=>{const e=this.product.variants.find(e=>this.optionsAreEqual(e.options,t));return c(!1,t,e)}):[c(!0,[],this.product.variants[0])]}getVariantPrototype(t,e){return e.filter(e=>t.map(t=>t.name).filter(t=>e.options.map(t=>t.name).includes(t))).length?Object(en.pick)(e[0],["sku","price","stock"]):{sku:"",price:0,stock:0}}deleteVariant(t){this.modalService.dialog({title:Object(i.a)("catalog.confirm-delete-product-variant"),buttons:[{type:"secondary",label:Object(i.a)("common.cancel")},{type:"danger",label:Object(i.a)("common.delete"),returnValue:!0}]}).pipe(Object(V.a)(e=>e?this.productDetailService.deleteProductVariant(t,this.product.id):O.a),Object(V.a)(()=>this.reFetchProduct(null))).subscribe(()=>{this.notificationService.success(Object(i.a)("common.notify-delete-success"),{entity:"ProductVariant"}),this.initOptionsAndVariants()},t=>{this.notificationService.error(Object(i.a)("common.notify-delete-error"),{entity:"ProductVariant"})})}save(){const t=this.optionGroups.filter(t=>t.isNew).map(t=>({name:t.name,values:[]}));this.confirmDeletionOfDefault().pipe(Object(L.a)(()=>this.productDetailService.createProductOptionGroups(t,this.languageCode)),Object(L.a)(t=>this.addOptionGroupsToProduct(t)),Object(L.a)(t=>this.addNewOptionsToGroups(t)),Object(L.a)(t=>this.fetchOptionGroups(t)),Object(L.a)(t=>this.createNewProductVariants(t)),Object(L.a)(t=>this.deleteDefaultVariant(t.createProductVariants)),Object(L.a)(t=>this.reFetchProduct(t))).subscribe({next:t=>{this.formValueChanged=!1,this.notificationService.success(Object(i.a)("catalog.created-new-variants-success"),{count:t.length}),this.initOptionsAndVariants()}})}confirmDeletionOfDefault(){return this.hasOnlyDefaultVariant(this.product)?this.modalService.dialog({title:Object(i.a)("catalog.confirm-adding-options-delete-default-title"),body:Object(i.a)("catalog.confirm-adding-options-delete-default-body"),buttons:[{type:"secondary",label:Object(i.a)("common.cancel")},{type:"danger",label:Object(i.a)("catalog.delete-default-variant"),returnValue:!0}]}).pipe(Object(L.a)(t=>!0===t?Object(G.a)(!0):O.a)):Object(G.a)(!0)}hasOnlyDefaultVariant(t){return 1===t.variants.length&&0===t.optionGroups.length}addOptionGroupsToProduct(t){return t.length?Object(Qt.a)(t.map(t=>this.dataService.product.addOptionGroupToProduct({productId:this.product.id,optionGroupId:t.id}))).pipe(Object(o.a)(()=>t)):Object(G.a)([])}addNewOptionsToGroups(t){const e=this.optionGroups.map(e=>{const c=t.find(t=>t.name===e.name),n=c?c.id:e.id;if(!n)throw new Error("Could not get a productOptionGroupId");return e.values.filter(t=>!t.locked).map(t=>({productOptionGroupId:n,code:Object(A.normalizeString)(t.name,"-"),translations:[{name:t.name,languageCode:this.languageCode}]}))}).reduce((t,e)=>[...t,...e],[]),c=[...t.map(t=>t.id),...this.optionGroups.map(t=>t.id).filter(Tt.notNullOrUndefined)];return e.length?Object(Qt.a)(e.map(t=>this.dataService.product.addOptionToGroup(t))).pipe(Object(o.a)(()=>c)):Object(G.a)(c)}fetchOptionGroups(t){return Object(Qt.a)(t.map(t=>this.dataService.product.getProductOptionGroup(t).mapSingle(t=>t.productOptionGroup).pipe(Object(cn.a)(Tt.notNullOrUndefined))))}createNewProductVariants(t){const e=t.filter(Tt.notNullOrUndefined).map(t=>t.options).reduce((t,e)=>[...t,...e],[]),c=this.generatedVariants.filter(t=>t.enabled&&!t.existing).map(t=>({price:t.price,sku:t.sku,stock:t.stock,optionIds:t.options.map(t=>e.find(e=>e.name===t.name)).filter(Tt.notNullOrUndefined).map(t=>t.id)}));return this.productDetailService.createProductVariants(this.product,c,e,this.languageCode)}deleteDefaultVariant(t){return this.hasOnlyDefaultVariant(this.product)?this.dataService.product.deleteProductVariant(this.product.variants[0].id).pipe(Object(o.a)(()=>t)):Object(G.a)(t)}reFetchProduct(t){const e=this.route.snapshot.paramMap.get("id");return e?this.dataService.product.getProduct(e).single$.pipe(Object(o.a)(()=>t)):Object(G.a)(t)}initOptionsAndVariants(){this.dataService.product.getProductVariantsOptions(this.route.snapshot.paramMap.get("id")).mapSingle(({product:t})=>t).subscribe(t=>{this.product=t,this.optionGroups=t.optionGroups.map(t=>({id:t.id,isNew:!1,name:t.name,values:t.options.map(t=>({id:t.id,name:t.name,locked:!0}))})),this.generateVariants()})}optionsAreEqual(t,e){function c(t){return t.map(t=>t.name).sort().join("|")}return c(t)===c(e)}}Fn.\u0275fac=function(t){return new(t||Fn)(s.bc(n.a),s.bc(a.s),s.bc(Me),s.bc(a.G),s.bc(a.F))},Fn.\u0275cmp=s.Vb({type:Fn,selectors:[["vdr-product-variants-editor"]],decls:28,vars:25,consts:[[1,"btn","btn-primary",3,"disabled","click"],["class","option-groups",4,"ngFor","ngForOf"],["class","btn btn-primary-outline btn-sm",3,"click",4,"ngIf"],[1,"variants-preview"],[1,"table"],[3,"disabled",4,"ngFor","ngForOf"],[1,"option-groups"],[1,"name"],["clrInput","","name","name",3,"ngModel","readonly","ngModelChange"],[1,"values"],[3,"ngModel","groupName","disabled","ngModelChange"],["optionValueInputComponent",""],[1,"btn","btn-primary-outline","btn-sm",3,"click"],["shape","plus"],["type","checkbox","name","enabled","clrCheckbox","",3,"ngModel","ngModelChange",4,"ngIf"],[4,"ngIf"],["type","checkbox","name","enabled","clrCheckbox","",3,"ngModel","ngModelChange"],["clrInput","","type","text","name","sku","required","",3,"ngModel","placeholder","ngModelChange"],["clrInput","","name","price",3,"ngModel","currencyCode","ngModelChange"],["clrInput","","type","number","name","stock","min","0","step","1",3,"ngModel","ngModelChange"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"click"],["shape","trash",1,"is-danger"]],template:function(t,e){1&t&&(s.hc(0,"vdr-action-bar"),s.hc(1,"vdr-ab-right"),s.hc(2,"button",0),s.pc("click",function(){return e.save()}),s.Vc(3),s.sc(4,"translate"),s.gc(),s.gc(),s.gc(),s.Tc(5,dn,12,11,"div",1),s.Tc(6,un,4,3,"button",2),s.hc(7,"div",3),s.hc(8,"table",4),s.hc(9,"thead"),s.hc(10,"tr"),s.hc(11,"th"),s.Vc(12),s.sc(13,"translate"),s.gc(),s.hc(14,"th"),s.Vc(15),s.sc(16,"translate"),s.gc(),s.hc(17,"th"),s.Vc(18),s.sc(19,"translate"),s.gc(),s.hc(20,"th"),s.Vc(21),s.sc(22,"translate"),s.gc(),s.hc(23,"th"),s.Vc(24),s.sc(25,"translate"),s.gc(),s.cc(26,"th"),s.gc(),s.gc(),s.Tc(27,Cn,17,13,"tr",5),s.gc(),s.gc()),2&t&&(s.Qb(2),s.yc("disabled",!e.formValueChanged||0===e.getVariantsToAdd().length),s.Qb(1),s.Xc(" ",s.uc(4,10,"common.add-new-variants",s.Cc(23,On,e.getVariantsToAdd().length))," "),s.Qb(2),s.yc("ngForOf",e.optionGroups),s.Qb(1),s.yc("ngIf",1===(null==e.product?null:e.product.variants.length)&&0===(null==e.product?null:e.product.optionGroups.length)),s.Qb(6),s.Wc(s.tc(13,13,"common.create")),s.Qb(3),s.Wc(s.tc(16,15,"catalog.variant")),s.Qb(3),s.Wc(s.tc(19,17,"catalog.sku")),s.Qb(3),s.Wc(s.tc(22,19,"catalog.price")),s.Qb(3),s.Wc(s.tc(25,21,"catalog.stock-on-hand")),s.Qb(3),s.yc("ngForOf",e.generatedVariants))},directives:[l.a,l.c,h.n,h.o,vt.u,B.a,r.b,vt.s,r.p,r.s,sn,vt.o,r.a,vt.i,vt.t,r.z,ln.a,r.v,$t.a,At.a,_t.a,Lt.a],pipes:[m.d,We.a],styles:[".option-groups[_ngcontent-%COMP%]{display:flex}.option-groups[_ngcontent-%COMP%]:first-of-type{margin-top:24px}.values[_ngcontent-%COMP%]{flex:1;margin:0 6px}.variants-preview[_ngcontent-%COMP%]   tr.disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);color:var(--color-grey-400)}"]});class In extends a.m{constructor(t,e){super(t,{__typename:"Asset",id:"",createdAt:"",updatedAt:"",name:"",type:a.i.IMAGE,fileSize:0,mimeType:"",width:0,height:0,source:"",preview:"",focalPoint:null},t=>e.product.getAsset(t).mapStream(t=>t.asset))}}In.\u0275fac=function(t){return new(t||In)(s.lc(n.e),s.lc(a.s))},In.\u0275prov=s.Xb({token:In,factory:In.\u0275fac,providedIn:"root"});class Vn extends a.m{constructor(t,e){super(t,{__typename:"Collection",id:"",createdAt:"",updatedAt:"",languageCode:Object(a.X)(),name:"",slug:"",isPrivate:!1,description:"",featuredAsset:null,assets:[],translations:[],filters:[],parent:{},children:null},t=>e.collection.getCollection(t).mapStream(t=>t.collection))}}Vn.\u0275fac=function(t){return new(t||Vn)(s.lc(n.e),s.lc(a.s))},Vn.\u0275prov=s.Xb({token:Vn,factory:Vn.\u0275fac,providedIn:"root"});class kn extends a.m{constructor(t,e){super(t,{__typename:"Facet",id:"",createdAt:"",updatedAt:"",isPrivate:!1,languageCode:Object(a.X)(),name:"",code:"",translations:[],values:[]},t=>e.facet.getFacet(t).mapStream(t=>t.facet))}}kn.\u0275fac=function(t){return new(t||kn)(s.lc(n.e),s.lc(a.s))},kn.\u0275prov=s.Xb({token:kn,factory:kn.\u0275fac,providedIn:"root"});class xn extends a.m{constructor(t,e){super(e,{__typename:"Product",id:"",createdAt:"",updatedAt:"",enabled:!0,languageCode:Object(a.X)(),name:"",slug:"",featuredAsset:null,assets:[],description:"",translations:[],optionGroups:[],facetValues:[],variants:[],channels:[]},e=>t.product.getProduct(e).refetchOnChannelChange().mapStream(t=>t.product))}}xn.\u0275fac=function(t){return new(t||xn)(s.lc(a.s),s.lc(n.e))},xn.\u0275prov=s.Xb({token:xn,factory:xn.\u0275fac,providedIn:"root"});class Tn extends a.m{constructor(t,e){super(t,{__typename:"Product",id:"",createdAt:"",updatedAt:"",name:"",optionGroups:[],variants:[]},t=>e.product.getProductVariantsOptions(t).mapStream(t=>t.product))}}Tn.\u0275fac=function(t){return new(t||Tn)(s.lc(n.e),s.lc(a.s))},Tn.\u0275prov=s.Xb({token:Tn,factory:Tn.\u0275fac,providedIn:"root"});const Qn=[{path:"products",component:tn,data:{breadcrumb:Object(i.a)("breadcrumb.products")}},{path:"products/:id",component:jc,resolve:Object(a.O)(xn),canDeactivate:[a.o],data:{breadcrumb:jn}},{path:"products/:id/manage-variants",component:Fn,resolve:Object(a.O)(Tn),canDeactivate:[a.o],data:{breadcrumb:Mn}},{path:"facets",component:Ce,data:{breadcrumb:Object(i.a)("breadcrumb.facets")}},{path:"facets/:id",component:ae,resolve:Object(a.O)(kn),canDeactivate:[a.o],data:{breadcrumb:wn}},{path:"collections",component:xt,data:{breadcrumb:Object(i.a)("breadcrumb.collections")}},{path:"collections/:id",component:ft,resolve:Object(a.O)(Vn),canDeactivate:[a.o],data:{breadcrumb:Sn}},{path:"assets",component:$,data:{breadcrumb:Object(i.a)("breadcrumb.assets")}},{path:"assets/:id",component:v,resolve:Object(a.O)(In),data:{breadcrumb:Dn}}];function jn(t,e){return Object(a.Q)({entity:t.entity,id:e.id,breadcrumbKey:"breadcrumb.products",getName:t=>t.name,route:"products"})}function Mn(t,e){return t.entity.pipe(Object(o.a)(t=>[{label:Object(i.a)("breadcrumb.products"),link:["../","products"]},{label:`${t.name}`,link:["../","products",e.id,{tab:"variants"}]},{label:Object(i.a)("breadcrumb.manage-variants"),link:["manage-variants"]}]))}function wn(t,e){return Object(a.Q)({entity:t.entity,id:e.id,breadcrumbKey:"breadcrumb.facets",getName:t=>t.name,route:"facets"})}function Sn(t,e){return Object(a.Q)({entity:t.entity,id:e.id,breadcrumbKey:"breadcrumb.collections",getName:t=>t.name,route:"collections"})}function Dn(t,e){return Object(a.Q)({entity:t.entity,id:e.id,breadcrumbKey:"breadcrumb.assets",getName:t=>t.name,route:"assets"})}var $n=c("5+WD");function An(t,e){1&t&&s.cc(0,"clr-icon",31)}function _n(t,e){1&t&&s.cc(0,"clr-icon",32)}function Ln(t,e){if(1&t){const t=s.ic();s.hc(0,"button",28),s.pc("click",function(){s.Lc(t);const e=s.rc().$implicit;return e.expanded=!e.expanded}),s.Tc(1,An,1,0,"clr-icon",29),s.Tc(2,_n,1,0,"clr-icon",30),s.gc()}if(2&t){const t=s.rc().$implicit,e=s.rc();s.yc("disabled",e.expandAll),s.Qb(1),s.yc("ngIf",!t.expanded&&!e.expandAll),s.Qb(1),s.yc("ngIf",t.expanded||e.expandAll)}}function Nn(t,e){1&t&&s.cc(0,"div",33)}function Gn(t,e){1&t&&(s.hc(0,"vdr-chip"),s.Vc(1),s.sc(2,"translate"),s.gc()),2&t&&(s.Qb(1),s.Wc(s.tc(2,1,"catalog.private")))}function En(t,e){1&t&&(s.hc(0,"div",34),s.cc(1,"clr-icon",35),s.gc())}const Wn=function(t){return{parentId:t}},Un=function(t){return["./","create",t]};function Bn(t,e){if(1&t&&(s.hc(0,"a",36),s.cc(1,"clr-icon",37),s.Vc(2),s.sc(3,"translate"),s.gc()),2&t){const t=s.rc().$implicit;s.yc("routerLink",s.Cc(6,Un,s.Cc(4,Wn,t.id))),s.Qb(2),s.Xc(" ",s.tc(3,2,"catalog.create-new-collection")," ")}}function Xn(t,e){if(1&t){const t=s.ic();s.hc(0,"button",20),s.pc("click",function(){s.Lc(t);const c=e.$implicit,n=s.rc().$implicit;return s.rc().move(n,c.id)}),s.sc(1,"async"),s.cc(2,"clr-icon",38),s.Vc(3),s.gc()}if(2&t){const t=e.$implicit,c=s.rc(2);s.yc("disabled",!s.tc(1,2,c.hasUpdatePermission$)),s.Qb(3),s.Xc(" ",t.path," ")}}function Rn(t,e){if(1&t&&s.cc(0,"vdr-collection-tree-node",39),2&t){const t=s.rc().$implicit,e=s.rc();s.yc("expandAll",e.expandAll)("collectionTree",t)("activeCollectionId",e.activeCollectionId)}}const Hn=function(t){return{contents:t}},zn=function(t){return["./",t]},qn=function(t){return["/catalog/collections/",t]},Kn=function(){return["UpdateCatalog","UpdateCollection"]},Zn=function(){return["CreateCatalog","CreateCollection"]};function Yn(t,e){if(1&t){const t=s.ic();s.hc(0,"div",3),s.hc(1,"div",4),s.hc(2,"div",5),s.Tc(3,Ln,3,3,"button",6),s.Tc(4,Nn,1,0,"ng-template",null,7,s.Uc),s.Vc(6),s.gc(),s.cc(7,"div",8),s.Tc(8,Gn,3,3,"vdr-chip",9),s.hc(9,"a",10),s.cc(10,"clr-icon",11),s.Vc(11),s.sc(12,"translate"),s.gc(),s.hc(13,"a",12),s.cc(14,"clr-icon",13),s.Vc(15),s.sc(16,"translate"),s.gc(),s.Tc(17,En,2,0,"div",14),s.hc(18,"vdr-dropdown"),s.hc(19,"button",15),s.cc(20,"clr-icon",16),s.gc(),s.hc(21,"vdr-dropdown-menu",17),s.Tc(22,Bn,4,8,"a",18),s.cc(23,"div",19),s.hc(24,"button",20),s.pc("click",function(){s.Lc(t);const c=e.$implicit,n=e.index;return s.rc().moveUp(c,n)}),s.sc(25,"async"),s.cc(26,"clr-icon",21),s.Vc(27),s.sc(28,"translate"),s.gc(),s.hc(29,"button",20),s.pc("click",function(){s.Lc(t);const c=e.$implicit,n=e.index;return s.rc().moveDown(c,n)}),s.sc(30,"async"),s.cc(31,"clr-icon",22),s.Vc(32),s.sc(33,"translate"),s.gc(),s.hc(34,"h4",23),s.Vc(35),s.sc(36,"translate"),s.gc(),s.Tc(37,Xn,4,4,"button",24),s.cc(38,"div",19),s.hc(39,"button",25),s.pc("click",function(){s.Lc(t);const c=e.$implicit;return s.rc().delete(c.id)}),s.sc(40,"async"),s.cc(41,"clr-icon",26),s.Vc(42),s.sc(43,"translate"),s.gc(),s.gc(),s.gc(),s.gc(),s.Tc(44,Rn,1,3,"vdr-collection-tree-node",27),s.gc()}if(2&t){const t=e.$implicit,c=e.index,n=s.Ic(5),a=s.rc();s.Tb("private",t.isPrivate),s.yc("cdkDragData",t),s.Qb(1),s.Tb("active",t.id===a.activeCollectionId),s.yc("ngClass","depth-"+a.depth),s.Qb(2),s.yc("ngIf",null==t.children?null:t.children.length)("ngIfElse",n),s.Qb(3),s.Xc(" ",t.name," "),s.Qb(2),s.yc("ngIf",t.isPrivate),s.Qb(1),s.yc("routerLink",s.Cc(45,zn,s.Cc(43,Hn,t.id))),s.Qb(2),s.Xc(" ",s.tc(12,25,"catalog.view-contents")," "),s.Qb(2),s.yc("routerLink",s.Cc(47,qn,t.id)),s.Qb(2),s.Xc(" ",s.tc(16,27,"common.edit")," "),s.Qb(2),s.yc("vdrIfPermissions",s.Bc(49,Kn)),s.Qb(5),s.yc("vdrIfPermissions",s.Bc(50,Zn)),s.Qb(2),s.yc("disabled",0===c||!s.tc(25,29,a.hasUpdatePermission$)),s.Qb(3),s.Xc(" ",s.tc(28,31,"catalog.move-up")," "),s.Qb(2),s.yc("disabled",c===a.collectionTree.children.length-1||!s.tc(30,33,a.hasUpdatePermission$)),s.Qb(3),s.Xc(" ",s.tc(33,35,"catalog.move-down")," "),s.Qb(3),s.Wc(s.tc(36,37,"catalog.move-to")),s.Qb(2),s.yc("ngForOf",a.getMoveListItems(t)),s.Qb(2),s.yc("disabled",!s.tc(40,39,a.hasDeletePermission$)),s.Qb(3),s.Xc(" ",s.tc(43,41,"common.delete")," "),s.Qb(2),s.yc("ngIf",t.expanded||a.expandAll)}}class Jn{constructor(t,e,c){this.parent=t,this.root=e,this.dataService=c,this.depth=0,this.expandAll=!1,t&&(this.depth=t.depth+1)}ngOnInit(){this.parentName=this.collectionTree.name||"<root>";const t=this.dataService.client.userStatus().mapStream(t=>t.userStatus.permissions).pipe(Object(bt.a)(1));this.hasUpdatePermission$=t.pipe(Object(o.a)(t=>t.includes(a.H.UpdateCatalog)||t.includes(a.H.UpdateCollection))),this.hasDeletePermission$=t.pipe(Object(o.a)(t=>t.includes(a.H.DeleteCatalog)||t.includes(a.H.DeleteCollection)))}ngOnChanges(t){const e=t.expandAll;e&&!0===e.previousValue&&!1===e.currentValue&&this.collectionTree.children.forEach(t=>t.expanded=!1)}trackByFn(t,e){return e.id}getMoveListItems(t){const e=(c,n,a)=>{if(c.id!==t.id){const i=n.concat(c.name),o=t.parent&&t.parent.id;c.id!==o&&a.push({path:i.slice(1).join(" / ")||"root",id:c.id}),c.children.forEach(t=>e(t,i,a))}return a};return e(this.root.collectionTree,[],[])}move(t,e){this.root.onMove({index:0,parentId:e,collectionId:t.id})}moveUp(t,e){t.parent&&this.root.onMove({index:e-1,parentId:t.parent.id,collectionId:t.id})}moveDown(t,e){t.parent&&this.root.onMove({index:e+1,parentId:t.parent.id,collectionId:t.id})}drop(t){Object($n.f)(this.collectionTree.children,t.previousIndex,t.currentIndex),this.root.onDrop(t)}delete(t){this.root.onDelete(t)}}function ta(t,e){if(1&t){const t=s.ic();s.hc(0,"div",7),s.hc(1,"div",8),s.hc(2,"label"),s.Vc(3),s.sc(4,"translate"),s.gc(),s.hc(5,"input",9),s.pc("ngModelChange",function(t){return e.$implicit.name=t})("keydown.enter",function(e){s.Lc(t);const c=s.Ic(11);return s.rc().handleEnter(e,c)}),s.gc(),s.gc(),s.hc(6,"div",10),s.hc(7,"label"),s.Vc(8),s.sc(9,"translate"),s.gc(),s.hc(10,"vdr-option-value-input",11,12),s.pc("ngModelChange",function(t){return e.$implicit.values=t})("ngModelChange",function(){s.Lc(t);return s.rc().generateVariants()}),s.gc(),s.gc(),s.hc(12,"div",13),s.hc(13,"button",14),s.pc("click",function(){s.Lc(t);const c=e.$implicit;return s.rc().removeOption(c.name)}),s.sc(14,"translate"),s.cc(15,"clr-icon",15),s.gc(),s.gc(),s.gc()}if(2&t){const t=e.$implicit;s.Qb(3),s.Wc(s.tc(4,7,"catalog.option")),s.Qb(2),s.yc("ngModel",t.name),s.Qb(3),s.Wc(s.tc(9,9,"catalog.option-values")),s.Qb(2),s.yc("ngModel",t.values)("groupName",t.name)("disabled",""===t.name),s.Qb(3),s.yc("title",s.tc(14,11,"catalog.remove-option"))}}function ea(t,e){1&t&&(s.hc(0,"th"),s.Vc(1),s.sc(2,"translate"),s.gc()),2&t&&(s.Qb(1),s.Wc(s.tc(2,1,"common.create")))}function ca(t,e){1&t&&(s.hc(0,"th"),s.Vc(1),s.sc(2,"translate"),s.gc()),2&t&&(s.Qb(1),s.Wc(s.tc(2,1,"catalog.variant")))}function na(t,e){if(1&t){const t=s.ic();s.hc(0,"td"),s.hc(1,"input",19),s.pc("change",function(){s.Lc(t);return s.rc(2).onFormChange()})("ngModelChange",function(e){s.Lc(t);const c=s.rc().$implicit;return s.rc().variantFormValues[c.id].enabled=e}),s.gc(),s.gc()}if(2&t){const t=s.rc().$implicit,e=s.rc();s.Qb(1),s.yc("ngModel",e.variantFormValues[t.id].enabled)}}function aa(t,e){if(1&t&&(s.hc(0,"td"),s.Vc(1),s.gc()),2&t){const t=s.rc().$implicit;s.Qb(1),s.Xc(" ",t.values.join(" ")," ")}}function ia(t,e){if(1&t){const t=s.ic();s.hc(0,"tr"),s.Tc(1,na,2,1,"td",5),s.Tc(2,aa,2,1,"td",5),s.hc(3,"td"),s.hc(4,"clr-input-container"),s.hc(5,"input",16),s.pc("change",function(){s.Lc(t);return s.rc().onFormChange()})("ngModelChange",function(c){s.Lc(t);const n=e.$implicit;return s.rc().variantFormValues[n.id].sku=c}),s.sc(6,"translate"),s.gc(),s.gc(),s.gc(),s.hc(7,"td"),s.hc(8,"clr-input-container"),s.hc(9,"vdr-currency-input",17),s.pc("ngModelChange",function(c){s.Lc(t);const n=e.$implicit;return s.rc().variantFormValues[n.id].price=c})("ngModelChange",function(){s.Lc(t);return s.rc().onFormChange()}),s.gc(),s.gc(),s.gc(),s.hc(10,"td"),s.hc(11,"clr-input-container"),s.hc(12,"input",18),s.pc("ngModelChange",function(c){s.Lc(t);const n=e.$implicit;return s.rc().variantFormValues[n.id].stock=c})("change",function(){s.Lc(t);return s.rc().onFormChange()}),s.gc(),s.gc(),s.gc(),s.gc()}if(2&t){const t=e.$implicit,c=s.rc();s.Tb("disabled",!c.variantFormValues[t.id].enabled),s.Qb(1),s.yc("ngIf",1<c.variants.length),s.Qb(1),s.yc("ngIf",1<c.variants.length),s.Qb(3),s.yc("ngModel",c.variantFormValues[t.id].sku)("placeholder",s.tc(6,9,"catalog.sku")),s.Qb(4),s.yc("ngModel",c.variantFormValues[t.id].price)("currencyCode",c.currencyCode),s.Qb(3),s.yc("ngModel",c.variantFormValues[t.id].stock)}}Jn.\u0275fac=function(t){return new(t||Jn)(s.bc(Jn,12),s.bc(Ot),s.bc(a.s))},Jn.\u0275cmp=s.Vb({type:Jn,selectors:[["vdr-collection-tree-node"]],inputs:{collectionTree:"collectionTree",activeCollectionId:"activeCollectionId",expandAll:"expandAll"},features:[s.Ob],decls:4,vars:6,consts:[["cdkDropList","",1,"tree-node",3,"cdkDropListData","cdkDropListDisabled","cdkDropListDropped"],["dropList",""],["class","collection","cdkDrag","",3,"private","cdkDragData",4,"ngFor","ngForOf","ngForTrackBy"],["cdkDrag","",1,"collection",3,"cdkDragData"],[1,"collection-detail",3,"ngClass"],[1,"name"],["class","icon-button folder-button",3,"disabled","click",4,"ngIf","ngIfElse"],["folderSpacer",""],[1,"flex-spacer"],[4,"ngIf"],["queryParamsHandling","preserve",1,"btn","btn-link","btn-sm",3,"routerLink"],["shape","view-list"],[1,"btn","btn-link","btn-sm",3,"routerLink"],["shape","edit"],["class","drag-handle","cdkDragHandle","",4,"vdrIfPermissions"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["class","dropdown-item",3,"routerLink",4,"vdrIfPermissions"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",3,"disabled","click"],["shape","caret up"],["shape","caret down"],[1,"dropdown-header"],["type","button","vdrDropdownItem","",3,"disabled","click",4,"ngFor","ngForOf"],["vdrDropdownItem","",1,"button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"expandAll","collectionTree","activeCollectionId",4,"ngIf"],[1,"icon-button","folder-button",3,"disabled","click"],["shape","folder",4,"ngIf"],["shape","folder-open",4,"ngIf"],["shape","folder"],["shape","folder-open"],[1,"folder-button-spacer"],["cdkDragHandle","",1,"drag-handle"],["shape","drag-handle","size","24"],[1,"dropdown-item",3,"routerLink"],["shape","plus"],["shape","child-arrow"],[3,"expandAll","collectionTree","activeCollectionId"]],template:function(t,e){1&t&&(s.hc(0,"div",0,1),s.pc("cdkDropListDropped",function(t){return e.drop(t)}),s.sc(2,"async"),s.Tc(3,Yn,45,51,"div",2),s.gc()),2&t&&(s.yc("cdkDropListData",e.collectionTree)("cdkDropListDisabled",!s.tc(2,4,e.hasUpdatePermission$)),s.Qb(3),s.yc("ngForOf",e.collectionTree.children)("ngForTrackBy",e.trackByFn))},directives:[$n.c,h.n,vt.l,$n.a,h.m,h.o,n.h,vt.o,p.a,$t.a,At.a,_t.a,Lt.a,oe.a,$n.b,Jn],pipes:[h.b,m.d],styles:["[_nghost-%COMP%]{display:block}.collection[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);font-size:.65rem;transition:transform .25s cubic-bezier(0,0,.2,1);margin-bottom:2px;border-left:2px solid transparent;transition:border-left-color .2s}.collection.private[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}.collection[_ngcontent-%COMP%]   .collection-detail[_ngcontent-%COMP%]{padding:6px 12px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--color-component-border-100)}.collection[_ngcontent-%COMP%]   .collection-detail.active[_ngcontent-%COMP%]{background-color:var(--clr-global-selection-color)}.collection[_ngcontent-%COMP%]   .collection-detail.depth-1[_ngcontent-%COMP%]{padding-left:36px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-2[_ngcontent-%COMP%]{padding-left:60px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-3[_ngcontent-%COMP%]{padding-left:84px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-4[_ngcontent-%COMP%]{padding-left:108px}.collection[_ngcontent-%COMP%]   .collection-detail[_ngcontent-%COMP%]   .folder-button-spacer[_ngcontent-%COMP%]{display:inline-block;width:28px}.tree-node[_ngcontent-%COMP%]{display:block;background:var(--color-component-bg-100);overflow:hidden}.tree-node.cdk-drop-list-dragging[_ngcontent-%COMP%] > .collection[_ngcontent-%COMP%]{border-left-color:var(--color-primary-300)}.drag-placeholder[_ngcontent-%COMP%]{min-height:120px;background-color:var(--color-component-bg-300);transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%], .example-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .tree-node[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"],changeDetection:0});class oa{constructor(t){this.dataService=t,this.variantsChange=new s.t,this.optionGroups=[],this.variantFormValues={}}ngOnInit(){this.dataService.settings.getActiveChannel().single$.subscribe(t=>{this.currencyCode=t.activeChannel.currencyCode}),this.generateVariants()}addOption(){this.optionGroups.push({name:"",values:[]})}removeOption(t){this.optionGroups=this.optionGroups.filter(e=>e.name!==t),this.generateVariants()}generateVariants(){const t=this.optionGroups.reduce((t,e)=>t+e.values.length,0)?this.optionGroups.map(t=>t.values.map(t=>t.name)):[["__DEFAULT_VARIANT__"]];this.variants=Object(Tt.generateAllCombinations)(t).map(t=>({id:t.join("|"),values:t})),this.variants.forEach(t=>{this.variantFormValues[t.id]||(this.variantFormValues[t.id]={optionValues:t.values,enabled:!0,price:this.copyFromDefault(t.id,"price",0),sku:this.copyFromDefault(t.id,"sku",""),stock:this.copyFromDefault(t.id,"stock",0)})}),this.onFormChange()}trackByFn(t,e){return e.values.join("|")}handleEnter(t,e){t.preventDefault(),t.stopPropagation(),e.focus()}onFormChange(){const t=this.variants.map(t=>this.variantFormValues[t.id]).filter(t=>t.enabled);this.variantsChange.emit({groups:this.optionGroups.map(t=>({name:t.name,values:t.values.map(t=>t.name)})),variants:t})}copyFromDefault(t,e,c){return"__DEFAULT_VARIANT__"!==t?this.variantFormValues.__DEFAULT_VARIANT__[e]:c}}oa.\u0275fac=function(t){return new(t||oa)(s.bc(a.s))},oa.\u0275cmp=s.Vb({type:oa,selectors:[["vdr-generate-product-variants"]],outputs:{variantsChange:"variantsChange"},decls:21,vars:17,consts:[["class","option-groups",4,"ngFor","ngForOf"],[1,"btn","btn-primary-outline","btn-sm",3,"click"],["shape","plus"],[1,"variants-preview"],[1,"table"],[4,"ngIf"],[3,"disabled",4,"ngFor","ngForOf","ngForTrackBy"],[1,"option-groups"],[1,"name"],["placeholder","e.g. Size","clrInput","","name","name","required","",3,"ngModel","ngModelChange","keydown.enter"],[1,"values"],[3,"ngModel","groupName","disabled","ngModelChange"],["optionValueInputComponent",""],[1,"remove-group"],[1,"btn","btn-icon","btn-warning-outline",3,"title","click"],["shape","trash"],["clrInput","","type","text",3,"ngModel","placeholder","change","ngModelChange"],["clrInput","",3,"ngModel","currencyCode","ngModelChange"],["clrInput","","type","number","min","0","step","1",3,"ngModel","ngModelChange","change"],["type","checkbox","clrCheckbox","",3,"ngModel","change","ngModelChange"]],template:function(t,e){1&t&&(s.Tc(0,ta,16,13,"div",0),s.hc(1,"button",1),s.pc("click",function(){return e.addOption()}),s.cc(2,"clr-icon",2),s.Vc(3),s.sc(4,"translate"),s.gc(),s.hc(5,"div",3),s.hc(6,"table",4),s.hc(7,"thead"),s.hc(8,"tr"),s.Tc(9,ea,3,3,"th",5),s.Tc(10,ca,3,3,"th",5),s.hc(11,"th"),s.Vc(12),s.sc(13,"translate"),s.gc(),s.hc(14,"th"),s.Vc(15),s.sc(16,"translate"),s.gc(),s.hc(17,"th"),s.Vc(18),s.sc(19,"translate"),s.gc(),s.gc(),s.gc(),s.Tc(20,ia,13,11,"tr",6),s.gc(),s.gc()),2&t&&(s.yc("ngForOf",e.optionGroups),s.Qb(3),s.Xc(" ",s.tc(4,9,"catalog.add-option"),"\n"),s.Qb(6),s.yc("ngIf",1<e.variants.length),s.Qb(1),s.yc("ngIf",1<e.variants.length),s.Qb(2),s.Wc(s.tc(13,11,"catalog.sku")),s.Qb(3),s.Wc(s.tc(16,13,"catalog.price")),s.Qb(3),s.Wc(s.tc(19,15,"catalog.stock-on-hand")),s.Qb(2),s.yc("ngForOf",e.variants)("ngForTrackBy",e.trackByFn))},directives:[h.n,vt.o,h.o,vt.l,vt.u,B.a,r.b,vt.s,r.z,r.p,r.s,sn,vt.t,ln.a,r.v,r.a,vt.i],pipes:[m.d],styles:["[_nghost-%COMP%]{display:block;margin-bottom:120px}.option-groups[_ngcontent-%COMP%]{display:flex}.values[_ngcontent-%COMP%]{flex:1;margin:0 6px}.remove-group[_ngcontent-%COMP%]{padding-top:18px}.variants-preview[_ngcontent-%COMP%]   tr.disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);color:var(--color-grey-400)}"]});var ra=c("vxfF");const sa=["dlg"],la=["dl"];function da(t,e){if(1&t){const t=s.ic();s.hc(0,"img",11),s.pc("click",function(){s.Lc(t);const e=s.rc(2);return e.previewAsset(e.featuredAsset)}),s.sc(1,"assetPreview"),s.gc()}if(2&t){const t=s.rc(2);s.yc("src",s.uc(1,1,t.featuredAsset,"small"),s.Nc)}}function ua(t,e){if(1&t){const t=s.ic();s.hc(0,"div",12),s.pc("click",function(){s.Lc(t);return s.rc(2).selectAssets()}),s.cc(1,"clr-icon",13),s.hc(2,"div"),s.Vc(3),s.sc(4,"translate"),s.gc(),s.gc()}2&t&&(s.Qb(3),s.Wc(s.tc(4,1,"catalog.no-featured-asset")))}function pa(t,e){1&t&&s.dc(0)}function ga(t,e){if(1&t){const t=s.ic();s.hc(0,"div",14),s.hc(1,"button",15),s.pc("click",function(){s.Lc(t);return s.rc(2).selectAssets()}),s.cc(2,"clr-icon",16),s.Vc(3),s.sc(4,"translate"),s.gc(),s.gc()}2&t&&(s.Qb(3),s.Xc(" ",s.tc(4,1,"asset.add-asset")," "))}function ha(t,e){if(1&t&&(s.hc(0,"div",3),s.hc(1,"div",4),s.hc(2,"div",5),s.Tc(3,da,2,4,"img",6),s.Tc(4,ua,5,3,"div",7),s.gc(),s.gc(),s.hc(5,"div",8),s.Tc(6,pa,1,0,"ng-container",9),s.gc(),s.Tc(7,ga,5,3,"div",10),s.gc()),2&t){const t=s.rc(),e=s.Ic(4);s.Qb(3),s.yc("ngIf",t.featuredAsset),s.Qb(1),s.yc("ngIf",!t.featuredAsset),s.Qb(2),s.yc("ngTemplateOutlet",e),s.Qb(1),s.yc("vdrIfPermissions",t.updatePermissions)}}function ma(t,e){if(1&t){const t=s.ic();s.hc(0,"img",11),s.pc("click",function(){s.Lc(t);const e=s.rc(2);return e.previewAsset(e.featuredAsset)}),s.sc(1,"assetPreview"),s.gc()}if(2&t){const t=s.rc(2);s.yc("src",s.uc(1,1,t.featuredAsset,"thumb"),s.Nc)}}function fa(t,e){if(1&t){const t=s.ic();s.hc(0,"div",12),s.pc("click",function(){s.Lc(t);return s.rc(2).selectAssets()}),s.cc(1,"clr-icon",19),s.gc()}}function ba(t,e){1&t&&s.dc(0)}function va(t,e){if(1&t){const t=s.ic();s.hc(0,"button",20),s.pc("click",function(){s.Lc(t);return s.rc(2).selectAssets()}),s.sc(1,"translate"),s.cc(2,"clr-icon",16),s.Vc(3),s.sc(4,"translate"),s.gc()}2&t&&(s.yc("title",s.tc(1,2,"asset.add-asset")),s.Qb(3),s.Xc(" ",s.tc(4,4,"asset.add-asset")," "))}function ya(t,e){if(1&t&&(s.hc(0,"div",17),s.Tc(1,ma,2,4,"img",6),s.Tc(2,fa,2,0,"div",7),s.gc(),s.Tc(3,ba,1,0,"ng-container",9),s.Tc(4,va,5,6,"button",18)),2&t){const t=s.rc(),e=s.Ic(4);s.Qb(1),s.yc("ngIf",t.featuredAsset),s.Qb(1),s.yc("ngIf",!t.featuredAsset),s.Qb(1),s.yc("ngTemplateOutlet",e),s.Qb(1),s.yc("vdrIfPermissions",t.updatePermissions)}}function Ca(t,e){if(1&t){const t=s.ic();s.hc(0,"div",23),s.pc("cdkDropListDropped",function(){s.Lc(t);return s.rc(2).dropListDropped()}),s.sc(1,"hasPermission"),s.hc(2,"vdr-dropdown",26),s.pc("cdkDragMoved",function(e){s.Lc(t);return s.rc(2).dragMoved(e)}),s.hc(3,"div",27),s.cc(4,"img",28),s.sc(5,"assetPreview"),s.gc(),s.hc(6,"vdr-dropdown-menu",29),s.hc(7,"button",30),s.pc("click",function(){s.Lc(t);const c=e.$implicit;return s.rc(2).previewAsset(c)}),s.Vc(8),s.sc(9,"translate"),s.gc(),s.hc(10,"button",31),s.pc("click",function(){s.Lc(t);const c=e.$implicit;return s.rc(2).setAsFeatured(c)}),s.sc(11,"hasPermission"),s.Vc(12),s.sc(13,"translate"),s.gc(),s.cc(14,"div",32),s.hc(15,"button",33),s.pc("click",function(){s.Lc(t);const c=e.$implicit;return s.rc(2).removeAsset(c)}),s.sc(16,"hasPermission"),s.Vc(17),s.sc(18,"translate"),s.gc(),s.gc(),s.gc(),s.gc()}if(2&t){const t=e.$implicit,c=s.rc(2);s.yc("cdkDropListDisabled",!s.tc(1,10,c.updatePermissions))("cdkDropListEnterPredicate",c.dropListEnterPredicate),s.Qb(3),s.Tb("featured",c.isFeatured(t)),s.Qb(1),s.yc("src",s.uc(5,12,t,"tiny"),s.Nc),s.Qb(4),s.Xc(" ",s.tc(9,15,"asset.preview")," "),s.Qb(2),s.yc("disabled",c.isFeatured(t)||!s.tc(11,17,c.updatePermissions)),s.Qb(2),s.Xc(" ",s.tc(13,19,"asset.set-as-featured-asset")," "),s.Qb(3),s.yc("disabled",!s.tc(16,21,c.updatePermissions)),s.Qb(2),s.Xc(" ",s.tc(18,23,"asset.remove-asset")," ")}}function Oa(t,e){if(1&t){const t=s.ic();s.hc(0,"div",21,22),s.hc(2,"div",23,24),s.pc("cdkDropListDropped",function(){s.Lc(t);return s.rc().dropListDropped()}),s.sc(4,"hasPermission"),s.gc(),s.Tc(5,Ca,19,25,"div",25),s.gc()}if(2&t){const t=s.rc();s.Tb("compact",t.compact),s.Qb(2),s.yc("cdkDropListDisabled",!s.tc(4,5,t.updatePermissions))("cdkDropListEnterPredicate",t.dropListEnterPredicate),s.Qb(3),s.yc("ngForOf",t.assets)}}class Pa{constructor(t,e,c,n){this.modalService=t,this.changeDetector=e,this.viewportRuler=c,this.collectionDetailComponent=n,this.compact=!1,this.change=new s.t,this.assets=[],this.updateCollectionPermissions=[a.H.UpdateCatalog,a.H.UpdateCollection],this.updateProductPermissions=[a.H.UpdateCatalog,a.H.UpdateProduct],this.dropListEnterPredicate=(t,e)=>{if(e===this.placeholder)return!0;if(e!==this.activeContainer)return!1;const c=this.placeholder.element.nativeElement,n=t.dropContainer.element.nativeElement,a=e.element.nativeElement,i=a.parentElement&&a.parentElement.children,o=Fa(i,this.source?c:n),r=Fa(i,a);return this.source||(this.sourceIndex=o,this.source=t.dropContainer,c.style.width=n.clientWidth+"px",c.style.height=n.clientHeight+"px",n.parentElement&&n.parentElement.removeChild(n)),this.targetIndex=r,this.target=e,c.style.display="",a.parentElement&&a.parentElement.insertBefore(c,r>o?a.nextSibling:a),this.placeholder._dropListRef.enter(t._dragRef,t.element.nativeElement.offsetLeft,t.element.nativeElement.offsetTop),!1}}set assetsSetter(t){this.assets=t.slice()}get updatePermissions(){return this.collectionDetailComponent?this.updateCollectionPermissions:this.updateProductPermissions}ngAfterViewInit(){const t=this.placeholder.element.nativeElement;t.style.display="none",t.parentElement&&t.parentElement.removeChild(t)}selectAssets(){this.modalService.fromComponent(a.g,{size:"xl"}).subscribe(t=>{t&&t.length&&(this.assets=Object(Pe.unique)(this.assets.concat(t),"id"),this.featuredAsset||(this.featuredAsset=t[0]),this.emitChangeEvent(this.assets,this.featuredAsset),this.changeDetector.markForCheck())})}setAsFeatured(t){this.featuredAsset=t,this.emitChangeEvent(this.assets,t)}isFeatured(t){return!!this.featuredAsset&&this.featuredAsset.id===t.id}previewAsset(t){this.modalService.fromComponent(a.h,{size:"xl",closable:!0,locals:{asset:t}}).subscribe()}removeAsset(t){this.assets=this.assets.filter(e=>e.id!==t.id),this.featuredAsset&&this.featuredAsset.id===t.id&&(this.featuredAsset=this.assets.length>0?this.assets[0]:void 0),this.emitChangeEvent(this.assets,this.featuredAsset)}emitChangeEvent(t,e){this.change.emit({assets:t,featuredAsset:e})}dragMoved(t){const e=this.getPointerPositionOnPage(t.event);this.listGroup._items.forEach(t=>{(function(t,e,c){const{top:n,bottom:a,left:i,right:o}=t.element.nativeElement.getBoundingClientRect();return c>=n&&c<=a&&e>=i&&e<=o})(t,e.x,e.y)&&(this.activeContainer=t)})}dropListDropped(){if(!this.target||!this.source)return;const t=this.placeholder.element.nativeElement,e=t.parentElement;t.style.display="none",e.removeChild(t),e.appendChild(t),e.insertBefore(this.source.element.nativeElement,e.children[this.sourceIndex]),this.target=null,this.source=null,this.sourceIndex!==this.targetIndex&&(Object($n.f)(this.assets,this.sourceIndex,this.targetIndex),this.emitChangeEvent(this.assets,this.featuredAsset))}getPointerPositionOnPage(t){const e=function(t){return t.type.startsWith("touch")}(t)?t.touches[0]||t.changedTouches[0]:t,c=this.viewportRuler.getViewportScrollPosition();return{x:e.pageX-c.left,y:e.pageY-c.top}}}function Fa(t,e){return t?Array.prototype.indexOf.call(t,e):-1}function Ia(t,e){1&t&&(s.Vc(0),s.sc(1,"translate")),2&t&&s.Wc(s.tc(1,1,"catalog.update-product-option"))}Pa.\u0275fac=function(t){return new(t||Pa)(s.bc(a.F),s.bc(s.j),s.bc(ra.d),s.bc(ft,8))},Pa.\u0275cmp=s.Vb({type:Pa,selectors:[["vdr-product-assets"]],viewQuery:function(t,e){if(1&t&&(s.ad(sa,1,$n.d),s.ad(la,1,$n.c)),2&t){let t;s.Hc(t=s.qc())&&(e.listGroup=t.first),s.Hc(t=s.qc())&&(e.placeholder=t.first)}},hostVars:2,hostBindings:function(t,e){2&t&&s.Tb("compact",e.compact)},inputs:{assetsSetter:["assets","assetsSetter"],featuredAsset:"featuredAsset",compact:"compact"},outputs:{change:"change"},decls:5,vars:2,consts:[["class","card",4,"ngIf","ngIfElse"],["compactView",""],["assetList",""],[1,"card"],[1,"card-img"],[1,"featured-asset"],[3,"src","click",4,"ngIf"],["class","placeholder",3,"click",4,"ngIf"],[1,"card-block"],[4,"ngTemplateOutlet"],["class","card-footer",4,"vdrIfPermissions"],[3,"src","click"],[1,"placeholder",3,"click"],["shape","image","size","128"],[1,"card-footer"],[1,"btn",3,"click"],["shape","attachment"],[1,"featured-asset","compact"],["class","compact-select btn btn-icon btn-sm btn-block",3,"title","click",4,"vdrIfPermissions"],["shape","image","size","150"],[1,"compact-select","btn","btn-icon","btn-sm","btn-block",3,"title","click"],["cdkDropListGroup","",1,"all-assets"],["dlg",""],["cdkDropList","",3,"cdkDropListDisabled","cdkDropListEnterPredicate","cdkDropListDropped"],["dl",""],["cdkDropList","",3,"cdkDropListDisabled","cdkDropListEnterPredicate","cdkDropListDropped",4,"ngFor","ngForOf"],["cdkDrag","",3,"cdkDragMoved"],["vdrDropdownTrigger","","tabindex","0",1,"asset-thumb",3,"title"],[3,"src"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",3,"click"],["type","button","vdrDropdownItem","",3,"disabled","click"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",1,"remove-asset",3,"disabled","click"]],template:function(t,e){if(1&t&&(s.Tc(0,ha,8,4,"div",0),s.Tc(1,ya,5,4,"ng-template",null,1,s.Uc),s.Tc(3,Oa,6,7,"ng-template",null,2,s.Uc)),2&t){const t=s.Ic(2);s.yc("ngIf",!e.compact)("ngIfElse",t)}},directives:[h.o,h.t,p.a,vt.o,$n.d,$n.c,h.n,$t.a,$n.a,At.a,_t.a,Lt.a],pipes:[Wc.a,m.d,w.a],styles:["[_nghost-%COMP%]{width:340px;display:block}.compact[_nghost-%COMP%]{width:162px}.placeholder[_ngcontent-%COMP%]{text-align:center;color:var(--color-grey-300)}.featured-asset[_ngcontent-%COMP%]{text-align:center;background:var(--color-component-bg-200);padding:6px;cursor:pointer}.featured-asset.compact[_ngcontent-%COMP%]{width:100%;min-height:40px;position:relative;padding:6px}.featured-asset[_ngcontent-%COMP%]   .compact-select[_ngcontent-%COMP%]{position:absolute;bottom:6px;right:6px;margin:0}.all-assets[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.all-assets[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{margin:3px;padding:0;border:2px solid var(--color-component-border-100);cursor:pointer}.all-assets[_ngcontent-%COMP%]   .asset-thumb.featured[_ngcontent-%COMP%]{border-color:var(--color-primary-500)}.all-assets[_ngcontent-%COMP%]   .remove-asset[_ngcontent-%COMP%]{color:var(--color-warning-500)}.all-assets.compact[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{margin:1px;border-width:1px}.cdk-drag-preview[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:50px;background-color:var(--color-component-bg-100);opacity:.9;box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.8;width:60px;height:50px}.cdk-drag-placeholder[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{background-color:var(--color-component-bg-300);height:100%;width:54px}.cdk-drag-placeholder[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:none}.all-assets.compact[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%], .all-assets.compact[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{width:50px}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.example-box[_ngcontent-%COMP%]:last-child{border:none}.all-assets.cdk-drop-list-dragging[_ngcontent-%COMP%]   vdr-dropdown[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"],changeDetection:0});const Va=function(){return["UpdateCatalog","UpdateProduct"]};function ka(t,e){if(1&t&&(s.cc(0,"vdr-custom-field-control",12),s.sc(1,"hasPermission")),2&t){const t=s.rc().$implicit,e=s.rc(2);s.yc("customFieldsFormGroup",e.customFieldsForm)("customField",t)("readonly",!s.tc(1,3,s.Bc(5,Va)))}}function xa(t,e){if(1&t&&(s.fc(0),s.Tc(1,ka,2,6,"vdr-custom-field-control",11),s.ec()),2&t){const t=e.$implicit,c=s.rc(2);s.Qb(1),s.yc("ngIf",c.customFieldsForm.get(t.name))}}function Ta(t,e){if(1&t&&(s.hc(0,"section"),s.hc(1,"label"),s.Vc(2),s.sc(3,"translate"),s.gc(),s.Tc(4,xa,2,1,"ng-container",10),s.gc()),2&t){const t=s.rc();s.Qb(2),s.Wc(s.tc(3,2,"common.custom-fields")),s.Qb(2),s.yc("ngForOf",t.customFields)}}function Qa(t,e){if(1&t){const t=s.ic();s.hc(0,"button",13),s.pc("click",function(){s.Lc(t);return s.rc().cancel()}),s.Vc(1),s.sc(2,"translate"),s.gc(),s.hc(3,"button",14),s.pc("click",function(){s.Lc(t);return s.rc().update()}),s.Vc(4),s.sc(5,"translate"),s.gc()}if(2&t){const t=s.rc(),e=s.Ic(4),c=s.Ic(8);s.Qb(1),s.Wc(s.tc(2,3,"common.cancel")),s.Qb(2),s.yc("disabled",e.invalid||c.invalid||e.pristine&&c.pristine&&t.customFieldsForm.pristine),s.Qb(1),s.Xc(" ",s.tc(5,5,"catalog.update-product-option")," ")}}class ja{constructor(){this.updateVariantName=!0,this.codeInputTouched=!1}ngOnInit(){var t;const e=this.productOption.translations.find(t=>t.languageCode===this.activeLanguage);if(this.name=null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"",this.code=this.productOption.code,this.customFieldsForm=new r.i({}),this.customFields){const t=e&&e.customFields||{};for(const e of this.customFields){const c=e.name,n="localeString"===e.type?t[c]:this.productOption.customFields[c];this.customFieldsForm.addControl(e.name,new r.f(n))}}}update(){const t=Object(a.P)({translatable:this.productOption,languageCode:this.activeLanguage,updatedFields:{code:this.code,name:this.name,customFields:this.customFieldsForm.value},customFieldConfig:this.customFields,defaultTranslation:{languageCode:this.activeLanguage,name:""}});this.resolveWith(Object.assign(Object.assign({},t),{autoUpdate:this.updateVariantName}))}cancel(){this.resolveWith()}updateCode(t){this.codeInputTouched||this.productOption.code||(this.code=Object(A.normalizeString)(t,"-"))}}ja.\u0275fac=function(t){return new(t||ja)},ja.\u0275cmp=s.Vb({type:ja,selectors:[["vdr-update-product-option-dialog"]],decls:16,vars:13,consts:[["vdrDialogTitle",""],["for","name",3,"label"],["id","name","type","text","required","",3,"ngModel","ngModelChange","input"],["nameInput","ngModel"],["for","code",3,"label"],["id","code","type","text","required","","pattern","[a-z0-9_-]+",3,"ngModel","ngModelChange"],["codeInput","ngModel"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],[4,"ngIf"],["vdrDialogButtons",""],[4,"ngFor","ngForOf"],["entityName","ProductOption",3,"customFieldsFormGroup","customField","readonly",4,"ngIf"],["entityName","ProductOption",3,"customFieldsFormGroup","customField","readonly"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(t,e){1&t&&(s.Tc(0,Ia,2,3,"ng-template",0),s.hc(1,"vdr-form-field",1),s.sc(2,"translate"),s.hc(3,"input",2,3),s.pc("ngModelChange",function(t){return e.name=t})("input",function(t){return e.updateCode(t.target.value)}),s.gc(),s.gc(),s.hc(5,"vdr-form-field",4),s.sc(6,"translate"),s.hc(7,"input",5,6),s.pc("ngModelChange",function(t){return e.code=t}),s.gc(),s.gc(),s.hc(9,"clr-checkbox-wrapper"),s.hc(10,"input",7),s.pc("ngModelChange",function(t){return e.updateVariantName=t}),s.gc(),s.hc(11,"label"),s.Vc(12),s.sc(13,"translate"),s.gc(),s.gc(),s.Tc(14,Ta,5,4,"section",8),s.Tc(15,Qa,6,7,"ng-template",9)),2&t&&(s.Qb(1),s.yc("label",s.tc(2,7,"catalog.option-name")),s.Qb(2),s.yc("ngModel",e.name),s.Qb(2),s.yc("label",s.tc(6,9,"common.code")),s.Qb(2),s.yc("ngModel",e.code),s.Qb(3),s.yc("ngModel",e.updateVariantName),s.Qb(2),s.Wc(s.tc(13,11,"catalog.auto-update-option-variant-name")),s.Qb(2),s.yc("ngIf",e.customFields.length))},directives:[we.a,wt.a,B.a,r.b,r.z,r.p,r.s,r.w,vt.k,r.a,vt.i,vt.u,h.o,De.a,h.n,Dt.a],pipes:[m.d,w.a],styles:[""],changeDetection:0});var Ma=c("sWn2");const wa=function(t){return{rate:t}};function Sa(t,e){if(1&t&&(s.hc(0,"div",2),s.Vc(1),s.sc(2,"translate"),s.sc(3,"async"),s.gc()),2&t){const t=s.rc();s.Qb(1),s.Xc(" ",s.uc(2,1,"catalog.price-includes-tax-at",s.Cc(6,wa,s.tc(3,4,t.taxRate$))),"\n")}}const Da=function(t,e){return{price:t,rate:e}};function $a(t,e){if(1&t&&(s.hc(0,"div",2),s.Vc(1),s.sc(2,"translate"),s.sc(3,"localeCurrency"),s.sc(4,"async"),s.sc(5,"async"),s.gc()),2&t){const t=s.rc();s.Qb(1),s.Xc(" ",s.uc(2,1,"catalog.price-with-tax-in-default-zone",s.Dc(11,Da,s.uc(3,4,s.tc(4,7,t.grossPrice$),t.currencyCode),s.tc(5,9,t.taxRate$))),"\n")}}class Aa{constructor(t){this.dataService=t,this.priceChange$=new y.a(0),this.taxCategoryIdChange$=new y.a("")}ngOnInit(){const t=this.dataService.settings.getTaxRates(999,0,"cache-first").mapStream(t=>t.taxRates.items),e=this.dataService.settings.getActiveChannel("cache-first").refetchOnChannelChange().mapStream(t=>t.activeChannel);this.taxRate$=Object(C.a)(e,t,this.taxCategoryIdChange$).pipe(Object(o.a)(([t,e,c])=>{const n=t.defaultTaxZone;if(!n)return 0;const a=e.find(t=>t.zone.id===n.id&&t.category.id===c);return a?a.value:0})),this.grossPrice$=Object(C.a)(this.taxRate$,this.priceChange$).pipe(Object(o.a)(([t,e])=>Math.round(e*((100+t)/100))))}ngOnChanges(t){"price"in t&&this.priceChange$.next(t.price.currentValue),"taxCategoryId"in t&&this.taxCategoryIdChange$.next(t.taxCategoryId.currentValue)}}Aa.\u0275fac=function(t){return new(t||Aa)(s.bc(a.s))},Aa.\u0275cmp=s.Vb({type:Aa,selectors:[["vdr-variant-price-detail"]],inputs:{priceIncludesTax:"priceIncludesTax",price:"price",currencyCode:"currencyCode",taxCategoryId:"taxCategoryId"},features:[s.Ob],decls:5,vars:5,consts:[[1,"clr-control-label"],["class","value",4,"ngIf"],[1,"value"]],template:function(t,e){1&t&&(s.hc(0,"label",0),s.Vc(1),s.sc(2,"translate"),s.gc(),s.Tc(3,Sa,4,8,"div",1),s.Tc(4,$a,6,14,"div",1)),2&t&&(s.Qb(1),s.Wc(s.tc(2,3,"catalog.taxes")),s.Qb(2),s.yc("ngIf",e.priceIncludesTax),s.Qb(1),s.yc("ngIf",!e.priceIncludesTax))},directives:[vt.u,h.o],pipes:[m.d,h.b,We.a],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}.value[_ngcontent-%COMP%]{margin-top:3px}"],changeDetection:0});var _a=c("SPqo"),La=c("SyQZ"),Na=c("9pfT"),Ga=c("gUbN"),Ea=c("UJ1G");function Wa(t,e){1&t&&(s.hc(0,"clr-toggle-wrapper"),s.cc(1,"input",48),s.hc(2,"label"),s.Vc(3),s.sc(4,"translate"),s.gc(),s.gc()),2&t&&(s.Qb(3),s.Wc(s.tc(4,1,"common.enabled")))}function Ua(t,e){if(1&t&&(s.hc(0,"option",51),s.Vc(1),s.gc()),2&t){const t=e.$implicit;s.yc("value",t.id),s.Qb(1),s.Xc(" ",t.name," ")}}function Ba(t,e){if(1&t&&(s.hc(0,"clr-select-container"),s.hc(1,"label"),s.Vc(2),s.sc(3,"translate"),s.gc(),s.hc(4,"select",49),s.Tc(5,Ua,2,2,"option",50),s.gc(),s.gc()),2&t){const t=s.rc(3);s.Qb(2),s.Wc(s.tc(3,2,"catalog.tax-category")),s.Qb(3),s.yc("ngForOf",t.taxCategories)}}function Xa(t,e){if(1&t&&(s.hc(0,"label",32),s.Vc(1),s.sc(2,"translate"),s.gc(),s.hc(3,"div",52),s.Vc(4),s.gc()),2&t){const t=s.rc().ngIf,e=s.rc(2);s.Qb(1),s.Wc(s.tc(2,2,"catalog.tax-category")),s.Qb(3),s.Xc(" ",e.getTaxCategoryName(t)," ")}}function Ra(t,e){if(1&t&&(s.cc(0,"vdr-currency-input",53),s.sc(1,"hasPermission")),2&t){const t=s.rc(2).$implicit,e=s.rc();s.yc("currencyCode",t.currencyCode)("readonly",!s.tc(1,2,e.updatePermission))}}function Ha(t,e){if(1&t&&(s.cc(0,"vdr-currency-input",54),s.sc(1,"hasPermission")),2&t){const t=s.rc(2).$implicit,e=s.rc();s.yc("currencyCode",t.currencyCode)("readonly",!s.tc(1,2,e.updatePermission))}}function za(t,e){if(1&t&&(s.hc(0,"clr-select-container"),s.hc(1,"label"),s.Vc(2),s.sc(3,"translate"),s.cc(4,"vdr-help-tooltip",30),s.sc(5,"translate"),s.gc(),s.hc(6,"select",55),s.hc(7,"option",51),s.Vc(8),s.sc(9,"translate"),s.gc(),s.hc(10,"option",51),s.Vc(11),s.sc(12,"translate"),s.gc(),s.hc(13,"option",51),s.Vc(14),s.sc(15,"translate"),s.gc(),s.gc(),s.gc()),2&t){const t=s.rc(3);s.Qb(2),s.Xc("",s.tc(3,8,"catalog.track-inventory")," "),s.Qb(2),s.yc("content",s.tc(5,10,"catalog.track-inventory-tooltip")),s.Qb(3),s.yc("value",t.GlobalFlag.TRUE),s.Qb(1),s.Xc(" ",s.tc(9,12,"catalog.track-inventory-true")," "),s.Qb(2),s.yc("value",t.GlobalFlag.FALSE),s.Qb(1),s.Xc(" ",s.tc(12,14,"catalog.track-inventory-false")," "),s.Qb(2),s.yc("value",t.GlobalFlag.INHERIT),s.Qb(1),s.Xc(" ",s.tc(15,16,"catalog.track-inventory-inherit")," ")}}function qa(t,e){if(1&t&&(s.cc(0,"vdr-custom-field-control",59),s.sc(1,"hasPermission")),2&t){const t=s.rc().$implicit,e=s.rc(2).ngIf,c=s.rc(2);s.yc("compact",!0)("customFieldsFormGroup",e.get("customFields"))("readonly",!s.tc(1,4,c.updatePermission))("customField",t)}}const Ka=function(t){return["customFields",t]};function Za(t,e){if(1&t&&(s.fc(0),s.Tc(1,qa,2,6,"vdr-custom-field-control",58),s.ec()),2&t){const t=e.$implicit,c=s.rc(2).ngIf;s.Qb(1),s.yc("ngIf",c.get(s.Cc(1,Ka,t.name)))}}function Ya(t,e){if(1&t&&(s.hc(0,"section",56),s.Tc(1,Za,2,3,"ng-container",57),s.gc()),2&t){const t=s.rc(3);s.Qb(1),s.yc("ngForOf",t.customFields)}}function Ja(t,e){if(1&t){const t=s.ic();s.hc(0,"vdr-chip",62),s.pc("iconClick",function(){s.Lc(t);const c=e.$implicit;return s.rc(4).editOption(c)}),s.sc(1,"hasPermission"),s.hc(2,"span",63),s.Vc(3),s.gc(),s.Vc(4),s.gc()}if(2&t){const t=e.$implicit,c=s.rc(4);s.yc("colorFrom",c.optionGroupName(t.groupId))("invert",!0)("icon",s.tc(1,5,c.updatePermission)&&"pencil"),s.Qb(3),s.Wc(c.optionGroupName(t.groupId)),s.Qb(1),s.Xc(" ",c.optionName(t)," ")}}function ti(t,e){if(1&t&&(s.hc(0,"div"),s.hc(1,"div",60),s.Tc(2,Ja,5,7,"vdr-chip",61),s.sc(3,"sort"),s.gc(),s.gc()),2&t){const t=s.rc(2).$implicit;s.Qb(2),s.yc("ngForOf",s.uc(3,1,t.options,"groupId"))}}function ei(t,e){if(1&t){const t=s.ic();s.hc(0,"vdr-facet-value-chip",64),s.pc("remove",function(){s.Lc(t);const c=e.$implicit,n=s.rc(2).$implicit;return s.rc().removeFacetValue(n,c.id)}),s.sc(1,"hasPermission"),s.gc()}if(2&t){const t=e.$implicit,c=s.rc(3);s.yc("facetValue",t)("removable",s.tc(1,2,c.updatePermission))}}function ci(t,e){if(1&t){const t=s.ic();s.hc(0,"vdr-facet-value-chip",64),s.pc("remove",function(){s.Lc(t);const c=e.$implicit,n=s.rc(2).$implicit;return s.rc().removeFacetValue(n,c.id)}),s.sc(1,"hasPermission"),s.gc()}if(2&t){const t=e.$implicit,c=s.rc(3);s.yc("facetValue",t)("removable",s.tc(1,2,c.updatePermission))}}function ni(t,e){if(1&t){const t=s.ic();s.hc(0,"button",65),s.pc("click",function(){s.Lc(t);const e=s.rc(2).$implicit;return s.rc().selectFacetValueClick.emit([e.id])}),s.cc(1,"clr-icon",66),s.Vc(2),s.sc(3,"translate"),s.gc()}2&t&&(s.Qb(2),s.Xc(" ",s.tc(3,1,"catalog.add-facets")," "))}function ai(t,e){if(1&t){const t=s.ic();s.hc(0,"vdr-chip",72),s.pc("iconClick",function(){s.Lc(t);const e=s.rc().$implicit,c=s.rc(4).$implicit;return s.rc().removeFromChannel.emit({channelId:e.id,variant:c})}),s.sc(1,"translate"),s.cc(2,"vdr-channel-badge",73),s.Vc(3),s.sc(4,"channelCodeToLabel"),s.gc()}if(2&t){const t=s.rc().$implicit;s.yc("title",s.tc(1,3,"catalog.remove-from-channel")),s.Qb(2),s.yc("channelCode",t.code),s.Qb(1),s.Xc(" ",s.tc(4,5,t.code)," ")}}function ii(t,e){if(1&t&&(s.fc(0),s.Tc(1,ai,5,7,"vdr-chip",71),s.ec()),2&t){const t=e.$implicit,c=s.rc(5);s.Qb(1),s.yc("ngIf",!c.isDefaultChannel(t.code))}}function oi(t,e){if(1&t){const t=s.ic();s.hc(0,"div",16),s.hc(1,"div",68),s.Tc(2,ii,2,1,"ng-container",57),s.hc(3,"button",69),s.pc("click",function(){s.Lc(t);const e=s.rc(3).$implicit;return s.rc().assignToChannel.emit(e)}),s.cc(4,"clr-icon",70),s.Vc(5),s.sc(6,"translate"),s.gc(),s.gc(),s.gc()}if(2&t){const t=s.rc(3).$implicit;s.Qb(2),s.yc("ngForOf",t.channels),s.Qb(3),s.Xc(" ",s.tc(6,2,"catalog.assign-to-channel")," ")}}function ri(t,e){1&t&&(s.fc(0),s.Tc(1,oi,7,4,"div",67),s.ec())}function si(t,e){if(1&t){const t=s.ic();s.fc(0,7),s.hc(1,"div",8),s.hc(2,"div",9),s.hc(3,"vdr-title-input",10),s.sc(4,"hasPermission"),s.hc(5,"clr-input-container"),s.cc(6,"input",11),s.sc(7,"hasPermission"),s.sc(8,"translate"),s.gc(),s.gc(),s.hc(9,"vdr-title-input",12),s.sc(10,"hasPermission"),s.hc(11,"clr-input-container"),s.cc(12,"input",13),s.sc(13,"hasPermission"),s.sc(14,"translate"),s.gc(),s.gc(),s.gc(),s.hc(15,"div",14),s.Tc(16,Wa,5,3,"clr-toggle-wrapper",15),s.gc(),s.gc(),s.hc(17,"div",16),s.hc(18,"div",17),s.hc(19,"div",18),s.hc(20,"vdr-product-assets",19),s.pc("change",function(e){s.Lc(t);const c=s.rc().$implicit;return s.rc().onAssetChange(c.id,e)}),s.gc(),s.gc(),s.hc(21,"div",20),s.hc(22,"div",21),s.hc(23,"div",22),s.hc(24,"div",23),s.Tc(25,Ba,6,4,"clr-select-container",24),s.Tc(26,Xa,5,4,"ng-template",null,25,s.Uc),s.gc(),s.hc(28,"div",26),s.hc(29,"clr-input-container"),s.hc(30,"label"),s.Vc(31),s.sc(32,"translate"),s.gc(),s.Tc(33,Ra,2,4,"vdr-currency-input",27),s.Tc(34,Ha,2,4,"vdr-currency-input",28),s.gc(),s.gc(),s.cc(35,"vdr-variant-price-detail",29),s.gc(),s.hc(36,"div",22),s.Tc(37,za,16,18,"clr-select-container",15),s.hc(38,"clr-input-container"),s.hc(39,"label"),s.Vc(40),s.sc(41,"translate"),s.cc(42,"vdr-help-tooltip",30),s.sc(43,"translate"),s.gc(),s.cc(44,"input",31),s.sc(45,"hasPermission"),s.gc(),s.hc(46,"div"),s.hc(47,"label",32),s.Vc(48),s.sc(49,"translate"),s.cc(50,"vdr-help-tooltip",30),s.sc(51,"translate"),s.gc(),s.hc(52,"div",33),s.Vc(53),s.gc(),s.gc(),s.hc(54,"div"),s.hc(55,"label",32),s.Vc(56),s.sc(57,"translate"),s.cc(58,"vdr-help-tooltip",30),s.sc(59,"translate"),s.gc(),s.hc(60,"div",33),s.Vc(61),s.gc(),s.gc(),s.gc(),s.hc(62,"div",22),s.hc(63,"div",34),s.hc(64,"label",32),s.Vc(65),s.sc(66,"translate"),s.cc(67,"vdr-help-tooltip",30),s.sc(68,"translate"),s.gc(),s.hc(69,"div",35),s.hc(70,"clr-input-container"),s.cc(71,"input",36),s.sc(72,"hasPermission"),s.gc(),s.hc(73,"clr-toggle-wrapper"),s.cc(74,"input",37),s.sc(75,"hasPermission"),s.hc(76,"label"),s.Vc(77),s.sc(78,"translate"),s.gc(),s.gc(),s.gc(),s.gc(),s.gc(),s.gc(),s.hc(79,"div",38),s.hc(80,"div",22),s.Tc(81,Ya,2,1,"section",39),s.gc(),s.gc(),s.gc(),s.gc(),s.gc(),s.hc(82,"div",16),s.hc(83,"div",40),s.cc(84,"vdr-entity-info",41),s.Tc(85,ti,4,4,"div",42),s.cc(86,"div",43),s.hc(87,"div",44),s.Tc(88,ei,2,4,"vdr-facet-value-chip",45),s.Tc(89,ci,2,4,"vdr-facet-value-chip",45),s.Tc(90,ni,4,3,"button",46),s.gc(),s.gc(),s.gc(),s.Tc(91,ri,2,0,"ng-container",47),s.ec()}if(2&t){const t=e.ngIf,c=s.Ic(27),n=s.rc().$implicit,a=s.rc();let i=null;s.yc("formGroup",t),s.Qb(3),s.yc("readonly",!s.tc(4,53,a.updatePermission)),s.Qb(3),s.yc("readonly",!s.tc(7,55,a.updatePermission))("placeholder",s.tc(8,57,"catalog.sku")),s.Qb(3),s.yc("readonly",!s.tc(10,59,a.updatePermission)),s.Qb(3),s.yc("readonly",!s.tc(13,61,a.updatePermission))("placeholder",s.tc(14,63,"common.name")),s.Qb(4),s.yc("vdrIfPermissions",a.updatePermission),s.Qb(4),s.yc("compact",!0)("assets",(null==a.pendingAssetChanges[n.id]?null:a.pendingAssetChanges[n.id].assets)||n.assets)("featuredAsset",(null==a.pendingAssetChanges[n.id]?null:a.pendingAssetChanges[n.id].featuredAsset)||n.featuredAsset),s.Qb(5),s.yc("vdrIfPermissions",a.updatePermission)("vdrIfPermissionsElse",c),s.Qb(6),s.Wc(s.tc(32,65,"catalog.price")),s.Qb(2),s.yc("ngIf",!a.channelPriceIncludesTax),s.Qb(1),s.yc("ngIf",a.channelPriceIncludesTax),s.Qb(1),s.yc("price",t.get("price").value)("currencyCode",n.currencyCode)("priceIncludesTax",a.channelPriceIncludesTax)("taxCategoryId",t.get("taxCategoryId").value),s.Qb(2),s.yc("vdrIfPermissions",a.updatePermission),s.Qb(3),s.Xc("",s.tc(41,67,"catalog.stock-on-hand")," "),s.Qb(2),s.yc("content",s.tc(43,69,"catalog.stock-on-hand-tooltip")),s.Qb(2),s.Tb("inventory-untracked",a.inventoryIsNotTracked(t)),s.yc("readonly",!s.tc(45,71,a.updatePermission))("vdrDisabled",a.inventoryIsNotTracked(t)),s.Qb(2),s.Tb("inventory-untracked",a.inventoryIsNotTracked(t)),s.Qb(2),s.Xc("",s.tc(49,73,"catalog.stock-allocated")," "),s.Qb(2),s.yc("content",s.tc(51,75,"catalog.stock-allocated-tooltip")),s.Qb(3),s.Xc(" ",n.stockAllocated," "),s.Qb(1),s.Tb("inventory-untracked",a.inventoryIsNotTracked(t)),s.Qb(2),s.Xc("",s.tc(57,77,"catalog.stock-saleable")," "),s.Qb(2),s.yc("content",s.tc(59,79,"catalog.stock-saleable-tooltip")),s.Qb(3),s.Xc(" ",a.getSaleableStockLevel(n)," "),s.Qb(2),s.Tb("inventory-untracked",a.inventoryIsNotTracked(t)),s.Qb(2),s.Wc(s.tc(66,81,"catalog.out-of-stock-threshold")),s.Qb(2),s.yc("content",s.tc(68,83,"catalog.out-of-stock-threshold-tooltip")),s.Qb(4),s.yc("formControl",t.get("outOfStockThreshold"))("readonly",!s.tc(72,85,a.updatePermission))("vdrDisabled",!1!==(null==(i=t.get("useGlobalOutOfStockThreshold"))?null:i.value)||a.inventoryIsNotTracked(t)),s.Qb(3),s.yc("vdrDisabled",!s.tc(75,87,a.updatePermission)||a.inventoryIsNotTracked(t)),s.Qb(3),s.Yc("",s.tc(78,89,"catalog.use-global-value")," (",a.globalOutOfStockThreshold,")"),s.Qb(4),s.yc("ngIf",a.customFields.length),s.Qb(3),s.yc("entity",n),s.Qb(1),s.yc("ngIf",n.options.length),s.Qb(3),s.yc("ngForOf",a.existingFacetValues(n)),s.Qb(1),s.yc("ngForOf",a.pendingFacetValues(n)),s.Qb(1),s.yc("vdrIfPermissions",a.updatePermission)}}function li(t,e){if(1&t&&(s.hc(0,"div",5),s.Tc(1,si,92,91,"ng-container",6),s.gc()),2&t){const t=e.$implicit,c=s.rc();let n=null,a=null;s.Tb("disabled",!(null!=(n=c.formGroupMap.get(t.id))&&(null!=(a=n.get("enabled"))&&a.value))),s.Qb(1),s.yc("ngIf",c.formGroupMap.get(t.id))}}class di{constructor(t,e,c){this.changeDetector=t,this.modalService=e,this.dataService=c,this.assignToChannel=new s.t,this.removeFromChannel=new s.t,this.assetChange=new s.t,this.selectionChange=new s.t,this.selectFacetValueClick=new s.t,this.updateProductOption=new s.t,this.selectedVariantIds=[],this.pagination={currentPage:1,itemsPerPage:10},this.formGroupMap=new Map,this.GlobalFlag=a.w,this.updatePermission=[a.H.UpdateCatalog,a.H.UpdateProduct]}ngOnInit(){this.dataService.settings.getGlobalSettings("cache-first").single$.subscribe(({globalSettings:t})=>{this.globalTrackInventory=t.trackInventory,this.globalOutOfStockThreshold=t.outOfStockThreshold,this.changeDetector.markForCheck()}),this.subscription=this.formArray.valueChanges.subscribe(()=>this.changeDetector.markForCheck()),this.subscription.add(this.formArray.valueChanges.pipe(Object(o.a)(t=>t.length),Object(P.a)(1),Object(W.a)()).subscribe(()=>{this.buildFormGroupMap()})),this.buildFormGroupMap()}ngOnChanges(t){var e,c;"facets"in t&&t.facets.currentValue&&(this.facetValues=Object(a.T)(this.facets)),"variants"in t&&(null===(e=t.variants.currentValue)||void 0===e?void 0:e.length)!==(null===(c=t.variants.previousValue)||void 0===c?void 0:c.length)&&(this.pagination.currentPage=1)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}isDefaultChannel(t){return t===Oe.DEFAULT_CHANNEL_CODE}trackById(t,e){return e.id}inventoryIsNotTracked(t){var e;const c=null===(e=t.get("trackInventory"))||void 0===e?void 0:e.value;return c===a.w.FALSE||c===a.w.INHERIT&&!1===this.globalTrackInventory}getTaxCategoryName(t){const e=t.get(["taxCategoryId"]);if(e&&this.taxCategories){const t=this.taxCategories.find(t=>t.id===e.value);return t?t.name:""}return""}getSaleableStockLevel(t){const e=t.useGlobalOutOfStockThreshold?this.globalOutOfStockThreshold:t.outOfStockThreshold;return t.stockOnHand-t.stockAllocated-e}areAllSelected(){return!!this.variants&&this.selectedVariantIds.length===this.variants.length}onAssetChange(t,e){this.assetChange.emit(Object.assign({variantId:t},e));const c=this.variants.findIndex(e=>e.id===t);this.formArray.at(c).markAsDirty()}toggleSelectAll(){this.areAllSelected()?this.selectedVariantIds=[]:this.selectedVariantIds=this.variants.map(t=>t.id),this.selectionChange.emit(this.selectedVariantIds)}toggleSelectVariant(t){const e=this.selectedVariantIds.indexOf(t);-1<e?this.selectedVariantIds.splice(e,1):this.selectedVariantIds.push(t),this.selectionChange.emit(this.selectedVariantIds)}optionGroupName(t){var e;const c=this.optionGroups.find(e=>e.id===t);if(c){return(null!==(e=null==c?void 0:c.translations.find(t=>t.languageCode===this.activeLanguage))&&void 0!==e?e:c.translations[0]).name}}optionName(t){var e;return(null!==(e=t.translations.find(t=>t.languageCode===this.activeLanguage))&&void 0!==e?e:t.translations[0]).name}pendingFacetValues(t){if(this.facets){const e=this.getFacetValueIds(t.id),c=t.facetValues.map(t=>t.id);return e.filter(t=>!c.includes(t)).map(t=>this.facetValues.find(e=>e.id===t)).filter(Tt.notNullOrUndefined)}return[]}existingFacetValues(t){return[...this.getFacetValueIds(t.id)].filter(e=>t.facetValues.map(t=>t.id).includes(e)).map(e=>t.facetValues.find(t=>t.id===e)).filter(Tt.notNullOrUndefined)}removeFacetValue(t,e){const c=this.formGroupMap.get(t.id);if(c){const t=c.value.facetValueIds.filter(t=>t!==e);c.patchValue({facetValueIds:t}),c.markAsDirty()}}isVariantSelected(t){return-1<this.selectedVariantIds.indexOf(t)}editOption(t){this.modalService.fromComponent(ja,{size:"md",locals:{productOption:t,activeLanguage:this.activeLanguage,customFields:this.customOptionFields}}).subscribe(t=>{t&&this.updateProductOption.emit(t)})}buildFormGroupMap(){this.formGroupMap.clear();for(const t of this.formArray.controls)this.formGroupMap.set(t.value.id,t);this.changeDetector.markForCheck()}getFacetValueIds(t){var e;return(null===(e=this.formGroupMap.get(t))||void 0===e?void 0:e.value).facetValueIds}}di.\u0275fac=function(t){return new(t||di)(s.bc(s.j),s.bc(a.F),s.bc(a.s))},di.\u0275cmp=s.Vb({type:di,selectors:[["vdr-product-variants-list"]],inputs:{formArray:["productVariantsFormArray","formArray"],variants:"variants",channelPriceIncludesTax:"channelPriceIncludesTax",taxCategories:"taxCategories",facets:"facets",optionGroups:"optionGroups",customFields:"customFields",customOptionFields:"customOptionFields",activeLanguage:"activeLanguage",pendingAssetChanges:"pendingAssetChanges"},outputs:{assignToChannel:"assignToChannel",removeFromChannel:"removeFromChannel",assetChange:"assetChange",selectionChange:"selectionChange",selectFacetValueClick:"selectFacetValueClick",updateProductOption:"updateProductOption"},features:[s.Ob],decls:6,vars:8,consts:[[1,"variants-list"],["class","variant-container card",3,"disabled",4,"ngFor","ngForOf","ngForTrackBy"],[1,"table-footer"],[3,"itemsPerPage","itemsPerPageChange"],[3,"currentPage","itemsPerPage","pageChange"],[1,"variant-container","card"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"card-block","header-row"],[1,"details"],[1,"sku",3,"readonly"],["clrInput","","type","text","formControlName","sku",3,"readonly","placeholder"],[1,"name",3,"readonly"],["clrInput","","type","text","formControlName","name",3,"readonly","placeholder"],[1,"right-controls"],[4,"vdrIfPermissions"],[1,"card-block"],[1,"variant-body"],[1,"assets"],[3,"compact","assets","featuredAsset","change"],[1,"variant-form-inputs"],[1,"standard-fields"],[1,"variant-form-input-row"],[1,"tax-category"],[4,"vdrIfPermissions","vdrIfPermissionsElse"],["taxCategoryLabel",""],[1,"price"],["clrInput","","formControlName","price",3,"currencyCode","readonly",4,"ngIf"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly",4,"ngIf"],[3,"price","currencyCode","priceIncludesTax","taxCategoryId"],[3,"content"],["clrInput","","type","number","min","0","step","1","formControlName","stockOnHand",3,"readonly","vdrDisabled"],[1,"clr-control-label"],[1,"value"],[1,"out-of-stock-threshold-wrapper"],[1,"flex"],["clrInput","","type","number",3,"formControl","readonly","vdrDisabled"],["type","checkbox","clrToggle","","name","useGlobalOutOfStockThreshold","formControlName","useGlobalOutOfStockThreshold",3,"vdrDisabled"],[1,"custom-fields"],["formGroupName","customFields",4,"ngIf"],[1,"options-facets"],[3,"entity"],[4,"ngIf"],[1,"flex-spacer"],[1,"facets"],[3,"facetValue","removable","remove",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary",3,"click",4,"vdrIfPermissions"],[4,"vdrIfMultichannel"],["type","checkbox","clrToggle","","name","enabled","formControlName","enabled"],["clrSelect","","name","options","formControlName","taxCategoryId"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"tax-category-label"],["clrInput","","formControlName","price",3,"currencyCode","readonly"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly"],["clrSelect","","name","options","formControlName","trackInventory"],["formGroupName","customFields"],[4,"ngFor","ngForOf"],["entityName","ProductVariant",3,"compact","customFieldsFormGroup","readonly","customField",4,"ngIf"],["entityName","ProductVariant",3,"compact","customFieldsFormGroup","readonly","customField"],[1,"options"],[3,"colorFrom","invert","icon","iconClick",4,"ngFor","ngForOf"],[3,"colorFrom","invert","icon","iconClick"],[1,"option-group-name"],[3,"facetValue","removable","remove"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","plus"],["class","card-block",4,"vdrIfDefaultChannelActive"],[1,"flex","channel-assignment"],[1,"btn","btn-sm",3,"click"],["shape","layers"],["icon","times-circle",3,"title","iconClick",4,"ngIf"],["icon","times-circle",3,"title","iconClick"],[3,"channelCode"]],template:function(t,e){1&t&&(s.hc(0,"div",0),s.Tc(1,li,2,3,"div",1),s.sc(2,"paginate"),s.hc(3,"div",2),s.hc(4,"vdr-items-per-page-controls",3),s.pc("itemsPerPageChange",function(t){return e.pagination.itemsPerPage=t}),s.gc(),s.hc(5,"vdr-pagination-controls",4),s.pc("pageChange",function(t){return e.pagination.currentPage=t}),s.gc(),s.gc(),s.gc()),2&t&&(s.Qb(1),s.yc("ngForOf",s.uc(2,5,e.variants,e.pagination))("ngForTrackBy",e.trackById),s.Qb(3),s.yc("itemsPerPage",e.pagination.itemsPerPage),s.Qb(1),s.yc("currentPage",e.pagination.currentPage)("itemsPerPage",e.pagination.itemsPerPage))},directives:[h.n,vt.l,Q.a,j.a,h.o,r.q,r.j,Ma.a,vt.t,B.a,r.b,vt.s,r.p,r.h,p.a,Pa,vt.u,Aa,_a.a,r.v,St.a,r.g,vt.k,r.a,vt.i,d.a,La.a,vt.B,r.A,vt.A,r.u,r.D,ln.a,r.k,Dt.a,oe.a,re.a,vt.o,Na.a,Ga.a],pipes:[M.b,w.a,m.d,Ea.a,Ee.a],styles:[".with-selected[_ngcontent-%COMP%]{display:flex;min-height:52px;align-items:center;border:1px solid var(--color-component-border-100);border-radius:3px;padding:6px 18px}.with-selected[_ngcontent-%COMP%] > label[_ngcontent-%COMP%], .with-selected[_ngcontent-%COMP%]   vdr-select-toggle[_ngcontent-%COMP%]{margin-right:12px}.variant-container[_ngcontent-%COMP%]{transition:background-color .2s;min-height:330px}.variant-container.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}.variant-container[_ngcontent-%COMP%]   .header-row[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap}.variant-container[_ngcontent-%COMP%]   .variant-body[_ngcontent-%COMP%]{display:flex;flex-direction:column}@media screen and (min-width:768px){.variant-container[_ngcontent-%COMP%]   .variant-body[_ngcontent-%COMP%]{flex-direction:row}}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;margin-right:12px}@media screen and (min-width:768px){.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{flex-direction:row;height:36px}}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{flex:1}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]     .clr-control-container{width:100%}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]     .clr-control-container input.clr-input{min-width:100%}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .sku[_ngcontent-%COMP%]{width:160px;margin-right:20px;flex:0}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]     .name input{min-width:300px}.variant-container[_ngcontent-%COMP%]   .right-controls[_ngcontent-%COMP%]{display:flex}.variant-container[_ngcontent-%COMP%]   .tax-category-label[_ngcontent-%COMP%]{margin-top:3px}.variant-container[_ngcontent-%COMP%]   .variant-form-inputs[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}@media screen and (min-width:768px){.variant-container[_ngcontent-%COMP%]   .variant-form-inputs[_ngcontent-%COMP%]{flex-direction:row}}.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}@media screen and (min-width:768px){.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%]{margin:0 6px 8px 24px}}.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-right:24px;margin-bottom:24px}.variant-container[_ngcontent-%COMP%]   .track-inventory-toggle[_ngcontent-%COMP%]{margin-top:22px}.variant-container[_ngcontent-%COMP%]   .clr-form-control[_ngcontent-%COMP%]{margin-top:0}.variant-container[_ngcontent-%COMP%]   .facets[_ngcontent-%COMP%]{display:flex;align-items:center}.variant-container[_ngcontent-%COMP%]   .pricing[_ngcontent-%COMP%]{display:flex}.variant-container[_ngcontent-%COMP%]   .pricing[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-right:12px}.variant-container[_ngcontent-%COMP%]   .option-group-name[_ngcontent-%COMP%]{color:var(--color-text-200);text-transform:uppercase;font-size:10px;margin-right:3px;height:11px}.variant-container[_ngcontent-%COMP%]   .options-facets[_ngcontent-%COMP%]{display:flex;color:var(--color-grey-400)}.channel-assignment[_ngcontent-%COMP%]{justify-content:flex-end}.channel-assignment[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin:6px 12px 6px 0}.out-of-stock-threshold-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.out-of-stock-threshold-wrapper[_ngcontent-%COMP%]   clr-toggle-wrapper[_ngcontent-%COMP%]{margin-left:24px}.inventory-untracked[_ngcontent-%COMP%]{opacity:.5}.table-footer[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:space-between;margin-top:6px}"],changeDetection:0});var ui=c("wypj");function pi(t,e){if(1&t&&(s.fc(0),s.hc(1,"vdr-dt-column"),s.Vc(2),s.gc(),s.ec()),2&t){const t=e.$implicit;s.Qb(2),s.Wc(t.name)}}function gi(t,e){if(1&t&&(s.cc(0,"img",17),s.sc(1,"assetPreview")),2&t){const t=e.ngIf;s.yc("src",s.uc(1,1,t,"tiny"),s.Nc)}}function hi(t,e){1&t&&(s.hc(0,"div",18),s.cc(1,"clr-icon",19),s.gc())}function mi(t,e){if(1&t&&(s.fc(0),s.hc(1,"td",4),s.sc(2,"stringToColor"),s.Vc(3),s.gc(),s.ec()),2&t){const t=e.$implicit,c=s.rc().ngIf,n=s.rc(2);s.Qb(1),s.Qc("color",s.tc(2,5,n.optionGroupName(t.groupId))),s.Tb("disabled",!c.get("enabled").value),s.Qb(2),s.Xc(" ",t.name," ")}}function fi(t,e){if(1&t&&(s.cc(0,"vdr-currency-input",20),s.sc(1,"hasPermission")),2&t){const t=s.rc(2).item,e=s.rc();s.yc("currencyCode",t.currencyCode)("readonly",!s.tc(1,2,e.updatePermission))}}function bi(t,e){if(1&t&&(s.cc(0,"vdr-currency-input",21),s.sc(1,"hasPermission")),2&t){const t=s.rc(2).item,e=s.rc();s.yc("currencyCode",t.currencyCode)("readonly",!s.tc(1,2,e.updatePermission))}}function vi(t,e){if(1&t&&(s.fc(0,3),s.hc(1,"td",4),s.hc(2,"div",5),s.hc(3,"div",6),s.Tc(4,gi,2,4,"img",7),s.Tc(5,hi,2,0,"ng-template",null,8,s.Uc),s.gc(),s.gc(),s.gc(),s.hc(7,"td",4),s.hc(8,"clr-input-container"),s.cc(9,"input",9),s.sc(10,"hasPermission"),s.sc(11,"translate"),s.gc(),s.gc(),s.hc(12,"td",4),s.hc(13,"clr-input-container"),s.cc(14,"input",10),s.sc(15,"hasPermission"),s.sc(16,"translate"),s.gc(),s.gc(),s.Tc(17,mi,4,7,"ng-container",1),s.sc(18,"sort"),s.hc(19,"td",11),s.hc(20,"clr-input-container"),s.Tc(21,fi,2,4,"vdr-currency-input",12),s.Tc(22,bi,2,4,"vdr-currency-input",13),s.gc(),s.gc(),s.hc(23,"td",14),s.hc(24,"clr-input-container"),s.cc(25,"input",15),s.sc(26,"hasPermission"),s.gc(),s.gc(),s.hc(27,"td",14),s.hc(28,"clr-toggle-wrapper"),s.cc(29,"input",16),s.sc(30,"hasPermission"),s.gc(),s.gc(),s.ec()),2&t){const t=e.ngIf,c=s.Ic(6),n=s.rc().item,a=s.rc();s.yc("formGroup",t),s.Qb(1),s.Tb("disabled",!t.get("enabled").value),s.Qb(3),s.yc("ngIf",a.getFeaturedAsset(n))("ngIfElse",c),s.Qb(3),s.Tb("disabled",!t.get("enabled").value),s.Qb(2),s.yc("readonly",!s.tc(10,24,a.updatePermission))("placeholder",s.tc(11,26,"common.name")),s.Qb(3),s.Tb("disabled",!t.get("enabled").value),s.Qb(2),s.yc("readonly",!s.tc(15,28,a.updatePermission))("placeholder",s.tc(16,30,"catalog.sku")),s.Qb(3),s.yc("ngForOf",s.uc(18,32,n.options,"groupId")),s.Qb(2),s.Tb("disabled",!t.get("enabled").value),s.Qb(2),s.yc("ngIf",!a.channelPriceIncludesTax),s.Qb(1),s.yc("ngIf",a.channelPriceIncludesTax),s.Qb(1),s.Tb("disabled",!t.get("enabled").value),s.Qb(2),s.yc("readonly",!s.tc(26,35,a.updatePermission)),s.Qb(2),s.Tb("disabled",!t.get("enabled").value),s.Qb(2),s.yc("vdrDisabled",!s.tc(30,37,a.updatePermission))}}function yi(t,e){if(1&t&&s.Tc(0,vi,31,39,"ng-container",2),2&t){const t=e.item,c=s.rc();s.yc("ngIf",c.formGroupMap.get(t.id))}}class Ci{constructor(t){this.changeDetector=t,this.formGroupMap=new Map,this.updatePermission=[a.H.UpdateCatalog,a.H.UpdateProduct]}ngOnInit(){this.subscription=this.formArray.valueChanges.pipe(Object(o.a)(t=>t.length),Object(P.a)(1),Object(W.a)()).subscribe(()=>{this.buildFormGroupMap()}),this.buildFormGroupMap()}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}getFeaturedAsset(t){var e;return(null===(e=this.pendingAssetChanges[t.id])||void 0===e?void 0:e.featuredAsset)||t.featuredAsset}optionGroupName(t){const e=this.optionGroups.find(e=>e.id===t);return e&&e.name}buildFormGroupMap(){this.formGroupMap.clear();for(const t of this.formArray.controls)this.formGroupMap.set(t.value.id,t);this.changeDetector.markForCheck()}}Ci.\u0275fac=function(t){return new(t||Ci)(s.bc(s.j))},Ci.\u0275cmp=s.Vb({type:Ci,selectors:[["vdr-product-variants-table"]],inputs:{formArray:["productVariantsFormArray","formArray"],variants:"variants",channelPriceIncludesTax:"channelPriceIncludesTax",optionGroups:"optionGroups",pendingAssetChanges:"pendingAssetChanges"},decls:20,vars:20,consts:[[3,"items"],[4,"ngFor","ngForOf"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"left","align-middle"],[1,"card-img"],[1,"featured-asset"],[3,"src",4,"ngIf","ngIfElse"],["placeholder",""],["clrInput","","type","text","formControlName","name",3,"readonly","placeholder"],["clrInput","","type","text","formControlName","sku",3,"readonly","placeholder"],[1,"left","align-middle","price"],["clrInput","","formControlName","price",3,"currencyCode","readonly",4,"ngIf"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly",4,"ngIf"],[1,"left","align-middle","stock"],["clrInput","","type","number","min","0","step","1","formControlName","stockOnHand",3,"readonly"],["type","checkbox","clrToggle","","name","enabled","formControlName","enabled",3,"vdrDisabled"],[3,"src"],[1,"placeholder"],["shape","image","size","48"],["clrInput","","formControlName","price",3,"currencyCode","readonly"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly"]],template:function(t,e){1&t&&(s.hc(0,"vdr-data-table",0),s.cc(1,"vdr-dt-column"),s.hc(2,"vdr-dt-column"),s.Vc(3),s.sc(4,"translate"),s.gc(),s.hc(5,"vdr-dt-column"),s.Vc(6),s.sc(7,"translate"),s.gc(),s.Tc(8,pi,3,1,"ng-container",1),s.sc(9,"sort"),s.hc(10,"vdr-dt-column"),s.Vc(11),s.sc(12,"translate"),s.gc(),s.hc(13,"vdr-dt-column"),s.Vc(14),s.sc(15,"translate"),s.gc(),s.hc(16,"vdr-dt-column"),s.Vc(17),s.sc(18,"translate"),s.gc(),s.Tc(19,yi,1,1,"ng-template"),s.gc()),2&t&&(s.yc("items",e.variants),s.Qb(3),s.Wc(s.tc(4,7,"common.name")),s.Qb(3),s.Wc(s.tc(7,9,"catalog.sku")),s.Qb(2),s.yc("ngForOf",s.uc(9,11,e.optionGroups,"id")),s.Qb(3),s.Wc(s.tc(12,14,"catalog.price")),s.Qb(3),s.Wc(s.tc(15,16,"catalog.stock-on-hand")),s.Qb(3),s.Wc(s.tc(18,18,"common.enabled")))},directives:[X.a,ie.a,h.n,h.o,r.q,r.j,vt.t,B.a,r.b,vt.s,r.p,r.h,r.v,vt.k,r.a,vt.i,St.a,vt.o,ln.a],pipes:[m.d,Ea.a,w.a,Wc.a,ui.a],styles:[".placeholder[_ngcontent-%COMP%]{color:var(--color-grey-300)}.price[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .stock[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:96px}td[_ngcontent-%COMP%]{transition:background-color .2s}td.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}"],changeDetection:0});var Oi=c("gEAM"),Pi=c("6y1o"),Fi=c("7xiD");class Ii{}Ii.\u0275fac=function(t){return new(t||Ii)},Ii.\u0275mod=s.Zb({type:Ii}),Ii.\u0275inj=s.Yb({imports:[[a.J,n.i.forChild(Qn)]]}),s.Oc(jc,[l.a,l.b,d.a,p.a,vt.k,B.a,r.a,vt.i,r.p,r.g,vt.u,Mt.a,l.c,u.a,h.o,r.E,r.q,r.j,vt.G,vt.R,vt.D,vt.F,vt.P,vt.p,vt.E,r.k,La.a,Na.a,Oi.a,h.n,oe.a,Ga.a,vt.o,wt.a,r.b,r.h,r.w,Pi.a,Dt.a,re.a,Pa,oa,n.h,Ci,di],[h.b,m.d,Ee.a,w.a]),s.Oc(ft,[l.a,l.b,d.a,Mt.a,l.c,u.a,h.o,p.a,r.E,r.q,r.j,wt.a,vt.k,B.a,r.a,vt.i,r.p,r.h,St.a,vt.u,r.b,r.w,Pi.a,r.k,h.n,Dt.a,Pa,r.d,Fi.a,$t.a,At.a,vt.o,_t.a,Lt.a,Y],[h.b,m.d,w.a]),s.Oc(Ot,[h.o,Jn,$n.d],[])}}]);
//# sourceMappingURL=7-es2015.e9256a6401c10da9ddda.js.map
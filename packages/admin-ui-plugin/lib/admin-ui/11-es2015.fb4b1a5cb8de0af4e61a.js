(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{ymA1:function(t,e,c){"use strict";c.r(e),c.d(e,"AddManualPaymentDialogComponent",function(){return h}),c.d(e,"CancelOrderDialogComponent",function(){return M}),c.d(e,"FulfillOrderDialogComponent",function(){return A}),c.d(e,"FulfillmentCardComponent",function(){return lt}),c.d(e,"FulfillmentDetailComponent",function(){return Z}),c.d(e,"FulfillmentStateLabelComponent",function(){return N}),c.d(e,"LineFulfillmentComponent",function(){return Ot}),c.d(e,"LineRefundsComponent",function(){return Pt}),c.d(e,"ModificationDetailComponent",function(){return Ft}),c.d(e,"OrderCustomFieldsCardComponent",function(){return Dt}),c.d(e,"OrderDetailComponent",function(){return wn}),c.d(e,"OrderEditorComponent",function(){return Or}),c.d(e,"OrderEditResultType",function(){return _n}),c.d(e,"OrderEditsPreviewDialogComponent",function(){return Nn}),c.d(e,"OrderHistoryComponent",function(){return Bc}),c.d(e,"OrderListComponent",function(){return Dr}),c.d(e,"OrderPaymentCardComponent",function(){return gn}),c.d(e,"NODE_HEIGHT",function(){return ae}),c.d(e,"OrderProcessEdgeComponent",function(){return ue}),c.d(e,"OrderProcessGraphComponent",function(){return me}),c.d(e,"OrderProcessNodeComponent",function(){return le}),c.d(e,"OrderProcessGraphDialogComponent",function(){return he}),c.d(e,"OrderStateSelectDialogComponent",function(){return ne}),c.d(e,"OrderTableComponent",function(){return ac}),c.d(e,"PaymentDetailComponent",function(){return fc}),c.d(e,"PaymentStateLabelComponent",function(){return Zc}),c.d(e,"RefundOrderDialogComponent",function(){return Le}),c.d(e,"RefundStateLabelComponent",function(){return Kc}),c.d(e,"SettleRefundDialogComponent",function(){return We}),c.d(e,"SimpleItemListComponent",function(){return $}),c.d(e,"OrderModule",function(){return Er}),c.d(e,"orderRoutes",function(){return Wr}),c.d(e,"orderBreadcrumb",function(){return Nr}),c.d(e,"modifyingOrderBreadcrumb",function(){return Rr}),c.d(e,"OrderTransitionService",function(){return re}),c.d(e,"OrderResolver",function(){return jr});var n=c("3Pt+"),r=c("t9nd"),i=c("fXoL"),o=c("xUfP"),a=c("1XD6"),s=c("ZOsW"),l=c("Bzlx"),d=c("jHbs"),u=c("sYmb"),f=c("ofXK"),g=c("ZFbG");function m(t,e){1&t&&(i.Vc(0),i.sc(1,"translate")),2&t&&i.Wc(i.tc(1,1,"order.add-payment-to-order"))}function p(t,e){if(1&t){const t=i.ic();i.hc(0,"button",7),i.pc("click",function(){i.Lc(t);return i.rc().cancel()}),i.Vc(1),i.sc(2,"translate"),i.gc(),i.hc(3,"button",8),i.pc("click",function(){i.Lc(t);return i.rc().submit()}),i.Vc(4),i.sc(5,"translate"),i.sc(6,"localeCurrency"),i.gc()}if(2&t){const t=i.rc();i.Qb(1),i.Wc(i.tc(2,4,"common.cancel")),i.Qb(2),i.yc("disabled",t.form.invalid||t.form.pristine),i.Qb(1),i.Yc(" ",i.tc(5,6,"order.add-payment")," (",i.uc(6,8,t.outstandingAmount,t.currencyCode),") ")}}class h{constructor(t){this.dataService=t,this.form=new n.i({method:new n.f("",n.C.required),transactionId:new n.f("",n.C.required)})}ngOnInit(){this.paymentMethods$=this.dataService.settings.getPaymentMethods(999).mapSingle(t=>t.paymentMethods.items)}submit(){const t=this.form.value;this.resolveWith({method:t.method,transactionId:t.transactionId})}cancel(){this.resolveWith()}}h.\u0275fac=function(t){return new(t||h)(i.bc(r.s))},h.\u0275cmp=i.Vb({type:h,selectors:[["vdr-add-manual-payment-dialog"]],decls:10,vars:11,consts:[["vdrDialogTitle",""],[3,"formGroup"],["for","method",3,"label"],["bindLabel","code","autofocus","","bindValue","code","formControlName","method",3,"items","addTag"],["for","transactionId",3,"label"],["id","transactionId","type","text","formControlName","transactionId"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(t,e){1&t&&(i.Tc(0,m,2,3,"ng-template",0),i.hc(1,"form",1),i.hc(2,"vdr-form-field",2),i.sc(3,"translate"),i.cc(4,"ng-select",3),i.sc(5,"async"),i.gc(),i.hc(6,"vdr-form-field",4),i.sc(7,"translate"),i.cc(8,"input",5),i.gc(),i.gc(),i.Tc(9,p,7,11,"ng-template",6)),2&t&&(i.Qb(1),i.yc("formGroup",e.form),i.Qb(1),i.yc("label",i.tc(3,5,"order.payment-method")),i.Qb(2),i.yc("items",i.tc(5,7,e.paymentMethods$))("addTag",!0),i.Qb(2),i.yc("label",i.tc(7,9,"order.transaction-id")))},directives:[o.a,n.E,n.q,n.j,a.a,s.a,n.p,n.h,l.a,n.b,d.a],pipes:[u.d,f.b,g.a],styles:[".ng-select[_ngcontent-%COMP%]{min-width:100%}"],changeDetection:0});var b=c("OxKu"),y=c("8MG2"),v=c("PPsv");function C(t,e){1&t&&(i.Vc(0),i.sc(1,"translate")),2&t&&i.Wc(i.tc(1,1,"order.cancel-order"))}function O(t,e){if(1&t){const t=i.ic();i.hc(0,"input",18),i.pc("ngModelChange",function(e){i.Lc(t);const c=i.rc().$implicit;return i.rc().lineQuantities[c.id]=e}),i.gc()}if(2&t){const t=i.rc().$implicit,e=i.rc();i.yc("ngModel",e.lineQuantities[t.id])("max",t.quantity)}}function Q(t,e){if(1&t&&i.Vc(0),2&t){const t=i.rc().$implicit;i.Wc(t.quantity)}}function I(t,e){if(1&t&&(i.hc(0,"tr",9),i.hc(1,"td",10),i.cc(2,"img",11),i.sc(3,"assetPreview"),i.gc(),i.hc(4,"td",12),i.Vc(5),i.gc(),i.hc(6,"td",13),i.Vc(7),i.gc(),i.hc(8,"td",14),i.Vc(9),i.gc(),i.hc(10,"td",14),i.Vc(11),i.sc(12,"localeCurrency"),i.gc(),i.hc(13,"td",15),i.Tc(14,O,1,2,"input",16),i.Tc(15,Q,1,1,"ng-template",null,17,i.Uc),i.gc(),i.gc()),2&t){const t=e.$implicit,c=i.Ic(16),n=i.rc();i.Tb("is-cancelled",0===t.quantity),i.Qb(2),i.yc("src",i.uc(3,9,t.featuredAsset,"tiny"),i.Nc),i.Qb(3),i.Wc(t.productVariant.name),i.Qb(2),i.Wc(t.productVariant.sku),i.Qb(2),i.Wc(t.quantity),i.Qb(2),i.Xc(" ",i.uc(12,12,t.unitPriceWithTax,n.order.currencyCode)," "),i.Qb(3),i.yc("ngIf",t.quantity>0&&!n.order.active)("ngIfElse",c)}}function T(t,e){1&t&&(i.fc(0),i.Vc(1),i.sc(2,"translate"),i.ec()),2&t&&(i.Qb(1),i.Xc(" ",i.tc(2,1,"order.cancel-selected-items")," "))}function P(t,e){1&t&&(i.fc(0),i.Vc(1),i.sc(2,"translate"),i.ec()),2&t&&(i.Qb(1),i.Xc(" ",i.tc(2,1,"order.cancel-order")," "))}function S(t,e){if(1&t){const t=i.ic();i.hc(0,"button",19),i.pc("click",function(){i.Lc(t);return i.rc().cancel()}),i.Vc(1),i.sc(2,"translate"),i.gc(),i.hc(3,"button",20),i.pc("click",function(){i.Lc(t);return i.rc().select()}),i.Tc(4,T,3,3,"ng-container",21),i.Tc(5,P,3,3,"ng-container",21),i.gc()}if(2&t){const t=i.rc();i.Qb(1),i.Wc(i.tc(2,4,"common.cancel")),i.Qb(2),i.yc("disabled",!t.reason||!t.order.active&&0===t.selectionCount),i.Qb(1),i.yc("ngIf",!t.order.active),i.Qb(1),i.yc("ngIf",t.order.active)}}class M{constructor(t){this.i18nService=t,this.lineQuantities={},this.reasons=[Object(b.a)("order.cancel-reason-customer-request"),Object(b.a)("order.cancel-reason-not-available")],this.reasons=this.reasons.map(t=>this.i18nService.translate(t))}get selectionCount(){return Object.values(this.lineQuantities).reduce((t,e)=>t+e,0)}ngOnInit(){this.lineQuantities=this.order.lines.reduce((t,e)=>Object.assign(Object.assign({},t),{[e.id]:0}),{})}select(){this.resolveWith({orderId:this.order.id,lines:this.getLineInputs(),reason:this.reason})}cancel(){this.resolveWith()}getLineInputs(){if(!this.order.active)return Object.entries(this.lineQuantities).map(([t,e])=>({orderLineId:t,quantity:e})).filter(t=>0<t.quantity)}}M.\u0275fac=function(t){return new(t||M)(i.bc(r.z))},M.\u0275cmp=i.Vb({type:M,selectors:[["vdr-cancel-order-dialog"]],decls:29,vars:22,consts:[["vdrDialogTitle",""],[1,"fulfillment-wrapper"],[1,"order-lines"],[1,"table"],["class","order-line",3,"is-cancelled",4,"ngFor","ngForOf"],[1,"cancellation-details"],[1,"clr-control-label"],["bindLabel","name","autofocus","","bindValue","id",3,"items","addTag","ngModel","ngModelChange"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[1,"align-middle","fulfil"],["type","number","min","0",3,"ngModel","max","ngModelChange",4,"ngIf","ngIfElse"],["nonEditable",""],["type","number","min","0",3,"ngModel","max","ngModelChange"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf"]],template:function(t,e){1&t&&(i.Tc(0,C,2,3,"ng-template",0),i.hc(1,"div",1),i.hc(2,"div",2),i.hc(3,"table",3),i.hc(4,"thead"),i.hc(5,"tr"),i.cc(6,"th"),i.hc(7,"th"),i.Vc(8),i.sc(9,"translate"),i.gc(),i.hc(10,"th"),i.Vc(11),i.sc(12,"translate"),i.gc(),i.hc(13,"th"),i.Vc(14),i.sc(15,"translate"),i.gc(),i.hc(16,"th"),i.Vc(17),i.sc(18,"translate"),i.gc(),i.hc(19,"th"),i.Vc(20),i.sc(21,"translate"),i.gc(),i.gc(),i.gc(),i.Tc(22,I,17,15,"tr",4),i.gc(),i.gc(),i.hc(23,"div",5),i.hc(24,"label",6),i.Vc(25),i.sc(26,"translate"),i.gc(),i.hc(27,"ng-select",7),i.pc("ngModelChange",function(t){return e.reason=t}),i.gc(),i.gc(),i.gc(),i.Tc(28,S,6,6,"ng-template",8)),2&t&&(i.Qb(8),i.Wc(i.tc(9,10,"order.product-name")),i.Qb(3),i.Wc(i.tc(12,12,"order.product-sku")),i.Qb(3),i.Wc(i.tc(15,14,"order.quantity")),i.Qb(3),i.Wc(i.tc(18,16,"order.unit-price")),i.Qb(3),i.Wc(i.tc(21,18,"order.cancel")),i.Qb(2),i.yc("ngForOf",e.order.lines),i.Qb(3),i.Wc(i.tc(26,20,"order.cancellation-reason")),i.Qb(2),i.yc("items",e.reasons)("addTag",!0)("ngModel",e.reason))},directives:[o.a,f.n,y.u,s.a,n.p,n.s,d.a,f.o,l.a,n.v,n.b],pipes:[u.d,v.a,g.a],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}.fulfillment-wrapper[_ngcontent-%COMP%]{flex:1}@media screen and (min-width:768px){.fulfillment-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row}}@media screen and (min-width:768px){.fulfillment-wrapper[_ngcontent-%COMP%]   .cancellation-details[_ngcontent-%COMP%]{margin-top:0;margin-left:24px;width:250px}}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-lines[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-lines[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.fulfillment-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}.fulfillment-wrapper[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}"],changeDetection:0});var V=c("qqSn"),x=c("7xiD");function F(t,e){1&t&&(i.Vc(0),i.sc(1,"translate")),2&t&&i.Wc(i.tc(1,1,"order.fulfill-order"))}function w(t,e){if(1&t&&(i.cc(0,"img",17),i.sc(1,"assetPreview")),2&t){const t=i.rc().$implicit;i.yc("src",i.uc(1,1,t.featuredAsset,"tiny"),i.Nc)}}function _(t,e){if(1&t){const t=i.ic();i.hc(0,"input",18),i.pc("ngModelChange",function(e){i.Lc(t);const c=i.rc().$implicit;return i.rc().fulfillmentQuantities[c.id].fulfillCount=e}),i.gc()}if(2&t){const t=i.rc().$implicit,e=i.rc();i.yc("disabled",0===e.getUnfulfilledCount(t))("ngModel",e.fulfillmentQuantities[t.id].fulfillCount)("max",e.fulfillmentQuantities[t.id].max)}}function k(t,e){if(1&t&&(i.hc(0,"tr",9),i.hc(1,"td",10),i.Tc(2,w,2,4,"img",11),i.gc(),i.hc(3,"td",12),i.Vc(4),i.gc(),i.hc(5,"td",13),i.Vc(6),i.gc(),i.hc(7,"td",14),i.Vc(8),i.gc(),i.hc(9,"td",14),i.Vc(10),i.gc(),i.hc(11,"td",15),i.Tc(12,_,1,3,"input",16),i.gc(),i.gc()),2&t){const t=e.$implicit,c=i.rc();i.Tb("ignore",0===c.getUnfulfilledCount(t)),i.Qb(2),i.yc("ngIf",t.featuredAsset),i.Qb(2),i.Wc(t.productVariant.name),i.Qb(2),i.Wc(t.productVariant.sku),i.Qb(2),i.Wc(c.getUnfulfilledCount(t)),i.Qb(2),i.Wc(t.productVariant.stockOnHand),i.Qb(2),i.yc("ngIf",c.fulfillmentQuantities[t.id])}}function L(t,e){if(1&t){const t=i.ic();i.hc(0,"button",19),i.pc("click",function(){i.Lc(t);return i.rc().cancel()}),i.Vc(1),i.sc(2,"translate"),i.gc(),i.hc(3,"button",20),i.pc("click",function(){i.Lc(t);return i.rc().select()}),i.Vc(4),i.sc(5,"translate"),i.gc()}if(2&t){const t=i.rc();i.Qb(1),i.Wc(i.tc(2,3,"common.cancel")),i.Qb(2),i.yc("disabled",!t.canSubmit()),i.Qb(1),i.Xc(" ",i.tc(5,5,"order.create-fulfillment")," ")}}class A{constructor(t,e){this.dataService=t,this.changeDetector=e,this.fulfillmentHandlerControl=new n.f,this.fulfillmentQuantities={}}ngOnInit(){this.dataService.settings.getGlobalSettings().single$.subscribe(({globalSettings:t})=>{this.fulfillmentQuantities=this.order.lines.reduce((e,c)=>{const n=this.getFulfillableCount(c,t.trackInventory);return Object.assign(Object.assign({},e),{[c.id]:{fulfillCount:n,max:n}})},{}),this.changeDetector.markForCheck()}),this.dataService.shippingMethod.getShippingMethodOperations().mapSingle(t=>t.fulfillmentHandlers).subscribe(t=>{this.fulfillmentHandlerDef=t.find(t=>{var e,c;return t.code===(null===(c=null===(e=this.order.shippingLines[0])||void 0===e?void 0:e.shippingMethod)||void 0===c?void 0:c.fulfillmentHandlerCode)})||t[0],this.fulfillmentHandler=Object(r.M)(this.fulfillmentHandlerDef),this.fulfillmentHandlerControl.patchValue(this.fulfillmentHandler),this.changeDetector.markForCheck()})}getFulfillableCount(t,e){const{trackInventory:c,stockOnHand:n}=t.productVariant,i=c===r.w.INHERIT?e:c===r.w.TRUE,o=this.getUnfulfilledCount(t);return i?Math.min(o,n):o}getUnfulfilledCount(t){const e=t.items.reduce((t,e)=>t+(e.fulfillment?1:0),0);return t.quantity-e}canSubmit(){const t=Object.values(this.fulfillmentQuantities).reduce((t,{fulfillCount:e})=>t+e,0);return Object(r.N)(this.fulfillmentHandlerDef,this.fulfillmentHandlerControl.value)&&this.fulfillmentHandlerControl.valid&&0<t}select(){const t=Object.entries(this.fulfillmentQuantities).map(([t,{fulfillCount:e}])=>({orderLineId:t,quantity:e}));this.resolveWith({lines:t,handler:Object(r.Z)(this.fulfillmentHandler,this.fulfillmentHandlerControl.value)})}cancel(){this.resolveWith()}}A.\u0275fac=function(t){return new(t||A)(i.bc(r.s),i.bc(i.j))},A.\u0275cmp=i.Vb({type:A,selectors:[["vdr-fulfill-order-dialog"]],decls:34,vars:29,consts:[["vdrDialogTitle",""],[1,"fulfillment-wrapper"],[1,"order-table"],[1,"table"],["class","order-line",3,"ignore",4,"ngFor","ngForOf"],[1,"shipping-details"],[3,"address"],[3,"operationDefinition","operation","formControl","removable"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[1,"align-middle","fulfil"],["type","number","min","0",3,"disabled","ngModel","max","ngModelChange",4,"ngIf"],[3,"src"],["type","number","min","0",3,"disabled","ngModel","max","ngModelChange"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(t,e){1&t&&(i.Tc(0,F,2,3,"ng-template",0),i.hc(1,"div",1),i.hc(2,"div",2),i.hc(3,"table",3),i.hc(4,"thead"),i.hc(5,"tr"),i.cc(6,"th"),i.hc(7,"th"),i.Vc(8),i.sc(9,"translate"),i.gc(),i.hc(10,"th"),i.Vc(11),i.sc(12,"translate"),i.gc(),i.hc(13,"th"),i.Vc(14),i.sc(15,"translate"),i.gc(),i.hc(16,"th"),i.Vc(17),i.sc(18,"translate"),i.gc(),i.hc(19,"th"),i.Vc(20),i.sc(21,"translate"),i.gc(),i.gc(),i.gc(),i.Tc(22,k,13,8,"tr",4),i.gc(),i.gc(),i.hc(23,"div",5),i.cc(24,"vdr-formatted-address",6),i.hc(25,"h6"),i.Vc(26),i.sc(27,"translate"),i.gc(),i.Vc(28),i.hc(29,"strong"),i.Vc(30),i.sc(31,"localeCurrency"),i.gc(),i.cc(32,"vdr-configurable-input",7),i.gc(),i.gc(),i.Tc(33,L,6,7,"ng-template",8)),2&t&&(i.Qb(8),i.Wc(i.tc(9,14,"order.product-name")),i.Qb(3),i.Wc(i.tc(12,16,"order.product-sku")),i.Qb(3),i.Wc(i.tc(15,18,"order.unfulfilled")),i.Qb(3),i.Wc(i.tc(18,20,"catalog.stock-on-hand")),i.Qb(3),i.Wc(i.tc(21,22,"order.fulfill")),i.Qb(2),i.yc("ngForOf",e.order.lines),i.Qb(2),i.yc("address",e.order.shippingAddress),i.Qb(2),i.Wc(i.tc(27,24,"order.shipping-method")),i.Qb(2),i.Xc(" ",null==e.order.shippingLines[0]||null==e.order.shippingLines[0].shippingMethod?null:e.order.shippingLines[0].shippingMethod.name," "),i.Qb(2),i.Wc(i.uc(31,26,e.order.shipping,e.order.currencyCode)),i.Qb(2),i.yc("operationDefinition",e.fulfillmentHandlerDef)("operation",e.fulfillmentHandler)("formControl",e.fulfillmentHandlerControl)("removable",!1))},directives:[o.a,f.n,V.a,x.a,n.p,n.g,d.a,f.o,l.a,n.v,n.b,n.s],pipes:[u.d,g.a,v.a],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}.fulfillment-wrapper[_ngcontent-%COMP%]{flex:1}@media screen and (min-width:768px){.fulfillment-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row}}.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]{margin-top:24px}@media screen and (min-width:768px){.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]{margin-top:0;margin-left:24px;width:250px}}.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]   clr-input-container[_ngcontent-%COMP%]{margin-top:24px}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.fulfillment-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}"],changeDetection:0});var D=c("2/wi"),j=c("ocEb");function W(t,e){1&t&&i.cc(0,"clr-icon",2)}class N{get chipColorType(){switch(this.state){case"Pending":case"Shipped":return"warning";case"Delivered":return"success";case"Cancelled":return"error"}}}N.\u0275fac=function(t){return new(t||N)},N.\u0275cmp=i.Vb({type:N,selectors:[["vdr-fulfillment-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(t,e){1&t&&(i.hc(0,"vdr-chip",0),i.sc(1,"translate"),i.Tc(2,W,1,0,"clr-icon",1),i.Vc(3),i.sc(4,"translate"),i.sc(5,"stateI18nToken"),i.gc()),2&t&&(i.yc("title",i.tc(1,4,"order.payment-state"))("colorType",e.chipColorType),i.Qb(2),i.yc("ngIf","Delivered"===e.state),i.Qb(1),i.Xc(" ",i.tc(4,6,i.tc(5,8,e.state)),"\n"))},directives:[D.a,f.o,y.o],pipes:[u.d,j.a],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0});var R=c("cOim"),E=c("0MpJ");function X(t,e){if(1&t&&(i.hc(0,"li",2),i.hc(1,"div",3),i.Vc(2),i.gc(),i.cc(3,"clr-icon",4),i.Vc(4),i.gc()),2&t){const t=e.$implicit;i.yc("title",t.name),i.Qb(2),i.Wc(t.quantity),i.Qb(2),i.Xc(" ",t.name," ")}}class ${}$.\u0275fac=function(t){return new(t||$)},$.\u0275cmp=i.Vb({type:$,selectors:[["vdr-simple-item-list"]],inputs:{items:"items"},decls:3,vars:1,consts:[[1,"items-list"],[3,"title",4,"ngFor","ngForOf"],[3,"title"],[1,"quantity"],["shape","times","size","12"]],template:function(t,e){1&t&&(i.hc(0,"div",0),i.hc(1,"ul"),i.Tc(2,X,5,3,"li",1),i.gc(),i.gc()),2&t&&(i.Qb(2),i.yc("ngForOf",e.items))},directives:[f.n,y.o],styles:[".items-list[_ngcontent-%COMP%]{font-size:12px}.items-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin-top:6px;list-style-type:none;margin-left:2px}.items-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{line-height:14px;text-overflow:ellipsis;overflow:hidden}.items-list[_ngcontent-%COMP%]   .quantity[_ngcontent-%COMP%]{min-width:16px;display:inline-block}"],changeDetection:0});var q=c("2zLM"),H=c("HMPB");function U(t,e){if(1&t&&(i.hc(0,"vdr-labeled-data",0),i.sc(1,"translate"),i.Vc(2),i.gc()),2&t){const t=i.rc();i.yc("label",i.tc(1,2,"order.tracking-code")),i.Qb(2),i.Xc(" ",null==t.fulfillment?null:t.fulfillment.trackingCode,"\n")}}const z=function(t){return{object:t}};function B(t,e){if(1&t&&i.cc(0,"vdr-object-tree",6),2&t){const t=i.rc().$implicit;i.yc("value",i.Cc(1,z,t.value))}}function G(t,e){if(1&t&&i.Vc(0),2&t){const t=i.rc().$implicit;i.Xc(" ",t.value," ")}}function Y(t,e){if(1&t&&(i.fc(0),i.hc(1,"vdr-labeled-data",0),i.Tc(2,B,1,3,"vdr-object-tree",4),i.Tc(3,G,1,1,"ng-template",null,5,i.Uc),i.gc(),i.ec()),2&t){const t=e.$implicit,c=i.Ic(4),n=i.rc();i.Qb(1),i.yc("label",t.key),i.Qb(1),i.yc("ngIf",n.customFieldIsObject(t.value))("ngIfElse",c)}}class Z{constructor(){this.customFields=[]}ngOnChanges(t){this.customFields=this.getCustomFields()}get fulfillment(){return this.order.fulfillments&&this.order.fulfillments.find(t=>t.id===this.fulfillmentId)}get items(){var t;const e=new Map,c=null===(t=this.fulfillment)||void 0===t?void 0:t.orderItems.map(t=>t.id);for(const n of this.order.lines)for(const t of n.items)if(null==c?void 0:c.includes(t.id)){const t=e.get(n.productVariant.name);null!=t?e.set(n.productVariant.name,t+1):e.set(n.productVariant.name,1)}return Array.from(e.entries()).map(([t,e])=>({name:t,quantity:e}))}getCustomFields(){const t=this.fulfillment.customFields;return t?Object.entries(t).filter(([t])=>"__typename"!==t).map(([t,e])=>({key:t,value:Array.isArray(e)||Object(R.isObject)(e)?e:e.toString()})):[]}customFieldIsObject(t){return Array.isArray(t)||Object(R.isObject)(t)}}Z.\u0275fac=function(t){return new(t||Z)},Z.\u0275cmp=i.Vb({type:Z,selectors:[["vdr-fulfillment-detail"]],inputs:{fulfillmentId:"fulfillmentId",order:"order"},features:[i.Ob],decls:12,vars:17,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"items"],[4,"ngFor","ngForOf"],[3,"value",4,"ngIf","ngIfElse"],["primitive",""],[3,"value"]],template:function(t,e){1&t&&(i.hc(0,"vdr-labeled-data",0),i.sc(1,"translate"),i.Vc(2),i.sc(3,"localeDate"),i.gc(),i.hc(4,"vdr-labeled-data",0),i.sc(5,"translate"),i.Vc(6),i.gc(),i.Tc(7,U,3,4,"vdr-labeled-data",1),i.hc(8,"vdr-labeled-data",0),i.sc(9,"translate"),i.cc(10,"vdr-simple-item-list",2),i.gc(),i.Tc(11,Y,5,3,"ng-container",3)),2&t&&(i.yc("label",i.tc(1,8,"common.created-at")),i.Qb(2),i.Xc(" ",i.uc(3,10,null==e.fulfillment?null:e.fulfillment.createdAt,"medium"),"\n"),i.Qb(2),i.yc("label",i.tc(5,13,"order.fulfillment-method")),i.Qb(2),i.Xc(" ",null==e.fulfillment?null:e.fulfillment.method,"\n"),i.Qb(1),i.yc("ngIf",null==e.fulfillment?null:e.fulfillment.trackingCode),i.Qb(1),i.yc("label",i.tc(9,15,"order.contents")),i.Qb(2),i.yc("items",e.items),i.Qb(1),i.yc("ngForOf",e.customFields))},directives:[E.a,f.o,$,f.n,q.a],pipes:[u.d,H.a],styles:[""],changeDetection:0});var J=c("zzDm"),K=c("eBFp"),tt=c("IKcI"),et=c("EFLa");function ct(t,e){if(1&t&&i.cc(0,"vdr-fulfillment-detail",7),2&t){const t=i.rc();i.yc("fulfillmentId",null==t.fulfillment?null:t.fulfillment.id)("order",t.order)}}const nt=function(t){return{state:t}};function rt(t,e){if(1&t){const t=i.ic();i.fc(0),i.hc(1,"button",14),i.pc("click",function(){i.Lc(t);const c=e.ngIf;return i.rc(2).transitionState.emit(c)}),i.Vc(2),i.sc(3,"translate"),i.sc(4,"translate"),i.sc(5,"stateI18nToken"),i.gc(),i.ec()}if(2&t){const t=e.ngIf;i.Qb(2),i.Xc(" ",i.uc(3,1,"order.set-fulfillment-state",i.Cc(8,nt,i.tc(4,4,i.tc(5,6,t))))," ")}}function it(t,e){if(1&t&&(i.fc(0),i.cc(1,"clr-icon",18),i.Vc(2),i.sc(3,"translate"),i.sc(4,"translate"),i.sc(5,"stateI18nToken"),i.ec()),2&t){const t=i.rc().$implicit;i.Qb(2),i.Xc(" ",i.uc(3,1,"order.transition-to-state",i.Cc(8,nt,i.tc(4,4,i.tc(5,6,t))))," ")}}function ot(t,e){1&t&&(i.cc(0,"clr-icon",19),i.Vc(1),i.sc(2,"translate")),2&t&&(i.Qb(1),i.Xc(" ",i.tc(2,1,"order.cancel-fulfillment")," "))}function at(t,e){if(1&t){const t=i.ic();i.fc(0),i.hc(1,"button",15),i.pc("click",function(){i.Lc(t);const c=e.$implicit;return i.rc(2).transitionState.emit(c)}),i.Tc(2,it,6,10,"ng-container",16),i.Tc(3,ot,3,3,"ng-template",null,17,i.Uc),i.gc(),i.ec()}if(2&t){const t=e.$implicit,c=i.Ic(4);i.Qb(2),i.yc("ngIf","Cancelled"!==t)("ngIfElse",c)}}function st(t,e){if(1&t&&(i.hc(0,"div",8),i.Tc(1,rt,6,10,"ng-container",9),i.hc(2,"vdr-dropdown"),i.hc(3,"button",10),i.cc(4,"clr-icon",11),i.gc(),i.hc(5,"vdr-dropdown-menu",12),i.Tc(6,at,5,2,"ng-container",13),i.gc(),i.gc(),i.gc()),2&t){const t=i.rc();i.Qb(1),i.yc("ngIf",t.nextSuggestedState()),i.Qb(5),i.yc("ngForOf",t.nextOtherStates())}}class lt{constructor(){this.transitionState=new i.t}nextSuggestedState(){var t;if(!this.fulfillment)return;const{nextStates:e}=this.fulfillment,c=t=>e.includes(t)?t:e[0];switch(null===(t=this.fulfillment)||void 0===t?void 0:t.state){case"Pending":return c("Shipped");case"Shipped":return c("Delivered");default:return e.find(t=>"Cancelled"!==t)}}nextOtherStates(){if(!this.fulfillment)return[];const t=this.nextSuggestedState();return this.fulfillment.nextStates.filter(e=>e!==t)}}function dt(t,e){1&t&&i.cc(0,"clr-icon",9)}function ut(t,e){1&t&&i.cc(0,"clr-icon",10)}function ft(t,e){1&t&&i.cc(0,"clr-icon",11)}function gt(t,e){1&t&&(i.hc(0,"label",12),i.Vc(1),i.sc(2,"translate"),i.gc()),2&t&&(i.Qb(1),i.Xc(" ",i.tc(2,1,"order.line-fulfillment-all")," "))}lt.\u0275fac=function(t){return new(t||lt)},lt.\u0275cmp=i.Vb({type:lt,selectors:[["vdr-fulfillment-card"]],inputs:{fulfillment:"fulfillment",order:"order"},outputs:{transitionState:"transitionState"},decls:10,vars:6,consts:[[1,"card"],[1,"card-header","fulfillment-header"],[1,"fulfillment-state"],[3,"state"],[1,"card-block"],[3,"fulfillmentId","order",4,"ngIf"],["class","card-footer",4,"ngIf"],[3,"fulfillmentId","order"],[1,"card-footer"],[4,"ngIf"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm","btn-primary",3,"click"],["type","button","vdrDropdownItem","",1,"btn",3,"click"],[4,"ngIf","ngIfElse"],["cancel",""],["shape","step-forward-2"],["shape","error-standard",1,"is-error"]],template:function(t,e){1&t&&(i.hc(0,"div",0),i.hc(1,"div",1),i.hc(2,"div"),i.Vc(3),i.sc(4,"translate"),i.gc(),i.hc(5,"div",2),i.cc(6,"vdr-fulfillment-state-label",3),i.gc(),i.gc(),i.hc(7,"div",4),i.Tc(8,ct,1,2,"vdr-fulfillment-detail",5),i.gc(),i.Tc(9,st,7,2,"div",6),i.gc()),2&t&&(i.Qb(3),i.Wc(i.tc(4,4,"order.fulfillment")),i.Qb(3),i.yc("state",null==e.fulfillment?null:e.fulfillment.state),i.Qb(2),i.yc("ngIf",!!e.fulfillment),i.Qb(1),i.yc("ngIf",null==e.fulfillment?null:e.fulfillment.nextStates.length))},directives:[N,f.o,Z,J.a,K.a,y.o,tt.a,f.n,et.a],pipes:[u.d,j.a],styles:[".fulfillment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}"],changeDetection:0});const mt=function(t,e){return{total:t,count:e}};function pt(t,e){if(1&t&&(i.hc(0,"label",12),i.Vc(1),i.sc(2,"translate"),i.gc()),2&t){const t=i.rc(2);i.Qb(1),i.Xc(" ",i.uc(2,1,"order.line-fulfillment-partial",i.Dc(4,mt,t.line.quantity,t.fulfilledCount))," ")}}function ht(t,e){1&t&&(i.hc(0,"label",12),i.Vc(1),i.sc(2,"translate"),i.gc()),2&t&&(i.Qb(1),i.Xc(" ",i.tc(2,1,"order.line-fulfillment-none")," "))}function bt(t,e){if(1&t&&(i.hc(0,"vdr-labeled-data",15),i.sc(1,"translate"),i.Vc(2),i.gc()),2&t){const t=i.rc().$implicit;i.yc("label",i.tc(1,2,"order.tracking-code")),i.Qb(2),i.Xc(" ",t.fulfillment.trackingCode," ")}}const yt=function(t){return{count:t}};function vt(t,e){if(1&t&&(i.hc(0,"div",13),i.hc(1,"div",14),i.Vc(2),i.sc(3,"translate"),i.sc(4,"translate"),i.gc(),i.hc(5,"vdr-labeled-data",15),i.sc(6,"translate"),i.Vc(7),i.sc(8,"localeDate"),i.gc(),i.hc(9,"vdr-labeled-data",15),i.sc(10,"translate"),i.Vc(11),i.gc(),i.Tc(12,bt,3,4,"vdr-labeled-data",16),i.gc()),2&t){const t=e.$implicit;i.Qb(2),i.Zc(" ",i.tc(3,8,"order.fulfillment")," #",t.fulfillment.id," (",i.uc(4,10,"order.item-count",i.Cc(20,yt,t.count)),") "),i.Qb(3),i.yc("label",i.tc(6,13,"common.created-at")),i.Qb(2),i.Xc(" ",i.uc(8,15,t.fulfillment.createdAt,"medium")," "),i.Qb(2),i.yc("label",i.tc(10,18,"order.fulfillment-method")),i.Qb(2),i.Xc(" ",t.fulfillment.method," "),i.Qb(1),i.yc("ngIf",t.fulfillment.trackingCode)}}function Ct(t,e){if(1&t&&(i.hc(0,"vdr-dropdown",1),i.hc(1,"button",2),i.Tc(2,dt,1,0,"clr-icon",3),i.Tc(3,ut,1,0,"clr-icon",4),i.Tc(4,ft,1,0,"clr-icon",5),i.gc(),i.hc(5,"vdr-dropdown-menu",6),i.Tc(6,gt,3,3,"label",7),i.Tc(7,pt,3,7,"label",7),i.Tc(8,ht,3,3,"label",7),i.Tc(9,vt,13,22,"div",8),i.gc(),i.gc()),2&t){const t=i.rc();i.Qb(2),i.yc("ngIf","full"===t.fulfillmentStatus),i.Qb(1),i.yc("ngIf","partial"===t.fulfillmentStatus),i.Qb(1),i.yc("ngIf","none"===t.fulfillmentStatus),i.Qb(2),i.yc("ngIf","full"===t.fulfillmentStatus),i.Qb(1),i.yc("ngIf","partial"===t.fulfillmentStatus),i.Qb(1),i.yc("ngIf","none"===t.fulfillmentStatus),i.Qb(1),i.yc("ngForOf",t.fulfillments)}}class Ot{constructor(){this.fulfilledCount=0,this.fulfillments=[]}ngOnChanges(t){this.line&&(this.fulfilledCount=this.getDeliveredCount(this.line),this.fulfillmentStatus=this.getFulfillmentStatus(this.fulfilledCount,this.line.items.length),this.fulfillments=this.getFulfillments(this.line))}getDeliveredCount(t){return t.items.reduce((t,e)=>t+(e.fulfillment?1:0),0)}getFulfillmentStatus(t,e){return t===e?"full":0<t&&t<e?"partial":"none"}getFulfillments(t){const e={};for(const n of t.items)n.fulfillment&&(void 0===e[n.fulfillment.id]?e[n.fulfillment.id]=1:e[n.fulfillment.id]++);const c=t.items.reduce((t,e)=>e.fulfillment?[...t,e.fulfillment]:t,[]);return Object.entries(e).map(([t,e])=>({count:e,fulfillment:c.find(e=>e.id===t)}))}}Ot.\u0275fac=function(t){return new(t||Ot)},Ot.\u0275cmp=i.Vb({type:Ot,selectors:[["vdr-line-fulfillment"]],inputs:{line:"line",orderState:"orderState"},features:[i.Ob],decls:1,vars:1,consts:[["class","search-settings-menu",4,"ngIf"],[1,"search-settings-menu"],["type","button","vdrDropdownTrigger","",1,"icon-button"],["class","item-fulfilled","shape","check-circle",4,"ngIf"],["class","item-partially-fulfilled","shape","check-circle",4,"ngIf"],["class","item-not-fulfilled","shape","exclamation-circle",4,"ngIf"],["vdrPosition","bottom-right"],["class","dropdown-header",4,"ngIf"],["class","fulfillment-detail",4,"ngFor","ngForOf"],["shape","check-circle",1,"item-fulfilled"],["shape","check-circle",1,"item-partially-fulfilled"],["shape","exclamation-circle",1,"item-not-fulfilled"],[1,"dropdown-header"],[1,"fulfillment-detail"],[1,"fulfillment-title"],[3,"label"],[3,"label",4,"ngIf"]],template:function(t,e){1&t&&i.Tc(0,Ct,10,7,"vdr-dropdown",0),2&t&&i.yc("ngIf",e.fulfilledCount||"PartiallyDelivered"===e.orderState)},directives:[f.o,J.a,K.a,tt.a,f.n,y.o,y.u,E.a],pipes:[u.d,H.a],styles:[".item-fulfilled[_ngcontent-%COMP%]{color:var(--color-success-500)}.item-partially-fulfilled[_ngcontent-%COMP%]{color:var(--color-warning-500)}.item-not-fulfilled[_ngcontent-%COMP%]{color:var(--color-error-500)}.fulfillment-detail[_ngcontent-%COMP%]{margin:6px 12px}.fulfillment-detail[_ngcontent-%COMP%]:not(:last-of-type){border-bottom:1px dashed var(--color-component-border-200)}"],changeDetection:0});var Qt=c("cH1L");const It=function(t){return{count:t}};function Tt(t,e){if(1&t&&(i.hc(0,"span",1),i.sc(1,"translate"),i.cc(2,"clr-icon",2),i.gc()),2&t){const t=i.rc();i.yc("title",i.uc(1,1,"order.refunded-count",i.Cc(4,It,t.getRefundedCount())))}}class Pt{getRefundedCount(){var t,e;const c=null!==(e=null===(t=this.payments)||void 0===t?void 0:t.reduce((t,e)=>[...t,...e.refunds],[]))&&void 0!==e?e:[];return this.line.items.filter(t=>{if(null===t.refundId&&!t.cancelled)return!1;if(t.refundId){const e=c.find(e=>e.id===t.refundId);return"Failed"!==(null==e?void 0:e.state)}return!1}).length}}function St(t,e){if(1&t&&(i.hc(0,"vdr-labeled-data",0),i.sc(1,"translate"),i.Vc(2),i.gc()),2&t){const t=i.rc();i.yc("label",i.tc(1,2,"order.note")),i.Qb(2),i.Wc(t.modification.note)}}function Mt(t,e){if(1&t&&(i.hc(0,"vdr-labeled-data",0),i.sc(1,"translate"),i.Vc(2),i.sc(3,"localeCurrency"),i.gc()),2&t){const t=e.$implicit,c=i.rc();let n=null;i.yc("label",i.tc(1,3,"order.surcharges")),i.Qb(2),i.Yc(" ",null==(n=c.getSurcharge(t.id))?null:n.description," ",i.uc(3,5,null==(n=c.getSurcharge(t.id))?null:n.priceWithTax,c.order.currencyCode),"")}}function Vt(t,e){if(1&t&&(i.hc(0,"vdr-labeled-data",0),i.sc(1,"translate"),i.cc(2,"vdr-simple-item-list",3),i.gc()),2&t){const t=i.rc();i.yc("label",i.tc(1,2,"order.added-items")),i.Qb(2),i.yc("items",t.getAddedItems())}}function xt(t,e){if(1&t&&(i.hc(0,"vdr-labeled-data",0),i.sc(1,"translate"),i.cc(2,"vdr-simple-item-list",3),i.gc()),2&t){const t=i.rc();i.yc("label",i.tc(1,2,"order.removed-items")),i.Qb(2),i.yc("items",t.getRemovedItems())}}Pt.\u0275fac=function(t){return new(t||Pt)},Pt.\u0275cmp=i.Vb({type:Pt,selectors:[["vdr-line-refunds"]],inputs:{line:"line",payments:"payments"},decls:1,vars:1,consts:[[3,"title",4,"ngIf"],[3,"title"],["shape","redo","dir","down",1,"is-solid"]],template:function(t,e){1&t&&i.Tc(0,Tt,3,6,"span",0),2&t&&i.yc("ngIf",e.getRefundedCount())},directives:[f.o,y.o,Qt.b],pipes:[u.d],styles:["[_nghost-%COMP%]{color:var(--color-error-500)}"],changeDetection:0});class Ft{constructor(){this.addedItems=new Map,this.removedItems=new Map}ngOnChanges(){const{added:t,removed:e}=this.getModifiedLines();this.addedItems=t,this.removedItems=e}getSurcharge(t){return this.order.surcharges.find(e=>e.id===t)}getAddedItems(){return[...this.addedItems.entries()].map(([t,e])=>({name:t.productVariant.name,quantity:e}))}getRemovedItems(){return[...this.removedItems.entries()].map(([t,e])=>({name:t.productVariant.name,quantity:e}))}getModifiedLines(){var t,e;const c=new Map,n=new Map;for(const r of this.modification.orderItems||[]){const i=this.getOrderLineAndItem(r.id);if(i){const{line:r,item:o}=i;if(o.cancelled){const e=null!==(t=n.get(r))&&void 0!==t?t:0;n.set(r,e+1)}else{const t=null!==(e=c.get(r))&&void 0!==e?e:0;c.set(r,t+1)}}}return{added:c,removed:n}}getOrderLineAndItem(t){for(const e of this.order.lines){const c=e.items.find(e=>e.id===t);if(c)return{line:e,item:c}}}}Ft.\u0275fac=function(t){return new(t||Ft)},Ft.\u0275cmp=i.Vb({type:Ft,selectors:[["vdr-modification-detail"]],inputs:{order:"order",modification:"modification"},features:[i.Ob],decls:7,vars:8,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"label",4,"ngFor","ngForOf"],[3,"items"]],template:function(t,e){1&t&&(i.hc(0,"vdr-labeled-data",0),i.sc(1,"translate"),i.Vc(2),i.gc(),i.Tc(3,St,3,4,"vdr-labeled-data",1),i.Tc(4,Mt,4,8,"vdr-labeled-data",2),i.Tc(5,Vt,3,4,"vdr-labeled-data",1),i.Tc(6,xt,3,4,"vdr-labeled-data",1)),2&t&&(i.yc("label",i.tc(1,6,"common.ID")),i.Qb(2),i.Wc(e.modification.id),i.Qb(1),i.yc("ngIf",e.modification.note),i.Qb(1),i.yc("ngForOf",e.modification.surcharges),i.Qb(1),i.yc("ngIf",e.getAddedItems().length),i.Qb(1),i.yc("ngIf",e.getRemovedItems().length))},directives:[E.a,f.o,f.n,$],pipes:[u.d,g.a],styles:[""],changeDetection:0});var wt=c("Lbhx");function _t(t,e){if(1&t&&(i.fc(0),i.cc(1,"vdr-custom-field-control",9),i.ec()),2&t){const t=e.$implicit,c=i.rc(2);i.Qb(1),i.yc("customFieldsFormGroup",c.customFieldForm)("compact",!0)("readonly",t.readonly||!c.editable)("customField",t)}}function kt(t,e){if(1&t){const t=i.ic();i.hc(0,"button",10),i.pc("click",function(){i.Lc(t);return i.rc(2).editable=!0}),i.cc(1,"clr-icon",11),i.Vc(2),i.sc(3,"translate"),i.gc()}2&t&&(i.Qb(2),i.Xc(" ",i.tc(3,1,"common.edit")," "))}function Lt(t,e){if(1&t){const t=i.ic();i.hc(0,"button",12),i.pc("click",function(){i.Lc(t);return i.rc(2).onUpdateClick()}),i.cc(1,"clr-icon",13),i.Vc(2),i.sc(3,"translate"),i.gc()}if(2&t){const t=i.rc(2);i.yc("disabled",t.customFieldForm.pristine||t.customFieldForm.invalid),i.Qb(2),i.Xc(" ",i.tc(3,2,"common.update")," ")}}function At(t,e){if(1&t&&(i.hc(0,"div",1),i.hc(1,"div",2),i.Vc(2),i.sc(3,"translate"),i.gc(),i.hc(4,"div",3),i.hc(5,"div",4),i.Tc(6,_t,2,4,"ng-container",5),i.gc(),i.gc(),i.hc(7,"div",6),i.Tc(8,kt,4,3,"button",7),i.Tc(9,Lt,4,4,"button",8),i.gc(),i.gc()),2&t){const t=i.rc();i.Qb(2),i.Xc(" ",i.tc(3,6,"common.custom-fields")," "),i.Qb(3),i.Tb("editable",t.editable),i.Qb(1),i.yc("ngForOf",t.customFieldsConfig),i.Qb(2),i.yc("ngIf",!t.editable),i.Qb(1),i.yc("ngIf",t.editable)}}class Dt{constructor(t){this.formBuilder=t,this.customFieldsConfig=[],this.customFieldValues={},this.updateClick=new i.t,this.editable=!1}ngOnInit(){this.customFieldForm=this.formBuilder.group({});for(const t of this.customFieldsConfig)this.customFieldForm.addControl(t.name,this.formBuilder.control(this.customFieldValues[t.name]))}onUpdateClick(){this.updateClick.emit(this.customFieldForm.value),this.customFieldForm.markAsPristine(),this.editable=!1}}Dt.\u0275fac=function(t){return new(t||Dt)(i.bc(n.e))},Dt.\u0275cmp=i.Vb({type:Dt,selectors:[["vdr-order-custom-fields-card"]],inputs:{customFieldsConfig:"customFieldsConfig",customFieldValues:"customFieldValues"},outputs:{updateClick:"updateClick"},decls:1,vars:1,consts:[["class","card",4,"ngIf"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"card-text","custom-field-form"],[4,"ngFor","ngForOf"],[1,"card-footer"],["class","btn btn-sm btn-secondary",3,"click",4,"ngIf"],["class","btn btn-sm btn-primary",3,"disabled","click",4,"ngIf"],["entityName","Order",3,"customFieldsFormGroup","compact","readonly","customField"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","pencil"],[1,"btn","btn-sm","btn-primary",3,"disabled","click"],["shape","check"]],template:function(t,e){1&t&&i.Tc(0,At,10,8,"div",0),2&t&&i.yc("ngIf",e.customFieldsConfig.length)},directives:[f.o,f.n,wt.a,y.o],pipes:[u.d],styles:["vdr-custom-field-control[_ngcontent-%COMP%]{margin-bottom:6px;display:block}.custom-field-form[_ngcontent-%COMP%]     .clr-control-label{color:var(--color-grey-400)}.custom-field-form.editable[_ngcontent-%COMP%]     .clr-control-label{color:inherit}"],changeDetection:0});var jt=c("78Ut"),Wt=c("XNiG"),Nt=c("EY2u"),Rt=c("LRne"),Et=c("VRyK"),Xt=c("IzEk"),$t=c("JX91"),qt=c("eIep"),Ht=c("lJxs"),Ut=c("CqXF"),zt=c("JIr8"),Bt=c("zx2A");class Gt{constructor(t,e){this.notifier=t,this.source=e}call(t,e){return e.subscribe(new Yt(t,this.notifier,this.source))}}class Yt extends Bt.b{constructor(t,e,c){super(t),this.notifier=e,this.source=c}error(t){if(!this.isStopped){let c=this.errors,n=this.retries,r=this.retriesSubscription;if(n)this.errors=void 0,this.retriesSubscription=void 0;else{c=new Wt.a;try{const{notifier:t}=this;n=t(c)}catch(e){return super.error(e)}r=Object(Bt.c)(n,new Bt.a(this))}this._unsubscribeAndRecycle(),this.errors=c,this.retries=n,this.retriesSubscription=r,c.next(t)}}_unsubscribe(){const{errors:t,retriesSubscription:e}=this;t&&(t.unsubscribe(),this.errors=void 0),e&&(e.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0}notifyNext(){const{_unsubscribe:t}=this;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=t,this.source.subscribe(this)}}var Zt=c("3E0/");function Jt(t,e){1&t&&(i.Vc(0),i.sc(1,"translate")),2&t&&i.Wc(i.tc(1,1,"order.select-state"))}function Kt(t,e){if(1&t&&(i.hc(0,"option",4),i.Vc(1),i.sc(2,"translate"),i.sc(3,"stateI18nToken"),i.gc()),2&t){const t=e.$implicit;i.yc("value",t),i.Qb(1),i.Xc(" ",i.tc(2,2,i.tc(3,4,t))," ")}}function te(t,e){if(1&t){const t=i.ic();i.hc(0,"button",7),i.pc("click",function(){i.Lc(t);return i.rc(2).cancel()}),i.Vc(1),i.sc(2,"translate"),i.gc()}2&t&&(i.Qb(1),i.Xc(" ",i.tc(2,1,"common.cancel")," "))}const ee=function(t){return{state:t}};function ce(t,e){if(1&t){const t=i.ic();i.Tc(0,te,3,3,"button",5),i.hc(1,"button",6),i.pc("click",function(){i.Lc(t);return i.rc().select()}),i.Vc(2),i.sc(3,"translate"),i.sc(4,"translate"),i.sc(5,"stateI18nToken"),i.gc()}if(2&t){const t=i.rc();i.yc("ngIf",t.cancellable),i.Qb(1),i.yc("disabled",!t.selectedState),i.Qb(1),i.Xc(" ",i.uc(3,3,"order.transition-to-state",i.Cc(10,ee,i.tc(4,6,i.tc(5,8,t.selectedState))))," ")}}class ne{constructor(){this.nextStates=[],this.message="",this.selectedState=""}select(){this.selectedState&&this.resolveWith(this.selectedState)}cancel(){this.resolveWith()}}ne.\u0275fac=function(t){return new(t||ne)},ne.\u0275cmp=i.Vb({type:ne,selectors:[["vdr-order-state-select-dialog"]],decls:8,vars:5,consts:[["vdrDialogTitle",""],["clrSelect","","name","state",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["vdrDialogButtons",""],[3,"value"],["type","submit","class","btn btn-secondary",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],["type","submit",1,"btn","btn-secondary",3,"click"]],template:function(t,e){1&t&&(i.Tc(0,Jt,2,3,"ng-template",0),i.hc(1,"p"),i.Vc(2),i.sc(3,"translate"),i.gc(),i.hc(4,"clr-select-container"),i.hc(5,"select",1),i.pc("ngModelChange",function(t){return e.selectedState=t}),i.Tc(6,Kt,4,6,"option",2),i.gc(),i.gc(),i.Tc(7,ce,6,12,"ng-template",3)),2&t&&(i.Qb(2),i.Wc(i.tc(3,3,e.message)),i.Qb(3),i.yc("ngModel",e.selectedState),i.Qb(1),i.yc("ngForOf",e.nextStates))},directives:[o.a,y.B,l.a,n.A,y.A,n.p,n.s,f.n,d.a,n.u,n.D,f.o],pipes:[u.d,j.a],styles:[""],changeDetection:0});class re{constructor(t,e,c,n){this.dataService=t,this.modalService=e,this.notificationService=c,this.i18nService=n}transitionToPreModifyingState(t,e){return this.getPreModifyingState(t).pipe(Object(qt.a)(c=>{const n={orderId:t,nextStates:e,message:this.i18nService.translate(Object(b.a)("order.unable-to-transition-to-state-try-another"),{state:c}),cancellable:!1,retry:10};return c?this.transitionToStateOrThrow(t,c).pipe(Object(zt.a)(t=>this.manuallyTransitionToState(n))):this.manuallyTransitionToState(n)}))}manuallyTransitionToState(t){return this.modalService.fromComponent(ne,{locals:{nextStates:t.nextStates,cancellable:t.cancellable,message:t.message},closable:!1,size:"md"}).pipe(Object(qt.a)(e=>{if(e)return this.transitionToStateOrThrow(t.orderId,e);if(t.cancellable)return Nt.a;throw new Error("An order state must be selected")}),(e=e=>e.pipe(Object(Zt.a)(2e3),Object(Xt.a)(t.retry)),t=>t.lift(new Gt(e,t))));var e}getPreModifyingState(t){return this.dataService.order.getOrderHistory(t,{filter:{type:{eq:r.y.ORDER_STATE_TRANSITION}},sort:{createdAt:r.L.DESC}}).mapSingle(t=>t.order).pipe(Object(Ht.a)(t=>{const e=null==t?void 0:t.history.items.find(t=>"Modifying"===t.data.to);return e?e.data.from:void 0}))}transitionToStateOrThrow(t,e){return this.dataService.order.transitionToState(t,e).pipe(Object(Ht.a)(({transitionOrderToState:t})=>{switch(null==t?void 0:t.__typename){case"Order":return null==t?void 0:t.state;case"OrderStateTransitionError":throw this.notificationService.error(null==t?void 0:t.transitionError),new Error(null==t?void 0:t.transitionError)}}))}}re.\u0275fac=function(t){return new(t||re)(i.lc(r.s),i.lc(r.F),i.lc(r.G),i.lc(r.z))},re.\u0275prov=i.Xb({token:re,factory:re.\u0275fac,providedIn:"root"});var ie=c("2Vo4"),oe=c("Kj3r");const ae=72;function se(t,e){if(1&t&&(i.hc(0,"div",3),i.cc(1,"div",4),i.cc(2,"clr-icon",5),i.hc(3,"div",6),i.Vc(4),i.sc(5,"translate"),i.sc(6,"stateI18nToken"),i.gc(),i.gc()),2&t){const t=i.rc();i.Qb(4),i.Xc(" ",i.tc(5,1,i.tc(6,3,t.cancelledState))," ")}}class le{constructor(t){this.elementRef=t,this.active$=new ie.a(!1),this.activeTarget$=new ie.a(!1),this.isCancellable=!1,this.cancelledState="Cancelled"}ngOnChanges(t){this.isCancellable=!!this.node.to.find(t=>"Cancelled"===t.name),t.active&&this.active$.next(this.active)}getPos(t="top"){var e,c;this.elementRef.nativeElement.getBoundingClientRect();const n=null!==(c=null===(e=this.elementRef.nativeElement.querySelector(".node"))||void 0===e?void 0:e.getBoundingClientRect().height)&&void 0!==c?c:0;return{x:10,y:this.index*ae+("bottom"===t?n:0)}}getStyle(){const t=this.getPos();return{"top.px":t.y,"left.px":t.x}}}le.\u0275fac=function(t){return new(t||le)(i.bc(i.r))},le.\u0275cmp=i.Vb({type:le,selectors:[["vdr-order-process-node"]],inputs:{node:"node",index:"index",active:"active"},features:[i.Ob],decls:8,vars:15,consts:[[1,"node-wrapper",3,"ngStyle"],[1,"node"],["class","cancelled-wrapper",4,"ngIf"],[1,"cancelled-wrapper"],[1,"cancelled-edge"],["shape","dot-circle"],[1,"cancelled-node"]],template:function(t,e){1&t&&(i.hc(0,"div",0),i.sc(1,"async"),i.hc(2,"div",1),i.sc(3,"async"),i.Vc(4),i.sc(5,"translate"),i.sc(6,"stateI18nToken"),i.gc(),i.Tc(7,se,7,5,"div",2),i.gc()),2&t&&(i.Tb("active",i.tc(1,7,e.active$)),i.yc("ngStyle",e.getStyle()),i.Qb(2),i.Tb("active-target",i.tc(3,9,e.activeTarget$)),i.Qb(2),i.Xc(" ",i.tc(5,11,i.tc(6,13,e.node.name))," "),i.Qb(3),i.yc("ngIf",e.isCancellable))},directives:[f.p,f.o,y.o],pipes:[f.b,u.d,j.a],styles:["[_nghost-%COMP%]{display:block}.node-wrapper[_ngcontent-%COMP%]{position:absolute;z-index:1;display:flex;align-items:center}.node[_ngcontent-%COMP%]{display:inline-block;border:2px solid var(--color-component-border-200);border-radius:3px;padding:3px 6px;z-index:1;background-color:var(--color-component-bg-100);opacity:.7;transition:opacity .2s,background-color .2s,color .2s;cursor:default}.node.active-target[_ngcontent-%COMP%]{border-color:var(--color-primary-500);opacity:.9}.cancelled-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;color:var(--color-grey-300);transition:color .2s,opacity .2s;opacity:.7}.cancelled-edge[_ngcontent-%COMP%]{width:48px;height:2px;background-color:var(--color-component-bg-300);transition:background-color .2s}clr-icon[_ngcontent-%COMP%]{margin-left:-1px}.cancelled-node[_ngcontent-%COMP%]{margin-left:6px}.active[_ngcontent-%COMP%]   .cancelled-wrapper[_ngcontent-%COMP%]{opacity:1}.active[_ngcontent-%COMP%]   .node[_ngcontent-%COMP%]{opacity:1;background-color:var(--color-primary-600);border-color:var(--color-primary-600);color:var(--color-primary-100)}.active[_ngcontent-%COMP%]   .cancelled-wrapper[_ngcontent-%COMP%]{color:var(--color-error-500)}.active[_ngcontent-%COMP%]   .cancelled-edge[_ngcontent-%COMP%]{background-color:var(--color-error-500)}"],changeDetection:0});var de=c("vkgz");class ue{ngOnInit(){this.active$=this.from.active$.asObservable().pipe(Object(de.a)(t=>this.to.activeTarget$.next(t)))}getStyle(){const t=this.from.index<this.to.index?"down":"up",e=this.from.getPos("down"===t?"bottom":"top"),c=this.to.getPos("down"===t?"top":"bottom"),n=Math.abs(e.x-c.x),r=Math.abs(e.y-c.y),i=Math.sqrt(Math.pow(n,2)+Math.pow(r,2));return Object.assign({"top.px":e.y,"left.px":e.x+("down"===t?10:40)+12*this.index,"height.px":i,"width.px":1},"up"===t?{transform:"rotateZ(180deg)","transform-origin":"top"}:{})}}function fe(t,e){if(1&t){const t=i.ic();i.fc(0),i.hc(1,"vdr-order-process-node",1),i.pc("mouseenter",function(){i.Lc(t);const c=e.$implicit;return i.rc().onMouseOver(c.name)})("mouseleave",function(){i.Lc(t);return i.rc().onMouseOut()}),i.sc(2,"async"),i.gc(),i.ec()}if(2&t){const t=e.$implicit,c=e.index,n=i.rc();i.Qb(1),i.yc("node",t)("index",c)("active",i.tc(2,3,n.activeState$)===t.name)}}function ge(t,e){if(1&t&&(i.fc(0),i.cc(1,"vdr-order-process-edge",2),i.ec()),2&t){const t=e.$implicit;i.Qb(1),i.yc("from",t.from)("to",t.to)("index",t.index)}}ue.\u0275fac=function(t){return new(t||ue)},ue.\u0275cmp=i.Vb({type:ue,selectors:[["vdr-order-process-edge"]],inputs:{from:"from",to:"to",index:"index"},decls:3,vars:7,consts:[[1,"edge",3,"ngStyle"],["shape","arrow","flip","vertical",1,"arrow"]],template:function(t,e){1&t&&(i.hc(0,"div",0),i.sc(1,"async"),i.cc(2,"clr-icon",1),i.gc()),2&t&&(i.Tb("active",i.tc(1,5,e.active$)),i.yc("ngStyle",e.getStyle()),i.Rb("data-from",e.from.node.name)("data-to",e.to.node.name))},directives:[f.p,y.o],pipes:[f.b],styles:[".edge[_ngcontent-%COMP%]{position:absolute;border:1px solid var(--color-component-border-200);background-color:var(--color-component-bg-300);opacity:.3;transition:border .2s,opacity .2s,background-color .2s}.edge.active[_ngcontent-%COMP%]{border-color:var(--color-primary-500);background-color:var(--color-primary-500);opacity:1}.edge.active[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{color:var(--color-primary-500)}.edge[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{position:absolute;bottom:-4px;left:-8px;color:var(--color-grey-300)}"],changeDetection:0});class me{constructor(t){this.changeDetector=t,this.setActiveState$=new ie.a(void 0),this.nodes=[],this.edges=[]}get outerHeight(){return this.nodes.length*ae}ngOnInit(){this.setActiveState$.next(this.initialState),this.activeState$=this.setActiveState$.pipe(Object(oe.a)(150))}ngOnChanges(t){this.populateNodes()}ngAfterViewInit(){setTimeout(()=>this.populateEdges())}onMouseOver(t){this.setActiveState$.next(t)}onMouseOut(){this.setActiveState$.next(this.initialState)}getNodeFor(t){if(this.nodeComponents)return this.nodeComponents.find(e=>e.node.name===t)}populateNodes(){var t,e;const c=new Map;for(const n of this.states)c.set(n.name,{name:n.name,to:[]});for(const[n,r]of c.entries()){const i=null!==(e=null===(t=this.states.find(t=>t.name===n))||void 0===t?void 0:t.to)&&void 0!==e?e:[];for(const t of i){const e=c.get(t);e&&r.to.push(e)}}this.nodes=[...c.values()].filter(t=>"Cancelled"!==t.name)}populateEdges(){for(const t of this.nodes){const e=this.getNodeFor(t.name);let c=0;for(const n of t.to){const t=this.getNodeFor(n.name);e&&t&&e!==t&&(this.edges.push({to:t,from:e,index:c}),c++)}}this.edges=[...this.edges],this.changeDetector.markForCheck()}}function pe(t,e){1&t&&(i.Vc(0),i.sc(1,"translate")),2&t&&i.Wc(i.tc(1,1,"order.order-state-diagram"))}me.\u0275fac=function(t){return new(t||me)(i.bc(i.j))},me.\u0275cmp=i.Vb({type:me,selectors:[["vdr-order-process-graph"]],viewQuery:function(t,e){if(1&t&&i.ad(le,1),2&t){let t;i.Hc(t=i.qc())&&(e.nodeComponents=t)}},hostVars:2,hostBindings:function(t,e){2&t&&i.Qc("height",e.outerHeight,"px")},inputs:{states:"states",initialState:"initialState"},features:[i.Ob],decls:2,vars:2,consts:[[4,"ngFor","ngForOf"],[3,"node","index","active","mouseenter","mouseleave"],[3,"from","to","index"]],template:function(t,e){1&t&&(i.Tc(0,fe,3,5,"ng-container",0),i.Tc(1,ge,2,3,"ng-container",0)),2&t&&(i.yc("ngForOf",e.nodes),i.Qb(1),i.yc("ngForOf",e.edges))},directives:[f.n,le,ue],pipes:[f.b],styles:["[_nghost-%COMP%]{display:block;border:1px #ff69b4;margin:20px;padding:12px;position:relative}.state-row[_ngcontent-%COMP%]{display:flex}"],changeDetection:0});class he{constructor(t){this.serverConfigService=t,this.states=[]}ngOnInit(){this.states=this.serverConfigService.getOrderProcessStates()}}he.\u0275fac=function(t){return new(t||he)(i.bc(r.I))},he.\u0275cmp=i.Vb({type:he,selectors:[["vdr-order-process-graph-dialog"]],decls:2,vars:2,consts:[["vdrDialogTitle",""],[3,"states","initialState"]],template:function(t,e){1&t&&(i.Tc(0,pe,2,3,"ng-template",0),i.cc(1,"vdr-order-process-graph",1)),2&t&&(i.Qb(1),i.yc("states",e.states)("initialState",e.activeState))},directives:[o.a,me],pipes:[u.d],styles:[""],changeDetection:0});var be=c("hmHg");function ye(t,e){1&t&&(i.Vc(0),i.sc(1,"translate")),2&t&&i.Wc(i.tc(1,1,"order.refund-and-cancel-order"))}function ve(t,e){if(1&t&&(i.hc(0,"div",36),i.Vc(1),i.hc(2,"div",37),i.Vc(3),i.sc(4,"currency"),i.sc(5,"number"),i.gc(),i.gc()),2&t){const t=e.$implicit,c=i.rc(3).$implicit,n=i.rc();i.Qb(1),i.Xc(" ",t.description," "),i.Qb(2),i.Xc(" ",i.uc(4,2,i.uc(5,5,t.amount/100/c.quantity,"1.0-2"),n.order.currencyCode)," ")}}function Ce(t,e){if(1&t&&(i.hc(0,"vdr-dropdown"),i.hc(1,"div",32),i.hc(2,"button",33),i.cc(3,"clr-icon",34),i.gc(),i.gc(),i.hc(4,"vdr-dropdown-menu"),i.Tc(5,ve,6,8,"div",35),i.gc(),i.gc()),2&t){const t=i.rc().ngIf;i.Qb(5),i.yc("ngForOf",t)}}function Oe(t,e){if(1&t&&(i.fc(0),i.Tc(1,Ce,6,1,"vdr-dropdown",26),i.ec()),2&t){const t=e.ngIf;i.Qb(1),i.yc("ngIf",t.length)}}function Qe(t,e){if(1&t){const t=i.ic();i.hc(0,"input",38),i.pc("ngModelChange",function(e){i.Lc(t);const c=i.rc().$implicit;return i.rc().lineQuantities[c.id].quantity=e})("input",function(){i.Lc(t);const e=i.rc().$implicit,c=i.rc();return c.handleZeroQuantity(c.lineQuantities[e.id])}),i.gc()}if(2&t){const t=i.rc().$implicit,e=i.rc();i.yc("ngModel",e.lineQuantities[t.id].quantity)("max",t.quantity)}}function Ie(t,e){if(1&t){const t=i.ic();i.hc(0,"input",39),i.pc("ngModelChange",function(e){i.Lc(t);const c=i.rc().$implicit;return i.rc().lineQuantities[c.id].refund=e}),i.gc()}if(2&t){const t=i.rc().$implicit,e=i.rc();i.yc("disabled",0===e.lineQuantities[t.id].quantity)("ngModel",e.lineQuantities[t.id].refund)}}function Te(t,e){if(1&t){const t=i.ic();i.hc(0,"input",39),i.pc("ngModelChange",function(e){i.Lc(t);const c=i.rc().$implicit;return i.rc().lineQuantities[c.id].cancel=e}),i.gc()}if(2&t){const t=i.rc().$implicit,e=i.rc();i.yc("disabled",0===e.lineQuantities[t.id].quantity)("ngModel",e.lineQuantities[t.id].cancel)}}function Pe(t,e){if(1&t&&(i.hc(0,"tr",18),i.hc(1,"td",19),i.cc(2,"img",20),i.sc(3,"assetPreview"),i.gc(),i.hc(4,"td",21),i.Vc(5),i.gc(),i.hc(6,"td",22),i.Vc(7),i.gc(),i.hc(8,"td",23),i.Vc(9),i.cc(10,"vdr-line-refunds",24),i.gc(),i.hc(11,"td",23),i.Vc(12),i.sc(13,"localeCurrency"),i.gc(),i.hc(14,"td",23),i.hc(15,"div",25),i.Vc(16),i.sc(17,"localeCurrency"),i.Tc(18,Oe,2,1,"ng-container",26),i.gc(),i.gc(),i.hc(19,"td",27),i.Tc(20,Qe,1,2,"input",28),i.gc(),i.hc(21,"td",29),i.hc(22,"div",30),i.Tc(23,Ie,1,2,"input",31),i.gc(),i.gc(),i.hc(24,"td",29),i.hc(25,"div",30),i.Tc(26,Te,1,2,"input",31),i.gc(),i.gc(),i.gc()),2&t){const t=e.$implicit,c=i.rc();i.Qb(2),i.yc("src",i.uc(3,12,t.featuredAsset,"tiny"),i.Nc),i.Qb(3),i.Wc(t.productVariant.name),i.Qb(2),i.Wc(t.productVariant.sku),i.Qb(2),i.Xc(" ",t.quantity," "),i.Qb(1),i.yc("line",t)("payments",c.order.payments),i.Qb(2),i.Xc(" ",i.uc(13,15,t.unitPriceWithTax,c.order.currencyCode)," "),i.Qb(4),i.Xc(" ",i.uc(17,18,t.proratedUnitPriceWithTax,c.order.currencyCode)," "),i.Qb(2),i.yc("ngIf",t.discounts),i.Qb(2),i.yc("ngIf",c.lineCanBeRefundedOrCancelled(t)),i.Qb(3),i.yc("ngIf",c.lineCanBeRefundedOrCancelled(t)),i.Qb(3),i.yc("ngIf",c.lineCanBeRefundedOrCancelled(t))}}function Se(t,e){if(1&t&&(i.hc(0,"option",40),i.Vc(1),i.sc(2,"localeCurrency"),i.gc()),2&t){const t=e.$implicit,c=i.rc();i.yc("ngValue",t)("disabled","Settled"!==t.state),i.Qb(1),i.Zc(" #",t.id," ",t.method,": ",i.uc(2,5,t.amount,c.order.currencyCode)," ")}}const Me=function(t,e){return{min:t,max:e}};function Ve(t,e){if(1&t&&(i.hc(0,"div",41),i.Vc(1),i.sc(2,"translate"),i.sc(3,"currency"),i.sc(4,"localeCurrency"),i.gc()),2&t){const t=i.rc();i.Qb(1),i.Xc(" ",i.uc(2,1,"order.refund-total-error",i.Dc(10,Me,i.uc(3,4,0,t.order.currencyCode),i.uc(4,7,t.settledPaymentsTotal,t.order.currencyCode)))," ")}}function xe(t,e){1&t&&(i.hc(0,"div",42),i.Vc(1),i.sc(2,"translate"),i.gc()),2&t&&(i.Qb(1),i.Xc(" ",i.tc(2,1,"order.refund-total-warning")," "))}const Fe=function(t){return{amount:t}};function we(t,e){if(1&t&&(i.fc(0),i.Vc(1),i.sc(2,"translate"),i.sc(3,"localeCurrency"),i.ec()),2&t){const t=i.rc(2);i.Qb(1),i.Xc(" ",i.uc(2,1,"order.refund-with-amount",i.Cc(7,Fe,i.uc(3,4,t.refundTotal,t.order.currencyCode)))," ")}}function _e(t,e){1&t&&(i.Vc(0),i.sc(1,"translate")),2&t&&i.Xc(" ",i.tc(1,1,"order.cancel-selected-items")," ")}function ke(t,e){if(1&t){const t=i.ic();i.hc(0,"button",43),i.pc("click",function(){i.Lc(t);return i.rc().cancel()}),i.Vc(1),i.sc(2,"translate"),i.gc(),i.hc(3,"button",44),i.pc("click",function(){i.Lc(t);return i.rc().select()}),i.Tc(4,we,4,9,"ng-container",45),i.Tc(5,_e,2,3,"ng-template",null,46,i.Uc),i.gc()}if(2&t){const t=i.Ic(6),e=i.rc();i.Qb(1),i.Wc(i.tc(2,4,"common.cancel")),i.Qb(2),i.yc("disabled",!e.canSubmit()),i.Qb(1),i.yc("ngIf",e.isRefunding())("ngIfElse",t)}}class Le{constructor(t){this.i18nService=t,this.lineQuantities={},this.refundShipping=!1,this.adjustment=0,this.reasons=[Object(b.a)("order.refund-reason-customer-request"),Object(b.a)("order.refund-reason-not-available")],this.reasons=this.reasons.map(t=>this.i18nService.translate(t))}get refundTotal(){return this.order.lines.reduce((t,e)=>{const c=this.lineQuantities[e.id],n=c.refund&&c.quantity||0;return t+e.proratedUnitPriceWithTax*n},0)+(this.refundShipping?this.order.shippingWithTax:0)+this.adjustment}get settledPaymentsTotal(){return this.settledPayments.map(t=>t.amount-Object(R.summate)(t.refunds.filter(t=>"Failed"!==t.state),"total")).reduce((t,e)=>t+e,0)}lineCanBeRefundedOrCancelled(t){var e,c;const n=null!==(c=null===(e=this.order.payments)||void 0===e?void 0:e.reduce((t,e)=>[...t,...e.refunds],[]))&&void 0!==c?c:[];return 0<t.items.filter(t=>{if(t.cancelled)return!1;if(null==t.refundId)return!0;const e=n.find(e=>e.id===t.refundId);return"Failed"===(null==e?void 0:e.state)}).length}ngOnInit(){this.lineQuantities=this.order.lines.reduce((t,e)=>Object.assign(Object.assign({},t),{[e.id]:{quantity:0,refund:!1,cancel:!1}}),{}),this.settledPayments=(this.order.payments||[]).filter(t=>"Settled"===t.state),this.settledPayments.length&&(this.selectedPayment=this.settledPayments[0])}handleZeroQuantity(t){0===(null==t?void 0:t.quantity)&&(t.cancel=!1,t.refund=!1)}isRefunding(){return Object.values(this.lineQuantities).reduce((t,e)=>t||0<e.quantity&&e.refund,!1)}isCancelling(){return Object.values(this.lineQuantities).reduce((t,e)=>t||0<e.quantity&&e.cancel,!1)}canSubmit(){return this.isRefunding()?!!(this.selectedPayment&&this.reason&&0<this.refundTotal&&this.refundTotal<=this.settledPaymentsTotal):!!this.isCancelling()&&!!this.reason}select(){const t=this.selectedPayment;if(t){const e=this.getOrderLineInput(t=>t.refund),c=this.getOrderLineInput(t=>t.cancel);this.resolveWith({refund:{lines:e,reason:this.reason,shipping:this.refundShipping?this.order.shipping:0,adjustment:this.adjustment,paymentId:t.id},cancel:{lines:c,orderId:this.order.id,reason:this.reason}})}}cancel(){this.resolveWith()}getOrderLineInput(t){return Object.entries(this.lineQuantities).filter(([e,c])=>0<c.quantity&&t(c)).map(([t,e])=>({orderLineId:t,quantity:e.quantity}))}}function Ae(t,e){1&t&&(i.Vc(0),i.sc(1,"translate")),2&t&&i.Wc(i.tc(1,1,"order.settle-refund"))}function De(t,e){if(1&t){const t=i.ic();i.hc(0,"button",4),i.pc("click",function(){i.Lc(t);return i.rc().cancel()}),i.Vc(1),i.sc(2,"translate"),i.gc(),i.hc(3,"button",5),i.pc("click",function(){i.Lc(t);return i.rc().submit()}),i.Vc(4),i.sc(5,"translate"),i.gc()}if(2&t){const t=i.rc();i.Qb(1),i.Wc(i.tc(2,3,"common.cancel")),i.Qb(2),i.yc("disabled",!t.transactionId),i.Qb(1),i.Xc(" ",i.tc(5,5,"order.settle-refund")," ")}}Le.\u0275fac=function(t){return new(t||Le)(i.bc(r.z))},Le.\u0275cmp=i.Vb({type:Le,selectors:[["vdr-refund-order-dialog"]],decls:69,vars:74,consts:[["vdrDialogTitle",""],[1,"refund-wrapper"],[1,"order-table"],[1,"table"],["class","order-line",4,"ngFor","ngForOf"],[1,"refund-details","mt4"],[1,"clr-control-label"],["bindLabel","name","autofocus","","bindValue","id",3,"disabled","items","placeholder","addTag","ngModel","ngModelChange"],["clrSelect","","name","options",3,"ngModel","disabled","ngModelChange"],[3,"ngValue","disabled",4,"ngFor","ngForOf"],["type","checkbox","clrCheckbox","",3,"ngModel","disabled","ngModelChange"],["clrInput","",3,"disabled","currencyCode","ngModel","ngModelChange"],[1,"totals"],[1,"order-total"],[1,"refund-total"],["class","refund-total-error",4,"ngIf"],["class","refund-total-warning",4,"ngIf"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[3,"line","payments"],[1,"prorated-wrapper"],[4,"ngIf"],[1,"align-middle","fulfil"],["type","number","min","0",3,"ngModel","max","ngModelChange","input",4,"ngIf"],[1,"align-middle"],[1,"cancel-checkbox-wrapper"],["type","checkbox","clrCheckbox","",3,"disabled","ngModel","ngModelChange",4,"ngIf"],["vdrDropdownTrigger","",1,"promotions-label"],[1,"icon-button"],["shape","info"],["class","line-promotion",4,"ngFor","ngForOf"],[1,"line-promotion"],[1,"promotion-amount"],["type","number","min","0",3,"ngModel","max","ngModelChange","input"],["type","checkbox","clrCheckbox","",3,"disabled","ngModel","ngModelChange"],[3,"ngValue","disabled"],[1,"refund-total-error"],[1,"refund-total-warning"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf","ngIfElse"],["cancelling",""]],template:function(t,e){1&t&&(i.Tc(0,ye,2,3,"ng-template",0),i.hc(1,"div",1),i.hc(2,"div",2),i.hc(3,"table",3),i.hc(4,"thead"),i.hc(5,"tr"),i.cc(6,"th"),i.hc(7,"th"),i.Vc(8),i.sc(9,"translate"),i.gc(),i.hc(10,"th"),i.Vc(11),i.sc(12,"translate"),i.gc(),i.hc(13,"th"),i.Vc(14),i.sc(15,"translate"),i.gc(),i.hc(16,"th"),i.Vc(17),i.sc(18,"translate"),i.gc(),i.hc(19,"th"),i.Vc(20),i.sc(21,"translate"),i.gc(),i.hc(22,"th"),i.Vc(23),i.sc(24,"translate"),i.gc(),i.hc(25,"th"),i.Vc(26),i.sc(27,"translate"),i.gc(),i.hc(28,"th"),i.Vc(29),i.sc(30,"translate"),i.gc(),i.gc(),i.gc(),i.Tc(31,Pe,27,21,"tr",4),i.gc(),i.gc(),i.hc(32,"div",5),i.hc(33,"div"),i.hc(34,"label",6),i.Vc(35),i.sc(36,"translate"),i.gc(),i.hc(37,"ng-select",7),i.pc("ngModelChange",function(t){return e.reason=t}),i.sc(38,"translate"),i.gc(),i.gc(),i.hc(39,"div"),i.hc(40,"clr-select-container"),i.hc(41,"label"),i.Vc(42),i.sc(43,"translate"),i.gc(),i.hc(44,"select",8),i.pc("ngModelChange",function(t){return e.selectedPayment=t}),i.Tc(45,Se,3,8,"option",9),i.gc(),i.gc(),i.hc(46,"clr-checkbox-wrapper"),i.hc(47,"input",10),i.pc("ngModelChange",function(t){return e.refundShipping=t}),i.gc(),i.hc(48,"label"),i.Vc(49),i.sc(50,"translate"),i.sc(51,"localeCurrency"),i.gc(),i.gc(),i.hc(52,"clr-input-container"),i.hc(53,"label"),i.Vc(54),i.sc(55,"translate"),i.gc(),i.hc(56,"vdr-currency-input",11),i.pc("ngModelChange",function(t){return e.adjustment=t}),i.gc(),i.gc(),i.hc(57,"div",12),i.hc(58,"div",13),i.Vc(59),i.sc(60,"translate"),i.sc(61,"localeCurrency"),i.gc(),i.hc(62,"div",14),i.Vc(63),i.sc(64,"translate"),i.sc(65,"localeCurrency"),i.gc(),i.Tc(66,Ve,5,13,"div",15),i.Tc(67,xe,3,3,"div",16),i.gc(),i.gc(),i.gc(),i.gc(),i.Tc(68,ke,7,6,"ng-template",17)),2&t&&(i.Qb(8),i.Wc(i.tc(9,35,"order.product-name")),i.Qb(3),i.Wc(i.tc(12,37,"order.product-sku")),i.Qb(3),i.Wc(i.tc(15,39,"order.quantity")),i.Qb(3),i.Wc(i.tc(18,41,"order.unit-price")),i.Qb(3),i.Wc(i.tc(21,43,"order.prorated-unit-price")),i.Qb(3),i.Wc(i.tc(24,45,"order.quantity")),i.Qb(3),i.Wc(i.tc(27,47,"order.refund")),i.Qb(3),i.Wc(i.tc(30,49,"order.cancel")),i.Qb(2),i.yc("ngForOf",e.order.lines),i.Qb(4),i.Wc(i.tc(36,51,"order.refund-cancellation-reason")),i.Qb(2),i.yc("disabled",!e.isRefunding()&&!e.isCancelling())("items",e.reasons)("placeholder",i.tc(38,53,"order.refund-cancellation-reason-required"))("addTag",!0)("ngModel",e.reason),i.Qb(5),i.Wc(i.tc(43,55,"order.payment-to-refund")),i.Qb(2),i.yc("ngModel",e.selectedPayment)("disabled",!e.isRefunding()),i.Qb(1),i.yc("ngForOf",e.settledPayments),i.Qb(2),i.yc("ngModel",e.refundShipping)("disabled",!e.isRefunding()),i.Qb(2),i.Yc(" ",i.tc(50,57,"order.refund-shipping")," (",i.uc(51,59,e.order.shipping,e.order.currencyCode),") "),i.Qb(5),i.Wc(i.tc(55,62,"order.refund-adjustment")),i.Qb(2),i.yc("disabled",!e.isRefunding())("currencyCode",e.order.currencyCode)("ngModel",e.adjustment),i.Qb(1),i.Tb("disabled",!e.isRefunding()),i.Qb(2),i.Yc(" ",i.tc(60,64,"order.payment-amount"),": ",i.uc(61,66,e.selectedPayment.amount,e.order.currencyCode)," "),i.Qb(4),i.Yc(" ",i.tc(64,69,"order.refund-total"),": ",i.uc(65,71,e.refundTotal,e.order.currencyCode)," "),i.Qb(3),i.yc("ngIf",e.refundTotal<0||e.settledPaymentsTotal<e.refundTotal),i.Qb(1),i.yc("ngIf",e.selectedPayment.amount<e.refundTotal))},directives:[o.a,f.n,y.u,s.a,n.p,n.s,y.B,l.a,n.A,y.A,y.k,n.a,y.i,y.t,be.a,y.s,f.o,d.a,Pt,J.a,K.a,y.o,tt.a,n.v,n.b,n.u,n.D],pipes:[u.d,g.a,v.a,f.d,f.f],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}.refund-wrapper[_ngcontent-%COMP%]{flex:1;flex-direction:column}.refund-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.refund-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.refund-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}.cancel-checkbox-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}clr-checkbox-wrapper[_ngcontent-%COMP%]{margin-top:12px;margin-bottom:12px;display:block}.refund-details[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.totals[_ngcontent-%COMP%]{margin-top:48px}.totals[_ngcontent-%COMP%]   .refund-total[_ngcontent-%COMP%]{font-size:18px}.totals[_ngcontent-%COMP%]   .refund-total-error[_ngcontent-%COMP%]{color:var(--color-error-500)}.totals[_ngcontent-%COMP%]   .refund-total-warning[_ngcontent-%COMP%]{color:var(--color-warning-600);max-width:250px}.totals.disabled[_ngcontent-%COMP%]{color:var(--color-grey-300)}.prorated-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center}.line-promotion[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:12px;padding:3px 6px}.line-promotion[_ngcontent-%COMP%]   .promotion-amount[_ngcontent-%COMP%]{margin-left:12px}"],changeDetection:0});const je=function(t){return{method:t}};class We{constructor(){this.transactionId=""}submit(){this.resolveWith(this.transactionId)}cancel(){this.resolveWith()}}We.\u0275fac=function(t){return new(t||We)},We.\u0275cmp=i.Vb({type:We,selectors:[["vdr-settle-refund-dialog"]],decls:10,vars:10,consts:[["vdrDialogTitle",""],[1,"instruction"],["clrInput","","name","transactionId",3,"ngModel","ngModelChange"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(t,e){1&t&&(i.Tc(0,Ae,2,3,"ng-template",0),i.hc(1,"p",1),i.Vc(2),i.sc(3,"translate"),i.gc(),i.hc(4,"clr-input-container"),i.hc(5,"label"),i.Vc(6),i.sc(7,"translate"),i.gc(),i.hc(8,"input",2),i.pc("ngModelChange",function(t){return e.transactionId=t}),i.gc(),i.gc(),i.Tc(9,De,6,7,"ng-template",3)),2&t&&(i.Qb(2),i.Xc(" ",i.uc(3,3,"order.settle-refund-manual-instructions",i.Cc(8,je,e.refund.method)),"\n"),i.Qb(4),i.Wc(i.tc(7,6,"order.transaction-id")),i.Qb(2),i.yc("ngModel",e.transactionId))},directives:[o.a,y.t,y.u,l.a,n.b,y.s,n.p,n.s,d.a],pipes:[u.d],styles:["[_nghost-%COMP%]{padding-bottom:32px}.instruction[_ngcontent-%COMP%]{margin-top:0;margin-bottom:24px}"],changeDetection:0});var Ne=c("tyNb"),Re=c("uEVm"),Ee=c("iszU"),Xe=c("R2pz"),$e=c("nqNv"),qe=c("t4Ah");function He(t,e){if(1&t&&(i.cc(0,"img",23),i.sc(1,"assetPreview")),2&t){const t=i.rc().$implicit;i.yc("src",i.uc(1,1,t.featuredAsset,"tiny"),i.Nc)}}function Ue(t,e){if(1&t&&(i.hc(0,"div",26),i.hc(1,"a",27),i.Vc(2),i.gc(),i.hc(3,"div",28),i.Vc(4),i.sc(5,"localeCurrency"),i.hc(6,"div",8),i.sc(7,"translate"),i.Vc(8),i.sc(9,"localeCurrency"),i.gc(),i.gc(),i.gc()),2&t){const t=e.$implicit,c=i.rc(4);i.Qb(1),i.yc("routerLink",c.getPromotionLink(t)),i.Qb(1),i.Wc(t.description),i.Qb(2),i.Xc(" ",i.uc(5,5,t.amountWithTax,c.order.currencyCode)," "),i.Qb(2),i.yc("title",i.tc(7,8,"order.net-price")),i.Qb(2),i.Xc(" ",i.uc(9,10,t.amount,c.order.currencyCode)," ")}}function ze(t,e){if(1&t&&(i.hc(0,"vdr-dropdown"),i.hc(1,"div",24),i.Vc(2),i.sc(3,"translate"),i.gc(),i.hc(4,"vdr-dropdown-menu"),i.Tc(5,Ue,10,13,"div",25),i.gc(),i.gc()),2&t){const t=i.rc().ngIf;i.Qb(2),i.Xc(" ",i.tc(3,2,"order.promotions-applied")," "),i.Qb(3),i.yc("ngForOf",t)}}function Be(t,e){if(1&t&&(i.fc(0),i.Tc(1,ze,6,4,"vdr-dropdown",22),i.ec()),2&t){const t=e.ngIf;i.Qb(1),i.yc("ngIf",t.length)}}function Ge(t,e){if(1&t&&(i.hc(0,"span",37),i.Vc(1),i.gc()),2&t){const t=i.rc().$implicit;i.yc("title",t.value),i.Qb(1),i.Wc(t.value)}}function Ye(t,e){1&t&&i.cc(0,"clr-icon",39)}function Ze(t,e){1&t&&i.cc(0,"clr-icon",40)}function Je(t,e){if(1&t&&(i.Tc(0,Ye,1,0,"ng-template",38),i.Tc(1,Ze,1,0,"ng-template",38)),2&t){const t=i.rc().$implicit;i.yc("ngIf",!0===t.value),i.Qb(1),i.yc("ngIf",!1===t.value)}}function Ke(t,e){if(1&t&&i.Vc(0),2&t){const t=i.rc().$implicit;i.Xc(" ",t.value," ")}}function tc(t,e){if(1&t&&(i.hc(0,"div",32),i.hc(1,"vdr-labeled-data",33),i.sc(2,"customFieldLabel"),i.hc(3,"div",34),i.Tc(4,Ge,2,2,"ng-template",35),i.Tc(5,Je,2,2,"ng-template",35),i.Tc(6,Ke,1,1,"ng-template",36),i.gc(),i.gc(),i.gc()),2&t){const t=e.$implicit;i.Qb(1),i.yc("label",i.tc(2,4,t.config)),i.Qb(2),i.yc("ngSwitch",t.config.type),i.Qb(1),i.yc("ngSwitchCase","datetime"),i.Qb(1),i.yc("ngSwitchCase","boolean")}}function ec(t,e){if(1&t&&(i.hc(0,"tr"),i.hc(1,"td",29),i.hc(2,"div",30),i.Tc(3,tc,7,6,"div",31),i.gc(),i.gc(),i.gc()),2&t){const t=i.rc().ngIf;i.Qb(3),i.yc("ngForOf",t)}}function cc(t,e){if(1&t&&(i.fc(0),i.Tc(1,ec,4,1,"tr",22),i.ec()),2&t){const t=e.ngIf;i.Qb(1),i.yc("ngIf",t.length)}}function nc(t,e){if(1&t&&(i.fc(0),i.hc(1,"tr",12),i.hc(2,"td",13),i.Tc(3,He,2,4,"img",14),i.gc(),i.hc(4,"td",15),i.Vc(5),i.gc(),i.hc(6,"td",16),i.Vc(7),i.gc(),i.hc(8,"td",17),i.Vc(9),i.sc(10,"localeCurrency"),i.hc(11,"div",8),i.sc(12,"translate"),i.Vc(13),i.sc(14,"localeCurrency"),i.gc(),i.gc(),i.hc(15,"td",18),i.Vc(16),i.cc(17,"vdr-line-refunds",19),i.cc(18,"vdr-line-fulfillment",20),i.gc(),i.hc(19,"td",21),i.Vc(20),i.sc(21,"localeCurrency"),i.hc(22,"div",8),i.sc(23,"translate"),i.Vc(24),i.sc(25,"localeCurrency"),i.gc(),i.Tc(26,Be,2,1,"ng-container",22),i.gc(),i.gc(),i.Tc(27,cc,2,1,"ng-container",22),i.ec()),2&t){const t=e.$implicit,c=i.rc();i.Qb(1),i.Tb("is-cancelled",0===t.quantity),i.Qb(2),i.yc("ngIf",t.featuredAsset),i.Qb(2),i.Wc(t.productVariant.name),i.Qb(2),i.Wc(t.productVariant.sku),i.Qb(2),i.Xc(" ",i.uc(10,18,t.unitPriceWithTax,c.order.currencyCode)," "),i.Qb(2),i.yc("title",i.tc(12,21,"order.net-price")),i.Qb(2),i.Xc(" ",i.uc(14,23,t.unitPrice,c.order.currencyCode)," "),i.Qb(3),i.Xc(" ",t.quantity," "),i.Qb(1),i.yc("line",t)("payments",c.order.payments),i.Qb(1),i.yc("line",t)("orderState",c.order.state),i.Qb(2),i.Xc(" ",i.uc(21,26,t.linePriceWithTax,c.order.currencyCode)," "),i.Qb(2),i.yc("title",i.tc(23,29,"order.net-price")),i.Qb(2),i.Xc(" ",i.uc(25,31,t.linePrice,c.order.currencyCode)," "),i.Qb(2),i.yc("ngIf",c.getLineDiscounts(t)),i.Qb(1),i.yc("ngIf",c.getLineCustomFields(t))}}function rc(t,e){if(1&t&&(i.hc(0,"tr",41),i.hc(1,"td",42),i.Vc(2),i.gc(),i.hc(3,"td",16),i.Vc(4),i.gc(),i.cc(5,"td",43),i.hc(6,"td",21),i.Vc(7),i.sc(8,"localeCurrency"),i.hc(9,"div",8),i.sc(10,"translate"),i.Vc(11),i.sc(12,"localeCurrency"),i.gc(),i.gc(),i.gc()),2&t){const t=e.$implicit,c=i.rc();i.Qb(2),i.Wc(t.description),i.Qb(2),i.Wc(t.sku),i.Qb(3),i.Xc(" ",i.uc(8,5,t.priceWithTax,c.order.currencyCode)," "),i.Qb(2),i.yc("title",i.tc(10,8,"order.net-price")),i.Qb(2),i.Xc(" ",i.uc(12,10,t.price,c.order.currencyCode)," ")}}function ic(t,e){if(1&t&&(i.hc(0,"vdr-chip"),i.Vc(1),i.gc()),2&t){const t=e.ngIf;i.Qb(1),i.Wc(t)}}function oc(t,e){if(1&t&&(i.hc(0,"tr",44),i.hc(1,"td",45),i.hc(2,"a",46),i.Vc(3),i.gc(),i.Tc(4,ic,2,1,"vdr-chip",22),i.gc(),i.hc(5,"td",7),i.Vc(6),i.sc(7,"localeCurrency"),i.hc(8,"div",8),i.sc(9,"translate"),i.Vc(10),i.sc(11,"localeCurrency"),i.gc(),i.gc(),i.gc()),2&t){const t=e.$implicit,c=i.rc();i.Qb(2),i.yc("routerLink",c.getPromotionLink(t)),i.Qb(1),i.Wc(t.description),i.Qb(1),i.yc("ngIf",c.getCouponCodeForAdjustment(c.order,t)),i.Qb(2),i.Xc(" ",i.uc(7,6,t.amountWithTax,c.order.currencyCode)," "),i.Qb(2),i.yc("title",i.tc(9,9,"order.net-price")),i.Qb(2),i.Xc(" ",i.uc(11,11,t.amount,c.order.currencyCode)," ")}}class ac{constructor(){this.orderLineCustomFieldsVisible=!1}get visibleOrderLineCustomFields(){return this.orderLineCustomFieldsVisible?this.orderLineCustomFields:[]}get showElided(){return!this.orderLineCustomFieldsVisible&&0<this.orderLineCustomFields.length}ngOnInit(){this.orderLineCustomFieldsVisible=this.orderLineCustomFields.length<2}toggleOrderLineCustomFields(){this.orderLineCustomFieldsVisible=!this.orderLineCustomFieldsVisible}getLineDiscounts(t){return t.discounts.filter(t=>t.type===r.c.PROMOTION)}getLineCustomFields(t){return this.orderLineCustomFields.map(e=>({config:e,value:t.customFields[e.name]})).filter(t=>!!this.orderLineCustomFieldsVisible||null!=t.value)}getPromotionLink(t){return["/marketing","promotions",t.adjustmentSource.split(":")[1]]}getCouponCodeForAdjustment(t,e){const c=e.adjustmentSource.split(":")[1],n=t.promotions.find(t=>t.id===c);if(n)return n.couponCode||void 0}}ac.\u0275fac=function(t){return new(t||ac)},ac.\u0275cmp=i.Vb({type:ac,selectors:[["vdr-order-table"]],inputs:{order:"order",orderLineCustomFields:"orderLineCustomFields"},decls:61,vars:61,consts:[[1,"order-table","table"],[4,"ngFor","ngForOf"],["class","surcharge",4,"ngFor","ngForOf"],["class","order-adjustment",4,"ngFor","ngForOf"],[1,"sub-total"],[1,"left","clr-align-middle"],["colspan","4"],[1,"clr-align-middle"],[1,"net-price",3,"title"],[1,"shipping"],["colspan","3"],[1,"total"],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","unit-price"],[1,"align-middle","quantity"],[3,"line","payments"],[3,"line","orderState"],[1,"align-middle","total"],[4,"ngIf"],[3,"src"],["vdrDropdownTrigger","",1,"promotions-label"],["class","line-promotion",4,"ngFor","ngForOf"],[1,"line-promotion"],[1,"promotion-name",3,"routerLink"],[1,"promotion-amount"],["colspan","6",1,"custom-fields-row"],[1,"order-line-custom-fields"],["class","custom-field",4,"ngFor","ngForOf"],[1,"custom-field"],[3,"label"],[1,"mt2",3,"ngSwitch"],[3,"ngSwitchCase"],["ngSwitchDefault",""],[3,"title"],[3,"ngIf"],["shape","check"],["shape","times"],[1,"surcharge"],["colspan","2",1,"align-middle","name","left"],["colspan","2",1,"align-middle"],[1,"order-adjustment"],["colspan","5",1,"left","clr-align-middle"],[3,"routerLink"]],template:function(t,e){1&t&&(i.hc(0,"table",0),i.hc(1,"thead"),i.hc(2,"tr"),i.cc(3,"th"),i.hc(4,"th"),i.Vc(5),i.sc(6,"translate"),i.gc(),i.hc(7,"th"),i.Vc(8),i.sc(9,"translate"),i.gc(),i.hc(10,"th"),i.Vc(11),i.sc(12,"translate"),i.gc(),i.hc(13,"th"),i.Vc(14),i.sc(15,"translate"),i.gc(),i.hc(16,"th"),i.Vc(17),i.sc(18,"translate"),i.gc(),i.gc(),i.gc(),i.hc(19,"tbody"),i.Tc(20,nc,28,34,"ng-container",1),i.Tc(21,rc,13,13,"tr",2),i.Tc(22,oc,12,14,"tr",3),i.hc(23,"tr",4),i.hc(24,"td",5),i.Vc(25),i.sc(26,"translate"),i.gc(),i.cc(27,"td",6),i.hc(28,"td",7),i.Vc(29),i.sc(30,"localeCurrency"),i.hc(31,"div",8),i.sc(32,"translate"),i.Vc(33),i.sc(34,"localeCurrency"),i.gc(),i.gc(),i.gc(),i.hc(35,"tr",9),i.hc(36,"td",5),i.Vc(37),i.sc(38,"translate"),i.gc(),i.hc(39,"td",7),i.Vc(40),i.gc(),i.cc(41,"td",10),i.hc(42,"td",7),i.Vc(43),i.sc(44,"localeCurrency"),i.hc(45,"div",8),i.sc(46,"translate"),i.Vc(47),i.sc(48,"localeCurrency"),i.gc(),i.gc(),i.gc(),i.hc(49,"tr",11),i.hc(50,"td",5),i.Vc(51),i.sc(52,"translate"),i.gc(),i.cc(53,"td",6),i.hc(54,"td",7),i.Vc(55),i.sc(56,"localeCurrency"),i.hc(57,"div",8),i.sc(58,"translate"),i.Vc(59),i.sc(60,"localeCurrency"),i.gc(),i.gc(),i.gc(),i.gc(),i.gc()),2&t&&(i.Qb(5),i.Wc(i.tc(6,21,"order.product-name")),i.Qb(3),i.Wc(i.tc(9,23,"order.product-sku")),i.Qb(3),i.Wc(i.tc(12,25,"order.unit-price")),i.Qb(3),i.Wc(i.tc(15,27,"order.quantity")),i.Qb(3),i.Wc(i.tc(18,29,"order.total")),i.Qb(3),i.yc("ngForOf",e.order.lines),i.Qb(1),i.yc("ngForOf",e.order.surcharges),i.Qb(1),i.yc("ngForOf",e.order.discounts),i.Qb(3),i.Wc(i.tc(26,31,"order.sub-total")),i.Qb(4),i.Xc(" ",i.uc(30,33,e.order.subTotalWithTax,e.order.currencyCode)," "),i.Qb(2),i.yc("title",i.tc(32,36,"order.net-price")),i.Qb(2),i.Xc(" ",i.uc(34,38,e.order.subTotal,e.order.currencyCode)," "),i.Qb(4),i.Wc(i.tc(38,41,"order.shipping")),i.Qb(3),i.Wc(null==e.order.shippingLines[0]||null==e.order.shippingLines[0].shippingMethod?null:e.order.shippingLines[0].shippingMethod.name),i.Qb(3),i.Xc(" ",i.uc(44,43,e.order.shippingWithTax,e.order.currencyCode)," "),i.Qb(2),i.yc("title",i.tc(46,46,"order.net-price")),i.Qb(2),i.Xc(" ",i.uc(48,48,e.order.shipping,e.order.currencyCode)," "),i.Qb(4),i.Wc(i.tc(52,51,"order.total")),i.Qb(4),i.Xc(" ",i.uc(56,53,e.order.totalWithTax,e.order.currencyCode)," "),i.Qb(2),i.yc("title",i.tc(58,56,"order.net-price")),i.Qb(2),i.Xc(" ",i.uc(60,58,e.order.total,e.order.currencyCode)," "))},directives:[f.n,f.o,Pt,Ot,J.a,K.a,tt.a,Ne.h,E.a,f.q,f.r,f.s,y.o,D.a],pipes:[u.d,g.a,v.a,qe.a],styles:[".order-table[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}.order-table[_ngcontent-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700}.order-table[_ngcontent-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-right:18px}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%], .order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px}.order-table[_ngcontent-%COMP%]   .promotions-label[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted var(--color-text-200);text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}  .line-promotion{display:flex;justify-content:space-between;padding:6px 12px}  .line-promotion .promotion-amount{margin-left:12px}  .line-promotion .net-price{font-size:11px;color:var(--color-text-300)}"],changeDetection:0});var sc=c("yW18"),lc=c("u1bq");function dc(t,e){if(1&t&&(i.hc(0,"vdr-labeled-data",0),i.sc(1,"translate"),i.Vc(2),i.gc()),2&t){const t=i.rc();i.yc("label",i.tc(1,2,"order.error-message")),i.Qb(2),i.Xc(" ",t.payment.errorMessage,"\n")}}function uc(t,e){if(1&t&&(i.hc(0,"vdr-labeled-data",0),i.sc(1,"translate"),i.Vc(2),i.gc()),2&t){const t=i.rc();i.yc("label",i.tc(1,2,"order.transaction-id")),i.Qb(2),i.Xc(" ",t.payment.transactionId,"\n")}}class fc{}fc.\u0275fac=function(t){return new(t||fc)},fc.\u0275cmp=i.Vb({type:fc,selectors:[["vdr-payment-detail"]],inputs:{payment:"payment",currencyCode:"currencyCode"},decls:12,vars:17,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"value"]],template:function(t,e){1&t&&(i.hc(0,"vdr-labeled-data",0),i.sc(1,"translate"),i.Vc(2),i.gc(),i.hc(3,"vdr-labeled-data",0),i.sc(4,"translate"),i.Vc(5),i.sc(6,"localeCurrency"),i.gc(),i.Tc(7,dc,3,4,"vdr-labeled-data",1),i.Tc(8,uc,3,4,"vdr-labeled-data",1),i.hc(9,"vdr-labeled-data",0),i.sc(10,"translate"),i.cc(11,"vdr-object-tree",2),i.gc()),2&t&&(i.yc("label",i.tc(1,8,"order.payment-method")),i.Qb(2),i.Xc(" ",e.payment.method,"\n"),i.Qb(1),i.yc("label",i.tc(4,10,"order.amount")),i.Qb(2),i.Xc(" ",i.uc(6,12,e.payment.amount,e.currencyCode),"\n"),i.Qb(2),i.yc("ngIf",e.payment.errorMessage),i.Qb(1),i.yc("ngIf",e.payment.transactionId),i.Qb(1),i.yc("label",i.tc(10,15,"order.payment-metadata")),i.Qb(2),i.yc("value",e.payment.metadata))},directives:[E.a,f.o,q.a],pipes:[u.d,g.a],styles:[""],changeDetection:0});var gc=c("V0to");function mc(t,e){1&t&&(i.hc(0,"span",12),i.Vc(1),i.sc(2,"translate"),i.gc()),2&t&&(i.Qb(1),i.Xc(" ",i.tc(2,1,"order.note-only-visible-to-administrators")," "))}function pc(t,e){1&t&&(i.hc(0,"span",13),i.Vc(1),i.sc(2,"translate"),i.gc()),2&t&&(i.Qb(1),i.Xc(" ",i.tc(2,1,"order.note-visible-to-customer")," "))}function hc(t,e){1&t&&(i.hc(0,"div",11),i.Vc(1),i.sc(2,"translate"),i.gc()),2&t&&(i.Qb(1),i.Xc(" ",i.tc(2,1,"order.history-order-fulfilled")," "))}function bc(t,e){1&t&&(i.hc(0,"div",11),i.Vc(1),i.sc(2,"translate"),i.gc()),2&t&&(i.Qb(1),i.Xc(" ",i.tc(2,1,"order.history-order-cancelled")," "))}const yc=function(t,e){return{from:t,to:e}};function vc(t,e){if(1&t&&(i.Vc(0),i.sc(1,"translate")),2&t){const t=i.rc(2).$implicit;i.Xc(" ",i.uc(1,1,"order.history-order-transition",i.Dc(4,yc,t.data.from,t.data.to))," ")}}function Cc(t,e){if(1&t&&(i.fc(0),i.Tc(1,hc,3,3,"div",17),i.Tc(2,bc,3,3,"div",17),i.Tc(3,vc,2,7,"ng-template",18),i.ec()),2&t){const t=i.rc().$implicit;i.Qb(1),i.yc("ngIf","Delivered"===t.data.to),i.Qb(1),i.yc("ngIf","Cancelled"===t.data.to),i.Qb(1),i.yc("ngIf","Cancelled"!==t.data.to&&"Delivered"!==t.data.to)}}function Oc(t,e){1&t&&(i.hc(0,"vdr-chip",23),i.Vc(1),i.sc(2,"translate"),i.gc()),2&t&&(i.Qb(1),i.Wc(i.tc(2,1,"order.modification-settled")))}function Qc(t,e){1&t&&(i.hc(0,"vdr-chip",24),i.Vc(1),i.sc(2,"translate"),i.gc()),2&t&&(i.Qb(1),i.Wc(i.tc(2,1,"order.modification-not-settled")))}function Ic(t,e){if(1&t&&(i.fc(0),i.Vc(1),i.sc(2,"translate"),i.hc(3,"strong"),i.Vc(4),i.sc(5,"localeCurrency"),i.gc(),i.Tc(6,Oc,3,3,"vdr-chip",20),i.Tc(7,Qc,3,3,"vdr-chip",21),i.hc(8,"vdr-history-entry-detail"),i.cc(9,"vdr-modification-detail",22),i.gc(),i.ec()),2&t){const t=e.ngIf,c=i.rc(3);i.Qb(1),i.Xc(" ",i.tc(2,6,"order.modify-order-price-difference"),": "),i.Qb(3),i.Wc(i.uc(5,8,t.priceChange,c.order.currencyCode)),i.Qb(2),i.yc("ngIf",t.isSettled),i.Qb(1),i.yc("ngIf",!t.isSettled),i.Qb(2),i.yc("order",c.order)("modification",t)}}function Tc(t,e){if(1&t&&(i.fc(0),i.hc(1,"div",11),i.Vc(2),i.sc(3,"translate"),i.gc(),i.Tc(4,Ic,10,11,"ng-container",19),i.ec()),2&t){const t=i.rc().$implicit,e=i.rc();i.Qb(2),i.Xc(" ",i.tc(3,2,"order.history-order-modified")," "),i.Qb(2),i.yc("ngIf",e.getModification(t.data.modificationId))}}function Pc(t,e){if(1&t&&(i.hc(0,"vdr-history-entry-detail"),i.cc(1,"vdr-payment-detail",27),i.gc()),2&t){const t=e.ngIf,c=i.rc(4);i.Qb(1),i.yc("payment",t)("currencyCode",c.order.currencyCode)}}function Sc(t,e){if(1&t&&(i.fc(0),i.hc(1,"div",11),i.Vc(2),i.sc(3,"translate"),i.gc(),i.Vc(4),i.sc(5,"translate"),i.Tc(6,Pc,2,2,"vdr-history-entry-detail",19),i.ec()),2&t){const t=i.rc(2).$implicit,e=i.rc();let c=null;i.Qb(2),i.Xc(" ",i.tc(3,4,"order.history-payment-settled")," "),i.Qb(2),i.Yc(" ",i.tc(5,6,"order.transaction-id"),": ",null==(c=e.getPayment(t))?null:c.transactionId," "),i.Qb(2),i.yc("ngIf",e.getPayment(t))}}const Mc=function(t,e,c){return{from:t,to:e,id:c}};function Vc(t,e){if(1&t&&(i.Vc(0),i.sc(1,"translate")),2&t){const t=i.rc(2).$implicit,e=i.rc();let c=null;i.Xc(" ",i.uc(1,1,"order.history-payment-transition",i.Ec(4,Mc,t.data.from,t.data.to,null==(c=e.getPayment(t))?null:c.transactionId))," ")}}function xc(t,e){if(1&t&&(i.fc(0),i.Tc(1,Sc,7,8,"ng-container",25),i.Tc(2,Vc,2,8,"ng-template",null,26,i.Uc),i.ec()),2&t){const t=i.Ic(3),e=i.rc().$implicit;i.Qb(1),i.yc("ngIf","Settled"===e.data.to)("ngIfElse",t)}}function Fc(t,e){if(1&t&&(i.fc(0),i.Vc(1),i.sc(2,"translate"),i.ec()),2&t){const t=i.rc().$implicit;i.Qb(1),i.Xc(" ",i.uc(2,1,"order.history-refund-transition",i.Ec(4,Mc,t.data.from,t.data.to,t.data.refundId))," ")}}function wc(t,e){if(1&t&&(i.hc(0,"vdr-history-entry-detail"),i.hc(1,"vdr-labeled-data",28),i.sc(2,"translate"),i.Vc(3),i.gc(),i.hc(4,"vdr-labeled-data",28),i.sc(5,"translate"),i.cc(6,"vdr-simple-item-list",29),i.gc(),i.gc()),2&t){const t=e.ngIf,c=i.rc(2).$implicit;i.Qb(1),i.yc("label",i.tc(2,4,"order.cancellation-reason")),i.Qb(2),i.Xc(" ",c.data.reason," "),i.Qb(1),i.yc("label",i.tc(5,6,"order.contents")),i.Qb(2),i.yc("items",t)}}const _c=function(t){return{count:t}};function kc(t,e){if(1&t&&(i.fc(0),i.Vc(1),i.sc(2,"translate"),i.Tc(3,wc,7,8,"vdr-history-entry-detail",19),i.ec()),2&t){const t=i.rc().$implicit,e=i.rc();i.Qb(1),i.Xc(" ",i.uc(2,2,"order.history-items-cancelled",i.Cc(5,_c,t.data.orderItemIds.length))," "),i.Qb(2),i.yc("ngIf",e.getCancelledItems(t))}}function Lc(t,e){if(1&t&&(i.hc(0,"vdr-history-entry-detail"),i.cc(1,"vdr-fulfillment-detail",30),i.gc()),2&t){const t=e.ngIf,c=i.rc(3);i.Qb(1),i.yc("fulfillmentId",t.id)("order",c.order)}}function Ac(t,e){if(1&t&&(i.fc(0),i.Vc(1),i.sc(2,"translate"),i.Tc(3,Lc,2,2,"vdr-history-entry-detail",19),i.ec()),2&t){const t=i.rc().$implicit,e=i.rc();i.Qb(1),i.Xc(" ",i.tc(2,2,"order.history-fulfillment-created")," "),i.Qb(2),i.yc("ngIf",e.getFulfillment(t))}}function Dc(t,e){if(1&t&&(i.fc(0),i.hc(1,"div",11),i.Vc(2),i.sc(3,"translate"),i.gc(),i.Vc(4),i.sc(5,"translate"),i.ec()),2&t){const t=i.rc(2).$implicit,e=i.rc();let c=null;i.Qb(2),i.Xc(" ",i.tc(3,3,"order.history-fulfillment-delivered")," "),i.Qb(2),i.Yc(" ",i.tc(5,5,"order.tracking-code"),": ",null==(c=e.getFulfillment(t))?null:c.trackingCode," ")}}function jc(t,e){if(1&t&&(i.fc(0),i.hc(1,"div",11),i.Vc(2),i.sc(3,"translate"),i.gc(),i.Vc(4),i.sc(5,"translate"),i.ec()),2&t){const t=i.rc(2).$implicit,e=i.rc();let c=null;i.Qb(2),i.Xc(" ",i.tc(3,3,"order.history-fulfillment-shipped")," "),i.Qb(2),i.Yc(" ",i.tc(5,5,"order.tracking-code"),": ",null==(c=e.getFulfillment(t))?null:c.trackingCode," ")}}function Wc(t,e){if(1&t&&(i.fc(0),i.Vc(1),i.sc(2,"translate"),i.ec()),2&t){const t=i.rc(2).$implicit;i.Qb(1),i.Xc(" ",i.uc(2,1,"order.history-fulfillment-transition",i.Dc(4,yc,t.data.from,t.data.to))," ")}}function Nc(t,e){if(1&t&&(i.hc(0,"vdr-history-entry-detail"),i.cc(1,"vdr-fulfillment-detail",30),i.gc()),2&t){const t=e.ngIf,c=i.rc(3);i.Qb(1),i.yc("fulfillmentId",t.id)("order",c.order)}}function Rc(t,e){if(1&t&&(i.fc(0),i.Tc(1,Dc,6,7,"ng-container",19),i.Tc(2,jc,6,7,"ng-container",19),i.Tc(3,Wc,3,7,"ng-container",19),i.Tc(4,Nc,2,2,"vdr-history-entry-detail",19),i.ec()),2&t){const t=i.rc().$implicit,e=i.rc();i.Qb(1),i.yc("ngIf","Delivered"===t.data.to),i.Qb(1),i.yc("ngIf","Shipped"===t.data.to),i.Qb(1),i.yc("ngIf","Delivered"!==t.data.to&&"Shipped"!==t.data.to),i.Qb(1),i.yc("ngIf",e.getFulfillment(t))}}function Ec(t,e){1&t&&(i.hc(0,"span",43),i.Vc(1),i.sc(2,"translate"),i.gc()),2&t&&(i.Qb(1),i.Wc(i.tc(2,1,"common.public")))}function Xc(t,e){1&t&&(i.hc(0,"span",44),i.Vc(1),i.sc(2,"translate"),i.gc()),2&t&&(i.Qb(1),i.Wc(i.tc(2,1,"common.private")))}function $c(t,e){if(1&t){const t=i.ic();i.fc(0),i.hc(1,"div",31),i.hc(2,"div",32),i.Tc(3,Ec,3,3,"span",33),i.Tc(4,Xc,3,3,"span",34),i.Vc(5),i.gc(),i.cc(6,"div",35),i.hc(7,"vdr-dropdown"),i.hc(8,"button",36),i.cc(9,"clr-icon",37),i.gc(),i.hc(10,"vdr-dropdown-menu",38),i.hc(11,"button",39),i.pc("click",function(){i.Lc(t);const e=i.rc().$implicit;return i.rc().updateNote.emit(e)}),i.sc(12,"hasPermission"),i.cc(13,"clr-icon",40),i.Vc(14),i.sc(15,"translate"),i.gc(),i.cc(16,"div",41),i.hc(17,"button",39),i.pc("click",function(){i.Lc(t);const e=i.rc().$implicit;return i.rc().deleteNote.emit(e)}),i.sc(18,"hasPermission"),i.cc(19,"clr-icon",42),i.Vc(20),i.sc(21,"translate"),i.gc(),i.gc(),i.gc(),i.gc(),i.ec()}if(2&t){const t=i.rc().$implicit;i.Qb(3),i.yc("ngIf",t.isPublic),i.Qb(1),i.yc("ngIf",!t.isPublic),i.Qb(1),i.Xc(" ",t.data.note," "),i.Qb(6),i.yc("disabled",!i.tc(12,7,"UpdateOrder")),i.Qb(3),i.Xc(" ",i.tc(15,9,"common.edit")," "),i.Qb(3),i.yc("disabled",!i.tc(18,11,"UpdateOrder")),i.Qb(3),i.Xc(" ",i.tc(21,13,"common.delete")," ")}}const qc=function(t){return["/marketing","promotions",t]};function Hc(t,e){if(1&t&&(i.fc(0),i.Vc(1),i.sc(2,"translate"),i.hc(3,"vdr-chip"),i.hc(4,"a",45),i.Vc(5),i.gc(),i.gc(),i.ec()),2&t){const t=i.rc().$implicit;i.Qb(1),i.Xc(" ",i.tc(2,3,"order.history-coupon-code-applied"),": "),i.Qb(3),i.yc("routerLink",i.Cc(5,qc,t.data.promotionId)),i.Qb(1),i.Wc(t.data.couponCode)}}function Uc(t,e){if(1&t&&(i.fc(0),i.Vc(1),i.sc(2,"translate"),i.hc(3,"vdr-chip"),i.hc(4,"span",46),i.Vc(5),i.gc(),i.gc(),i.ec()),2&t){const t=i.rc().$implicit;i.Qb(1),i.Xc(" ",i.tc(2,2,"order.history-coupon-code-removed"),": "),i.Qb(4),i.Wc(t.data.couponCode)}}function zc(t,e){if(1&t){const t=i.ic();i.hc(0,"vdr-timeline-entry",14),i.pc("expandClick",function(){i.Lc(t);const e=i.rc();return e.expanded=!e.expanded}),i.fc(1,15),i.Tc(2,Cc,4,3,"ng-container",16),i.Tc(3,Tc,5,4,"ng-container",16),i.Tc(4,xc,4,2,"ng-container",16),i.Tc(5,Fc,3,8,"ng-container",16),i.Tc(6,kc,4,7,"ng-container",16),i.Tc(7,Ac,4,4,"ng-container",16),i.Tc(8,Rc,5,4,"ng-container",16),i.Tc(9,$c,22,15,"ng-container",16),i.Tc(10,Hc,6,7,"ng-container",16),i.Tc(11,Uc,6,4,"ng-container",16),i.ec(),i.gc()}if(2&t){const t=e.$implicit,c=i.rc();i.yc("displayType",c.getDisplayType(t))("iconShape",c.getTimelineIcon(t))("createdAt",t.createdAt)("name",c.getName(t))("featured",c.isFeatured(t))("collapsed",!c.expanded&&!c.isFeatured(t)),i.Qb(1),i.yc("ngSwitch",t.type),i.Qb(1),i.yc("ngSwitchCase",c.type.ORDER_STATE_TRANSITION),i.Qb(1),i.yc("ngSwitchCase",c.type.ORDER_MODIFIED),i.Qb(1),i.yc("ngSwitchCase",c.type.ORDER_PAYMENT_TRANSITION),i.Qb(1),i.yc("ngSwitchCase",c.type.ORDER_REFUND_TRANSITION),i.Qb(1),i.yc("ngSwitchCase",c.type.ORDER_CANCELLATION),i.Qb(1),i.yc("ngSwitchCase",c.type.ORDER_FULFILLMENT),i.Qb(1),i.yc("ngSwitchCase",c.type.ORDER_FULFILLMENT_TRANSITION),i.Qb(1),i.yc("ngSwitchCase",c.type.ORDER_NOTE),i.Qb(1),i.yc("ngSwitchCase",c.type.ORDER_COUPON_APPLIED),i.Qb(1),i.yc("ngSwitchCase",c.type.ORDER_COUPON_REMOVED)}}class Bc{constructor(){this.addNote=new i.t,this.updateNote=new i.t,this.deleteNote=new i.t,this.note="",this.noteIsPrivate=!0,this.expanded=!1,this.type=r.y}getDisplayType(t){if(t.type===r.y.ORDER_STATE_TRANSITION){if("Delivered"===t.data.to)return"success";if("Cancelled"===t.data.to)return"error"}return t.type===r.y.ORDER_FULFILLMENT_TRANSITION&&"Delivered"===t.data.to?"success":t.type!==r.y.ORDER_PAYMENT_TRANSITION||"Declined"!==t.data.to&&"Cancelled"!==t.data.to?t.type===r.y.ORDER_CANCELLATION?"error":t.type===r.y.ORDER_REFUND_TRANSITION?"warning":"default":"error"}getTimelineIcon(t){if(t.type===r.y.ORDER_STATE_TRANSITION){if("Delivered"===t.data.to)return["success-standard","is-solid"];if("Cancelled"===t.data.to)return"ban"}if(t.type===r.y.ORDER_PAYMENT_TRANSITION&&"Settled"===t.data.to)return"credit-card";if(t.type===r.y.ORDER_NOTE)return"note";if(t.type===r.y.ORDER_MODIFIED)return"pencil";if(t.type===r.y.ORDER_FULFILLMENT_TRANSITION){if("Shipped"===t.data.to)return"truck";if("Delivered"===t.data.to)return"truck"}}isFeatured(t){switch(t.type){case r.y.ORDER_STATE_TRANSITION:return"Delivered"===t.data.to||"Cancelled"===t.data.to||"Settled"===t.data.to;case r.y.ORDER_PAYMENT_TRANSITION:return"Settled"===t.data.to||"Cancelled"===t.data.to;case r.y.ORDER_FULFILLMENT_TRANSITION:return"Delivered"===t.data.to||"Shipped"===t.data.to;case r.y.ORDER_NOTE:case r.y.ORDER_MODIFIED:return!0;default:return!1}}getFulfillment(t){if((t.type===r.y.ORDER_FULFILLMENT||t.type===r.y.ORDER_FULFILLMENT_TRANSITION)&&this.order.fulfillments)return this.order.fulfillments.find(e=>e.id===t.data.fulfillmentId)}getPayment(t){if(t.type===r.y.ORDER_PAYMENT_TRANSITION&&this.order.payments)return this.order.payments.find(e=>e.id===t.data.paymentId)}getCancelledItems(t){const e=new Map,c=t.data.orderItemIds;for(const n of this.order.lines)for(const t of n.items)if(c.includes(t.id)){const t=e.get(n.productVariant.name);null!=t?e.set(n.productVariant.name,t+1):e.set(n.productVariant.name,1)}return Array.from(e.entries()).map(([t,e])=>({name:t,quantity:e}))}getModification(t){return this.order.modifications.find(e=>e.id===t)}getName(t){const{administrator:e}=t;if(e)return`${e.firstName} ${e.lastName}`;{const t=this.order.customer;if(t)return`${t.firstName} ${t.lastName}`}return""}addNoteToOrder(){this.addNote.emit({note:this.note,isPublic:!this.noteIsPrivate}),this.note="",this.noteIsPrivate=!0}}Bc.\u0275fac=function(t){return new(t||Bc)},Bc.\u0275cmp=i.Vb({type:Bc,selectors:[["vdr-order-history"]],inputs:{order:"order",history:"history"},outputs:{addNote:"addNote",updateNote:"updateNote",deleteNote:"deleteNote"},decls:23,vars:24,consts:[[1,"entry-list"],["iconShape","note","displayType","muted",3,"featured"],[1,"note-entry"],["name","note",1,"note",3,"ngModel","ngModelChange"],[1,"btn","btn-secondary",3,"disabled","click"],[1,"visibility-select"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],["class","private",4,"ngIf"],["class","public",4,"ngIf"],[3,"displayType","iconShape","createdAt","name","featured","collapsed","expandClick",4,"ngFor","ngForOf"],[3,"isLast","createdAt","featured"],[1,"title"],[1,"private"],[1,"public"],[3,"displayType","iconShape","createdAt","name","featured","collapsed","expandClick"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","title",4,"ngIf"],[3,"ngIf"],[4,"ngIf"],["colorType","success",4,"ngIf"],["colorType","error",4,"ngIf"],[3,"order","modification"],["colorType","success"],["colorType","error"],[4,"ngIf","ngIfElse"],["regularPaymentTransition",""],[3,"payment","currencyCode"],[3,"label"],[3,"items"],[3,"fulfillmentId","order"],[1,"flex"],[1,"note-text"],["class","note-visibility public",4,"ngIf"],["class","note-visibility private",4,"ngIf"],[1,"flex-spacer"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["vdrDropdownItem","",1,"button",3,"disabled","click"],["shape","edit"],[1,"dropdown-divider"],["shape","trash",1,"is-danger"],[1,"note-visibility","public"],[1,"note-visibility","private"],[3,"routerLink"],[1,"cancelled-coupon-code"]],template:function(t,e){1&t&&(i.hc(0,"h4"),i.Vc(1),i.sc(2,"translate"),i.gc(),i.hc(3,"div",0),i.hc(4,"vdr-timeline-entry",1),i.hc(5,"div",2),i.hc(6,"textarea",3),i.pc("ngModelChange",function(t){return e.note=t}),i.gc(),i.hc(7,"button",4),i.pc("click",function(){return e.addNoteToOrder()}),i.Vc(8),i.sc(9,"translate"),i.gc(),i.gc(),i.hc(10,"div",5),i.hc(11,"clr-checkbox-wrapper"),i.hc(12,"input",6),i.pc("ngModelChange",function(t){return e.noteIsPrivate=t}),i.gc(),i.hc(13,"label"),i.Vc(14),i.sc(15,"translate"),i.gc(),i.gc(),i.Tc(16,mc,3,3,"span",7),i.Tc(17,pc,3,3,"span",8),i.gc(),i.gc(),i.Tc(18,zc,12,17,"vdr-timeline-entry",9),i.hc(19,"vdr-timeline-entry",10),i.hc(20,"div",11),i.Vc(21),i.sc(22,"translate"),i.gc(),i.gc(),i.gc()),2&t&&(i.Qb(1),i.Wc(i.tc(2,16,"order.order-history")),i.Qb(2),i.Tb("expanded",e.expanded),i.Qb(1),i.yc("featured",!0),i.Qb(2),i.yc("ngModel",e.note),i.Qb(1),i.yc("disabled",!e.note),i.Qb(1),i.Xc(" ",i.tc(9,18,"common.add-note")," "),i.Qb(4),i.yc("ngModel",e.noteIsPrivate),i.Qb(2),i.Wc(i.tc(15,20,"order.note-is-private")),i.Qb(2),i.yc("ngIf",e.noteIsPrivate),i.Qb(1),i.yc("ngIf",!e.noteIsPrivate),i.Qb(1),i.yc("ngForOf",e.history),i.Qb(1),i.yc("isLast",!0)("createdAt",e.order.createdAt)("featured",!0),i.Qb(2),i.Xc(" ",i.tc(22,22,"order.history-order-created")," "))},directives:[sc.a,l.a,n.b,n.p,n.s,y.k,n.a,y.i,y.u,f.o,f.n,f.q,f.r,lc.a,Ft,D.a,fc,E.a,$,Z,J.a,K.a,y.o,tt.a,et.a,Ne.h],pipes:[u.d,g.a,gc.a],styles:["[_nghost-%COMP%]{margin-top:48px;display:block}.entry-list[_ngcontent-%COMP%]{margin-top:24px;margin-left:24px;margin-right:12px}.note-entry[_ngcontent-%COMP%]{display:flex;align-items:center}.note-entry[_ngcontent-%COMP%]   .note[_ngcontent-%COMP%]{flex:1}.note-entry[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0}.visibility-select[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:baseline}.visibility-select[_ngcontent-%COMP%]   .public[_ngcontent-%COMP%]{color:var(--color-warning-500)}.visibility-select[_ngcontent-%COMP%]   .private[_ngcontent-%COMP%]{color:var(--color-success-500)}textarea.note[_ngcontent-%COMP%]{flex:1;height:36px;border-radius:3px;margin-right:6px}.note-text[_ngcontent-%COMP%]{color:var(--color-grey-800);white-space:pre-wrap}.cancelled-coupon-code[_ngcontent-%COMP%]{text-decoration:line-through}.note-visibility[_ngcontent-%COMP%]{text-transform:lowercase}.note-visibility.public[_ngcontent-%COMP%]{color:var(--color-warning-500)}.note-visibility.private[_ngcontent-%COMP%]{color:var(--color-success-500)}"],changeDetection:0});var Gc=c("dBS1");function Yc(t,e){1&t&&i.cc(0,"clr-icon",2)}class Zc{get chipColorType(){switch(this.state){case"Authorized":return"warning";case"Settled":return"success";case"Declined":case"Cancelled":return"error"}}}function Jc(t,e){1&t&&i.cc(0,"clr-icon",2)}Zc.\u0275fac=function(t){return new(t||Zc)},Zc.\u0275cmp=i.Vb({type:Zc,selectors:[["vdr-payment-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(t,e){1&t&&(i.hc(0,"vdr-chip",0),i.sc(1,"translate"),i.Tc(2,Yc,1,0,"clr-icon",1),i.Vc(3),i.sc(4,"translate"),i.sc(5,"stateI18nToken"),i.gc()),2&t&&(i.yc("title",i.tc(1,4,"order.payment-state"))("colorType",e.chipColorType),i.Qb(2),i.yc("ngIf","Settled"===e.state),i.Qb(1),i.Xc(" ",i.tc(4,6,i.tc(5,8,e.state)),"\n"))},directives:[D.a,f.o,y.o],pipes:[u.d,j.a],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0});class Kc{get chipColorType(){switch(this.state){case"Pending":return"warning";case"Settled":return"success";case"Failed":return"error"}}}function tn(t,e){if(1&t&&(i.fc(0),i.Vc(1),i.ec()),2&t){const t=i.rc();i.Qb(1),i.Xc("#",t.payment.transactionId,"")}}function en(t,e){if(1&t&&(i.hc(0,"vdr-labeled-data",11),i.sc(1,"translate"),i.Vc(2),i.gc()),2&t){const t=i.rc().$implicit;i.yc("label",i.tc(1,2,"order.transaction-id")),i.Qb(2),i.Xc(" ",t.transactionId," ")}}function cn(t,e){if(1&t&&(i.hc(0,"vdr-labeled-data",11),i.sc(1,"translate"),i.Vc(2),i.gc()),2&t){const t=i.rc().$implicit;i.yc("label",i.tc(1,2,"order.refund-reason")),i.Qb(2),i.Xc(" ",t.reason," ")}}function nn(t,e){if(1&t&&(i.hc(0,"vdr-labeled-data",11),i.sc(1,"translate"),i.cc(2,"vdr-object-tree",13),i.gc()),2&t){const t=i.rc().$implicit;i.yc("label",i.tc(1,2,"order.refund-metadata")),i.Qb(2),i.yc("value",t.metadata)}}function rn(t,e){if(1&t){const t=i.ic();i.hc(0,"div",14),i.hc(1,"button",15),i.pc("click",function(){i.Lc(t);const e=i.rc().$implicit;return i.rc().settleRefund.emit(e)}),i.Vc(2),i.sc(3,"translate"),i.gc(),i.gc()}2&t&&(i.Qb(2),i.Xc(" ",i.tc(3,1,"order.settle-refund")," "))}function on(t,e){if(1&t&&(i.fc(0),i.hc(1,"div",1),i.cc(2,"clr-icon",9),i.Vc(3),i.sc(4,"translate"),i.cc(5,"div",10),i.cc(6,"vdr-refund-state-label",4),i.gc(),i.hc(7,"div",5),i.hc(8,"vdr-labeled-data",11),i.sc(9,"translate"),i.Vc(10),i.sc(11,"localeDate"),i.gc(),i.hc(12,"vdr-labeled-data",11),i.sc(13,"translate"),i.Vc(14),i.sc(15,"localeCurrency"),i.gc(),i.Tc(16,en,3,4,"vdr-labeled-data",12),i.Tc(17,cn,3,4,"vdr-labeled-data",12),i.Tc(18,nn,3,4,"vdr-labeled-data",12),i.gc(),i.Tc(19,rn,4,3,"div",8),i.ec()),2&t){const t=e.$implicit,c=i.rc();i.Qb(3),i.Yc(" ",i.tc(4,11,"order.refund")," #",t.id," "),i.Qb(3),i.yc("state",t.state),i.Qb(2),i.yc("label",i.tc(9,13,"common.created-at")),i.Qb(2),i.Xc(" ",i.uc(11,15,t.createdAt,"medium")," "),i.Qb(2),i.yc("label",i.tc(13,18,"order.refund-total")),i.Qb(2),i.Xc(" ",i.uc(15,20,t.total,c.currencyCode)," "),i.Qb(2),i.yc("ngIf",t.transactionId),i.Qb(1),i.yc("ngIf",t.reason),i.Qb(1),i.yc("ngIf",c.refundHasMetadata(t)),i.Qb(1),i.yc("ngIf","Pending"===t.state)}}function an(t,e){if(1&t){const t=i.ic();i.hc(0,"button",15),i.pc("click",function(){i.Lc(t);const e=i.rc(2);return e.settlePayment.emit(e.payment)}),i.Vc(1),i.sc(2,"translate"),i.gc()}2&t&&(i.Qb(1),i.Xc(" ",i.tc(2,1,"order.settle-payment")," "))}Kc.\u0275fac=function(t){return new(t||Kc)},Kc.\u0275cmp=i.Vb({type:Kc,selectors:[["vdr-refund-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(t,e){1&t&&(i.hc(0,"vdr-chip",0),i.sc(1,"translate"),i.Tc(2,Jc,1,0,"clr-icon",1),i.Vc(3),i.sc(4,"translate"),i.sc(5,"stateI18nToken"),i.gc()),2&t&&(i.yc("title",i.tc(1,4,"order.payment-state"))("colorType",e.chipColorType),i.Qb(2),i.yc("ngIf","Settled"===e.state),i.Qb(1),i.Xc(" ",i.tc(4,6,i.tc(5,8,e.state)),"\n"))},directives:[D.a,f.o,y.o],pipes:[u.d,j.a],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0});const sn=function(t){return{state:t}};function ln(t,e){if(1&t&&(i.fc(0),i.cc(1,"clr-icon",23),i.Vc(2),i.sc(3,"translate"),i.sc(4,"translate"),i.sc(5,"stateI18nToken"),i.ec()),2&t){const t=i.rc().$implicit;i.Qb(2),i.Xc(" ",i.uc(3,1,"order.transition-to-state",i.Cc(8,sn,i.tc(4,4,i.tc(5,6,t))))," ")}}function dn(t,e){1&t&&(i.cc(0,"clr-icon",24),i.Vc(1),i.sc(2,"translate")),2&t&&(i.Qb(1),i.Xc(" ",i.tc(2,1,"order.cancel-payment")," "))}function un(t,e){if(1&t){const t=i.ic();i.fc(0),i.hc(1,"button",20),i.pc("click",function(){i.Lc(t);const c=e.$implicit,n=i.rc(2);return n.transitionPaymentState.emit({payment:n.payment,state:c})}),i.Tc(2,ln,6,10,"ng-container",21),i.Tc(3,dn,3,3,"ng-template",null,22,i.Uc),i.gc(),i.ec()}if(2&t){const t=e.$implicit,c=i.Ic(4);i.Qb(2),i.yc("ngIf","Cancelled"!==t)("ngIfElse",c)}}function fn(t,e){if(1&t&&(i.hc(0,"div",14),i.Tc(1,an,3,3,"button",16),i.hc(2,"vdr-dropdown"),i.hc(3,"button",17),i.cc(4,"clr-icon",18),i.gc(),i.hc(5,"vdr-dropdown-menu",19),i.Tc(6,un,5,2,"ng-container",7),i.gc(),i.gc(),i.gc()),2&t){const t=i.rc();i.Qb(1),i.yc("ngIf",t.payment.nextStates.includes("Settled")),i.Qb(5),i.yc("ngForOf",t.nextOtherStates())}}class gn{constructor(){this.settlePayment=new i.t,this.transitionPaymentState=new i.t,this.settleRefund=new i.t}refundHasMetadata(t){return!!t&&Object.keys(t.metadata).length>0}nextOtherStates(){return this.payment?this.payment.nextStates.filter(t=>"Settled"!==t):[]}}function mn(t,e){if(1&t){const t=i.ic();i.hc(0,"button",16),i.pc("click",function(){i.Lc(t);const e=i.rc().ngIf;return i.rc().addManualPayment(e)}),i.Vc(1),i.sc(2,"translate"),i.sc(3,"localeCurrency"),i.gc()}if(2&t){const t=i.rc().ngIf,e=i.rc();i.Qb(1),i.Yc(" ",i.tc(2,2,"order.add-payment-to-order")," (",i.uc(3,4,e.outstandingPaymentAmount(t),t.currencyCode),") ")}}function pn(t,e){if(1&t){const t=i.ic();i.hc(0,"button",16),i.pc("click",function(){i.Lc(t);return i.rc(2).transitionToState("ArrangingAdditionalPayment")}),i.Vc(1),i.sc(2,"translate"),i.gc()}2&t&&(i.Qb(1),i.Xc(" ",i.tc(2,1,"order.arrange-additional-payment")," "))}function hn(t,e){if(1&t){const t=i.ic();i.fc(0),i.hc(1,"button",14),i.pc("click",function(){i.Lc(t);return i.rc(2).transitionToModifying()}),i.cc(2,"clr-icon",17),i.Vc(3),i.sc(4,"translate"),i.gc(),i.cc(5,"div",13),i.ec()}2&t&&(i.Qb(3),i.Xc(" ",i.tc(4,1,"order.modify-order")," "))}function bn(t,e){1&t&&(i.fc(0),i.Vc(1),i.sc(2,"translate"),i.ec()),2&t&&(i.Qb(1),i.Xc(" ",i.tc(2,1,"order.refund-and-cancel-order")," "))}function yn(t,e){1&t&&(i.Vc(0),i.sc(1,"translate")),2&t&&i.Xc(" ",i.tc(1,1,"order.cancel-order")," ")}function vn(t,e){if(1&t){const t=i.ic();i.hc(0,"button",14),i.pc("click",function(){i.Lc(t);const e=i.rc().ngIf;return i.rc().cancelOrRefund(e)}),i.cc(1,"clr-icon",18),i.Tc(2,bn,3,3,"ng-container",19),i.Tc(3,yn,2,3,"ng-template",null,20,i.Uc),i.gc()}if(2&t){const t=i.Ic(4),e=i.rc().ngIf,c=i.rc();i.Qb(2),i.yc("ngIf",c.orderHasSettledPayments(e))("ngIfElse",t)}}gn.\u0275fac=function(t){return new(t||gn)},gn.\u0275cmp=i.Vb({type:gn,selectors:[["vdr-order-payment-card"]],inputs:{payment:"payment",currencyCode:"currencyCode"},outputs:{settlePayment:"settlePayment",transitionPaymentState:"transitionPaymentState",settleRefund:"settleRefund"},decls:12,vars:9,consts:[[1,"card"],[1,"card-header","payment-header"],[4,"ngIf"],[1,"payment-state"],[3,"state"],[1,"card-block"],[3,"payment","currencyCode"],[4,"ngFor","ngForOf"],["class","card-footer",4,"ngIf"],["shape","redo","dir","down",1,"refund-icon"],[1,"clr-flex-fill"],[3,"label"],[3,"label",4,"ngIf"],[3,"value"],[1,"card-footer"],[1,"btn","btn-sm","btn-primary",3,"click"],["class","btn btn-sm btn-primary",3,"click",4,"ngIf"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"btn",3,"click"],[4,"ngIf","ngIfElse"],["cancel",""],["shape","step-forward-2"],["shape","error-standard",1,"is-error"]],template:function(t,e){1&t&&(i.hc(0,"div",0),i.hc(1,"div",1),i.hc(2,"div"),i.Vc(3),i.sc(4,"translate"),i.Tc(5,tn,2,1,"ng-container",2),i.gc(),i.hc(6,"div",3),i.cc(7,"vdr-payment-state-label",4),i.gc(),i.gc(),i.hc(8,"div",5),i.cc(9,"vdr-payment-detail",6),i.gc(),i.Tc(10,on,20,23,"ng-container",7),i.Tc(11,fn,7,2,"div",8),i.gc()),2&t&&(i.Qb(3),i.Xc(" ",i.tc(4,7,"order.payment")," "),i.Qb(2),i.yc("ngIf",e.payment.transactionId),i.Qb(2),i.yc("state",e.payment.state),i.Qb(2),i.yc("payment",e.payment)("currencyCode",e.currencyCode),i.Qb(1),i.yc("ngForOf",e.payment.refunds),i.Qb(1),i.yc("ngIf",e.payment.nextStates.length))},directives:[f.o,Zc,fc,f.n,y.o,Qt.b,Kc,E.a,q.a,J.a,K.a,tt.a,et.a],pipes:[u.d,H.a,g.a,j.a],styles:[".payment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.refund-icon[_ngcontent-%COMP%]{margin-right:6px;color:var(--color-grey-400)}.card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}"],changeDetection:0});const Cn=function(t){return{state:t}};function On(t,e){if(1&t){const t=i.ic();i.hc(0,"button",14),i.pc("click",function(){i.Lc(t);const c=e.$implicit;return i.rc(3).transitionToState(c)}),i.cc(1,"clr-icon",22),i.Vc(2),i.sc(3,"translate"),i.sc(4,"translate"),i.sc(5,"stateI18nToken"),i.gc()}if(2&t){const t=e.$implicit;i.Qb(2),i.Xc(" ",i.uc(3,1,"order.transition-to-state",i.Cc(8,Cn,i.tc(4,4,i.tc(5,6,t))))," ")}}function Qn(t,e){if(1&t&&(i.fc(0),i.cc(1,"div",13),i.Tc(2,On,6,10,"button",21),i.sc(3,"async"),i.ec()),2&t){const t=i.rc(2);i.Qb(2),i.yc("ngForOf",i.tc(3,1,t.nextStates$))}}function In(t,e){if(1&t){const t=i.ic();i.hc(0,"vdr-action-bar"),i.hc(1,"vdr-ab-left"),i.hc(2,"div",1),i.cc(3,"vdr-entity-info",2),i.sc(4,"async"),i.hc(5,"vdr-order-state-label",3),i.hc(6,"button",4),i.pc("click",function(){i.Lc(t);return i.rc().openStateDiagram()}),i.sc(7,"translate"),i.cc(8,"clr-icon",5),i.gc(),i.gc(),i.gc(),i.gc(),i.hc(9,"vdr-ab-right"),i.cc(10,"vdr-action-bar-items",6),i.Tc(11,mn,4,7,"button",7),i.Tc(12,pn,3,3,"button",7),i.hc(13,"button",8),i.pc("click",function(){i.Lc(t);return i.rc().fulfillOrder()}),i.Vc(14),i.sc(15,"translate"),i.gc(),i.hc(16,"vdr-dropdown"),i.hc(17,"button",9),i.cc(18,"clr-icon",10),i.gc(),i.hc(19,"vdr-dropdown-menu",11),i.Tc(20,hn,6,3,"ng-container",0),i.Tc(21,vn,5,2,"button",12),i.Tc(22,Qn,4,3,"ng-container",0),i.sc(23,"async"),i.cc(24,"div",13),i.hc(25,"button",14),i.pc("click",function(){i.Lc(t);const c=e.ngIf;return i.rc().manuallyTransitionToState(c)}),i.cc(26,"clr-icon",15),i.Vc(27),i.sc(28,"translate"),i.gc(),i.gc(),i.gc(),i.gc(),i.gc()}if(2&t){const t=e.ngIf,c=i.rc();let n=null;i.Qb(3),i.yc("entity",i.tc(4,11,c.entity$)),i.Qb(2),i.yc("state",t.state),i.Qb(1),i.yc("title",i.tc(7,13,"order.order-state-diagram")),i.Qb(5),i.yc("ngIf","ArrangingAdditionalPayment"===t.state&&(c.hasUnsettledModifications(t)||0<c.outstandingPaymentAmount(t))),i.Qb(1),i.yc("ngIf","ArrangingAdditionalPayment"!==t.state&&0<c.outstandingPaymentAmount(t)),i.Qb(1),i.yc("disabled",!c.canAddFulfillment(t)),i.Qb(1),i.Xc(" ",i.tc(15,15,"order.fulfill-order")," "),i.Qb(6),i.yc("ngIf",t.nextStates.includes("Modifying")),i.Qb(1),i.yc("ngIf",t.nextStates.includes("Cancelled")),i.Qb(1),i.yc("ngIf",null==(n=i.tc(23,17,c.nextStates$))?null:n.length),i.Qb(5),i.Xc(" ",i.tc(28,19,"order.manually-transition-to-state")," ")}}function Tn(t,e){if(1&t&&(i.hc(0,"tr"),i.hc(1,"td"),i.Vc(2),i.gc(),i.hc(3,"td"),i.Vc(4),i.sc(5,"percent"),i.gc(),i.hc(6,"td"),i.Vc(7),i.sc(8,"localeCurrency"),i.gc(),i.hc(9,"td"),i.Vc(10),i.sc(11,"localeCurrency"),i.gc(),i.gc()),2&t){const t=e.$implicit,c=i.rc().ngIf;i.Qb(2),i.Wc(t.description),i.Qb(2),i.Wc(i.tc(5,4,t.taxRate/100)),i.Qb(3),i.Wc(i.uc(8,6,t.taxBase,c.currencyCode)),i.Qb(3),i.Wc(i.uc(11,9,t.taxTotal,c.currencyCode))}}function Pn(t,e){1&t&&(i.hc(0,"h6"),i.Vc(1),i.sc(2,"translate"),i.gc()),2&t&&(i.Qb(1),i.Xc(" ",i.tc(2,1,"order.shipping-address")," "))}function Sn(t,e){1&t&&(i.hc(0,"h6"),i.Vc(1),i.sc(2,"translate"),i.gc()),2&t&&(i.Qb(1),i.Xc(" ",i.tc(2,1,"order.billing-address")," "))}function Mn(t,e){if(1&t){const t=i.ic();i.hc(0,"vdr-order-payment-card",38),i.pc("settlePayment",function(e){i.Lc(t);return i.rc(3).settlePayment(e)})("transitionPaymentState",function(e){i.Lc(t);return i.rc(3).transitionPaymentState(e)})("settleRefund",function(e){i.Lc(t);return i.rc(3).settleRefund(e)}),i.gc()}if(2&t){const t=e.$implicit,c=i.rc(2).ngIf;i.yc("currencyCode",c.currencyCode)("payment",t)}}function Vn(t,e){if(1&t&&(i.fc(0),i.Tc(1,Mn,1,2,"vdr-order-payment-card",37),i.ec()),2&t){const t=i.rc().ngIf;i.Qb(1),i.yc("ngForOf",t.payments)}}function xn(t,e){if(1&t){const t=i.ic();i.fc(0),i.hc(1,"vdr-fulfillment-card",39),i.pc("transitionState",function(c){i.Lc(t);const n=e.$implicit;return i.rc(2).transitionFulfillment(n.id,c)}),i.gc(),i.ec()}if(2&t){const t=e.$implicit,c=i.rc().ngIf;i.Qb(1),i.yc("fulfillment",t)("order",c)}}function Fn(t,e){if(1&t){const t=i.ic();i.hc(0,"div"),i.hc(1,"div",23),i.hc(2,"div",24),i.cc(3,"vdr-order-table",25),i.hc(4,"h4"),i.Vc(5),i.sc(6,"translate"),i.gc(),i.hc(7,"table",26),i.hc(8,"thead"),i.hc(9,"tr"),i.hc(10,"th"),i.Vc(11),i.sc(12,"translate"),i.gc(),i.hc(13,"th"),i.Vc(14),i.sc(15,"translate"),i.gc(),i.hc(16,"th"),i.Vc(17),i.sc(18,"translate"),i.gc(),i.hc(19,"th"),i.Vc(20),i.sc(21,"translate"),i.gc(),i.gc(),i.gc(),i.hc(22,"tbody"),i.Tc(23,Tn,12,12,"tr",27),i.gc(),i.gc(),i.hc(24,"vdr-order-history",28),i.pc("addNote",function(e){i.Lc(t);return i.rc().addNote(e)})("updateNote",function(e){i.Lc(t);return i.rc().updateNote(e)})("deleteNote",function(e){i.Lc(t);return i.rc().deleteNote(e)}),i.sc(25,"async"),i.gc(),i.gc(),i.hc(26,"div",29),i.hc(27,"vdr-order-custom-fields-card",30),i.pc("updateClick",function(e){i.Lc(t);return i.rc().updateCustomFields(e)}),i.gc(),i.hc(28,"div",31),i.hc(29,"div",32),i.Vc(30),i.sc(31,"translate"),i.gc(),i.hc(32,"div",33),i.hc(33,"div",34),i.cc(34,"vdr-customer-label",35),i.Tc(35,Pn,3,3,"h6",0),i.cc(36,"vdr-formatted-address",36),i.Tc(37,Sn,3,3,"h6",0),i.cc(38,"vdr-formatted-address",36),i.gc(),i.gc(),i.gc(),i.Tc(39,Vn,2,1,"ng-container",0),i.Tc(40,xn,2,2,"ng-container",27),i.gc(),i.gc(),i.gc()}if(2&t){const t=e.ngIf,c=i.rc();i.Qb(3),i.yc("order",t)("orderLineCustomFields",c.orderLineCustomFields),i.Qb(2),i.Wc(i.tc(6,20,"order.tax-summary")),i.Qb(6),i.Wc(i.tc(12,22,"common.description")),i.Qb(3),i.Wc(i.tc(15,24,"order.tax-rate")),i.Qb(3),i.Wc(i.tc(18,26,"order.tax-base")),i.Qb(3),i.Wc(i.tc(21,28,"order.tax-total")),i.Qb(3),i.yc("ngForOf",t.taxSummary),i.Qb(1),i.yc("order",t)("history",i.tc(25,30,c.history$)),i.Qb(3),i.yc("customFieldsConfig",c.customFields)("customFieldValues",t.customFields),i.Qb(3),i.Xc(" ",i.tc(31,32,"order.customer")," "),i.Qb(4),i.yc("customer",t.customer),i.Qb(1),i.yc("ngIf",c.getOrderAddressLines(t.shippingAddress).length),i.Qb(1),i.yc("address",t.shippingAddress),i.Qb(1),i.yc("ngIf",c.getOrderAddressLines(t.billingAddress).length),i.Qb(1),i.yc("address",t.billingAddress),i.Qb(1),i.yc("ngIf",t.payments&&t.payments.length),i.Qb(1),i.yc("ngForOf",t.fulfillments)}}class wn extends r.l{constructor(t,e,c,r,i,o,a,s){super(e,t,c,i),this.changeDetector=r,this.dataService=i,this.notificationService=o,this.modalService=a,this.orderTransitionService=s,this.detailForm=new n.i({}),this.fetchHistory=new Wt.a,this.defaultStates=["AddingItems","ArrangingPayment","PaymentAuthorized","PaymentSettled","PartiallyShipped","Shipped","PartiallyDelivered","Delivered","Cancelled","Modifying","ArrangingAdditionalPayment"]}ngOnInit(){this.init(),this.entity$.pipe(Object(Xt.a)(1)).subscribe(t=>{"Modifying"===t.state&&this.router.navigate(["./","modify"],{relativeTo:this.route})}),this.customFields=this.getCustomFieldConfig("Order"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.history$=this.fetchHistory.pipe(Object($t.a)(null),Object(qt.a)(()=>this.dataService.order.getOrderHistory(this.id,{sort:{createdAt:r.L.DESC}}).mapStream(t=>{var e;return null===(e=t.order)||void 0===e?void 0:e.history.items}))),this.nextStates$=this.entity$.pipe(Object(Ht.a)(t=>!this.defaultStates.includes(t.state)?t.nextStates:t.nextStates.filter(t=>!this.defaultStates.includes(t))))}ngOnDestroy(){this.destroy()}openStateDiagram(){this.entity$.pipe(Object(Xt.a)(1),Object(qt.a)(t=>this.modalService.fromComponent(he,{closable:!0,locals:{activeState:t.state}}))).subscribe()}transitionToState(t){this.dataService.order.transitionToState(this.id,t).subscribe(({transitionOrderToState:e})=>{switch(null==e?void 0:e.__typename){case"Order":this.notificationService.success(Object(b.a)("order.transitioned-to-state-success"),{state:t}),this.fetchHistory.next();break;case"OrderStateTransitionError":this.notificationService.error(e.transitionError)}})}manuallyTransitionToState(t){this.orderTransitionService.manuallyTransitionToState({orderId:t.id,nextStates:t.nextStates,cancellable:!0,message:Object(b.a)("order.manually-transition-to-state-message"),retry:0}).subscribe()}transitionToModifying(){this.dataService.order.transitionToState(this.id,"Modifying").subscribe(({transitionOrderToState:t})=>{switch(null==t?void 0:t.__typename){case"Order":this.router.navigate(["./modify"],{relativeTo:this.route});break;case"OrderStateTransitionError":this.notificationService.error(t.transitionError)}})}updateCustomFields(t){this.dataService.order.updateOrderCustomFields({id:this.id,customFields:t}).subscribe(()=>{this.notificationService.success(Object(b.a)("common.notify-update-success"),{entity:"Order"})})}getOrderAddressLines(t){return t?Object.values(t).filter(t=>"OrderAddress"!==t).filter(t=>!!t):[]}settlePayment(t){this.dataService.order.settlePayment(t.id).subscribe(({settlePayment:t})=>{switch(t.__typename){case"Payment":"Settled"===t.state?this.notificationService.success(Object(b.a)("order.settle-payment-success")):this.notificationService.error(Object(b.a)("order.settle-payment-error")),this.dataService.order.getOrder(this.id).single$.subscribe(),this.fetchHistory.next();break;case"OrderStateTransitionError":case"PaymentStateTransitionError":case"SettlePaymentError":this.notificationService.error(t.message)}})}transitionPaymentState({payment:t,state:e}){this.dataService.order.transitionPaymentToState(t.id,e).subscribe(({transitionPaymentToState:t})=>{switch(t.__typename){case"Payment":this.notificationService.success(Object(b.a)("order.transitioned-payment-to-state-success"),{state:e}),this.dataService.order.getOrder(this.id).single$.subscribe(),this.fetchHistory.next();break;case"PaymentStateTransitionError":this.notificationService.error(t.message)}})}canAddFulfillment(t){return!t.lines.reduce((t,e)=>[...t,...e.items],[]).every(t=>!!t.fulfillment)&&!this.hasUnsettledModifications(t)&&0===this.outstandingPaymentAmount(t)&&(t.nextStates.includes("Shipped")||t.nextStates.includes("PartiallyShipped")||t.nextStates.includes("Delivered"))}hasUnsettledModifications(t){return 0<t.modifications.filter(t=>!t.isSettled).length}getOutstandingModificationAmount(t){return Object(R.summate)(t.modifications.filter(t=>!t.isSettled),"priceChange")}outstandingPaymentAmount(t){var e,c;const n=null!==(c=null===(e=t.payments)||void 0===e?void 0:e.filter(t=>"Cancelled"!==t.state&&"Declined"!==t.state&&"Error"!==t.state).map(t=>Object(jt.pick)(t,["amount"])))&&void 0!==c?c:[],r=Object(R.summate)(n,"amount");return t.totalWithTax-r}addManualPayment(t){this.modalService.fromComponent(h,{closable:!0,locals:{outstandingAmount:this.outstandingPaymentAmount(t),currencyCode:t.currencyCode}}).pipe(Object(qt.a)(t=>t?this.dataService.order.addManualPaymentToOrder({orderId:this.id,transactionId:t.transactionId,method:t.method,metadata:t.metadata||{}}):Nt.a),Object(qt.a)(({addManualPaymentToOrder:e})=>{switch(e.__typename){case"Order":return this.notificationService.success(Object(b.a)("order.add-payment-to-order-success")),this.orderTransitionService.transitionToPreModifyingState(t.id,t.nextStates);case"ManualPaymentStateError":return this.notificationService.error(e.message),Nt.a;default:return Nt.a}})).subscribe(t=>{t&&this.refetchOrder({result:t})})}fulfillOrder(){this.entity$.pipe(Object(Xt.a)(1),Object(qt.a)(t=>this.modalService.fromComponent(A,{size:"xl",locals:{order:t}})),Object(qt.a)(t=>t?this.dataService.order.createFulfillment(t):Object(Rt.a)(void 0)),Object(qt.a)(t=>this.refetchOrder(t).pipe(Object(Ut.a)(t)))).subscribe(t=>{if(t)switch(t.addFulfillmentToOrder.__typename){case"Fulfillment":this.notificationService.success(Object(b.a)("order.create-fulfillment-success"));break;case"EmptyOrderLineSelectionError":case"InsufficientStockOnHandError":case"ItemsAlreadyFulfilledError":this.notificationService.error(t.addFulfillmentToOrder.message)}})}transitionFulfillment(t,e){this.dataService.order.transitionFulfillmentToState(t,e).pipe(Object(qt.a)(t=>this.refetchOrder(t))).subscribe(()=>{this.notificationService.success(Object(b.a)("order.successfully-updated-fulfillment"))})}cancelOrRefund(t){const e=this.orderHasSettledPayments(t);"PaymentAuthorized"!==t.state&&!0!==t.active&&e?this.refundOrder(t):this.cancelOrder(t)}settleRefund(t){this.modalService.fromComponent(We,{size:"md",locals:{refund:t}}).pipe(Object(qt.a)(e=>e?this.dataService.order.settleRefund({transactionId:e,id:t.id},this.id):Object(Rt.a)(void 0))).subscribe(t=>{t&&this.notificationService.success(Object(b.a)("order.settle-refund-success"))})}addNote(t){const{note:e,isPublic:c}=t;this.dataService.order.addNoteToOrder({id:this.id,note:e,isPublic:c}).pipe(Object(qt.a)(t=>this.refetchOrder(t))).subscribe(t=>{this.notificationService.success(Object(b.a)("common.notify-create-success"),{entity:"Note"})})}updateNote(t){this.modalService.fromComponent(r.u,{closable:!0,locals:{displayPrivacyControls:!0,note:t.data.note,noteIsPrivate:!t.isPublic}}).pipe(Object(qt.a)(e=>e?this.dataService.order.updateOrderNote({noteId:t.id,isPublic:!e.isPrivate,note:e.note}):Nt.a)).subscribe(t=>{this.fetchHistory.next(),this.notificationService.success(Object(b.a)("common.notify-update-success"),{entity:"Note"})})}deleteNote(t){return this.modalService.dialog({title:Object(b.a)("common.confirm-delete-note"),body:t.data.note,buttons:[{type:"secondary",label:Object(b.a)("common.cancel")},{type:"danger",label:Object(b.a)("common.delete"),returnValue:!0}]}).pipe(Object(qt.a)(e=>e?this.dataService.order.deleteOrderNote(t.id):Nt.a)).subscribe(()=>{this.fetchHistory.next(),this.notificationService.success(Object(b.a)("common.notify-delete-success"),{entity:"Note"})})}orderHasSettledPayments(t){var e;return!!(null===(e=t.payments)||void 0===e?void 0:e.find(t=>"Settled"===t.state))}cancelOrder(t){this.modalService.fromComponent(M,{size:"xl",locals:{order:t}}).pipe(Object(qt.a)(t=>t?this.dataService.order.cancelOrder(t):Object(Rt.a)(void 0)),Object(qt.a)(t=>this.refetchOrder(t))).subscribe(t=>{t&&this.notificationService.success(Object(b.a)("order.cancelled-order-success"))})}refundOrder(t){this.modalService.fromComponent(Le,{size:"xl",locals:{order:t}}).pipe(Object(qt.a)(t=>{var e;if(!t)return Object(Rt.a)(void 0);const c=[];return t.refund.lines.length&&c.push(this.dataService.order.refundOrder(t.refund).pipe(Object(Ht.a)(t=>t.refundOrder))),(null===(e=t.cancel.lines)||void 0===e?void 0:e.length)&&c.push(this.dataService.order.cancelOrder(t.cancel).pipe(Object(Ht.a)(t=>t.cancelOrder))),Object(Et.a)(...c)})).subscribe(t=>{if(t)switch(t.__typename){case"Order":this.refetchOrder(t).subscribe(),this.notificationService.success(Object(b.a)("order.cancelled-order-success"));break;case"Refund":this.refetchOrder(t).subscribe(),"Failed"===t.state?this.notificationService.error(Object(b.a)("order.refund-order-failed")):this.notificationService.success(Object(b.a)("order.refund-order-success"));break;case"QuantityTooGreatError":case"MultipleOrderError":case"OrderStateTransitionError":case"CancelActiveOrderError":case"EmptyOrderLineSelectionError":case"AlreadyRefundedError":case"NothingToRefundError":case"PaymentOrderMismatchError":case"RefundOrderStateError":case"RefundStateTransitionError":this.notificationService.error(t.message)}})}refetchOrder(t){return this.fetchHistory.next(),t?this.dataService.order.getOrder(this.id).single$:Object(Rt.a)(void 0)}setFormValues(t){}}wn.\u0275fac=function(t){return new(t||wn)(i.bc(Ne.e),i.bc(Ne.a),i.bc(r.I),i.bc(i.j),i.bc(r.s),i.bc(r.G),i.bc(r.F),i.bc(re))},wn.\u0275cmp=i.Vb({type:wn,selectors:[["vdr-order-detail"]],features:[i.Nb],decls:4,vars:6,consts:[[4,"ngIf"],[1,"flex","clr-align-items-center"],[3,"entity"],[3,"state"],[1,"icon-button",3,"title","click"],["shape","list"],["locationId","order-detail"],["class","btn btn-primary",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","class","btn","vdrDropdownItem","",3,"click",4,"ngIf"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",1,"btn",3,"click"],["shape","step-forward-2",1,"is-warning"],[1,"btn","btn-primary",3,"click"],["shape","pencil"],["shape","error-standard",1,"is-error"],[4,"ngIf","ngIfElse"],["cancelOnly",""],["type","button","class","btn","vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["shape","step-forward-2"],[1,"clr-row"],[1,"clr-col-lg-8"],[3,"order","orderLineCustomFields"],[1,"table"],[4,"ngFor","ngForOf"],[3,"order","history","addNote","updateNote","deleteNote"],[1,"clr-col-lg-4","order-cards"],[3,"customFieldsConfig","customFieldValues","updateClick"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"card-text"],[3,"customer"],[3,"address"],[3,"currencyCode","payment","settlePayment","transitionPaymentState","settleRefund",4,"ngFor","ngForOf"],[3,"currencyCode","payment","settlePayment","transitionPaymentState","settleRefund"],[3,"fulfillment","order","transitionState"]],template:function(t,e){1&t&&(i.Tc(0,In,29,21,"vdr-action-bar",0),i.sc(1,"async"),i.Tc(2,Fn,41,34,"div",0),i.sc(3,"async")),2&t&&(i.yc("ngIf",i.tc(1,2,e.entity$)),i.Qb(2),i.yc("ngIf",i.tc(3,4,e.entity$)))},directives:[f.o,Re.a,Re.b,Ee.a,Xe.a,y.o,Re.c,$e.a,J.a,K.a,tt.a,et.a,f.n,ac,Bc,Dt,Gc.a,V.a,gn,lt],pipes:[f.b,u.d,g.a,j.a,f.v],styles:[".shipping-address[_ngcontent-%COMP%]{list-style-type:none;line-height:1.3em}.order-cards[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin-top:6px;color:var(--color-text-200)}"],changeDetection:0});var _n,kn=c("1G5W"),Ln=c("UXun");function An(t,e){1&t&&(i.Vc(0),i.sc(1,"translate")),2&t&&i.Wc(i.tc(1,1,"order.confirm-modifications"))}function Dn(t,e){if(1&t&&(i.hc(0,"option",9),i.Vc(1),i.sc(2,"localeCurrency"),i.gc()),2&t){const t=e.$implicit,c=i.rc(2);i.yc("ngValue",t),i.Qb(1),i.Zc(" #",t.id," ",t.method,": ",i.uc(2,4,t.amount,c.order.currencyCode)," ")}}function jn(t,e){if(1&t){const t=i.ic();i.hc(0,"div"),i.hc(1,"clr-select-container"),i.hc(2,"label"),i.Vc(3),i.sc(4,"translate"),i.gc(),i.hc(5,"select",5),i.pc("ngModelChange",function(e){i.Lc(t);return i.rc().selectedPayment=e}),i.Tc(6,Dn,3,7,"option",6),i.gc(),i.gc(),i.hc(7,"label",7),i.Vc(8),i.sc(9,"translate"),i.gc(),i.hc(10,"textarea",8),i.pc("ngModelChange",function(e){i.Lc(t);return i.rc().refundNote=e}),i.gc(),i.gc()}if(2&t){const t=i.rc();i.Qb(3),i.Wc(i.tc(4,5,"order.payment-to-refund")),i.Qb(2),i.yc("ngModel",t.selectedPayment),i.Qb(1),i.yc("ngForOf",t.order.payments),i.Qb(2),i.Wc(i.tc(9,7,"order.refund-cancellation-reason")),i.Qb(2),i.yc("ngModel",t.refundNote)}}function Wn(t,e){if(1&t){const t=i.ic();i.hc(0,"button",10),i.pc("click",function(){i.Lc(t);return i.rc().cancel()}),i.Vc(1),i.sc(2,"translate"),i.gc(),i.hc(3,"button",11),i.pc("click",function(){i.Lc(t);return i.rc().submit()}),i.Vc(4),i.sc(5,"translate"),i.gc()}if(2&t){const t=i.rc();i.Qb(1),i.Wc(i.tc(2,3,"common.cancel")),i.Qb(2),i.yc("disabled",t.priceDifference<0&&!t.selectedPayment),i.Qb(1),i.Xc(" ",i.tc(5,5,"common.confirm")," ")}}!function(t){t[t.Refund=0]="Refund",t[t.Payment=1]="Payment",t[t.PriceUnchanged=2]="PriceUnchanged",t[t.Cancel=3]="Cancel"}(_n||(_n={}));class Nn{get priceDifference(){return this.order.totalWithTax-this.originalTotalWithTax}ngOnInit(){this.refundNote=this.modifyOrderInput.note||""}cancel(){this.resolveWith({result:_n.Cancel})}submit(){0<this.priceDifference?this.resolveWith({result:_n.Payment}):this.priceDifference<0?this.resolveWith({result:_n.Refund,refundPaymentId:this.selectedPayment.id,refundNote:this.refundNote}):this.resolveWith({result:_n.PriceUnchanged})}}Nn.\u0275fac=function(t){return new(t||Nn)},Nn.\u0275cmp=i.Vb({type:Nn,selectors:[["vdr-order-edits-preview-dialog"]],decls:10,vars:10,consts:[["vdrDialogTitle",""],[3,"order","orderLineCustomFields"],[1,"h4"],[4,"ngIf"],["vdrDialogButtons",""],["clrSelect","","name","options",3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"clr-control-label"],["name","refundNote","clrTextarea","","required","",3,"ngModel","ngModelChange"],[3,"ngValue"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(t,e){1&t&&(i.Tc(0,An,2,3,"ng-template",0),i.cc(1,"vdr-order-table",1),i.hc(2,"h4",2),i.Vc(3),i.sc(4,"translate"),i.hc(5,"strong"),i.Vc(6),i.sc(7,"localeCurrency"),i.gc(),i.gc(),i.Tc(8,jn,11,9,"div",3),i.Tc(9,Wn,6,7,"ng-template",4)),2&t&&(i.Qb(1),i.yc("order",e.order)("orderLineCustomFields",e.orderLineCustomFields),i.Qb(2),i.Xc(" ",i.tc(4,5,"order.modify-order-price-difference"),": "),i.Qb(3),i.Wc(i.uc(7,7,e.priceDifference,e.order.currencyCode)),i.Qb(2),i.yc("ngIf",e.priceDifference<0))},directives:[o.a,ac,f.o,d.a,y.B,y.u,l.a,n.A,y.A,n.p,n.s,f.n,n.b,y.H,n.z,n.u,n.D],pipes:[u.d,g.a],styles:[""],changeDetection:0});var Rn=c("c+KD"),En=c("VhYM"),Xn=c("4ALk");function $n(t,e){if(1&t){const t=i.ic();i.hc(0,"vdr-action-bar"),i.hc(1,"vdr-ab-left"),i.hc(2,"div",1),i.cc(3,"vdr-entity-info",2),i.sc(4,"async"),i.cc(5,"vdr-order-state-label",3),i.gc(),i.gc(),i.hc(6,"vdr-ab-right"),i.hc(7,"button",4),i.pc("click",function(){i.Lc(t);const c=e.ngIf;return i.rc().transitionToPriorState(c)}),i.Vc(8),i.sc(9,"translate"),i.gc(),i.gc(),i.gc()}if(2&t){const t=e.ngIf,c=i.rc();i.Qb(3),i.yc("entity",i.tc(4,3,c.entity$)),i.Qb(2),i.yc("state",t.state),i.Qb(3),i.Xc(" ",i.tc(9,5,"order.cancel-modification")," ")}}function qn(t,e){1&t&&(i.hc(0,"th"),i.Vc(1),i.sc(2,"translate"),i.gc()),2&t&&(i.Qb(1),i.Wc(i.tc(2,1,"common.custom-fields")))}function Hn(t,e){if(1&t&&(i.cc(0,"img",41),i.sc(1,"assetPreview")),2&t){const t=i.rc().$implicit;i.yc("src",i.uc(1,1,t.featuredAsset,"tiny"),i.Nc)}}const Un=function(t){return[t]};function zn(t,e){if(1&t&&(i.fc(0),i.cc(1,"vdr-custom-field-control",44),i.ec()),2&t){const t=e.$implicit,c=i.rc(2).index,n=i.rc(2);i.Qb(1),i.yc("customField",t)("customFieldsFormGroup",n.orderLineCustomFieldsFormArray.get(i.Cc(3,Un,c)))("compact",!0)}}function Bn(t,e){if(1&t&&(i.hc(0,"td",42),i.Tc(1,zn,2,5,"ng-container",43),i.gc()),2&t){const t=i.rc(3);i.Qb(1),i.yc("ngForOf",t.orderLineCustomFields)}}function Gn(t,e){if(1&t){const t=i.ic();i.hc(0,"tr",29),i.hc(1,"td",30),i.Tc(2,Hn,2,4,"img",31),i.gc(),i.hc(3,"td",32),i.Vc(4),i.gc(),i.hc(5,"td",33),i.Vc(6),i.gc(),i.hc(7,"td",34),i.Vc(8),i.sc(9,"localeCurrency"),i.hc(10,"div",16),i.sc(11,"translate"),i.Vc(12),i.sc(13,"localeCurrency"),i.gc(),i.gc(),i.hc(14,"td",35),i.hc(15,"input",36),i.pc("input",function(c){i.Lc(t);const n=e.$implicit;return i.rc(2).updateLineQuantity(n,c.target.value)}),i.gc(),i.cc(16,"vdr-line-refunds",37),i.cc(17,"vdr-line-fulfillment",38),i.gc(),i.Tc(18,Bn,2,1,"td",39),i.hc(19,"td",40),i.Vc(20),i.sc(21,"localeCurrency"),i.hc(22,"div",16),i.sc(23,"translate"),i.Vc(24),i.sc(25,"localeCurrency"),i.gc(),i.gc(),i.gc()}if(2&t){const t=e.$implicit,c=i.rc().ngIf,n=i.rc();i.Tb("is-cancelled",0===t.quantity)("modified",n.isLineModified(t)),i.Qb(2),i.yc("ngIf",t.featuredAsset),i.Qb(2),i.Wc(t.productVariant.name),i.Qb(2),i.Wc(t.productVariant.sku),i.Qb(2),i.Xc(" ",i.uc(9,19,t.unitPriceWithTax,c.currencyCode)," "),i.Qb(2),i.yc("title",i.tc(11,22,"order.net-price")),i.Qb(2),i.Xc(" ",i.uc(13,24,t.unitPrice,c.currencyCode)," "),i.Qb(3),i.yc("value",t.quantity),i.Qb(1),i.yc("line",t)("payments",c.payments),i.Qb(1),i.yc("line",t)("orderState",c.state),i.Qb(1),i.yc("ngIf",n.orderLineCustomFields.length),i.Qb(2),i.Xc(" ",i.uc(21,27,t.linePriceWithTax,c.currencyCode)," "),i.Qb(2),i.yc("title",i.tc(23,30,"order.net-price")),i.Qb(2),i.Xc(" ",i.uc(25,32,t.linePrice,c.currencyCode)," ")}}function Yn(t,e){if(1&t&&(i.cc(0,"img",41),i.sc(1,"assetPreview")),2&t){const t=i.rc().$implicit;i.yc("src",i.uc(1,1,t.productAsset,"tiny"),i.Nc)}}function Zn(t,e){if(1&t&&(i.fc(0),i.cc(1,"vdr-custom-field-control",44),i.ec()),2&t){const t=e.$implicit,c=i.rc(2).index,n=i.rc(2);i.Qb(1),i.yc("customField",t)("customFieldsFormGroup",n.addItemCustomFieldsFormArray.get(i.Cc(3,Un,c)))("compact",!0)}}function Jn(t,e){if(1&t&&(i.hc(0,"td",42),i.Tc(1,Zn,2,5,"ng-container",43),i.gc()),2&t){const t=i.rc(3);i.Qb(1),i.yc("ngForOf",t.orderLineCustomFields)}}function Kn(t,e){if(1&t){const t=i.ic();i.hc(0,"tr",45),i.hc(1,"td",30),i.Tc(2,Yn,2,4,"img",31),i.gc(),i.hc(3,"td",32),i.Vc(4),i.gc(),i.hc(5,"td",33),i.Vc(6),i.gc(),i.hc(7,"td",34),i.Vc(8),i.sc(9,"localeCurrency"),i.hc(10,"div",16),i.sc(11,"translate"),i.Vc(12),i.sc(13,"localeCurrency"),i.gc(),i.gc(),i.hc(14,"td",35),i.hc(15,"input",36),i.pc("input",function(c){i.Lc(t);const n=e.$implicit;return i.rc(2).updateAddedItemQuantity(n,c.target.value)}),i.gc(),i.hc(16,"button",46),i.pc("click",function(){i.Lc(t);const c=e.index;return i.rc(2).removeAddedItem(c)}),i.cc(17,"clr-icon",47),i.gc(),i.gc(),i.Tc(18,Jn,2,1,"td",39),i.hc(19,"td",40),i.Vc(20),i.sc(21,"currency"),i.hc(22,"div",16),i.sc(23,"translate"),i.Vc(24),i.sc(25,"currency"),i.gc(),i.gc(),i.gc()}if(2&t){const t=e.$implicit,c=i.rc().ngIf,n=i.rc();i.Qb(2),i.yc("ngIf",t.productAsset),i.Qb(2),i.Wc(t.productVariantName),i.Qb(2),i.Wc(t.sku),i.Qb(2),i.Xc(" ",i.uc(9,11,t.priceWithTax,c.currencyCode)," "),i.Qb(2),i.yc("title",i.tc(11,14,"order.net-price")),i.Qb(2),i.Xc(" ",i.uc(13,16,t.price,c.currencyCode)," "),i.Qb(3),i.yc("value",t.quantity),i.Qb(3),i.yc("ngIf",n.orderLineCustomFields.length),i.Qb(2),i.Xc(" ",i.uc(21,19,t.priceWithTax*t.quantity/100,c.currencyCode)," "),i.Qb(2),i.yc("title",i.tc(23,22,"order.net-price")),i.Qb(2),i.Xc(" ",i.uc(25,24,t.price*t.quantity/100,c.currencyCode)," ")}}function tr(t,e){1&t&&i.cc(0,"td")}function er(t,e){if(1&t&&(i.hc(0,"tr",48),i.hc(1,"td",49),i.Vc(2),i.gc(),i.hc(3,"td",33),i.Vc(4),i.gc(),i.cc(5,"td",50),i.cc(6,"td"),i.Tc(7,tr,1,0,"td",0),i.hc(8,"td",40),i.Vc(9),i.sc(10,"localeCurrency"),i.hc(11,"div",16),i.sc(12,"translate"),i.Vc(13),i.sc(14,"localeCurrency"),i.gc(),i.gc(),i.gc()),2&t){const t=e.$implicit,c=i.rc().ngIf,n=i.rc();i.Qb(2),i.Wc(t.description),i.Qb(2),i.Wc(t.sku),i.Qb(3),i.yc("ngIf",n.orderLineCustomFields.length),i.Qb(2),i.Xc(" ",i.uc(10,6,t.priceWithTax,c.currencyCode)," "),i.Qb(2),i.yc("title",i.tc(12,9,"order.net-price")),i.Qb(2),i.Xc(" ",i.uc(14,11,t.price,c.currencyCode)," ")}}function cr(t,e){1&t&&i.cc(0,"td")}function nr(t,e){if(1&t&&(i.fc(0),i.Vc(1),i.sc(2,"localeCurrency"),i.hc(3,"div",16),i.sc(4,"translate"),i.Vc(5),i.sc(6,"localeCurrency"),i.gc(),i.ec()),2&t){const t=e.ngIf,c=i.rc(2).ngIf;i.Qb(1),i.Xc(" ",i.uc(2,3,t.priceWithTax,c.currencyCode)," "),i.Qb(2),i.yc("title",i.tc(4,6,"order.net-price")),i.Qb(2),i.Xc(" ",i.uc(6,8,t.price,c.currencyCode)," ")}}function rr(t,e){if(1&t){const t=i.ic();i.hc(0,"tr",51),i.hc(1,"td",49),i.Vc(2),i.hc(3,"button",46),i.pc("click",function(){i.Lc(t);const c=e.index;return i.rc(2).removeSurcharge(c)}),i.cc(4,"clr-icon",47),i.gc(),i.gc(),i.hc(5,"td",33),i.Vc(6),i.gc(),i.cc(7,"td",50),i.cc(8,"td"),i.Tc(9,cr,1,0,"td",0),i.hc(10,"td",40),i.Tc(11,nr,7,11,"ng-container",0),i.gc(),i.gc()}if(2&t){const t=e.$implicit,c=i.rc(2);i.Qb(2),i.Xc(" ",t.description," "),i.Qb(4),i.Wc(t.sku),i.Qb(3),i.yc("ngIf",c.orderLineCustomFields.length),i.Qb(2),i.yc("ngIf",c.getSurchargePrices(t))}}function ir(t,e){1&t&&i.cc(0,"td")}function or(t,e){if(1&t&&(i.cc(0,"img",58),i.sc(1,"assetPreview")),2&t){const t=e.ngIf;i.yc("src",i.uc(1,1,t,"tiny"),i.Nc)}}function ar(t,e){if(1&t&&(i.hc(0,"div",55),i.Tc(1,or,2,4,"img",56),i.hc(2,"div"),i.hc(3,"strong",57),i.Vc(4),i.gc(),i.hc(5,"small"),i.Vc(6),i.gc(),i.hc(7,"div"),i.Vc(8),i.sc(9,"localeCurrency"),i.gc(),i.gc(),i.gc()),2&t){const t=i.rc(2).ngIf,e=i.rc();i.Qb(1),i.yc("ngIf",e.addItemSelectedVariant.productAsset),i.Qb(3),i.Wc(e.addItemSelectedVariant.productVariantName),i.Qb(2),i.Wc(e.addItemSelectedVariant.sku),i.Qb(2),i.Xc(" ",i.uc(9,4,e.getSelectedItemPrice(e.addItemSelectedVariant),t.currencyCode)," ")}}function sr(t,e){if(1&t&&(i.fc(0),i.cc(1,"vdr-custom-field-control",59),i.ec()),2&t){const t=e.$implicit,c=i.rc(3);i.Qb(1),i.yc("readonly",!c.addItemSelectedVariant)("customField",t)("customFieldsFormGroup",c.addItemCustomFieldsForm)("compact",!0)}}function lr(t,e){if(1&t){const t=i.ic();i.hc(0,"clr-accordion-content"),i.hc(1,"vdr-product-selector",52),i.pc("productSelected",function(e){i.Lc(t);return i.rc(2).addItemSelectedVariant=e}),i.gc(),i.Tc(2,ar,10,7,"div",53),i.Tc(3,sr,2,4,"ng-container",43),i.hc(4,"button",54),i.pc("click",function(){i.Lc(t);const e=i.rc(2);return e.addItemToOrder(e.addItemSelectedVariant)}),i.Vc(5),i.sc(6,"translate"),i.gc(),i.gc()}if(2&t){const t=i.rc(2);i.Qb(2),i.yc("ngIf",t.addItemSelectedVariant),i.Qb(1),i.yc("ngForOf",t.orderLineCustomFields),i.Qb(1),i.yc("disabled",!t.addItemSelectedVariant||t.addItemCustomFieldsForm.invalid),i.Qb(1),i.Xc(" ",i.tc(6,4,"order.add-item-to-order")," ")}}const dr=function(t){return{rate:t}};function ur(t,e){if(1&t){const t=i.ic();i.hc(0,"clr-accordion-content"),i.hc(1,"form",60),i.pc("submit",function(){i.Lc(t);const e=i.rc(2);return e.addSurcharge(e.surchargeForm.value)}),i.hc(2,"vdr-form-field",61),i.sc(3,"translate"),i.cc(4,"input",62),i.gc(),i.hc(5,"vdr-form-field",63),i.sc(6,"translate"),i.cc(7,"input",64),i.gc(),i.hc(8,"vdr-form-field",65),i.sc(9,"translate"),i.cc(10,"vdr-currency-input",66),i.gc(),i.hc(11,"vdr-form-field",67),i.sc(12,"translate"),i.cc(13,"input",68),i.gc(),i.hc(14,"vdr-form-field",69),i.sc(15,"translate"),i.hc(16,"vdr-affixed-input",70),i.cc(17,"input",71),i.gc(),i.gc(),i.hc(18,"vdr-form-field",72),i.sc(19,"translate"),i.cc(20,"input",73),i.gc(),i.hc(21,"button",74),i.Vc(22),i.sc(23,"translate"),i.gc(),i.gc(),i.gc()}if(2&t){const t=i.rc().ngIf,e=i.rc();let c=null,n=null;i.Qb(1),i.yc("formGroup",e.surchargeForm),i.Qb(1),i.yc("label",i.tc(3,10,"common.description")),i.Qb(3),i.yc("label",i.tc(6,12,"order.product-sku")),i.Qb(3),i.yc("label",i.tc(9,14,"common.price")),i.Qb(2),i.yc("currencyCode",t.currencyCode),i.Qb(1),i.yc("label",i.uc(12,16,"catalog.price-includes-tax-at",i.Cc(25,dr,null==(c=e.surchargeForm.get("taxRate"))?null:c.value))),i.Qb(3),i.yc("label",i.tc(15,19,"order.tax-rate")),i.Qb(4),i.yc("label",i.tc(19,21,"order.tax-description")),i.Qb(3),i.yc("disabled",e.surchargeForm.invalid||e.surchargeForm.pristine||0===(null==(n=e.surchargeForm.get("price"))?null:n.value)),i.Qb(1),i.Xc(" ",i.tc(23,23,"order.add-surcharge")," ")}}function fr(t,e){if(1&t&&(i.hc(0,"clr-accordion-content"),i.cc(1,"vdr-address-form",75),i.sc(2,"async"),i.gc()),2&t){const t=i.rc(2);i.Qb(1),i.yc("formGroup",t.shippingAddressForm)("availableCountries",i.tc(2,3,t.availableCountries$))("customFields",t.addressCustomFields)}}function gr(t,e){if(1&t&&(i.hc(0,"clr-accordion-content"),i.cc(1,"vdr-address-form",75),i.sc(2,"async"),i.gc()),2&t){const t=i.rc(2);i.Qb(1),i.yc("formGroup",t.billingAddressForm)("availableCountries",i.tc(2,3,t.availableCountries$))("customFields",t.addressCustomFields)}}const mr=function(t){return{count:t}};function pr(t,e){if(1&t&&(i.hc(0,"li"),i.Vc(1),i.sc(2,"translate"),i.gc()),2&t){const t=i.rc(2);i.Qb(1),i.Xc(" ",i.uc(2,1,"order.modification-adding-items",i.Cc(4,mr,null==t.modifyOrderInput.addItems?null:t.modifyOrderInput.addItems.length))," ")}}function hr(t,e){if(1&t&&(i.hc(0,"li"),i.Vc(1),i.sc(2,"translate"),i.gc()),2&t){const t=i.rc(2);i.Qb(1),i.Xc(" ",i.uc(2,1,"order.modification-adjusting-lines",i.Cc(4,mr,null==t.modifyOrderInput.adjustOrderLines?null:t.modifyOrderInput.adjustOrderLines.length))," ")}}function br(t,e){if(1&t&&(i.hc(0,"li"),i.Vc(1),i.sc(2,"translate"),i.gc()),2&t){const t=i.rc(2);i.Qb(1),i.Xc(" ",i.uc(2,1,"order.modification-adding-surcharges",i.Cc(4,mr,null==t.modifyOrderInput.surcharges?null:t.modifyOrderInput.surcharges.length))," ")}}function yr(t,e){1&t&&(i.hc(0,"li"),i.Vc(1),i.sc(2,"translate"),i.gc()),2&t&&(i.Qb(1),i.Xc(" ",i.tc(2,1,"order.modification-updating-shipping-address")," "))}function vr(t,e){1&t&&(i.hc(0,"li"),i.Vc(1),i.sc(2,"translate"),i.gc()),2&t&&(i.Qb(1),i.Xc(" ",i.tc(2,1,"order.modification-updating-billing-address")," "))}function Cr(t,e){if(1&t){const t=i.ic();i.hc(0,"div"),i.hc(1,"div",5),i.hc(2,"div",6),i.hc(3,"table",7),i.hc(4,"thead"),i.hc(5,"tr"),i.cc(6,"th"),i.hc(7,"th"),i.Vc(8),i.sc(9,"translate"),i.gc(),i.hc(10,"th"),i.Vc(11),i.sc(12,"translate"),i.gc(),i.hc(13,"th"),i.Vc(14),i.sc(15,"translate"),i.gc(),i.hc(16,"th"),i.Vc(17),i.sc(18,"translate"),i.gc(),i.Tc(19,qn,3,3,"th",0),i.hc(20,"th"),i.Vc(21),i.sc(22,"translate"),i.gc(),i.gc(),i.gc(),i.hc(23,"tbody"),i.Tc(24,Gn,26,35,"tr",8),i.Tc(25,Kn,26,27,"tr",9),i.Tc(26,er,15,14,"tr",10),i.Tc(27,rr,12,4,"tr",11),i.hc(28,"tr",12),i.hc(29,"td",13),i.Vc(30),i.sc(31,"translate"),i.gc(),i.hc(32,"td",14),i.Vc(33),i.gc(),i.cc(34,"td",15),i.Tc(35,ir,1,0,"td",0),i.hc(36,"td",14),i.Vc(37),i.sc(38,"localeCurrency"),i.hc(39,"div",16),i.sc(40,"translate"),i.Vc(41),i.sc(42,"localeCurrency"),i.gc(),i.gc(),i.gc(),i.gc(),i.gc(),i.hc(43,"h4",17),i.Vc(44),i.sc(45,"translate"),i.gc(),i.hc(46,"clr-accordion"),i.hc(47,"clr-accordion-panel"),i.hc(48,"clr-accordion-title"),i.Vc(49),i.sc(50,"translate"),i.gc(),i.Tc(51,lr,7,6,"clr-accordion-content",18),i.gc(),i.hc(52,"clr-accordion-panel"),i.hc(53,"clr-accordion-title"),i.Vc(54),i.sc(55,"translate"),i.gc(),i.Tc(56,ur,24,27,"clr-accordion-content",18),i.gc(),i.hc(57,"clr-accordion-panel"),i.hc(58,"clr-accordion-title"),i.Vc(59),i.sc(60,"translate"),i.gc(),i.Tc(61,fr,3,5,"clr-accordion-content",18),i.gc(),i.hc(62,"clr-accordion-panel"),i.hc(63,"clr-accordion-title"),i.Vc(64),i.sc(65,"translate"),i.gc(),i.Tc(66,gr,3,5,"clr-accordion-content",18),i.gc(),i.gc(),i.gc(),i.hc(67,"div",19),i.hc(68,"div",20),i.hc(69,"div",21),i.Vc(70),i.sc(71,"translate"),i.gc(),i.hc(72,"div",22),i.hc(73,"ul"),i.Tc(74,pr,3,6,"li",0),i.Tc(75,hr,3,6,"li",0),i.Tc(76,br,3,6,"li",0),i.Tc(77,yr,3,3,"li",0),i.Tc(78,vr,3,3,"li",0),i.gc(),i.gc(),i.hc(79,"div",22),i.hc(80,"label",23),i.Vc(81),i.sc(82,"translate"),i.gc(),i.hc(83,"textarea",24),i.pc("ngModelChange",function(e){i.Lc(t);return i.rc().note=e}),i.gc(),i.hc(84,"clr-checkbox-wrapper",25),i.hc(85,"input",26),i.pc("ngModelChange",function(e){i.Lc(t);return i.rc().recalculateShipping=e}),i.gc(),i.hc(86,"label"),i.Vc(87),i.sc(88,"translate"),i.gc(),i.gc(),i.gc(),i.hc(89,"div",27),i.hc(90,"button",28),i.pc("click",function(){i.Lc(t);const c=e.ngIf;return i.rc().previewAndModify(c)}),i.Vc(91),i.sc(92,"translate"),i.gc(),i.gc(),i.gc(),i.gc(),i.gc(),i.gc()}if(2&t){const t=e.ngIf,c=i.rc();i.Qb(8),i.Wc(i.tc(9,34,"order.product-name")),i.Qb(3),i.Wc(i.tc(12,36,"order.product-sku")),i.Qb(3),i.Wc(i.tc(15,38,"order.unit-price")),i.Qb(3),i.Wc(i.tc(18,40,"order.quantity")),i.Qb(2),i.yc("ngIf",c.orderLineCustomFields.length),i.Qb(2),i.Wc(i.tc(22,42,"order.total")),i.Qb(3),i.yc("ngForOf",t.lines),i.Qb(1),i.yc("ngForOf",c.addedLines)("ngForTrackBy",c.trackByProductVariantId),i.Qb(1),i.yc("ngForOf",t.surcharges),i.Qb(1),i.yc("ngForOf",c.modifyOrderInput.surcharges),i.Qb(3),i.Wc(i.tc(31,44,"order.shipping")),i.Qb(3),i.Wc(null==t.shippingLines[0]||null==t.shippingLines[0].shippingMethod?null:t.shippingLines[0].shippingMethod.name),i.Qb(2),i.yc("ngIf",c.orderLineCustomFields.length),i.Qb(2),i.Xc(" ",i.uc(38,46,t.shippingWithTax,t.currencyCode)," "),i.Qb(2),i.yc("title",i.tc(40,49,"order.net-price")),i.Qb(2),i.Xc(" ",i.uc(42,51,t.shipping,t.currencyCode)," "),i.Qb(3),i.Wc(i.tc(45,54,"order.modifications")),i.Qb(5),i.Wc(i.tc(50,56,"order.add-item-to-order")),i.Qb(5),i.Wc(i.tc(55,58,"order.add-surcharge")),i.Qb(5),i.Wc(i.tc(60,60,"order.edit-shipping-address")),i.Qb(5),i.Wc(i.tc(65,62,"order.edit-billing-address")),i.Qb(6),i.Xc(" ",i.tc(71,64,"order.modification-summary")," "),i.Qb(4),i.yc("ngIf",null==c.modifyOrderInput.addItems?null:c.modifyOrderInput.addItems.length),i.Qb(1),i.yc("ngIf",null==c.modifyOrderInput.adjustOrderLines?null:c.modifyOrderInput.adjustOrderLines.length),i.Qb(1),i.yc("ngIf",null==c.modifyOrderInput.surcharges?null:c.modifyOrderInput.surcharges.length),i.Qb(1),i.yc("ngIf",c.shippingAddressForm.dirty),i.Qb(1),i.yc("ngIf",c.billingAddressForm.dirty),i.Qb(3),i.Wc(i.tc(82,66,"order.note")),i.Qb(2),i.yc("ngModel",c.note),i.Qb(2),i.yc("ngModel",c.recalculateShipping),i.Qb(2),i.Wc(i.tc(88,68,"order.modification-recalculate-shipping")),i.Qb(3),i.yc("disabled",!c.canPreviewChanges()),i.Qb(1),i.Xc(" ",i.tc(92,70,"order.preview-changes")," ")}}class Or extends r.l{constructor(t,e,c,r,i,o,a,s){super(e,t,c,i),this.changeDetector=r,this.dataService=i,this.notificationService=o,this.modalService=a,this.orderTransitionService=s,this.detailForm=new n.i({}),this.modifyOrderInput={dryRun:!0,orderId:"",addItems:[],adjustOrderLines:[],surcharges:[],note:"",updateShippingAddress:{},updateBillingAddress:{}},this.note="",this.recalculateShipping=!0,this.addedVariants=new Map}get addedLines(){const t=t=>"SinglePrice"===t.__typename?t.value:0;return(this.modifyOrderInput.addItems||[]).map(e=>{const c=this.addedVariants.get(e.productVariantId);if(c)return Object.assign(Object.assign({},c),{price:t(c.price),priceWithTax:t(c.priceWithTax),quantity:e.quantity})}).filter(R.notNullOrUndefined)}ngOnInit(){this.init(),this.addressCustomFields=this.getCustomFieldConfig("Address"),this.modifyOrderInput.orderId=this.route.snapshot.paramMap.get("id"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.entity$.pipe(Object(kn.a)(this.destroy$)).subscribe(t=>{var e,c,r,i,o,a,s,l,d,u,f,g,m,p,h,b,y,v;this.surchargeForm=new n.i({description:new n.f("",n.C.required),sku:new n.f(""),price:new n.f(0,n.C.required),priceIncludesTax:new n.f(!0),taxRate:new n.f(0),taxDescription:new n.f("")}),this.shippingAddressForm||(this.shippingAddressForm=new n.i({fullName:new n.f(null===(e=t.shippingAddress)||void 0===e?void 0:e.fullName),company:new n.f(null===(c=t.shippingAddress)||void 0===c?void 0:c.company),streetLine1:new n.f(null===(r=t.shippingAddress)||void 0===r?void 0:r.streetLine1),streetLine2:new n.f(null===(i=t.shippingAddress)||void 0===i?void 0:i.streetLine2),city:new n.f(null===(o=t.shippingAddress)||void 0===o?void 0:o.city),province:new n.f(null===(a=t.shippingAddress)||void 0===a?void 0:a.province),postalCode:new n.f(null===(s=t.shippingAddress)||void 0===s?void 0:s.postalCode),countryCode:new n.f(null===(l=t.shippingAddress)||void 0===l?void 0:l.countryCode),phoneNumber:new n.f(null===(d=t.shippingAddress)||void 0===d?void 0:d.phoneNumber)})),this.billingAddressForm||(this.billingAddressForm=new n.i({fullName:new n.f(null===(u=t.billingAddress)||void 0===u?void 0:u.fullName),company:new n.f(null===(f=t.billingAddress)||void 0===f?void 0:f.company),streetLine1:new n.f(null===(g=t.billingAddress)||void 0===g?void 0:g.streetLine1),streetLine2:new n.f(null===(m=t.billingAddress)||void 0===m?void 0:m.streetLine2),city:new n.f(null===(p=t.billingAddress)||void 0===p?void 0:p.city),province:new n.f(null===(h=t.billingAddress)||void 0===h?void 0:h.province),postalCode:new n.f(null===(b=t.billingAddress)||void 0===b?void 0:b.postalCode),countryCode:new n.f(null===(y=t.billingAddress)||void 0===y?void 0:y.countryCode),phoneNumber:new n.f(null===(v=t.billingAddress)||void 0===v?void 0:v.phoneNumber)})),this.orderLineCustomFieldsFormArray=new n.c([]);for(const C of t.lines){const t=new n.i({});for(const{name:e}of this.orderLineCustomFields)t.addControl(e,new n.f(C.customFields[e]));t.valueChanges.pipe(Object(kn.a)(this.destroy$)).subscribe(t=>{let e=this.modifyOrderInput.adjustOrderLines.find(t=>t.orderLineId===C.id);e||(e={orderLineId:C.id,quantity:C.quantity},this.modifyOrderInput.adjustOrderLines.push(e)),this.orderLineCustomFields.length&&(e.customFields=t)}),this.orderLineCustomFieldsFormArray.push(t)}}),this.addItemCustomFieldsFormArray=new n.c([]),this.addItemCustomFieldsForm=new n.i({});for(const t of this.orderLineCustomFields)this.addItemCustomFieldsForm.addControl(t.name,new n.f);this.availableCountries$=this.dataService.settings.getAvailableCountries().mapSingle(t=>t.countries.items).pipe(Object(Ln.a)(1)),this.dataService.order.getOrderHistory(this.id,{take:1,sort:{createdAt:r.L.DESC},filter:{type:{eq:r.y.ORDER_STATE_TRANSITION}}}).single$.subscribe(({order:t})=>{this.previousState=null==t?void 0:t.history.items[0].data.from})}ngOnDestroy(){this.destroy()}transitionToPriorState(t){this.orderTransitionService.transitionToPreModifyingState(t.id,t.nextStates).subscribe(t=>{this.router.navigate([".."],{relativeTo:this.route})})}canPreviewChanges(){const{addItems:t,adjustOrderLines:e,surcharges:c}=this.modifyOrderInput;return!!(null==t?void 0:t.length)||!!(null==c?void 0:c.length)||!!(null==e?void 0:e.length)||this.shippingAddressForm.dirty&&this.shippingAddressForm.valid||this.billingAddressForm.dirty&&this.billingAddressForm.valid}isLineModified(t){var e;return!!(null===(e=this.modifyOrderInput.adjustOrderLines)||void 0===e?void 0:e.find(e=>e.orderLineId===t.id&&e.quantity!==t.quantity))}updateLineQuantity(t,e){const{adjustOrderLines:c}=this.modifyOrderInput;let n=null==c?void 0:c.find(e=>e.orderLineId===t.id);n&&+e===t.quantity&&(null==c||c.splice(null==c?void 0:c.indexOf(n),1)),n||(n={orderLineId:t.id,quantity:+e},null==c||c.push(n)),n.quantity=+e}updateAddedItemQuantity(t,e){var c;const n=null===(c=this.modifyOrderInput.addItems)||void 0===c?void 0:c.find(e=>e.productVariantId===t.productVariantId);n&&(n.quantity=+e)}trackByProductVariantId(t,e){return e.productVariantId}getSelectedItemPrice(t){switch(null==t?void 0:t.priceWithTax.__typename){case"SinglePrice":return t.priceWithTax.value;default:return 0}}addItemToOrder(t){var e,c;if(!t)return;const r=this.orderLineCustomFields.length?this.addItemCustomFieldsForm.value:void 0;let i=null===(e=this.modifyOrderInput.addItems)||void 0===e?void 0:e.find(e=>this.isMatchingAddItemRow(e,t,r));if(i?i.quantity++:(i={productVariantId:t.productVariantId,quantity:1},r&&(i.customFields=r),null===(c=this.modifyOrderInput.addItems)||void 0===c||c.push(i)),r){const t=new n.i({});for(const[e,c]of Object.entries(r))t.addControl(e,new n.f(c));this.addItemCustomFieldsFormArray.push(t),t.valueChanges.pipe(Object(kn.a)(this.destroy$)).subscribe(t=>{i&&(i.customFields=t)})}this.addItemCustomFieldsForm.reset({}),this.addItemSelectedVariant=void 0,this.addedVariants.set(t.productVariantId,t)}isMatchingAddItemRow(t,e,c){return t.productVariantId===e.productVariantId&&JSON.stringify(t.customFields)===JSON.stringify(c)}removeAddedItem(t){this.modifyOrderInput.addItems.splice(t,1),-1<t&&this.addItemCustomFieldsFormArray.removeAt(t)}getSurchargePrices(t){const e=t.priceIncludesTax?t.price:Math.round(t.price*((100+(t.taxRate||0))/100));return{price:t.priceIncludesTax?Math.round(t.price/((100+(t.taxRate||0))/100)):t.price,priceWithTax:e}}addSurcharge(t){var e;null===(e=this.modifyOrderInput.surcharges)||void 0===e||e.push(t),this.surchargeForm.reset({price:0,priceIncludesTax:!0,taxRate:0})}removeSurcharge(t){var e;null===(e=this.modifyOrderInput.surcharges)||void 0===e||e.splice(t,1)}previewAndModify(t){var e;const c=Object.assign(Object.assign(Object.assign(Object.assign({},this.modifyOrderInput),this.billingAddressForm.dirty?{updateBillingAddress:this.billingAddressForm.value}:{}),this.shippingAddressForm.dirty?{updateShippingAddress:this.shippingAddressForm.value}:{}),{dryRun:!0,note:null!==(e=this.note)&&void 0!==e?e:"",options:{recalculateShipping:this.recalculateShipping}}),n=t.totalWithTax;this.dataService.order.modifyOrder(c).pipe(Object(qt.a)(({modifyOrder:t})=>{switch(t.__typename){case"Order":return this.modalService.fromComponent(Nn,{size:"xl",closable:!1,locals:{originalTotalWithTax:n,order:t,orderLineCustomFields:this.orderLineCustomFields,modifyOrderInput:c}});case"InsufficientStockError":case"NegativeQuantityError":case"NoChangesSpecifiedError":case"OrderLimitError":case"OrderModificationStateError":case"PaymentMethodMissingError":case"RefundPaymentIdMissingError":return this.notificationService.error(t.message),Object(Rt.a)(!1);case null:case void 0:return Object(Rt.a)(!1);default:Object(R.assertNever)(t)}}),Object(qt.a)(e=>{if(e&&e.result!==_n.Cancel){const r=Object.assign(Object.assign({},c),{dryRun:!1});return e.result===_n.Refund&&(r.refund={paymentId:e.refundPaymentId,reason:e.refundNote}),this.dataService.order.modifyOrder(r).pipe(Object(qt.a)(({modifyOrder:e})=>{if("Order"===e.__typename){const c=0<e.totalWithTax-n?"ArrangingAdditionalPayment":this.previousState;return this.dataService.order.transitionToState(t.id,c).pipe(Object(Ut.a)(!0))}return this.notificationService.error(e.message),Nt.a}))}return this.dataService.order.getOrder(this.id).mapSingle(()=>!1)})).subscribe(t=>{t&&this.router.navigate(["../"],{relativeTo:this.route})})}setFormValues(t,e){}}Or.\u0275fac=function(t){return new(t||Or)(i.bc(Ne.e),i.bc(Ne.a),i.bc(r.I),i.bc(i.j),i.bc(r.s),i.bc(r.G),i.bc(r.F),i.bc(re))},Or.\u0275cmp=i.Vb({type:Or,selectors:[["vdr-order-editor"]],features:[i.Nb],decls:4,vars:6,consts:[[4,"ngIf"],[1,"flex","clr-align-items-center"],[3,"entity"],[3,"state"],[1,"btn","btn-secondary",3,"click"],[1,"clr-row"],[1,"clr-col-lg-8"],[1,"order-table","table"],["class","order-line",3,"is-cancelled","modified",4,"ngFor","ngForOf"],["class","modified",4,"ngFor","ngForOf","ngForTrackBy"],["class","surcharge",4,"ngFor","ngForOf"],["class","surcharge modified",4,"ngFor","ngForOf"],[1,"shipping"],[1,"left","clr-align-middle"],[1,"clr-align-middle"],["colspan","3"],[1,"net-price",3,"title"],[1,"mb2"],[4,"clrIfExpanded"],[1,"clr-col-lg-4","order-cards"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"clr-control-label"],["name","note","clrTextarea","","required","",3,"ngModel","ngModelChange"],[1,""],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],[1,"card-footer"],[1,"btn","btn-primary",3,"disabled","click"],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","unit-price"],[1,"align-middle","quantity"],["type","number","min","0",3,"value","input"],[3,"line","payments"],[3,"line","orderState"],["class","order-line-custom-field align-middle",4,"ngIf"],[1,"align-middle","total"],[3,"src"],[1,"order-line-custom-field","align-middle"],[4,"ngFor","ngForOf"],["entityName","OrderLine",3,"customField","customFieldsFormGroup","compact"],[1,"modified"],[1,"icon-button",3,"click"],["shape","trash"],[1,"surcharge"],["colspan","2",1,"align-middle","name","left"],[1,"align-middle"],[1,"surcharge","modified"],[1,"mb4",3,"productSelected"],["class","flex mb4",4,"ngIf"],[1,"btn","btn-secondary",3,"disabled","click"],[1,"flex","mb4"],["class","mr4",3,"src",4,"ngIf"],[1,"mr4"],[1,"mr4",3,"src"],["entityName","OrderLine",3,"readonly","customField","customFieldsFormGroup","compact"],[3,"formGroup","submit"],["for","description",3,"label"],["id","description","type","text","formControlName","description"],["for","sku",3,"label"],["id","sku","type","text","formControlName","sku"],["for","price",3,"label"],["id","price","formControlName","price",3,"currencyCode"],["for","priceIncludesTax",3,"label"],["id","priceIncludesTax","type","checkbox","clrCheckbox","","formControlName","priceIncludesTax"],["for","taxRate",3,"label"],["suffix","%"],["id","taxRate","type","number","min","0","max","100","formControlName","taxRate"],["for","taxDescription",3,"label"],["id","taxDescription","type","text","formControlName","taxDescription"],[1,"btn","btn-secondary",3,"disabled"],[3,"formGroup","availableCountries","customFields"]],template:function(t,e){1&t&&(i.Tc(0,$n,10,7,"vdr-action-bar",0),i.sc(1,"async"),i.Tc(2,Cr,93,72,"div",0),i.sc(3,"async")),2&t&&(i.yc("ngIf",i.tc(1,2,e.entity$)),i.Qb(2),i.yc("ngIf",i.tc(3,4,e.entity$)))},directives:[f.o,Re.a,Re.b,Ee.a,Xe.a,Re.c,f.n,y.l,y.b,y.O,y.d,y.N,y.e,y.Q,y.q,y.u,l.a,n.b,y.H,n.z,n.p,n.s,y.k,n.a,y.i,Pt,Ot,wt.a,y.o,y.c,Rn.a,n.E,n.q,n.j,a.a,n.h,be.a,En.a,n.v,Xn.a],pipes:[f.b,u.d,g.a,v.a,f.d],styles:[".order-table[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}.order-table[_ngcontent-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700}.order-table[_ngcontent-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-right:18px}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%], .order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px}.order-table[_ngcontent-%COMP%]   .promotions-label[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted var(--color-text-200);text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}.order-table[_ngcontent-%COMP%]   tr.modified[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-warning-100)}"],changeDetection:0});var Qr=c("/uUt"),Ir=c("pLZG"),Tr=c("tBhK"),Pr=c("CotX"),Sr=c("r2d8"),Mr=c("ef/U"),Vr=c("uHMJ");function xr(t,e){if(1&t){const t=i.ic();i.hc(0,"button",18),i.pc("click",function(){i.Lc(t);const c=e.$implicit;return i.rc(2).selectFilterPreset(c.name)}),i.Vc(1),i.sc(2,"translate"),i.gc()}if(2&t){const t=e.$implicit,c=i.rc().ngIf;i.Tb("btn-primary",c===t.name),i.Qb(1),i.Xc(" ",i.tc(2,3,t.label)," ")}}function Fr(t,e){if(1&t){const t=i.ic();i.hc(0,"div",16),i.Tc(1,xr,3,5,"button",17),i.hc(2,"button",18),i.pc("click",function(){i.Lc(t);return i.rc().selectFilterPreset("custom")}),i.Vc(3),i.sc(4,"translate"),i.cc(5,"clr-icon",19),i.gc(),i.gc()}if(2&t){const t=e.ngIf,c=i.rc();i.Qb(1),i.yc("ngForOf",c.filterPresets),i.Qb(1),i.Tb("btn-primary","custom"===t),i.Qb(1),i.Xc(" ",i.tc(4,4,"order.filter-custom")," ")}}function wr(t,e){if(1&t&&(i.Vc(0),i.sc(1,"translate"),i.sc(2,"stateI18nToken")),2&t){const t=e.item;i.Wc(i.tc(1,1,i.tc(2,3,t)))}}function _r(t,e){if(1&t&&(i.hc(0,"span",20),i.Vc(1),i.sc(2,"translate"),i.sc(3,"stateI18nToken"),i.gc(),i.hc(4,"span",21),i.pc("click",function(){const t=e.item;return(0,e.clear)(t)}),i.Vc(5,"\xd7"),i.gc()),2&t){const t=e.item;i.Qb(1),i.Xc(" ",i.tc(2,1,i.tc(3,3,t)),"")}}const kr=function(t){return["./",t,"modify"]},Lr=function(t){return["./",t]};function Ar(t,e){if(1&t&&(i.hc(0,"td",22),i.Vc(1),i.gc(),i.hc(2,"td",22),i.cc(3,"vdr-customer-label",23),i.gc(),i.hc(4,"td",22),i.cc(5,"vdr-order-state-label",24),i.gc(),i.hc(6,"td",22),i.Vc(7),i.sc(8,"localeCurrency"),i.gc(),i.hc(9,"td",22),i.Vc(10),i.sc(11,"timeAgo"),i.gc(),i.hc(12,"td",22),i.Vc(13),i.sc(14,"localeDate"),i.gc(),i.hc(15,"td",22),i.Vc(16),i.gc(),i.hc(17,"td",25),i.cc(18,"vdr-table-row-action",26),i.sc(19,"translate"),i.gc()),2&t){const t=e.item,c=i.rc();i.Qb(1),i.Wc(t.code),i.Qb(2),i.yc("customer",t.customer),i.Qb(2),i.yc("state",t.state),i.Qb(2),i.Wc(i.uc(8,9,t.total,t.currencyCode)),i.Qb(3),i.Wc(i.tc(11,12,t.updatedAt)),i.Qb(3),i.Wc(i.uc(14,14,t.orderPlacedAt,"medium")),i.Qb(3),i.Wc(c.getShippingNames(t)),i.Qb(2),i.yc("label",i.tc(19,17,"common.open"))("linkTo","Modifying"===t.state?i.Cc(19,kr,t.id):i.Cc(21,Lr,t.id))}}class Dr extends r.n{constructor(t,e,c,r,i){super(r,i),this.serverConfigService=t,this.dataService=e,this.localStorageService=c,this.searchOrderCodeControl=new n.f(""),this.searchLastNameControl=new n.f(""),this.orderStates=this.serverConfigService.getOrderProcessStates().map(t=>t.name),this.filterPresets=[{name:"open",label:Object(b.a)("order.filter-preset-open"),config:{active:!1,states:this.orderStates.filter(t=>"Delivered"!==t&&"Cancelled"!==t&&"Shipped"!==t)}},{name:"shipped",label:Object(b.a)("order.filter-preset-shipped"),config:{active:!1,states:["Shipped"]}},{name:"completed",label:Object(b.a)("order.filter-preset-completed"),config:{active:!1,states:["Delivered","Cancelled"]}},{name:"active",label:Object(b.a)("order.filter-preset-active"),config:{active:!0}}],super.setQueryFn((t,e)=>this.dataService.order.getOrders({take:t,skip:e}).refetchOnChannelChange(),t=>t.orders,(t,e)=>this.createQueryOptions(t,e,this.searchOrderCodeControl.value,this.searchLastNameControl.value,this.route.snapshot.queryParamMap.get("filter")||"open"));const o=this.localStorageService.get("orderListLastCustomFilters");o&&this.setQueryParam(o,{replaceUrl:!0})}ngOnInit(){var t;super.ngOnInit(),this.activePreset$=this.route.queryParamMap.pipe(Object(Ht.a)(t=>t.get("filter")||"open"),Object(Qr.a)());const e=Object(Et.a)(this.searchOrderCodeControl.valueChanges,this.searchLastNameControl.valueChanges).pipe(Object(Ir.a)(t=>2<t.length||0===t.length),Object(oe.a)(250));Object(Et.a)(e,this.route.queryParamMap).pipe(Object(kn.a)(this.destroy$)).subscribe(t=>{this.refresh()});const c=this.route.snapshot.queryParamMap;this.customFilterForm=new n.i({states:new n.f(null!==(t=c.getAll("states"))&&void 0!==t?t:[]),placedAtStart:new n.f(c.get("placedAtStart")),placedAtEnd:new n.f(c.get("placedAtEnd"))})}selectFilterPreset(t){var e;const c=null!==(e=this.localStorageService.get("orderListLastCustomFilters"))&&void 0!==e?e:{},n="custom"===t?c:{states:void 0,placedAtStart:void 0,placedAtEnd:void 0};this.setQueryParam(Object.assign({filter:t,page:1},n),{replaceUrl:!0})}applyCustomFilters(){const t=this.customFilterForm.value,e={states:t.states,placedAtStart:t.placedAtStart,placedAtEnd:t.placedAtEnd};this.setQueryParam(Object.assign({filter:"custom"},e)),this.customFilterForm.markAsPristine(),this.localStorageService.set("orderListLastCustomFilters",e)}createQueryOptions(t,e,c,n,i){var o;const a=this.filterPresets.find(t=>t.name===i),s={};if(a)null!=a.config.active&&(s.active={eq:a.config.active}),a.config.states&&(s.state={in:a.config.states});else if("custom"===i){const t=this.route.snapshot.queryParamMap,e=null!==(o=t.getAll("states"))&&void 0!==o?o:[],c=t.get("placedAtStart"),n=t.get("placedAtEnd");e.length&&(s.state={in:e}),c&&n?s.orderPlacedAt={between:{start:c,end:n}}:c?s.orderPlacedAt={after:c}:n&&(s.orderPlacedAt={before:n})}return n&&(s.customerLastName={contains:n}),c&&(s.code={contains:c}),{options:{skip:t,take:e,filter:Object.assign({},null!=s?s:{}),sort:{updatedAt:r.L.DESC}}}}getShippingNames(t){return t.shippingLines.length?t.shippingLines.map(t=>t.shippingMethod.name).join(", "):""}}Dr.\u0275fac=function(t){return new(t||Dr)(i.bc(r.I),i.bc(r.s),i.bc(r.D),i.bc(Ne.e),i.bc(Ne.a))},Dr.\u0275cmp=i.Vb({type:Dr,selectors:[["vdr-order-list"]],features:[i.Nb],decls:62,vars:67,consts:[[1,"search-form"],["class","btn-group btn-outline-primary",4,"ngIf"],["type","text","name","searchTerm",1,"search-input",3,"formControl","placeholder"],[1,"custom-filters"],[3,"formGroup"],[1,"flex","align-center"],["appendTo","body","formControlName","states",3,"items","addTag","multiple","placeholder","clearable","searchable"],["ng-option-tmp",""],["ng-label-tmp",""],[1,"btn","btn-secondary",3,"disabled","click"],["shape","filter"],[1,"flex"],["formControlName","placedAtStart"],["formControlName","placedAtEnd"],["locationId","order-list"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"btn-group","btn-outline-primary"],["class","btn",3,"btn-primary","click",4,"ngFor","ngForOf"],[1,"btn",3,"click"],["shape","angle down"],[1,"ng-value-label"],["aria-hidden","true",1,"ng-value-icon","right",3,"click"],[1,"left","align-middle"],[3,"customer"],[3,"state"],[1,"right","align-middle"],["iconShape","shopping-cart",3,"label","linkTo"]],template:function(t,e){1&t&&(i.hc(0,"vdr-action-bar"),i.hc(1,"vdr-ab-left"),i.hc(2,"div",0),i.Tc(3,Fr,6,6,"div",1),i.sc(4,"async"),i.cc(5,"input",2),i.sc(6,"translate"),i.cc(7,"input",2),i.sc(8,"translate"),i.gc(),i.hc(9,"div",3),i.sc(10,"async"),i.hc(11,"form",4),i.hc(12,"div",5),i.hc(13,"ng-select",6),i.sc(14,"translate"),i.Tc(15,wr,3,5,"ng-template",7),i.Tc(16,_r,6,5,"ng-template",8),i.gc(),i.hc(17,"button",9),i.pc("click",function(){return e.applyCustomFilters()}),i.Vc(18),i.sc(19,"translate"),i.cc(20,"clr-icon",10),i.gc(),i.gc(),i.hc(21,"div",11),i.hc(22,"div"),i.hc(23,"label"),i.Vc(24),i.sc(25,"translate"),i.gc(),i.cc(26,"vdr-datetime-picker",12),i.gc(),i.hc(27,"div"),i.hc(28,"label"),i.Vc(29),i.sc(30,"translate"),i.gc(),i.cc(31,"vdr-datetime-picker",13),i.gc(),i.gc(),i.gc(),i.gc(),i.gc(),i.hc(32,"vdr-ab-right"),i.cc(33,"vdr-action-bar-items",14),i.gc(),i.gc(),i.hc(34,"vdr-data-table",15),i.pc("pageChange",function(t){return e.setPageNumber(t)})("itemsPerPageChange",function(t){return e.setItemsPerPage(t)}),i.sc(35,"async"),i.sc(36,"async"),i.sc(37,"async"),i.sc(38,"async"),i.hc(39,"vdr-dt-column"),i.Vc(40),i.sc(41,"translate"),i.gc(),i.hc(42,"vdr-dt-column"),i.Vc(43),i.sc(44,"translate"),i.gc(),i.hc(45,"vdr-dt-column"),i.Vc(46),i.sc(47,"translate"),i.gc(),i.hc(48,"vdr-dt-column"),i.Vc(49),i.sc(50,"translate"),i.gc(),i.hc(51,"vdr-dt-column"),i.Vc(52),i.sc(53,"translate"),i.gc(),i.hc(54,"vdr-dt-column"),i.Vc(55),i.sc(56,"translate"),i.gc(),i.hc(57,"vdr-dt-column"),i.Vc(58),i.sc(59,"translate"),i.gc(),i.cc(60,"vdr-dt-column"),i.Tc(61,Ar,20,23,"ng-template"),i.gc()),2&t&&(i.Qb(3),i.yc("ngIf",i.tc(4,29,e.activePreset$)),i.Qb(2),i.yc("formControl",e.searchOrderCodeControl)("placeholder",i.tc(6,31,"order.search-by-order-code")),i.Qb(2),i.yc("formControl",e.searchLastNameControl)("placeholder",i.tc(8,33,"order.search-by-customer-last-name")),i.Qb(2),i.Tb("expanded","custom"===i.tc(10,35,e.activePreset$)),i.Qb(2),i.yc("formGroup",e.customFilterForm),i.Qb(2),i.yc("items",e.orderStates)("addTag",!1)("multiple",!0)("placeholder",i.tc(14,37,"state.all-orders"))("clearable",!0)("searchable",!1),i.Qb(4),i.yc("disabled",e.customFilterForm.pristine),i.Qb(1),i.Xc(" ",i.tc(19,39,"order.apply-filters")," "),i.Qb(6),i.Wc(i.tc(25,41,"order.placed-at-start")),i.Qb(5),i.Wc(i.tc(30,43,"order.placed-at-end")),i.Qb(5),i.yc("items",i.tc(35,45,e.items$))("itemsPerPage",i.tc(36,47,e.itemsPerPage$))("totalItems",i.tc(37,49,e.totalItems$))("currentPage",i.tc(38,51,e.currentPage$)),i.Qb(6),i.Wc(i.tc(41,53,"common.code")),i.Qb(3),i.Wc(i.tc(44,55,"order.customer")),i.Qb(3),i.Wc(i.tc(47,57,"order.state")),i.Qb(3),i.Wc(i.tc(50,59,"order.total")),i.Qb(3),i.Wc(i.tc(53,61,"common.updated-at")),i.Qb(3),i.Wc(i.tc(56,63,"order.placed-at")),i.Qb(3),i.Wc(i.tc(59,65,"order.shipping")))},directives:[Re.a,Re.b,f.o,l.a,n.b,n.p,n.g,n.E,n.q,n.j,s.a,n.h,s.d,s.e,y.o,y.u,Tr.a,Re.c,$e.a,Pr.a,Sr.a,f.n,Gc.a,Xe.a,Mr.a],pipes:[f.b,u.d,j.a,g.a,Vr.a,H.a],styles:[".search-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:baseline;width:100%;margin-bottom:6px}@media screen and (min-width:768px){.search-form[_ngcontent-%COMP%]{flex-direction:row}}.search-input[_ngcontent-%COMP%]{margin-left:6px;margin-top:6px;min-width:300px}.custom-filters[_ngcontent-%COMP%]{overflow:hidden;max-height:0;padding-bottom:6px}.custom-filters.expanded[_ngcontent-%COMP%]{max-height:none}.custom-filters[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.custom-filters[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%}ng-select[_ngcontent-%COMP%]{flex:1;min-width:200px}ng-select[_ngcontent-%COMP%], ng-select[_ngcontent-%COMP%]     .ng-select-container{height:36px}"],changeDetection:0});class jr extends r.m{constructor(t,e){super(t,{__typename:"Order",id:"",code:"",createdAt:"",updatedAt:"",total:0},t=>e.order.getOrder(t).mapStream(t=>t.order))}}jr.\u0275fac=function(t){return new(t||jr)(i.lc(Ne.e),i.lc(r.s))},jr.\u0275prov=i.Xb({token:jr,factory:jr.\u0275fac,providedIn:"root"});const Wr=[{path:"",component:Dr,data:{breadcrumb:Object(b.a)("breadcrumb.orders")}},{path:":id",component:wn,resolve:Object(r.O)(jr),canDeactivate:[r.o],data:{breadcrumb:Nr}},{path:":id/modify",component:Or,resolve:Object(r.O)(jr),data:{breadcrumb:Rr}}];function Nr(t,e){return Object(r.Q)({entity:t.entity,id:e.id,breadcrumbKey:"breadcrumb.orders",getName:t=>t.code,route:""})}function Rr(t,e){return Nr(t,e).pipe(Object(Ht.a)(t=>{const e=t.slice();return e[0].link[0]="../",e[1].link[0]="../orders",e.concat({label:Object(b.a)("breadcrumb.modifying"),link:[""]})}))}class Er{}Er.\u0275fac=function(t){return new(t||Er)},Er.\u0275mod=i.Zb({type:Er}),Er.\u0275inj=i.Yb({imports:[[r.J,Ne.i.forChild(Wr)]]})}}]);
//# sourceMappingURL=11-es2015.fb4b1a5cb8de0af4e61a.js.map
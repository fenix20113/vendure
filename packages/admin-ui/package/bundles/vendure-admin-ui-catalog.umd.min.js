!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/router"),require("@vendure/admin-ui/core"),require("@biesbjerg/ngx-translate-extract-marker"),require("rxjs/operators"),require("@angular/forms"),require("rxjs"),require("@vendure/common/lib/normalize-string"),require("@vendure/common/lib/shared-utils"),require("@angular/common"),require("@vendure/common/lib/shared-constants"),require("@vendure/common/lib/unique"),require("@vendure/common/lib/pick"),require("@angular/cdk/drag-drop"),require("@angular/cdk/overlay"),require("@ng-select/ng-select")):"function"==typeof define&&define.amd?define("@vendure/admin-ui/catalog",["exports","@angular/core","@angular/router","@vendure/admin-ui/core","@biesbjerg/ngx-translate-extract-marker","rxjs/operators","@angular/forms","rxjs","@vendure/common/lib/normalize-string","@vendure/common/lib/shared-utils","@angular/common","@vendure/common/lib/shared-constants","@vendure/common/lib/unique","@vendure/common/lib/pick","@angular/cdk/drag-drop","@angular/cdk/overlay","@ng-select/ng-select"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).vendure=e.vendure||{},e.vendure["admin-ui"]=e.vendure["admin-ui"]||{},e.vendure["admin-ui"].catalog={}),e.ng.core,e.ng.router,e.vendure["admin-ui"].core,e.ngxTranslateExtractMarker,e.rxjs.operators,e.ng.forms,e.rxjs,e.normalizeString,e.sharedUtils,e.ng.common,e.sharedConstants,e.unique,e.pick,e.ng.cdk.dragDrop,e.ng.cdk.overlay,e.ngSelect)}(this,(function(e,t,n,a,r,o,i,s,c,l,d,u,p,m,g,v,f){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var h=function(e,t){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}h(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function b(e,t,n,a){return new(n||(n=Promise))((function(r,o){function i(e){try{c(a.next(e))}catch(e){o(e)}}function s(e){try{c(a.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((a=a.apply(e,t||[])).next())}))}function C(e,t){var n,a,r,o,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,a&&(r=2&o[0]?a.return:o[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,o[1])).done)return r;switch(a=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,a=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){i.label=o[1];break}if(6===o[0]&&i.label<r[1]){i.label=r[1],r=o;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(o);break}r[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],a=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}Object.create;function F(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],a=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function x(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var a,r,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(a=o.next()).done;)i.push(a.value)}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return i}function I(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(x(arguments[t]));return e}Object.create;var P=function(e){function t(t,n,a,r,o,s){var c=e.call(this,n,t,a,o)||this;return c.notificationService=r,c.dataService=o,c.formBuilder=s,c.detailForm=new i.FormGroup({}),c.customFields=c.getCustomFieldConfig("Asset"),c}return y(t,e),t.prototype.ngOnInit=function(){this.detailForm=new i.FormGroup({name:new i.FormControl(""),tags:new i.FormControl([]),customFields:this.formBuilder.group(this.customFields.reduce((function(e,t){var n;return Object.assign(Object.assign({},e),((n={})[t.name]="",n))}),{}))}),this.init()},t.prototype.ngOnDestroy=function(){this.destroy()},t.prototype.onAssetChange=function(e){var t,n;null===(t=this.detailForm.get("name"))||void 0===t||t.setValue(e.name),null===(n=this.detailForm.get("tags"))||void 0===n||n.setValue(e.tags),this.detailForm.markAsDirty()},t.prototype.save=function(){var e=this;this.dataService.product.updateAsset({id:this.id,name:this.detailForm.value.name,tags:this.detailForm.value.tags,customFields:this.detailForm.value.customFields}).subscribe((function(){e.notificationService.success(r.marker("common.notify-update-success"),{entity:"Asset"})}),(function(t){e.notificationService.error(r.marker("common.notify-update-error"),{entity:"Asset"})}))},t.prototype.setFormValues=function(e,t){var n,a,r,o;if(null===(r=this.detailForm.get("name"))||void 0===r||r.setValue(e.name),null===(o=this.detailForm.get("tags"))||void 0===o||o.setValue(e.tags),this.customFields.length){var i=this.detailForm.get("customFields");try{for(var s=F(this.customFields),c=s.next();!c.done;c=s.next()){var l=c.value.name,d=e.customFields[l],u=i.get(l);u&&u.patchValue(d)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}}},t}(a.BaseDetailComponent);P.decorators=[{type:t.Component,args:[{selector:"vdr-asset-detail",template:'<vdr-action-bar>\n    <vdr-ab-left>\n        <vdr-entity-info [entity]="entity$ | async"></vdr-entity-info>\n    </vdr-ab-left>\n\n    <vdr-ab-right>\n        <vdr-action-bar-items locationId="asset-detail"></vdr-action-bar-items>\n        <button\n            *vdrIfPermissions="[\'UpdateCatalog\', \'UpdateAsset\']"\n            class="btn btn-primary"\n            (click)="save()"\n            [disabled]="detailForm.invalid || detailForm.pristine"\n        >\n            {{ \'common.update\' | translate }}\n        </button>\n    </vdr-ab-right>\n</vdr-action-bar>\n<vdr-asset-preview\n    [asset]="entity$ | async"\n    [editable]="true"\n    [customFields]="customFields"\n    [customFieldsForm]="detailForm.get(\'customFields\')"\n    (assetChange)="onAssetChange($event)"\n></vdr-asset-preview>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[":host{display:flex;flex-direction:column;height:100%}"]}]}],P.ctorParameters=function(){return[{type:n.Router},{type:n.ActivatedRoute},{type:a.ServerConfigService},{type:a.NotificationService},{type:a.DataService},{type:i.FormBuilder}]};var k=function(e){function t(t,n,r,o,i){var c=e.call(this,o,i)||this;return c.notificationService=t,c.modalService=n,c.dataService=r,c.searchTerm$=new s.BehaviorSubject(void 0),c.filterByTags$=new s.BehaviorSubject(void 0),c.uploading=!1,e.prototype.setQueryFn.call(c,(function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=c.dataService.product).getAssetList.apply(e,I(t))}),(function(e){return e.assets}),(function(e,t){var n,r=c.searchTerm$.value,o=null===(n=c.filterByTags$.value)||void 0===n?void 0:n.map((function(e){return e.value}));return{options:Object.assign(Object.assign({skip:e,take:t},r?{filter:{name:{contains:r}}}:{}),{sort:{createdAt:a.SortOrder.DESC},tags:o,tagsOperator:a.LogicalOperator.AND})}}),{take:25,skip:0}),c}return y(t,e),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),this.paginationConfig$=s.combineLatest(this.itemsPerPage$,this.currentPage$,this.totalItems$).pipe(o.map((function(e){var t=x(e,3);return{itemsPerPage:t[0],currentPage:t[1],totalItems:t[2]}}))),this.searchTerm$.pipe(o.debounceTime(250),o.takeUntil(this.destroy$)).subscribe((function(){return t.refresh()})),this.filterByTags$.pipe(o.takeUntil(this.destroy$)).subscribe((function(){return t.refresh()})),this.allTags$=this.dataService.product.getTagList().mapStream((function(e){return e.tags.items}))},t.prototype.filesSelected=function(t){var n=this;t.length&&(this.uploading=!0,this.dataService.product.createAssets(t).pipe(o.finalize((function(){return n.uploading=!1}))).subscribe((function(t){var a,o,i=t.createAssets,s=0;try{for(var c=F(i),l=c.next();!l.done;l=c.next()){var d=l.value;switch(d.__typename){case"Asset":s++;break;case"MimeTypeError":n.notificationService.error(d.message)}}}catch(e){a={error:e}}finally{try{l&&!l.done&&(o=c.return)&&o.call(c)}finally{if(a)throw a.error}}0<s&&(e.prototype.refresh.call(n),n.notificationService.success(r.marker("asset.notify-create-assets-success"),{count:s}))})))},t.prototype.deleteAssets=function(e){var t=this;this.showModalAndDelete(e.map((function(e){return e.id}))).pipe(o.switchMap((function(n){return n.result===a.DeletionResult.DELETED?[!0]:t.showModalAndDelete(e.map((function(e){return e.id})),n.message||"").pipe(o.map((function(e){return e.result===a.DeletionResult.DELETED})))}))).subscribe((function(){t.notificationService.success(r.marker("common.notify-delete-success"),{entity:"Assets"}),t.refresh()}),(function(e){t.notificationService.error(r.marker("common.notify-delete-error"),{entity:"Assets"})}))},t.prototype.showModalAndDelete=function(e,t){var n=this;return this.modalService.dialog({title:r.marker("catalog.confirm-delete-assets"),translationVars:{count:e.length},body:t,buttons:[{type:"secondary",label:r.marker("common.cancel")},{type:"danger",label:r.marker("common.delete"),returnValue:!0}]}).pipe(o.switchMap((function(a){return a?n.dataService.product.deleteAssets(e,!!t):s.EMPTY})),o.map((function(e){return e.deleteAssets})))},t}(a.BaseListComponent);k.decorators=[{type:t.Component,args:[{selector:"vdr-asset-list",template:'<vdr-action-bar>\n    <vdr-ab-left [grow]="true">\n        <vdr-asset-search-input\n            class="pr4 mt1"\n            [tags]="allTags$ | async"\n            (searchTermChange)="searchTerm$.next($event)"\n            (tagsChange)="filterByTags$.next($event)"\n        ></vdr-asset-search-input>\n    </vdr-ab-left>\n    <vdr-ab-right>\n        <vdr-action-bar-items locationId="asset-list"></vdr-action-bar-items>\n        <vdr-asset-file-input\n            (selectFiles)="filesSelected($event)"\n            [uploading]="uploading"\n            dropZoneTarget=".content-area"\n        ></vdr-asset-file-input>\n    </vdr-ab-right>\n</vdr-action-bar>\n\n<vdr-asset-gallery\n    [assets]="(items$ | async)! | paginate: (paginationConfig$ | async) || {}"\n    [multiSelect]="true"\n    [canDelete]="[\'DeleteCatalog\', \'DeleteAsset\'] | hasPermission"\n    (deleteAssets)="deleteAssets($event)"\n></vdr-asset-gallery>\n\n<div class="paging-controls">\n    <vdr-items-per-page-controls\n        [itemsPerPage]="itemsPerPage$ | async"\n        (itemsPerPageChange)="setItemsPerPage($event)"\n    ></vdr-items-per-page-controls>\n\n    <vdr-pagination-controls\n        [currentPage]="currentPage$ | async"\n        [itemsPerPage]="itemsPerPage$ | async"\n        [totalItems]="totalItems$ | async"\n        (pageChange)="setPageNumber($event)"\n    ></vdr-pagination-controls>\n</div>\n',styles:[":host{display:flex;flex-direction:column;height:100%}vdr-asset-gallery{flex:1}.paging-controls{padding-top:6px;border-top:1px solid var(--color-component-border-100);display:flex;justify-content:space-between}.search-input{margin-top:6px;min-width:300px}"]}]}],k.ctorParameters=function(){return[{type:a.NotificationService},{type:a.ModalService},{type:a.DataService},{type:n.Router},{type:n.ActivatedRoute}]};var w=function(e){function t(t,n,r,o,s,c,l,d){var u=e.call(this,n,t,r,s)||this;return u.changeDetector=o,u.dataService=s,u.formBuilder=c,u.notificationService=l,u.modalService=d,u.assetChanges={},u.filters=[],u.allFilters=[],u.updatePermission=[a.Permission.UpdateCatalog,a.Permission.UpdateCollection],u.customFields=u.getCustomFieldConfig("Collection"),u.detailForm=u.formBuilder.group({name:["",i.Validators.required],slug:"",description:"",visible:!1,filters:u.formBuilder.array([]),customFields:u.formBuilder.group(u.customFields.reduce((function(e,t){var n;return Object.assign(Object.assign({},e),((n={})[t.name]="",n))}),{}))}),u}return y(t,e),t.prototype.ngOnInit=function(){var e=this;this.init(),this.dataService.collection.getCollectionFilters().single$.subscribe((function(t){e.allFilters=t.collectionFilters}))},t.prototype.ngOnDestroy=function(){this.destroy()},t.prototype.getFilterDefinition=function(e){return this.allFilters.find((function(t){return t.code===e.code}))},t.prototype.customFieldIsSet=function(e){return!!this.detailForm.get(["customFields",e])},t.prototype.assetsChanged=function(){return!!Object.values(this.assetChanges).length},t.prototype.updateSlug=function(e){var t=this;s.combineLatest(this.entity$,this.languageCode$).pipe(o.take(1)).subscribe((function(n){var r=x(n,2),o=r[0],i=r[1],s=t.detailForm.get(["slug"]),l=a.findTranslation(o,i),d=!l||!l.slug;s&&s.pristine&&d&&s.setValue(c.normalizeString(""+e,"-"))}))},t.prototype.addFilter=function(e){var t=this.detailForm.get("filters");if(-1===t.value.findIndex((function(t){return t.code===e.code}))){var n=e.args.reduce((function(e,t){var n;return Object.assign(Object.assign({},e),((n={})[t.name]=a.getConfigArgValue(t.value),n))}),{});t.push(this.formBuilder.control({code:e.code,args:n})),this.filters.push({code:e.code,args:e.args.map((function(e){return{name:e.name,value:a.getConfigArgValue(e.value)}}))})}},t.prototype.removeFilter=function(e){var t=this.detailForm.get("filters"),n=t.value.findIndex((function(t){return t.code===e.code}));-1!==n&&(t.removeAt(n),this.filters.splice(n,1))},t.prototype.create=function(){var e=this;this.detailForm.dirty&&s.combineLatest(this.entity$,this.languageCode$).pipe(o.take(1),o.mergeMap((function(t){var n=x(t,2),a=n[0],r=n[1],o=e.getUpdatedCollection(a,e.detailForm,r),i=e.route.snapshot.paramMap.get("parentId");return i&&(o.parentId=i),e.dataService.collection.createCollection(o)}))).subscribe((function(t){e.notificationService.success(r.marker("common.notify-create-success"),{entity:"Collection"}),e.assetChanges={},e.detailForm.markAsPristine(),e.changeDetector.markForCheck(),e.router.navigate(["../",t.createCollection.id],{relativeTo:e.route})}),(function(t){e.notificationService.error(r.marker("common.notify-create-error"),{entity:"Collection"})}))},t.prototype.save=function(){var e=this;s.combineLatest(this.entity$,this.languageCode$).pipe(o.take(1),o.mergeMap((function(t){var n=x(t,2),a=n[0],r=n[1],o=e.getUpdatedCollection(a,e.detailForm,r);return e.dataService.collection.updateCollection(o)}))).subscribe((function(){e.assetChanges={},e.detailForm.markAsPristine(),e.changeDetector.markForCheck(),e.notificationService.success(r.marker("common.notify-update-success"),{entity:"Collection"}),e.contentsComponent.refresh()}),(function(t){e.notificationService.error(r.marker("common.notify-update-error"),{entity:"Collection"})}))},t.prototype.canDeactivate=function(){return e.prototype.canDeactivate.call(this)&&!this.assetChanges.assets&&!this.assetChanges.featuredAsset},t.prototype.setFormValues=function(e,t){var n,r,o=this,i=a.findTranslation(e,t);if(this.detailForm.patchValue({name:i?i.name:"",slug:i?i.slug:"",description:i?i.description:"",visible:!e.isPrivate}),e.filters.forEach((function(e){return o.addFilter(e)})),this.customFields.length){var s=this.detailForm.get(["customFields"]);try{for(var c=F(this.customFields),l=c.next();!l.done;l=c.next()){var d=l.value,u=d.name,p="localeString"===d.type?i.customFields[u]:e.customFields[u],m=s.get(u);m&&m.patchValue(p)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}},t.prototype.getUpdatedCollection=function(e,t,n){var r,o,i=a.createUpdatedTranslatable({translatable:e,updatedFields:t.value,customFieldConfig:this.customFields,languageCode:n,defaultTranslation:{languageCode:n,name:e.name||"",slug:e.slug||"",description:e.description||""}});return Object.assign(Object.assign({},i),{assetIds:null===(r=this.assetChanges.assets)||void 0===r?void 0:r.map((function(e){return e.id})),featuredAssetId:null===(o=this.assetChanges.featuredAsset)||void 0===o?void 0:o.id,isPrivate:!t.value.visible,filters:this.mapOperationsToInputs(this.filters,this.detailForm.value.filters)})},t.prototype.mapOperationsToInputs=function(e,t){return e.map((function(e,n){return{code:e.code,arguments:Object.values(t[n].args).map((function(t,n){return{name:e.args[n].name,value:a.encodeConfigArgValue(t)}}))}}))},t}(a.BaseDetailComponent);w.decorators=[{type:t.Component,args:[{selector:"vdr-collection-detail",template:'<vdr-action-bar>\n    <vdr-ab-left>\n        <vdr-entity-info [entity]="entity$ | async"></vdr-entity-info>\n        <vdr-language-selector\n            [disabled]="isNew$ | async"\n            [availableLanguageCodes]="availableLanguages$ | async"\n            [currentLanguageCode]="languageCode$ | async"\n            (languageCodeChange)="setLanguage($event)"\n        ></vdr-language-selector>\n    </vdr-ab-left>\n\n    <vdr-ab-right>\n        <vdr-action-bar-items locationId="collection-detail"></vdr-action-bar-items>\n        <button\n            class="btn btn-primary"\n            *ngIf="isNew$ | async; else updateButton"\n            (click)="create()"\n            [disabled]="detailForm.invalid || detailForm.pristine"\n        >\n            {{ \'common.create\' | translate }}\n        </button>\n        <ng-template #updateButton>\n            <button\n                *vdrIfPermissions="updatePermission"\n                class="btn btn-primary"\n                (click)="save()"\n                [disabled]="(detailForm.invalid || detailForm.pristine) && !assetsChanged()"\n            >\n                {{ \'common.update\' | translate }}\n            </button>\n        </ng-template>\n    </vdr-ab-right>\n</vdr-action-bar>\n\n<form class="form" [formGroup]="detailForm" *ngIf="entity$ | async as category">\n    <div class="clr-row">\n        <div class="clr-col">\n            <vdr-form-field [label]="\'catalog.visibility\' | translate" for="visibility">\n                <clr-toggle-wrapper>\n                    <input\n                        type="checkbox"\n                        clrToggle\n                        formControlName="visible"\n                        id="visibility"\n                        [vdrDisabled]="!(updatePermission | hasPermission)"\n                    />\n                    <label class="visible-toggle">\n                        <ng-container *ngIf="detailForm.value.visible; else private">{{ \'catalog.public\' | translate }}</ng-container>\n                        <ng-template #private>{{ \'catalog.private\' | translate }}</ng-template>\n                    </label>\n                </clr-toggle-wrapper>\n            </vdr-form-field>\n            <vdr-form-field [label]="\'common.name\' | translate" for="name">\n                <input\n                    id="name"\n                    type="text"\n                    formControlName="name"\n                    [readonly]="!(updatePermission | hasPermission)"\n                    (input)="updateSlug($event.target.value)"\n                />\n            </vdr-form-field>\n            <vdr-form-field\n                [label]="\'catalog.slug\' | translate"\n                for="slug"\n                [errors]="{ pattern: (\'catalog.slug-pattern-error\' | translate) }"\n            >\n                <input\n                    id="slug"\n                    type="text"\n                    formControlName="slug"\n                    [readonly]="!(updatePermission | hasPermission)"\n                    pattern="[a-z0-9_-]+"\n                />\n            </vdr-form-field>\n            <vdr-rich-text-editor\n                formControlName="description"\n                [readonly]="!(updatePermission | hasPermission)"\n                [label]="\'common.description\' | translate"\n            ></vdr-rich-text-editor>\n\n            <section formGroupName="customFields" *ngIf="customFields.length">\n                <label>{{ \'common.custom-fields\' | translate }}</label>\n                <ng-container *ngFor="let customField of customFields">\n                    <vdr-custom-field-control\n                        *ngIf="customFieldIsSet(customField.name)"\n                        entityName="Collection"\n                        [customFieldsFormGroup]="detailForm.get([\'customFields\'])"\n                        [customField]="customField"\n                    ></vdr-custom-field-control>\n                </ng-container>\n            </section>\n        </div>\n        <div class="clr-col-md-auto">\n            <vdr-product-assets\n                [assets]="category.assets"\n                [featuredAsset]="category.featuredAsset"\n                (change)="assetChanges = $event"\n            ></vdr-product-assets>\n        </div>\n    </div>\n    <div class="clr-row" formArrayName="filters">\n        <div class="clr-col">\n            <label>{{ \'catalog.filters\' | translate }}</label>\n            <ng-container *ngFor="let filter of filters; index as i">\n                <vdr-configurable-input\n                    (remove)="removeFilter($event)"\n                    [operation]="filter"\n                    [operationDefinition]="getFilterDefinition(filter)"\n                    [formControlName]="i"\n                    [readonly]="!(updatePermission | hasPermission)"\n                ></vdr-configurable-input>\n            </ng-container>\n\n            <div *vdrIfPermissions="updatePermission">\n                <vdr-dropdown>\n                    <button class="btn btn-outline" vdrDropdownTrigger>\n                        <clr-icon shape="plus"></clr-icon>\n                        {{ \'marketing.add-condition\' | translate }}\n                    </button>\n                    <vdr-dropdown-menu vdrPosition="bottom-left">\n                        <button\n                            *ngFor="let filter of allFilters"\n                            type="button"\n                            vdrDropdownItem\n                            (click)="addFilter(filter)"\n                        >\n                            {{ filter.description }}\n                        </button>\n                    </vdr-dropdown-menu>\n                </vdr-dropdown>\n            </div>\n        </div>\n        <div class="clr-col">\n            <vdr-collection-contents [collectionId]="id" #collectionContents>\n                <ng-template let-count>\n                    <div class="contents-title">\n                        {{ \'catalog.collection-contents\' | translate }} ({{\n                            \'common.results-count\' | translate: { count: count }\n                        }})\n                    </div>\n                </ng-template>\n            </vdr-collection-contents>\n        </div>\n    </div>\n</form>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[".visible-toggle{margin-top:-3px!important}"]}]}],w.ctorParameters=function(){return[{type:n.Router},{type:n.ActivatedRoute},{type:a.ServerConfigService},{type:t.ChangeDetectorRef},{type:a.DataService},{type:i.FormBuilder},{type:a.NotificationService},{type:a.ModalService}]},w.propDecorators={contentsComponent:[{type:t.ViewChild,args:["collectionContents"]}]};var S=function(){function e(e,t,n,a,r){this.dataService=e,this.notificationService=t,this.modalService=n,this.router=a,this.route=r,this.expandAll=!1}return e.prototype.ngOnInit=function(){this.queryResult=this.dataService.collection.getCollections(1e3,0).refetchOnChannelChange(),this.items$=this.queryResult.mapStream((function(e){return e.collections.items})).pipe(o.shareReplay(1)),this.activeCollectionId$=this.route.paramMap.pipe(o.map((function(e){return e.get("contents")})),o.distinctUntilChanged()),this.activeCollectionTitle$=s.combineLatest(this.activeCollectionId$,this.items$).pipe(o.map((function(e){var t=x(e,2),n=t[0],a=t[1];if(n){var r=a.find((function(e){return e.id===n}));return r?r.name:""}return""})))},e.prototype.ngOnDestroy=function(){this.queryResult.completed$.next()},e.prototype.onRearrange=function(e){var t=this;this.dataService.collection.moveCollection([e]).subscribe({next:function(){t.notificationService.success(r.marker("common.notify-saved-changes")),t.refresh()},error:function(e){t.notificationService.error(r.marker("common.notify-save-changes-error"))}})},e.prototype.deleteCollection=function(e){var t=this;this.items$.pipe(o.take(1),o.map((function(t){return-1<t.findIndex((function(t){return t.parent&&t.parent.id===e}))})),o.switchMap((function(e){return t.modalService.dialog({title:r.marker("catalog.confirm-delete-collection"),body:e?r.marker("catalog.confirm-delete-collection-and-children-body"):void 0,buttons:[{type:"secondary",label:r.marker("common.cancel")},{type:"danger",label:r.marker("common.delete"),returnValue:!0}]})})),o.switchMap((function(n){return n?t.dataService.collection.deleteCollection(e):s.EMPTY}))).subscribe((function(){t.notificationService.success(r.marker("common.notify-delete-success"),{entity:"Collection"}),t.refresh()}),(function(e){t.notificationService.error(r.marker("common.notify-delete-error"),{entity:"Collection"})}))},e.prototype.closeContents=function(){var e=Object.assign({},this.route.snapshot.params);delete e.contents,this.router.navigate(["./",e],{relativeTo:this.route,queryParamsHandling:"preserve"})},e.prototype.refresh=function(){this.queryResult.ref.refetch()},e}();S.decorators=[{type:t.Component,args:[{selector:"vdr-collection-list",template:'<vdr-action-bar>\n    <vdr-ab-left>\n        <clr-checkbox-wrapper class="expand-all-toggle ml3">\n            <input type="checkbox" clrCheckbox [(ngModel)]="expandAll" />\n            <label>{{ \'catalog.expand-all-collections\' | translate }}</label>\n        </clr-checkbox-wrapper>\n    </vdr-ab-left>\n    <vdr-ab-right>\n        <vdr-action-bar-items locationId="collection-list"></vdr-action-bar-items>\n        <a class="btn btn-primary" *vdrIfPermissions="[\'CreateCatalog\', \'CreateCollection\']" [routerLink]="[\'./create\']">\n            <clr-icon shape="plus"></clr-icon>\n            {{ \'catalog.create-new-collection\' | translate }}\n        </a>\n    </vdr-ab-right>\n</vdr-action-bar>\n<div class="collection-wrapper">\n    <vdr-collection-tree\n        [collections]="items$ | async"\n        [activeCollectionId]="activeCollectionId$ | async"\n        [expandAll]="expandAll"\n        (rearrange)="onRearrange($event)"\n        (deleteCollection)="deleteCollection($event)"\n    ></vdr-collection-tree>\n\n    <div class="collection-contents" [class.expanded]="activeCollectionId$ | async">\n        <vdr-collection-contents [collectionId]="activeCollectionId$ | async">\n            <ng-template let-count>\n                <div class="collection-title">\n                    {{ activeCollectionTitle$ | async }} ({{\n                        \'common.results-count\' | translate: { count: count }\n                    }})\n                </div>\n                <button type="button" class="close-button" (click)="closeContents()">\n                    <clr-icon shape="close"></clr-icon>\n                </button>\n            </ng-template>\n        </vdr-collection-contents>\n    </div>\n</div>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[":host{height:100%;display:flex;flex-direction:column}.expand-all-toggle{display:block;margin-top:14px}.collection-wrapper{display:flex;height:calc(100% - 50px)}.collection-wrapper vdr-collection-tree{flex:1;height:100%;overflow:auto}.collection-wrapper .collection-contents{height:100%;width:0;opacity:0;visibility:hidden;overflow:auto;transition:width .3s,opacity .2s .3s,visibility 0s .3s}.collection-wrapper .collection-contents.expanded{width:30vw;visibility:visible;opacity:1;padding-left:12px}.collection-wrapper .collection-contents .close-button{margin:0;background:none;border:none;cursor:pointer}.paging-controls{padding-top:6px;border-top:1px solid var(--color-component-border-100);display:flex;justify-content:space-between}"]}]}],S.ctorParameters=function(){return[{type:a.DataService},{type:a.NotificationService},{type:a.ModalService},{type:n.Router},{type:n.ActivatedRoute}]};var V=function(e){function t(t,n,r,o,s,c,l,d){var u=e.call(this,n,t,r,s)||this;return u.changeDetector=o,u.dataService=s,u.formBuilder=c,u.notificationService=l,u.modalService=d,u.updatePermission=[a.Permission.UpdateCatalog,a.Permission.UpdateFacet],u.customFields=u.getCustomFieldConfig("Facet"),u.customValueFields=u.getCustomFieldConfig("FacetValue"),u.detailForm=u.formBuilder.group({facet:u.formBuilder.group({code:["",i.Validators.required],name:"",visible:!0,customFields:u.formBuilder.group(u.customFields.reduce((function(e,t){var n;return Object.assign(Object.assign({},e),((n={})[t.name]="",n))}),{}))}),values:u.formBuilder.array([])}),u}return y(t,e),t.prototype.ngOnInit=function(){this.init()},t.prototype.ngOnDestroy=function(){this.destroy()},t.prototype.updateCode=function(e,t){if(!e){var n=this.detailForm.get(["facet","code"]);n&&n.pristine&&n.setValue(c.normalizeString(t,"-"))}},t.prototype.updateValueCode=function(e,t,n){if(!e){var a=this.detailForm.get(["values",n,"code"]);a&&a.pristine&&a.setValue(c.normalizeString(t,"-"))}},t.prototype.customFieldIsSet=function(e){return!!this.detailForm.get(["facet","customFields",e])},t.prototype.customValueFieldIsSet=function(e,t){return!!this.detailForm.get(["values",e,"customFields",t])},t.prototype.getValuesFormArray=function(){return this.detailForm.get("values")},t.prototype.addFacetValue=function(){var e=this.detailForm.get("values");e&&(e.insert(e.length,this.formBuilder.group({id:"",name:["",i.Validators.required],code:""})),this.values.push({name:"",code:""}))},t.prototype.create=function(){var e=this,t=this.detailForm.get("facet");t&&t.dirty&&s.combineLatest(this.entity$,this.languageCode$).pipe(o.take(1),o.mergeMap((function(n){var a=x(n,2),r=a[0],o=a[1],i=e.getUpdatedFacet(r,t,o);return e.dataService.facet.createFacet(i)})),o.switchMap((function(t){return e.dataService.facet.getAllFacets().single$.pipe(o.mapTo(t))}))).subscribe((function(t){e.notificationService.success(r.marker("common.notify-create-success"),{entity:"Facet"}),e.detailForm.markAsPristine(),e.changeDetector.markForCheck(),e.router.navigate(["../",t.createFacet.id],{relativeTo:e.route})}),(function(t){e.notificationService.error(r.marker("common.notify-create-error"),{entity:"Facet"})}))},t.prototype.save=function(){var e=this;s.combineLatest(this.entity$,this.languageCode$).pipe(o.take(1),o.mergeMap((function(t){var n=x(t,2),a=n[0],r=n[1],i=e.detailForm.get("facet"),c=[];if(i&&i.dirty){var l=e.getUpdatedFacet(a,i,r);l&&c.push(e.dataService.facet.updateFacet(l))}var d=e.detailForm.get("values");if(d&&d.dirty){var u=d.controls.filter((function(e){return!e.value.id})).map((function(e){return{facetId:a.id,code:e.value.code,translations:[{name:e.value.name,languageCode:r}]}}));u.length&&c.push(e.dataService.facet.createFacetValues(u).pipe(o.switchMap((function(){return e.dataService.facet.getFacet(e.id).single$}))));var p=e.getUpdatedFacetValues(a,d,r);p.length&&c.push(e.dataService.facet.updateFacetValues(p))}return s.forkJoin(c)})),o.switchMap((function(){return e.dataService.facet.getAllFacets().single$}))).subscribe((function(){e.detailForm.markAsPristine(),e.changeDetector.markForCheck(),e.notificationService.success(r.marker("common.notify-update-success"),{entity:"Facet"})}),(function(t){e.notificationService.error(r.marker("common.notify-update-error"),{entity:"Facet"})}))},t.prototype.deleteFacetValue=function(e,t){var n=this;if(!e){var i=this.detailForm.get("values");return i&&i.removeAt(t),void this.values.splice(t,1)}this.showModalAndDelete(e).pipe(o.switchMap((function(t){return t.result===a.DeletionResult.DELETED?[!0]:n.showModalAndDelete(e,t.message||"").pipe(o.map((function(e){return e.result===a.DeletionResult.DELETED})))})),o.switchMap((function(e){return e?n.dataService.facet.getFacet(n.id).single$:[]}))).subscribe((function(){n.notificationService.success(r.marker("common.notify-delete-success"),{entity:"FacetValue"})}),(function(e){n.notificationService.error(r.marker("common.notify-delete-error"),{entity:"FacetValue"})}))},t.prototype.showModalAndDelete=function(e,t){var n=this;return this.modalService.dialog({title:r.marker("catalog.confirm-delete-facet-value"),body:t,buttons:[{type:"secondary",label:r.marker("common.cancel")},{type:"danger",label:r.marker("common.delete"),returnValue:!0}]}).pipe(o.switchMap((function(a){return a?n.dataService.facet.deleteFacetValues([e],!!t):s.EMPTY})),o.map((function(e){return e.deleteFacetValues[0]})))},t.prototype.setFormValues=function(e,t){var n,r,o,s=this,c=a.findTranslation(e,t);if(this.detailForm.patchValue({facet:{code:e.code,visible:!e.isPrivate,name:null!==(o=null==c?void 0:c.name)&&void 0!==o?o:""}}),this.customFields.length){var l=this.detailForm.get(["facet","customFields"]);try{for(var d=F(this.customFields),u=d.next();!u.done;u=d.next()){var p=u.value,m=p.name,g="localeString"===p.type?c.customFields[m]:e.customFields[m],v=l.get(m);v&&v.patchValue(g)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=d.return)&&r.call(d)}finally{if(n)throw n.error}}}var f=this.detailForm.get("values");this.values=I(e.values),e.values.forEach((function(e,n){var r,o,c=a.findTranslation(e,t),l={id:e.id,code:e.code,name:c?c.name:""},d=f.at(n);if(d?d.setValue(l):f.insert(n,s.formBuilder.group(l)),s.customValueFields.length){var u=s.detailForm.get(["values",n,"customFields"]);if(u||(u=new i.FormGroup({}),s.detailForm.get(["values",n]).addControl("customFields",u)),u)try{for(var p=F(s.customValueFields),m=p.next();!m.done;m=p.next()){var g=m.value,v=g.name,h="localeString"===g.type?c.customFields[v]:e.customFields[v],y=u.get(v);y?y.setValue(h):u.addControl(v,new i.FormControl(h))}}catch(e){r={error:e}}finally{try{m&&!m.done&&(o=p.return)&&o.call(p)}finally{if(r)throw r.error}}}}))},t.prototype.getUpdatedFacet=function(e,t,n){var r=a.createUpdatedTranslatable({translatable:e,updatedFields:t.value,customFieldConfig:this.customFields,languageCode:n,defaultTranslation:{languageCode:n,name:e.name||""}});return r.isPrivate=!t.value.visible,r},t.prototype.getUpdatedFacetValues=function(e,t,n){var o=this,i=e.values.filter((function(e,n){var a=t.get(n.toString());return a&&a.dirty&&a.value.id})),s=t.controls.filter((function(e){return e.dirty&&e.value.id})).map((function(e){return e.value}));if(i.length!==s.length)throw new Error(r.marker("error.facet-value-form-values-do-not-match"));return i.map((function(e,t){return a.createUpdatedTranslatable({translatable:e,updatedFields:s[t],customFieldConfig:o.customValueFields,languageCode:n,defaultTranslation:{languageCode:n,name:""}})})).filter(l.notNullOrUndefined)},t}(a.BaseDetailComponent);V.decorators=[{type:t.Component,args:[{selector:"vdr-facet-detail",template:'<vdr-action-bar>\n    <vdr-ab-left>\n        <vdr-entity-info [entity]="entity$ | async"></vdr-entity-info>\n        <vdr-language-selector\n            [disabled]="isNew$ | async"\n            [availableLanguageCodes]="availableLanguages$ | async"\n            [currentLanguageCode]="languageCode$ | async"\n            (languageCodeChange)="setLanguage($event)"\n        ></vdr-language-selector>\n    </vdr-ab-left>\n\n    <vdr-ab-right>\n        <vdr-action-bar-items locationId="facet-detail"></vdr-action-bar-items>\n        <button\n            class="btn btn-primary"\n            *ngIf="isNew$ | async; else updateButton"\n            (click)="create()"\n            [disabled]="detailForm.invalid || detailForm.pristine"\n        >\n            {{ \'common.create\' | translate }}\n        </button>\n        <ng-template #updateButton>\n            <button\n                *vdrIfPermissions="updatePermission"\n                class="btn btn-primary"\n                (click)="save()"\n                [disabled]="detailForm.invalid || detailForm.pristine"\n            >\n                {{ \'common.update\' | translate }}\n            </button>\n        </ng-template>\n    </vdr-ab-right>\n</vdr-action-bar>\n\n<form class="form" [formGroup]="detailForm" *ngIf="entity$ | async as facet">\n    <section class="form-block" formGroupName="facet">\n        <vdr-form-field [label]="\'catalog.visibility\' | translate" for="visibility">\n            <clr-toggle-wrapper>\n                <input\n                    type="checkbox"\n                    clrToggle\n                    [vdrDisabled]="!(updatePermission | hasPermission)"\n                    formControlName="visible"\n                    id="visibility"\n                />\n                <label class="visible-toggle">\n                    <ng-container *ngIf="detailForm.value.facet.visible; else private">{{ \'catalog.public\' | translate }}</ng-container>\n                    <ng-template #private>{{ \'catalog.private\' | translate }}</ng-template>\n                </label>\n            </clr-toggle-wrapper>\n        </vdr-form-field>\n        <vdr-form-field [label]="\'common.name\' | translate" for="name">\n            <input\n                id="name"\n                type="text"\n                formControlName="name"\n                [readonly]="!(updatePermission | hasPermission)"\n                (input)="updateCode(facet.code, $event.target.value)"\n            />\n        </vdr-form-field>\n        <vdr-form-field\n            [label]="\'common.code\' | translate"\n            for="code"\n            [readOnlyToggle]="updatePermission | hasPermission"\n        >\n            <input\n                id="code"\n                type="text"\n                [readonly]="!(updatePermission | hasPermission)"\n                formControlName="code"\n            />\n        </vdr-form-field>\n\n        <section formGroupName="customFields" *ngIf="customFields.length">\n            <label>{{ \'common.custom-fields\' | translate }}</label>\n            <ng-container *ngFor="let customField of customFields">\n                <vdr-custom-field-control\n                    *ngIf="customFieldIsSet(customField.name)"\n                    entityName="Facet"\n                    [customFieldsFormGroup]="detailForm.get([\'facet\', \'customFields\'])"\n                    [customField]="customField"\n                ></vdr-custom-field-control>\n            </ng-container>\n        </section>\n    </section>\n\n    <section class="form-block" *ngIf="!(isNew$ | async)">\n        <label>{{ \'catalog.facet-values\' | translate }}</label>\n\n        <table class="facet-values-list table" formArrayName="values" *ngIf="0 < getValuesFormArray().length">\n            <thead>\n                <tr>\n                    <th></th>\n                    <th>{{ \'common.name\' | translate }}</th>\n                    <th>{{ \'common.code\' | translate }}</th>\n                    <ng-container *ngFor="let customField of customValueFields">\n                        <th>{{ customField.name }}</th>\n                    </ng-container>\n                    <th></th>\n                </tr>\n            </thead>\n            <tbody>\n                <tr\n                    class="facet-value"\n                    *ngFor="let value of values; let i = index"\n                    [formGroupName]="i"\n                >\n                    <td class="align-middle">\n                        <vdr-entity-info [entity]="value"></vdr-entity-info>\n                    </td>\n                    <td class="align-middle">\n                        <input\n                            type="text"\n                            formControlName="name"\n                            [readonly]="!(updatePermission | hasPermission)"\n                            (input)="updateValueCode(facet.values[i]?.code, $event.target.value, i)"\n                        />\n                    </td>\n                    <td class="align-middle"><input type="text" formControlName="code" readonly /></td>\n                    <ng-container *ngFor="let customField of customValueFields">\n                        <td class="align-middle">\n                            <vdr-custom-field-control\n                                *ngIf="customValueFieldIsSet(i, customField.name)"\n                                entityName="FacetValue"\n                                [showLabel]="false"\n                                [customFieldsFormGroup]="detailForm.get([\'values\', i, \'customFields\'])"\n                                [customField]="customField"\n                            ></vdr-custom-field-control>\n                        </td>\n                    </ng-container>\n                    <td class="align-middle">\n                        <vdr-dropdown>\n                            <button type="button" class="btn btn-link btn-sm" vdrDropdownTrigger>\n                                {{ \'common.actions\' | translate }}\n                                <clr-icon shape="caret down"></clr-icon>\n                            </button>\n                            <vdr-dropdown-menu vdrPosition="bottom-right">\n                                <button\n                                    type="button"\n                                    class="delete-button"\n                                    (click)="deleteFacetValue(facet.values[i]?.id, i)"\n                                    [disabled]="!(updatePermission | hasPermission)"\n                                    vdrDropdownItem\n                                >\n                                    <clr-icon shape="trash" class="is-danger"></clr-icon>\n                                    {{ \'common.delete\' | translate }}\n                                </button>\n                            </vdr-dropdown-menu>\n                        </vdr-dropdown>\n                    </td>\n                </tr>\n            </tbody>\n        </table>\n\n        <div>\n            <button\n                type="button"\n                class="btn btn-secondary"\n                *vdrIfPermissions="[\'CreateCatalog\', \'CreateFacet\']"\n                (click)="addFacetValue()"\n            >\n                <clr-icon shape="add"></clr-icon>\n                {{ \'catalog.add-facet-value\' | translate }}\n            </button>\n        </div>\n    </section>\n</form>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[".visible-toggle{margin-top:-3px!important}"]}]}],V.ctorParameters=function(){return[{type:n.Router},{type:n.ActivatedRoute},{type:a.ServerConfigService},{type:t.ChangeDetectorRef},{type:a.DataService},{type:i.FormBuilder},{type:a.NotificationService},{type:a.ModalService}]};var D=function(e){function t(t,n,a,r,o){var i=e.call(this,r,o)||this;return i.dataService=t,i.modalService=n,i.notificationService=a,i.initialLimit=3,i.displayLimit={},e.prototype.setQueryFn.call(i,(function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=i.dataService.facet).getFacets.apply(e,I(t)).refetchOnChannelChange()}),(function(e){return e.facets})),i}return y(t,e),t.prototype.toggleDisplayLimit=function(e){this.displayLimit[e.id]===e.values.length?this.displayLimit[e.id]=this.initialLimit:this.displayLimit[e.id]=e.values.length},t.prototype.deleteFacet=function(e){var t=this;this.showModalAndDelete(e).pipe(o.switchMap((function(n){return n.result===a.DeletionResult.DELETED?[!0]:t.showModalAndDelete(e,n.message||"").pipe(o.map((function(e){return e.result===a.DeletionResult.DELETED})))})),o.switchMap((function(){return t.dataService.facet.getAllFacets().single$}))).subscribe((function(){t.notificationService.success(r.marker("common.notify-delete-success"),{entity:"FacetValue"}),t.refresh()}),(function(e){t.notificationService.error(r.marker("common.notify-delete-error"),{entity:"FacetValue"})}))},t.prototype.showModalAndDelete=function(e,t){var n=this;return this.modalService.dialog({title:r.marker("catalog.confirm-delete-facet"),body:t,buttons:[{type:"secondary",label:r.marker("common.cancel")},{type:"danger",label:r.marker("common.delete"),returnValue:!0}]}).pipe(o.switchMap((function(a){return a?n.dataService.facet.deleteFacet(e,!!t):s.EMPTY})),o.map((function(e){return e.deleteFacet})))},t}(a.BaseListComponent);function T(e,t,n){if(!e)return"";var a=e.lastIndexOf(t);return-1===a?e:e.substr(0,a)+e.substr(a).replace(t,n)}D.decorators=[{type:t.Component,args:[{selector:"vdr-facet-list",template:'<vdr-action-bar>\n    <vdr-ab-right>\n        <vdr-action-bar-items locationId="facet-list"></vdr-action-bar-items>\n        <a class="btn btn-primary"\n           *vdrIfPermissions="[\'CreateCatalog\', \'CreateFacet\']"\n           [routerLink]="[\'./create\']">\n            <clr-icon shape="plus"></clr-icon>\n            {{ \'catalog.create-new-facet\' | translate }}\n        </a>\n    </vdr-ab-right>\n</vdr-action-bar>\n\n<vdr-data-table\n    [items]="items$ | async"\n    [itemsPerPage]="itemsPerPage$ | async"\n    [totalItems]="totalItems$ | async"\n    [currentPage]="currentPage$ | async"\n    (pageChange)="setPageNumber($event)"\n    (itemsPerPageChange)="setItemsPerPage($event)"\n>\n    <vdr-dt-column>{{ \'common.code\' | translate }}</vdr-dt-column>\n    <vdr-dt-column>{{ \'common.name\' | translate }}</vdr-dt-column>\n    <vdr-dt-column [expand]="true">{{ \'catalog.values\' | translate }}</vdr-dt-column>\n    <vdr-dt-column>{{ \'catalog.visibility\' | translate }}</vdr-dt-column>\n    <vdr-dt-column></vdr-dt-column>\n    <vdr-dt-column></vdr-dt-column>\n    <ng-template let-facet="item">\n        <td class="left align-middle" [class.private]="facet.isPrivate">{{ facet.code }}</td>\n        <td class="left align-middle" [class.private]="facet.isPrivate">{{ facet.name }}</td>\n        <td class="left align-middle" [class.private]="facet.isPrivate">\n            <vdr-facet-value-chip\n                *ngFor="let value of facet.values | slice: 0:displayLimit[facet.id] || 3"\n                [facetValue]="value"\n                [removable]="false"\n                [displayFacetName]="false"\n            ></vdr-facet-value-chip>\n            <button\n                class="btn btn-sm btn-secondary btn-icon"\n                *ngIf="facet.values.length > initialLimit"\n                (click)="toggleDisplayLimit(facet)"\n            >\n                <ng-container *ngIf="(displayLimit[facet.id] || 0) < facet.values.length; else collapse">\n                    <clr-icon shape="plus"></clr-icon>\n                    {{ facet.values.length - initialLimit }}\n                </ng-container>\n                <ng-template #collapse>\n                    <clr-icon shape="minus"></clr-icon>\n                </ng-template>\n            </button>\n        </td>\n        <td class="left align-middle" [class.private]="facet.isPrivate">\n            <vdr-chip>\n                <ng-container *ngIf="!facet.isPrivate; else private">{{ \'catalog.public\' | translate }}</ng-container>\n                <ng-template #private>{{ \'catalog.private\' | translate }}</ng-template>\n            </vdr-chip>\n        </td>\n        <td class="right align-middle" [class.private]="facet.isPrivate">\n            <vdr-table-row-action\n                iconShape="edit"\n                [label]="\'common.edit\' | translate"\n                [linkTo]="[\'./\', facet.id]"\n            ></vdr-table-row-action>\n        </td>\n        <td class="right align-middle" [class.private]="facet.isPrivate">\n            <vdr-dropdown>\n                <button type="button" class="btn btn-link btn-sm" vdrDropdownTrigger>\n                    {{ \'common.actions\' | translate }}\n                    <clr-icon shape="caret down"></clr-icon>\n                </button>\n                <vdr-dropdown-menu vdrPosition="bottom-right">\n                    <button\n                        type="button"\n                        class="delete-button"\n                        (click)="deleteFacet(facet.id)"\n                        [disabled]="!([\'DeleteCatalog\', \'DeleteFacet\'] | hasPermission)"\n                        vdrDropdownItem\n                    >\n                        <clr-icon shape="trash" class="is-danger"></clr-icon>\n                        {{ \'common.delete\' | translate }}\n                    </button>\n                </vdr-dropdown-menu>\n            </vdr-dropdown>\n        </td>\n    </ng-template>\n</vdr-data-table>\n',styles:["td.private{background-color:var(--color-component-bg-200)}"]}]}],D.ctorParameters=function(){return[{type:a.DataService},{type:a.ModalService},{type:a.NotificationService},{type:n.Router},{type:n.ActivatedRoute}]};var O=function(){function e(e){this.dataService=e}return e.prototype.getFacets=function(){return this.dataService.facet.getAllFacets().mapSingle((function(e){return e.facets.items}))},e.prototype.getTaxCategories=function(){return this.dataService.settings.getTaxCategories().mapSingle((function(e){return e.taxCategories})).pipe(o.shareReplay(1))},e.prototype.createProductWithVariants=function(e,t,n){var a=this,r=this.dataService.product.createProduct(e),i=t.groups.filter((function(e){return 0<e.values.length})),c=this.createProductOptionGroups(i,n);return s.forkJoin(r,c).pipe(o.mergeMap((function(e){var t=x(e,2),n=t[0].createProduct,r=t[1];return(r.length?s.forkJoin(r.map((function(e){return a.dataService.product.addOptionGroupToProduct({productId:n.id,optionGroupId:e.id})}))):s.of([])).pipe(o.map((function(){return{createProduct:n,optionGroups:r}})))})),o.mergeMap((function(e){var r=e.createProduct,o=e.optionGroups,i=t.variants.map((function(e){var t=o.length?e.optionValues.map((function(e,t){var n=o[t].options.find((function(t){return t.name===e}));if(!n)throw new Error('Could not find a matching ProductOption "'+e+'" when creating variant');return n.id})):[];return Object.assign(Object.assign({},e),{optionIds:t})})),s=o.map((function(e){return e.options})).reduce((function(e,t){return I(e,t)}),[]);return a.createProductVariants(r,i,s,n)})))},e.prototype.createProductOptionGroups=function(e,t){var n=this;return e.length?s.forkJoin(e.map((function(e){return n.dataService.product.createProductOptionGroups({code:c.normalizeString(e.name,"-"),translations:[{languageCode:t,name:e.name}],options:e.values.map((function(e){return{code:c.normalizeString(e,"-"),translations:[{languageCode:t,name:e}]}}))}).pipe(o.map((function(e){return e.createProductOptionGroup})))}))):s.of([])},e.prototype.createProductVariants=function(e,t,n,a){var r=t.map((function(t){var r=n.length?e.name+" "+t.optionIds.map((function(e){return n.find((function(t){return t.id===e}))})).filter(l.notNullOrUndefined).map((function(e){return e.name})).join(" "):e.name;return{productId:e.id,price:t.price,sku:t.sku,stockOnHand:t.stock,translations:[{languageCode:a,name:r}],optionIds:t.optionIds}}));return this.dataService.product.createProductVariants(r).pipe(o.map((function(t){return{createProductVariants:t.createProductVariants,productId:e.id}})))},e.prototype.updateProduct=function(e){var t,n,r,o,i,c=e.product,l=e.languageCode,d=e.autoUpdate,u=e.productInput,p=[],m=e.variantsInput||[];if(u){p.push(this.dataService.product.updateProduct(u));var g=null===(r=a.findTranslation(c,l))||void 0===r?void 0:r.name,v=null===(o=a.findTranslation(u,l))||void 0===o?void 0:o.name;if(g&&v&&d){var f=function(e){var t=(null===(i=a.findTranslation(e,l))||void 0===i?void 0:i.name)||"",n=void 0,r=m.find((function(t){return t.id===e.id}));r?n=r:(n={id:e.id,translations:[{languageCode:l,name:t}]},m.push(n));var o=a.findTranslation(n,l);o&&(o.name=T(o.name,g,v))};try{for(var h=F(c.variants),y=h.next();!y.done;y=h.next()){f(y.value)}}catch(e){t={error:e}}finally{try{y&&!y.done&&(n=h.return)&&n.call(h)}finally{if(t)throw t.error}}}}return m.length&&p.push(this.dataService.product.updateProductVariants(m)),s.forkJoin(p)},e.prototype.updateProductOption=function(e,t,n){var r,i,c,l,d,u=s.of([]);if(e.autoUpdate){var p=void 0,m=null===(c=a.findTranslation(e,n))||void 0===c?void 0:c.name;m||(u=s.of([]));var g=[];try{for(var v=F(t.variants),f=v.next();!f.done;f=v.next()){var h=f.value;if(h.options.map((function(e){return e.id})).includes(e.id)){p||(p=null===(l=a.findTranslation(h.options.find((function(t){return t.id===e.id})),n))||void 0===l?void 0:l.name);var y=(null===(d=a.findTranslation(h,n))||void 0===d?void 0:d.name)||"";p&&m&&y.includes(p)&&g.push({id:h.id,translations:[{languageCode:n,name:T(y,p,m)}]})}}}catch(e){r={error:e}}finally{try{f&&!f.done&&(i=v.return)&&i.call(v)}finally{if(r)throw r.error}}g.length&&(u=this.dataService.product.updateProductVariants(g))}return this.dataService.product.updateProductOption(e).pipe(o.mergeMap((function(){return u})))},e.prototype.deleteProductVariant=function(e,t){var n=this;return this.dataService.product.deleteProductVariant(e).pipe(o.switchMap((function(e){return e.deleteProductVariant.result===a.DeletionResult.DELETED?n.dataService.product.getProduct(t).single$:s.throwError(e.deleteProductVariant.message)})))},e}();O.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new O(t.ɵɵinject(a.DataService))},token:O,providedIn:"root"}),O.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],O.ctorParameters=function(){return[{type:a.DataService}]};var A=function(){function e(e){this.changeDetector=e,this.selectedValues=[]}return e.prototype.ngAfterViewInit=function(){var e=this;setTimeout((function(){return e.selector.focus()}),0)},e.prototype.selectValues=function(){this.resolveWith(this.selectedValues)},e.prototype.cancel=function(){this.resolveWith()},e}();A.decorators=[{type:t.Component,args:[{selector:"vdr-apply-facet-dialog",template:'<ng-template vdrDialogTitle>{{ \'catalog.add-facets\' | translate }}</ng-template>\n\n<vdr-facet-value-selector\n    [facets]="facets"\n    (selectedValuesChange)="selectedValues = $event"\n></vdr-facet-value-selector>\n\n<ng-template vdrDialogButtons>\n    <button type="button" class="btn" (click)="cancel()">{{ \'common.cancel\' | translate }}</button>\n    <button\n        type="submit"\n        (click)="selectValues()"\n        [disabled]="selectedValues.length === 0"\n        class="btn btn-primary"\n    >\n        {{ \'catalog.add-facets\' | translate }}\n    </button>\n</ng-template>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[""]}]}],A.ctorParameters=function(){return[{type:t.ChangeDetectorRef}]},A.propDecorators={selector:[{type:t.ViewChild,args:[a.FacetValueSelectorComponent]}]};var $=function(){function e(e,t){this.dataService=e,this.notificationService=t,this.priceFactorControl=new i.FormControl(1),this.selectedChannelIdControl=new i.FormControl}return Object.defineProperty(e.prototype,"isProductVariantMode",{get:function(){return null!=this.productVariantIds},enumerable:!1,configurable:!0}),e.prototype.ngOnInit=function(){var e=this,t=this.dataService.client.userStatus().mapSingle((function(e){return e.userStatus.activeChannelId})),n=this.dataService.settings.getChannels().mapSingle((function(e){return e.channels}));s.combineLatest(t,n).subscribe((function(t){var n=x(t,2),a=n[0],r=n[1];e.currentChannel=r.find((function(e){return e.id===a})),e.availableChannels=r})),this.selectedChannelIdControl.valueChanges.subscribe((function(t){e.selectChannel(t)})),this.variantsPreview$=s.combineLatest(s.from(this.getTopVariants(10)),this.priceFactorControl.valueChanges.pipe(o.startWith(1))).pipe(o.map((function(e){var t=x(e,2),n=t[0],a=t[1];return n.map((function(e){return{id:e.id,name:e.name,price:e.price,pricePreview:e.price*+a}}))})))},e.prototype.selectChannel=function(e){this.selectedChannel=this.availableChannels.find((function(t){return t.id===e[0]}))},e.prototype.assign=function(){var e=this,t=this.selectedChannel;t&&(this.isProductVariantMode?this.productVariantIds&&this.dataService.product.assignVariantsToChannel({channelId:t.id,productVariantIds:this.productVariantIds,priceFactor:+this.priceFactorControl.value}).subscribe((function(){e.notificationService.success(r.marker("catalog.assign-variant-to-channel-success"),{channel:t.code}),e.resolveWith(!0)})):this.dataService.product.assignProductsToChannel({channelId:t.id,productIds:this.productIds,priceFactor:+this.priceFactorControl.value}).subscribe((function(){e.notificationService.success(r.marker("catalog.assign-product-to-channel-success"),{channel:t.code}),e.resolveWith(!0)})))},e.prototype.cancel=function(){this.resolveWith()},e.prototype.getTopVariants=function(e){return b(this,void 0,void 0,(function(){var t,n,a,r=this;return C(this,(function(o){switch(o.label){case 0:t=[],n=0,o.label=1;case 1:return n<this.productIds.length&&t.length<e?[4,this.dataService.product.getProduct(this.productIds[n]).mapSingle((function(e){var t=e.product;return(t?t.variants:[]).filter((function(e){var t;return!r.isProductVariantMode||(null===(t=r.productVariantIds)||void 0===t?void 0:t.includes(e.id))}))})).toPromise()]:[3,4];case 2:a=o.sent(),t.push.apply(t,I(a||[])),o.label=3;case 3:return n++,[3,1];case 4:return[2,t.slice(0,e)]}}))}))},e}();$.decorators=[{type:t.Component,args:[{selector:"vdr-assign-products-to-channel-dialog",template:'<ng-template vdrDialogTitle>\n    <ng-container *ngIf="isProductVariantMode; else productModeTitle">{{\n        \'catalog.assign-variants-to-channel\' | translate\n    }}</ng-container>\n    <ng-template #productModeTitle>{{ \'catalog.assign-products-to-channel\' | translate }}</ng-template>\n</ng-template>\n\n<div class="flex">\n    <clr-input-container>\n        <label>{{ \'common.channel\' | translate }}</label>\n        <vdr-channel-assignment-control\n            clrInput\n            [multiple]="false"\n            [includeDefaultChannel]="false"\n            [disableChannelIds]="currentChannelIds"\n            [formControl]="selectedChannelIdControl"\n        ></vdr-channel-assignment-control>\n    </clr-input-container>\n    <div class="flex-spacer"></div>\n    <clr-input-container>\n        <label>{{ \'catalog.price-conversion-factor\' | translate }}</label>\n        <input clrInput type="number" min="0" max="99999" [formControl]="priceFactorControl" />\n    </clr-input-container>\n</div>\n\n<div class="channel-price-preview">\n    <label class="clr-control-label">{{ \'catalog.channel-price-preview\' | translate }}</label>\n    <table class="table">\n        <thead>\n            <tr>\n                <th>{{ \'common.name\' | translate }}</th>\n                <th>\n                    {{\n                        \'catalog.price-in-channel\'\n                            | translate: { channel: currentChannel?.code | channelCodeToLabel | translate }\n                    }}\n                </th>\n                <th>\n                    <ng-template [ngIf]="selectedChannel" [ngIfElse]="noSelection">\n                        {{ \'catalog.price-in-channel\' | translate: { channel: selectedChannel?.code } }}\n                    </ng-template>\n                    <ng-template #noSelection>\n                        {{ \'catalog.no-channel-selected\' | translate }}\n                    </ng-template>\n                </th>\n            </tr>\n        </thead>\n        <tbody>\n            <tr *ngFor="let row of variantsPreview$ | async">\n                <td>{{ row.name }}</td>\n                <td>{{ row.price | localeCurrency: currentChannel?.currencyCode }}</td>\n                <td>\n                    <ng-template [ngIf]="selectedChannel" [ngIfElse]="noChannelSelected">\n                        {{ row.pricePreview | localeCurrency: selectedChannel?.currencyCode }}\n                    </ng-template>\n                    <ng-template #noChannelSelected> - </ng-template>\n                </td>\n            </tr>\n        </tbody>\n    </table>\n</div>\n\n<ng-template vdrDialogButtons>\n    <button type="button" class="btn" (click)="cancel()">{{ \'common.cancel\' | translate }}</button>\n    <button type="submit" (click)="assign()" [disabled]="!selectedChannel" class="btn btn-primary">\n        <ng-template [ngIf]="selectedChannel" [ngIfElse]="noSelection">\n            {{ \'catalog.assign-to-named-channel\' | translate: { channelCode: selectedChannel?.code } }}\n        </ng-template>\n        <ng-template #noSelection>\n            {{ \'catalog.no-channel-selected\' | translate }}\n        </ng-template>\n    </button>\n</ng-template>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:["vdr-channel-assignment-control{min-width:200px}.channel-price-preview{margin-top:24px}.channel-price-preview table.table{margin-top:6px}"]}]}],$.ctorParameters=function(){return[{type:a.DataService},{type:a.NotificationService}]};var M=function(e){function t(t,n,a,r,o,s,c,l,d,u){var p=e.call(this,t,n,a,l)||this;return p.productDetailService=r,p.formBuilder=o,p.modalService=s,p.notificationService=c,p.dataService=l,p.location=d,p.changeDetector=u,p.filterInput=new i.FormControl(""),p.assetChanges={},p.variantAssetChanges={},p.selectedVariantIds=[],p.variantDisplayMode="card",p.createVariantsConfig={groups:[],variants:[]},p.customFields=p.getCustomFieldConfig("Product"),p.customVariantFields=p.getCustomFieldConfig("ProductVariant"),p.customOptionGroupFields=p.getCustomFieldConfig("ProductOptionGroup"),p.customOptionFields=p.getCustomFieldConfig("ProductOption"),p.detailForm=p.formBuilder.group({product:p.formBuilder.group({enabled:!0,name:["",i.Validators.required],autoUpdateVariantNames:!0,slug:"",description:"",facetValueIds:[[]],customFields:p.formBuilder.group(p.customFields.reduce((function(e,t){var n;return Object.assign(Object.assign({},e),((n={})[t.name]="",n))}),{}))}),variants:p.formBuilder.array([])}),p}return y(t,e),t.prototype.ngOnInit=function(){this.init(),this.product$=this.entity$;var e=this.product$.pipe(o.map((function(e){return e.variants}))),t=this.filterInput.valueChanges.pipe(o.startWith(""),o.debounceTime(50),o.shareReplay());this.variants$=s.combineLatest(e,t).pipe(o.map((function(e){var t=x(e,2),n=t[0],a=t[1];return a?n.filter((function(e){a.toLocaleLowerCase();return e.name.toLocaleLowerCase().includes(a)||e.sku.toLocaleLowerCase().includes(a)})):n}))),this.taxCategories$=this.productDetailService.getTaxCategories().pipe(o.takeUntil(this.destroy$)),this.activeTab$=this.route.paramMap.pipe(o.map((function(e){return e.get("tab")}))),this.facets$=this.productDetailService.getFacets();var n=this.product$.pipe(o.map((function(e){return e.facetValues}))),r=this.facets$.pipe(o.map(a.flattenFacetValues)),i=this.getProductFormGroup().valueChanges.pipe(o.map((function(e){return e.facetValueIds})),o.distinctUntilChanged()),c=s.combineLatest(i,n,r).pipe(o.map((function(e){var t=x(e,3),n=t[0],a=I(t[1],t[2]);return n.map((function(e){return a.find((function(t){return t.id===e}))})).filter(l.notNullOrUndefined)})));this.facetValues$=s.merge(n,c),this.productChannels$=this.product$.pipe(o.map((function(e){return e.channels}))),this.channelPriceIncludesTax$=this.dataService.settings.getActiveChannel("cache-first").refetchOnChannelChange().mapStream((function(e){return e.activeChannel.pricesIncludeTax})).pipe(o.shareReplay(1))},t.prototype.ngOnDestroy=function(){this.destroy()},t.prototype.navigateToTab=function(e){this.location.replaceState(this.router.createUrlTree(["./",Object.assign(Object.assign({},this.route.snapshot.params),{tab:e})],{queryParamsHandling:"merge",relativeTo:this.route}).toString())},t.prototype.isDefaultChannel=function(e){return e===u.DEFAULT_CHANNEL_CODE},t.prototype.assignToChannel=function(){var e=this;this.productChannels$.pipe(o.take(1),o.switchMap((function(t){return e.modalService.fromComponent($,{size:"lg",locals:{productIds:[e.id],currentChannelIds:t.map((function(e){return e.id}))}})}))).subscribe()},t.prototype.removeFromChannel=function(e){var t=this;this.modalService.dialog({title:r.marker("catalog.remove-product-from-channel"),buttons:[{type:"secondary",label:r.marker("common.cancel")},{type:"danger",label:r.marker("catalog.remove-from-channel"),returnValue:!0}]}).pipe(o.switchMap((function(n){return n?t.dataService.product.removeProductsFromChannel({channelId:e,productIds:[t.id]}):s.EMPTY}))).subscribe((function(){t.notificationService.success(r.marker("catalog.notify-remove-product-from-channel-success"))}),(function(e){t.notificationService.error(r.marker("catalog.notify-remove-product-from-channel-error"))}))},t.prototype.assignVariantToChannel=function(e){return this.modalService.fromComponent($,{size:"lg",locals:{productIds:[this.id],productVariantIds:[e.id],currentChannelIds:e.channels.map((function(e){return e.id}))}}).subscribe()},t.prototype.removeVariantFromChannel=function(e){var t=this,n=e.channelId,a=e.variant;this.modalService.dialog({title:r.marker("catalog.remove-product-variant-from-channel"),buttons:[{type:"secondary",label:r.marker("common.cancel")},{type:"danger",label:r.marker("catalog.remove-from-channel"),returnValue:!0}]}).pipe(o.switchMap((function(e){return e?t.dataService.product.removeVariantsFromChannel({channelId:n,productVariantIds:[a.id]}):s.EMPTY}))).subscribe((function(){t.notificationService.success(r.marker("catalog.notify-remove-variant-from-channel-success"))}),(function(e){t.notificationService.error(r.marker("catalog.notify-remove-variant-from-channel-error"))}))},t.prototype.customFieldIsSet=function(e){return!!this.detailForm.get(["product","customFields",e])},t.prototype.assetsChanged=function(){return!!Object.values(this.assetChanges).length},t.prototype.variantAssetsChanged=function(){return!!Object.keys(this.variantAssetChanges).length},t.prototype.variantAssetChange=function(e){this.variantAssetChanges[e.variantId]=e},t.prototype.updateSlug=function(e){var t=this;s.combineLatest(this.entity$,this.languageCode$).pipe(o.take(1)).subscribe((function(n){var r=x(n,2),o=r[0],i=r[1],s=t.detailForm.get(["product","slug"]),l=a.findTranslation(o,i),d=!l||!l.slug;s&&s.pristine&&d&&s.setValue(c.normalizeString(""+e,"-"))}))},t.prototype.selectProductFacetValue=function(){var e=this;this.displayFacetValueModal().subscribe((function(t){if(t){var n=e.getProductFormGroup(),a=n.value.facetValueIds;n.patchValue({facetValueIds:p.unique(I(a,t))}),n.markAsDirty()}}))},t.prototype.updateProductOption=function(e){var t=this;s.combineLatest(this.product$,this.languageCode$).pipe(o.take(1),o.mergeMap((function(n){var a=x(n,2),r=a[0],o=a[1];return t.productDetailService.updateProductOption(e,r,o)}))).subscribe((function(){t.notificationService.success(r.marker("common.notify-update-success"),{entity:"ProductOption"})}),(function(e){t.notificationService.error(r.marker("common.notify-update-error"),{entity:"ProductOption"})}))},t.prototype.removeProductFacetValue=function(e){var t=this.getProductFormGroup(),n=t.value.facetValueIds;t.patchValue({facetValueIds:n.filter((function(t){return t!==e}))}),t.markAsDirty()},t.prototype.selectVariantFacetValue=function(e){var t=this;this.displayFacetValueModal().pipe(o.withLatestFrom(this.variants$)).subscribe((function(n){var a,r,o=x(n,2),i=o[0],s=o[1];if(i){var c=function(e){var n=s.findIndex((function(t){return t.id===e})),a=s[n],r=a?a.facetValues.map((function(e){return e.id})):[],o=t.detailForm.get(["variants",n]);o&&(o.patchValue({facetValueIds:p.unique(I(r,i))}),o.markAsDirty())};try{for(var l=F(e),d=l.next();!d.done;d=l.next()){c(d.value)}}catch(e){a={error:e}}finally{try{d&&!d.done&&(r=l.return)&&r.call(l)}finally{if(a)throw a.error}}t.changeDetector.markForCheck()}}))},t.prototype.variantsToCreateAreValid=function(){return 0<this.createVariantsConfig.variants.length&&this.createVariantsConfig.variants.every((function(e){return""!==e.sku}))},t.prototype.displayFacetValueModal=function(){var e=this;return this.productDetailService.getFacets().pipe(o.mergeMap((function(t){return e.modalService.fromComponent(A,{size:"md",closable:!0,locals:{facets:t}})})),o.map((function(e){return e&&e.map((function(e){return e.id}))})))},t.prototype.create=function(){var e=this,t=this.getProductFormGroup();t.dirty&&s.combineLatest(this.product$,this.languageCode$).pipe(o.take(1),o.mergeMap((function(n){var a=x(n,2),r=a[0],o=a[1],i=e.getUpdatedProduct(r,t,o);return e.productDetailService.createProductWithVariants(i,e.createVariantsConfig,o)}))).subscribe((function(t){t.createProductVariants;var n=t.productId;e.notificationService.success(r.marker("common.notify-create-success"),{entity:"Product"}),e.assetChanges={},e.variantAssetChanges={},e.detailForm.markAsPristine(),e.router.navigate(["../",n],{relativeTo:e.route})}),(function(t){console.error(t),e.notificationService.error(r.marker("common.notify-create-error"),{entity:"Product"})}))},t.prototype.save=function(){var e=this;s.combineLatest(this.product$,this.languageCode$,this.channelPriceIncludesTax$).pipe(o.take(1),o.mergeMap((function(t){var n,a,r,o,i=x(t,3),s=i[0],c=i[1],l=i[2],d=e.getProductFormGroup();(d.dirty||e.assetsChanged())&&(r=e.getUpdatedProduct(s,d,c));var u=e.detailForm.get("variants");return(u&&u.dirty||e.variantAssetsChanged())&&(o=e.getUpdatedProductVariants(s,u,c,l)),e.productDetailService.updateProduct({product:s,languageCode:c,autoUpdate:null!==(a=null===(n=e.detailForm.get(["product","autoUpdateVariantNames"]))||void 0===n?void 0:n.value)&&void 0!==a&&a,productInput:r,variantsInput:o})}))).subscribe((function(t){e.updateSlugAfterSave(t),e.detailForm.markAsPristine(),e.assetChanges={},e.variantAssetChanges={},e.notificationService.success(r.marker("common.notify-update-success"),{entity:"Product"}),e.changeDetector.markForCheck()}),(function(t){e.notificationService.error(r.marker("common.notify-update-error"),{entity:"Product"})}))},t.prototype.canDeactivate=function(){return e.prototype.canDeactivate.call(this)&&!this.assetChanges.assets&&!this.assetChanges.featuredAsset},t.prototype.setFormValues=function(e,t){var n,r,o=this,i=a.findTranslation(e,t);if(this.detailForm.patchValue({product:{enabled:e.enabled,name:i?i.name:"",slug:i?i.slug:"",description:i?i.description:"",facetValueIds:e.facetValues.map((function(e){return e.id}))}}),this.customFields.length){var s=this.detailForm.get(["product","customFields"]),c=i&&i.customFields||{},l=e.customFields||{};try{for(var d=F(this.customFields),u=d.next();!u.done;u=d.next()){var p=u.value,m=p.name,g="localeString"===p.type?c[m]:l[m],v=s.get(m);v&&v.patchValue(g)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=d.return)&&r.call(d)}finally{if(n)throw n.error}}}var f=this.detailForm.get("variants");e.variants.forEach((function(e,n){var r,i,s=a.findTranslation(e,t),c=e.facetValues.map((function(e){return e.id})),l={id:e.id,enabled:e.enabled,sku:e.sku,name:s?s.name:"",price:e.price,priceWithTax:e.priceWithTax,taxCategoryId:e.taxCategory.id,stockOnHand:e.stockOnHand,useGlobalOutOfStockThreshold:e.useGlobalOutOfStockThreshold,outOfStockThreshold:e.outOfStockThreshold,trackInventory:e.trackInventory,facetValueIds:c},d=f.at(n);if(d?d.patchValue(l):(d=o.formBuilder.group(Object.assign(Object.assign({},l),{facetValueIds:o.formBuilder.control(c)})),f.insert(n,d)),o.customVariantFields.length){var u=d.get(["customFields"]);u||(u=o.formBuilder.group(o.customVariantFields.reduce((function(e,t){var n;return Object.assign(Object.assign({},e),((n={})[t.name]="",n))}),{})),d.addControl("customFields",u));try{for(var p=F(o.customVariantFields),m=p.next();!m.done;m=p.next()){var g=m.value,v=g.name,h="localeString"===g.type?s.customFields[v]:e.customFields[v],y=u.get(v);y&&y.patchValue(h)}}catch(e){r={error:e}}finally{try{m&&!m.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}}}))},t.prototype.getUpdatedProduct=function(e,t,n){var r,o,i=a.createUpdatedTranslatable({translatable:e,updatedFields:t.value,customFieldConfig:this.customFields,languageCode:n,defaultTranslation:{languageCode:n,name:e.name||"",slug:e.slug||"",description:e.description||""}});return Object.assign(Object.assign({},i),{assetIds:null===(r=this.assetChanges.assets)||void 0===r?void 0:r.map((function(e){return e.id})),featuredAssetId:null===(o=this.assetChanges.featuredAsset)||void 0===o?void 0:o.id,facetValueIds:t.value.facetValueIds})},t.prototype.getUpdatedProductVariants=function(e,t,n,o){var i=this,s=e.variants.filter((function(e,n){var a=t.get(n.toString());return a&&a.dirty})),c=t.controls.filter((function(e){return e.dirty})).map((function(e){return e.value}));if(s.length!==c.length)throw new Error(r.marker("error.product-variant-form-values-do-not-match"));return s.map((function(e,t){var r,s,l=c[t],d=a.createUpdatedTranslatable({translatable:e,updatedFields:l,customFieldConfig:i.customVariantFields,languageCode:n,defaultTranslation:{languageCode:n,name:""}});d.taxCategoryId=l.taxCategoryId,d.facetValueIds=l.facetValueIds,d.price=o?l.priceWithTax:l.price;var u=i.variantAssetChanges[e.id];return u&&(d.featuredAssetId=null===(r=u.featuredAsset)||void 0===r?void 0:r.id,d.assetIds=null===(s=u.assets)||void 0===s?void 0:s.map((function(e){return e.id}))),d})).filter(l.notNullOrUndefined)},t.prototype.getProductFormGroup=function(){return this.detailForm.get("product")},t.prototype.updateSlugAfterSave=function(e){var t=e[0],n=this.detailForm.get(["product","slug"]);n&&t.hasOwnProperty("updateProduct")&&n.setValue(t.updateProduct.slug,{emitEvent:!1})},t}(a.BaseDetailComponent);M.decorators=[{type:t.Component,args:[{selector:"vdr-product-detail",template:'<vdr-action-bar>\n    <vdr-ab-left>\n        <div class="flex clr-flex-row">\n            <vdr-entity-info [entity]="entity$ | async"></vdr-entity-info>\n            <clr-toggle-wrapper *vdrIfPermissions="[\'UpdateCatalog\', \'UpdateProduct\']">\n                <input\n                    type="checkbox"\n                    clrToggle\n                    name="enabled"\n                    [formControl]="detailForm.get([\'product\', \'enabled\'])"\n                />\n                <label>{{ \'common.enabled\' | translate }}</label>\n            </clr-toggle-wrapper>\n        </div>\n        <vdr-language-selector\n            [disabled]="isNew$ | async"\n            [availableLanguageCodes]="availableLanguages$ | async"\n            [currentLanguageCode]="languageCode$ | async"\n            (languageCodeChange)="setLanguage($event)"\n        ></vdr-language-selector>\n    </vdr-ab-left>\n\n    <vdr-ab-right>\n        <vdr-action-bar-items locationId="product-detail"></vdr-action-bar-items>\n        <button\n            class="btn btn-primary"\n            *ngIf="isNew$ | async; else updateButton"\n            (click)="create()"\n            [disabled]="detailForm.invalid || detailForm.pristine || !variantsToCreateAreValid()"\n        >\n            {{ \'common.create\' | translate }}\n        </button>\n        <ng-template #updateButton>\n            <button\n                *vdrIfPermissions="[\'UpdateCatalog\', \'UpdateProduct\']"\n                class="btn btn-primary"\n                (click)="save()"\n                [disabled]="\n                    (detailForm.invalid || detailForm.pristine) && !assetsChanged() && !variantAssetsChanged()\n                "\n            >\n                {{ \'common.update\' | translate }}\n            </button>\n        </ng-template>\n    </vdr-ab-right>\n</vdr-action-bar>\n\n<form\n    class="form"\n    [formGroup]="detailForm"\n    *ngIf="product$ | async as product"\n    (keydown.enter)="$event.preventDefault()"\n>\n    <clr-tabs>\n        <clr-tab>\n            <button clrTabLink (click)="navigateToTab(\'details\')">\n                {{ \'catalog.product-details\' | translate }}\n            </button>\n            <clr-tab-content *clrIfActive="(activeTab$ | async) === \'details\'">\n                <div class="clr-row">\n                    <div class="clr-col">\n                        <section class="form-block" formGroupName="product">\n                            <ng-container *vdrIfMultichannel>\n                                <vdr-form-item\n                                    [label]="\'common.channels\' | translate"\n                                    *vdrIfDefaultChannelActive\n                                >\n                                    <div class="flex channel-assignment">\n                                        <ng-container *ngFor="let channel of productChannels$ | async">\n                                            <vdr-chip\n                                                *ngIf="!isDefaultChannel(channel.code)"\n                                                icon="times-circle"\n                                                (iconClick)="removeFromChannel(channel.id)"\n                                            >\n                                                <vdr-channel-badge\n                                                    [channelCode]="channel.code"\n                                                ></vdr-channel-badge>\n                                                {{ channel.code | channelCodeToLabel }}\n                                            </vdr-chip>\n                                        </ng-container>\n                                        <button class="btn btn-sm" (click)="assignToChannel()">\n                                            <clr-icon shape="layers"></clr-icon>\n                                            {{ \'catalog.assign-to-channel\' | translate }}\n                                        </button>\n                                    </div>\n                                </vdr-form-item>\n                            </ng-container>\n                            <vdr-form-field [label]="\'catalog.product-name\' | translate" for="name">\n                                <input\n                                    id="name"\n                                    type="text"\n                                    formControlName="name"\n                                    [readonly]="!([\'UpdateCatalog\', \'UpdateProduct\'] | hasPermission)"\n                                    (input)="updateSlug($event.target.value)"\n                                />\n                            </vdr-form-field>\n                            <div\n                                class="auto-rename-wrapper"\n                                [class.visible]="\n                                    (isNew$ | async) === false && detailForm.get([\'product\', \'name\'])?.dirty\n                                "\n                            >\n                                <clr-checkbox-wrapper>\n                                    <input\n                                        clrCheckbox\n                                        type="checkbox"\n                                        id="auto-update"\n                                        formControlName="autoUpdateVariantNames"\n                                    />\n                                    <label>{{\n                                        \'catalog.auto-update-product-variant-name\' | translate\n                                    }}</label>\n                                </clr-checkbox-wrapper>\n                            </div>\n                            <vdr-form-field\n                                [label]="\'catalog.slug\' | translate"\n                                for="slug"\n                                [errors]="{ pattern: \'catalog.slug-pattern-error\' | translate }"\n                            >\n                                <input\n                                    id="slug"\n                                    type="text"\n                                    formControlName="slug"\n                                    [readonly]="!([\'UpdateCatalog\', \'UpdateProduct\'] | hasPermission)"\n                                    pattern="[a-z0-9_-]+"\n                                />\n                            </vdr-form-field>\n                            <vdr-rich-text-editor\n                                formControlName="description"\n                                [readonly]="!([\'UpdateCatalog\', \'UpdateProduct\'] | hasPermission)"\n                                [label]="\'common.description\' | translate"\n                            ></vdr-rich-text-editor>\n\n                            <section formGroupName="customFields" *ngIf="customFields.length">\n                                <label>{{ \'common.custom-fields\' | translate }}</label>\n                                <ng-container *ngFor="let customField of customFields">\n                                    <vdr-custom-field-control\n                                        *ngIf="customFieldIsSet(customField.name)"\n                                        entityName="Product"\n                                        [customFieldsFormGroup]="detailForm.get([\'product\', \'customFields\'])"\n                                        [customField]="customField"\n                                        [readonly]="!([\'UpdateCatalog\', \'UpdateProduct\'] | hasPermission)"\n                                    ></vdr-custom-field-control>\n                                </ng-container>\n                            </section>\n\n                            <div class="facets">\n                                <vdr-facet-value-chip\n                                    *ngFor="let facetValue of facetValues$ | async"\n                                    [facetValue]="facetValue"\n                                    [removable]="[\'UpdateCatalog\', \'UpdateProduct\'] | hasPermission"\n                                    (remove)="removeProductFacetValue(facetValue.id)"\n                                ></vdr-facet-value-chip>\n                                <button\n                                    class="btn btn-sm btn-secondary"\n                                    *vdrIfPermissions="[\'UpdateCatalog\', \'UpdateProduct\']"\n                                    (click)="selectProductFacetValue()"\n                                >\n                                    <clr-icon shape="plus"></clr-icon>\n                                    {{ \'catalog.add-facets\' | translate }}\n                                </button>\n                            </div>\n                        </section>\n                    </div>\n                    <div class="clr-col-md-auto">\n                        <vdr-product-assets\n                            [assets]="assetChanges.assets || product.assets"\n                            [featuredAsset]="assetChanges.featuredAsset || product.featuredAsset"\n                            (change)="assetChanges = $event"\n                        ></vdr-product-assets>\n                    </div>\n                </div>\n\n                <div *ngIf="isNew$ | async">\n                    <h4>{{ \'catalog.product-variants\' | translate }}</h4>\n                    <vdr-generate-product-variants\n                        (variantsChange)="createVariantsConfig = $event"\n                    ></vdr-generate-product-variants>\n                </div>\n            </clr-tab-content>\n        </clr-tab>\n        <clr-tab *ngIf="!(isNew$ | async)">\n            <button clrTabLink (click)="navigateToTab(\'variants\')">\n                {{ \'catalog.product-variants\' | translate }}\n            </button>\n            <clr-tab-content *clrIfActive="(activeTab$ | async) === \'variants\'">\n                <section class="form-block">\n                    <div class="view-mode">\n                        <div class="btn-group">\n                            <button\n                                class="btn btn-secondary-outline"\n                                (click)="variantDisplayMode = \'card\'"\n                                [class.btn-primary]="variantDisplayMode === \'card\'"\n                            >\n                                <clr-icon shape="list"></clr-icon>\n                                {{ \'catalog.display-variant-cards\' | translate }}\n                            </button>\n                            <button\n                                class="btn"\n                                (click)="variantDisplayMode = \'table\'"\n                                [class.btn-primary]="variantDisplayMode === \'table\'"\n                            >\n                                <clr-icon shape="table"></clr-icon>\n                                {{ \'catalog.display-variant-table\' | translate }}\n                            </button>\n                        </div>\n                        <div class="variant-filter">\n                            <input\n                                [formControl]="filterInput"\n                                [placeholder]="\'catalog.filter-by-name-or-sku\' | translate"\n                            />\n                            <button class="icon-button" (click)="filterInput.setValue(\'\')">\n                                <clr-icon shape="times"></clr-icon>\n                            </button>\n                        </div>\n                        <div class="flex-spacer"></div>\n                        <a\n                            *vdrIfPermissions="[\'UpdateCatalog\', \'UpdateProduct\']"\n                            [routerLink]="[\'./\', \'manage-variants\']"\n                            class="btn btn-secondary edit-variants-btn"\n                        >\n                            <clr-icon shape="add-text"></clr-icon>\n                            {{ \'catalog.manage-variants\' | translate }}\n                        </a>\n                    </div>\n\n                    <vdr-product-variants-table\n                        *ngIf="variantDisplayMode === \'table\'"\n                        [variants]="variants$ | async"\n                        [optionGroups]="product.optionGroups"\n                        [channelPriceIncludesTax]="channelPriceIncludesTax$ | async"\n                        [productVariantsFormArray]="detailForm.get(\'variants\')"\n                        [pendingAssetChanges]="variantAssetChanges"\n                    ></vdr-product-variants-table>\n                    <vdr-product-variants-list\n                        *ngIf="variantDisplayMode === \'card\'"\n                        [variants]="variants$ | async"\n                        [channelPriceIncludesTax]="channelPriceIncludesTax$ | async"\n                        [facets]="facets$ | async"\n                        [optionGroups]="product.optionGroups"\n                        [productVariantsFormArray]="detailForm.get(\'variants\')"\n                        [taxCategories]="taxCategories$ | async"\n                        [customFields]="customVariantFields"\n                        [customOptionFields]="customOptionFields"\n                        [activeLanguage]="languageCode$ | async"\n                        [pendingAssetChanges]="variantAssetChanges"\n                        (assignToChannel)="assignVariantToChannel($event)"\n                        (removeFromChannel)="removeVariantFromChannel($event)"\n                        (assetChange)="variantAssetChange($event)"\n                        (updateProductOption)="updateProductOption($event)"\n                        (selectionChange)="selectedVariantIds = $event"\n                        (selectFacetValueClick)="selectVariantFacetValue($event)"\n                    ></vdr-product-variants-list>\n                </section>\n            </clr-tab-content>\n        </clr-tab>\n    </clr-tabs>\n</form>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[":host ::ng-deep trix-toolbar{top:24px}vdr-action-bar clr-toggle-wrapper{margin-top:12px}.variant-filter{flex:1;display:flex}.variant-filter input{flex:1;max-width:none;border-radius:3px 0 0 3px!important}.variant-filter .icon-button{border:1px solid var(--color-component-border-300);background-color:var(--color-component-bg-100);border-radius:0 3px 3px 0;border-left:none}.group-name{padding-right:6px}.view-mode{display:flex;justify-content:flex-end;align-items:center}.edit-variants-btn{margin-top:0}.channel-assignment{flex-wrap:wrap}.auto-rename-wrapper{overflow:hidden;max-height:0;padding-left:9.5rem;margin-bottom:0;transition:max-height .2s,margin-bottom .2s}.auto-rename-wrapper.visible{max-height:24px;margin-bottom:12px}"]}]}],M.ctorParameters=function(){return[{type:n.ActivatedRoute},{type:n.Router},{type:a.ServerConfigService},{type:O},{type:i.FormBuilder},{type:a.ModalService},{type:a.NotificationService},{type:a.DataService},{type:d.Location},{type:t.ChangeDetectorRef}]};var G=function(e){function t(t,n,r,o,i,s){var c=e.call(this,i,s)||this;return c.dataService=t,c.modalService=n,c.notificationService=r,c.jobQueueService=o,c.searchTerm="",c.facetValueIds=[],c.groupByProduct=!0,e.prototype.setQueryFn.call(c,(function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=c.dataService.product).searchProducts.apply(e,I([c.searchTerm],t)).refetchOnChannelChange()}),(function(e){return e.search}),(function(e,t){return{input:{skip:e,take:t,term:c.searchTerm,facetValueIds:c.facetValueIds,facetValueOperator:a.LogicalOperator.AND,groupByProduct:c.groupByProduct}}})),c}return y(t,e),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),this.facetValues$=this.result$.pipe(o.map((function(e){return e.search.facetValues}))),this.route.queryParamMap.pipe(o.map((function(e){return e.get("q")})),o.takeUntil(this.destroy$)).subscribe((function(e){t.productSearchInput.setSearchTerm(e)}));var n=this.route.queryParamMap.pipe(o.map((function(e){return e.getAll("fvids")})));n.pipe(o.takeUntil(this.destroy$)).subscribe((function(e){t.productSearchInput.setFacetValues(e)})),this.facetValues$.pipe(o.take(1),o.delay(100),o.withLatestFrom(n)).subscribe((function(e){var n=x(e,2),a=(n[0],n[1]);t.productSearchInput.setFacetValues(a)}))},t.prototype.setSearchTerm=function(e){this.searchTerm=e,this.setQueryParam({q:e||null,page:1}),this.refresh()},t.prototype.setFacetValueIds=function(e){this.facetValueIds=e,this.setQueryParam({fvids:e,page:1}),this.refresh()},t.prototype.rebuildSearchIndex=function(){var e=this;this.dataService.product.reindex().subscribe((function(t){var n=t.reindex;e.notificationService.info(r.marker("catalog.reindexing")),e.jobQueueService.addJob(n.id,(function(t){if(t.state===a.JobState.COMPLETED){var n=(new Intl.NumberFormat).format(t.duration||0);e.notificationService.success(r.marker("catalog.reindex-successful"),{count:t.result.indexedItemCount,time:n}),e.refresh()}else e.notificationService.error(r.marker("catalog.reindex-error"))}))}))},t.prototype.deleteProduct=function(e){var t=this;this.modalService.dialog({title:r.marker("catalog.confirm-delete-product"),buttons:[{type:"secondary",label:r.marker("common.cancel")},{type:"danger",label:r.marker("common.delete"),returnValue:!0}]}).pipe(o.switchMap((function(n){return n?t.dataService.product.deleteProduct(e):s.EMPTY})),o.delay(500)).subscribe((function(){t.notificationService.success(r.marker("common.notify-delete-success"),{entity:"Product"}),t.refresh()}),(function(e){t.notificationService.error(r.marker("common.notify-delete-error"),{entity:"Product"})}))},t}(a.BaseListComponent);G.decorators=[{type:t.Component,args:[{selector:"vdr-products-list",template:'<vdr-action-bar>\n    <vdr-ab-left [grow]="true">\n        <div class="search-form">\n            <vdr-product-search-input\n                #productSearchInputComponent\n                [facetValueResults]="facetValues$ | async"\n                (searchTermChange)="setSearchTerm($event)"\n                (facetValueChange)="setFacetValueIds($event)"\n            ></vdr-product-search-input>\n            <vdr-dropdown class="search-settings-menu mr3">\n                <button type="button" class="icon-button" vdrDropdownTrigger>\n                    <clr-icon shape="cog"></clr-icon>\n                </button>\n                <vdr-dropdown-menu vdrPosition="bottom-right">\n                    <button\n                        type="button"\n                        vdrDropdownItem\n                        (click)="rebuildSearchIndex()"\n                        [disabled]="!([\'UpdateCatalog\', \'UpdateProduct\'] | hasPermission)"\n                    >\n                        {{ \'catalog.rebuild-search-index\' | translate }}\n                    </button>\n                </vdr-dropdown-menu>\n            </vdr-dropdown>\n        </div>\n        <clr-checkbox-wrapper>\n            <input type="checkbox" clrCheckbox [(ngModel)]="groupByProduct" />\n            <label>{{ \'catalog.group-by-product\' | translate }}</label>\n        </clr-checkbox-wrapper>\n    </vdr-ab-left>\n    <vdr-ab-right>\n        <vdr-action-bar-items locationId="product-list"></vdr-action-bar-items>\n        <a class="btn btn-primary" [routerLink]="[\'./create\']" *vdrIfPermissions="[\'CreateCatalog\', \'CreateProduct\']">\n            <clr-icon shape="plus"></clr-icon>\n            <span class="full-label">{{ \'catalog.create-new-product\' | translate }}</span>\n        </a>\n    </vdr-ab-right>\n</vdr-action-bar>\n\n<vdr-data-table\n    [items]="items$ | async"\n    [itemsPerPage]="itemsPerPage$ | async"\n    [totalItems]="totalItems$ | async"\n    [currentPage]="currentPage$ | async"\n    (pageChange)="setPageNumber($event)"\n    (itemsPerPageChange)="setItemsPerPage($event)"\n>\n    <ng-template let-result="item">\n        <td class="left align-middle" [class.disabled]="!result.enabled">\n            <div class="image-placeholder">\n                <img\n                    *ngIf="\n                        groupByProduct\n                            ? result.productAsset\n                            : result.productVariantAsset || result.productAsset as asset;\n                        else imagePlaceholder\n                    "\n                    [src]="asset | assetPreview:\'tiny\'"\n                />\n                <ng-template #imagePlaceholder>\n                    <div class="placeholder"><clr-icon shape="image" size="48"></clr-icon></div>\n                </ng-template>\n            </div>\n        </td>\n        <td class="left align-middle" [class.disabled]="!result.enabled">\n            {{ groupByProduct ? result.productName : result.productVariantName }}\n        </td>\n        <td class="align-middle" [class.disabled]="!result.enabled">\n            <vdr-chip *ngIf="!result.enabled">{{ \'common.disabled\' | translate }}</vdr-chip>\n        </td>\n        <td class="right align-middle" [class.disabled]="!result.enabled">\n            <vdr-table-row-action\n                iconShape="edit"\n                [label]="\'common.edit\' | translate"\n                [linkTo]="[\'./\', result.productId]"\n            ></vdr-table-row-action>\n        </td>\n        <td class="right align-middle" [class.disabled]="!result.enabled">\n            <vdr-dropdown>\n                <button type="button" class="btn btn-link btn-sm" vdrDropdownTrigger>\n                    {{ \'common.actions\' | translate }}\n                    <clr-icon shape="caret down"></clr-icon>\n                </button>\n                <vdr-dropdown-menu vdrPosition="bottom-right">\n                    <button\n                        type="button"\n                        class="delete-button"\n                        (click)="deleteProduct(result.productId)"\n                        [disabled]="!([\'DeleteCatalog\', \'DeleteProduct\'] | hasPermission)"\n                        vdrDropdownItem\n                    >\n                        <clr-icon shape="trash" class="is-danger"></clr-icon>\n                        {{ \'common.delete\' | translate }}\n                    </button>\n                </vdr-dropdown-menu>\n            </vdr-dropdown>\n        </td>\n    </ng-template>\n</vdr-data-table>\n',styles:[".image-placeholder{width:50px;height:50px;background-color:var(--color-component-bg-200)}.image-placeholder .placeholder{text-align:center;color:var(--color-grey-300)}.search-form{display:flex;align-items:center;width:100%;margin-bottom:6px}.search-input{min-width:300px}@media screen and (max-width:768px){.search-input{min-width:100px}}.search-settings-menu{margin:0 12px}td.disabled{background-color:var(--color-component-bg-200)}"]}]}],G.ctorParameters=function(){return[{type:a.DataService},{type:a.ModalService},{type:a.NotificationService},{type:a.JobQueueService},{type:n.Router},{type:n.ActivatedRoute}]},G.propDecorators={productSearchInput:[{type:t.ViewChild,args:["productSearchInputComponent",{static:!0}]}]};var L=function(e){var t,n;try{for(var a=F(Object.keys(e)),r=a.next();!r.done;r=a.next()){var o=r.value;this[o]=e[o]}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},E=function(){function e(e,t,n,a,r){this.route=e,this.dataService=t,this.productDetailService=n,this.notificationService=a,this.modalService=r,this.formValueChanged=!1,this.generatedVariants=[]}return e.prototype.ngOnInit=function(){var e=this;this.initOptionsAndVariants(),this.languageCode=this.route.snapshot.paramMap.get("lang")||a.getDefaultUiLanguage(),this.dataService.settings.getActiveChannel().single$.subscribe((function(t){e.currencyCode=t.activeChannel.currencyCode}))},e.prototype.onFormChanged=function(e){this.formValueChanged=!0,e.enabled=!0},e.prototype.canDeactivate=function(){return!this.formValueChanged},e.prototype.getVariantsToAdd=function(){return this.generatedVariants.filter((function(e){return!e.existing&&e.enabled}))},e.prototype.getVariantName=function(e){return 0===e.options.length?r.marker("catalog.default-variant"):e.options.map((function(e){return e.name})).join(" ")},e.prototype.addOption=function(){this.optionGroups.push({isNew:!0,name:"",values:[]})},e.prototype.generateVariants=function(){var e=this,t=this.optionGroups.map((function(e){return e.values})),n=this.generatedVariants,a=function(t,a,r){var o,i,s,c=e.getVariantPrototype(a,n);return new L({enabled:!1,existing:!!r,productVariantId:null==r?void 0:r.id,isDefault:t,options:a,price:null!==(o=null==r?void 0:r.price)&&void 0!==o?o:c.price,sku:null!==(i=null==r?void 0:r.sku)&&void 0!==i?i:c.sku,stock:null!==(s=null==r?void 0:r.stockOnHand)&&void 0!==s?s:c.stock})};this.generatedVariants=t.length?l.generateAllCombinations(t).map((function(t){var n=e.product.variants.find((function(n){return e.optionsAreEqual(n.options,t)}));return a(!1,t,n)})):[a(!0,[],this.product.variants[0])]},e.prototype.getVariantPrototype=function(e,t){return t.filter((function(t){return e.map((function(e){return e.name})).filter((function(e){return t.options.map((function(e){return e.name})).includes(e)}))})).length?m.pick(t[0],["sku","price","stock"]):{sku:"",price:0,stock:0}},e.prototype.deleteVariant=function(e){var t=this;this.modalService.dialog({title:r.marker("catalog.confirm-delete-product-variant"),buttons:[{type:"secondary",label:r.marker("common.cancel")},{type:"danger",label:r.marker("common.delete"),returnValue:!0}]}).pipe(o.switchMap((function(n){return n?t.productDetailService.deleteProductVariant(e,t.product.id):s.EMPTY})),o.switchMap((function(){return t.reFetchProduct(null)}))).subscribe((function(){t.notificationService.success(r.marker("common.notify-delete-success"),{entity:"ProductVariant"}),t.initOptionsAndVariants()}),(function(e){t.notificationService.error(r.marker("common.notify-delete-error"),{entity:"ProductVariant"})}))},e.prototype.save=function(){var e=this,t=this.optionGroups.filter((function(e){return e.isNew})).map((function(e){return{name:e.name,values:[]}}));this.confirmDeletionOfDefault().pipe(o.mergeMap((function(){return e.productDetailService.createProductOptionGroups(t,e.languageCode)})),o.mergeMap((function(t){return e.addOptionGroupsToProduct(t)})),o.mergeMap((function(t){return e.addNewOptionsToGroups(t)})),o.mergeMap((function(t){return e.fetchOptionGroups(t)})),o.mergeMap((function(t){return e.createNewProductVariants(t)})),o.mergeMap((function(t){return e.deleteDefaultVariant(t.createProductVariants)})),o.mergeMap((function(t){return e.reFetchProduct(t)}))).subscribe({next:function(t){e.formValueChanged=!1,e.notificationService.success(r.marker("catalog.created-new-variants-success"),{count:t.length}),e.initOptionsAndVariants()}})},e.prototype.confirmDeletionOfDefault=function(){return this.hasOnlyDefaultVariant(this.product)?this.modalService.dialog({title:r.marker("catalog.confirm-adding-options-delete-default-title"),body:r.marker("catalog.confirm-adding-options-delete-default-body"),buttons:[{type:"secondary",label:r.marker("common.cancel")},{type:"danger",label:r.marker("catalog.delete-default-variant"),returnValue:!0}]}).pipe(o.mergeMap((function(e){return!0===e?s.of(!0):s.EMPTY}))):s.of(!0)},e.prototype.hasOnlyDefaultVariant=function(e){return 1===e.variants.length&&0===e.optionGroups.length},e.prototype.addOptionGroupsToProduct=function(e){var t=this;return e.length?s.forkJoin(e.map((function(e){return t.dataService.product.addOptionGroupToProduct({productId:t.product.id,optionGroupId:e.id})}))).pipe(o.map((function(){return e}))):s.of([])},e.prototype.addNewOptionsToGroups=function(e){var t=this,n=this.optionGroups.map((function(n){var a=e.find((function(e){return e.name===n.name})),r=a?a.id:n.id;if(!r)throw new Error("Could not get a productOptionGroupId");return n.values.filter((function(e){return!e.locked})).map((function(e){return{productOptionGroupId:r,code:c.normalizeString(e.name,"-"),translations:[{name:e.name,languageCode:t.languageCode}]}}))})).reduce((function(e,t){return I(e,t)}),[]),a=I(e.map((function(e){return e.id})),this.optionGroups.map((function(e){return e.id})).filter(l.notNullOrUndefined));return n.length?s.forkJoin(n.map((function(e){return t.dataService.product.addOptionToGroup(e)}))).pipe(o.map((function(){return a}))):s.of(a)},e.prototype.fetchOptionGroups=function(e){var t=this;return s.forkJoin(e.map((function(e){return t.dataService.product.getProductOptionGroup(e).mapSingle((function(e){return e.productOptionGroup})).pipe(o.filter(l.notNullOrUndefined))})))},e.prototype.createNewProductVariants=function(e){var t=e.filter(l.notNullOrUndefined).map((function(e){return e.options})).reduce((function(e,t){return I(e,t)}),[]),n=this.generatedVariants.filter((function(e){return e.enabled&&!e.existing})).map((function(e){return{price:e.price,sku:e.sku,stock:e.stock,optionIds:e.options.map((function(e){return t.find((function(t){return t.name===e.name}))})).filter(l.notNullOrUndefined).map((function(e){return e.id}))}}));return this.productDetailService.createProductVariants(this.product,n,t,this.languageCode)},e.prototype.deleteDefaultVariant=function(e){return this.hasOnlyDefaultVariant(this.product)?this.dataService.product.deleteProductVariant(this.product.variants[0].id).pipe(o.map((function(){return e}))):s.of(e)},e.prototype.reFetchProduct=function(e){var t=this.route.snapshot.paramMap.get("id");return t?this.dataService.product.getProduct(t).single$.pipe(o.map((function(){return e}))):s.of(e)},e.prototype.initOptionsAndVariants=function(){var e=this;this.dataService.product.getProductVariantsOptions(this.route.snapshot.paramMap.get("id")).mapSingle((function(e){return e.product})).subscribe((function(t){e.product=t,e.optionGroups=t.optionGroups.map((function(e){return{id:e.id,isNew:!1,name:e.name,values:e.options.map((function(e){return{id:e.id,name:e.name,locked:!0}}))}})),e.generateVariants()}))},e.prototype.optionsAreEqual=function(e,t){function n(e){return e.map((function(e){return e.name})).sort().join("|")}return n(e)===n(t)},e}();E.decorators=[{type:t.Component,args:[{selector:"vdr-product-variants-editor",template:'<vdr-action-bar>\n    <vdr-ab-right>\n        <button\n            class="btn btn-primary"\n            (click)="save()"\n            [disabled]="!formValueChanged || getVariantsToAdd().length === 0"\n        >\n            {{ \'common.add-new-variants\' | translate: { count: getVariantsToAdd().length } }}\n        </button>\n    </vdr-ab-right>\n</vdr-action-bar>\n\n<div *ngFor="let group of optionGroups" class="option-groups">\n    <div class="name">\n        <label>{{ \'catalog.option\' | translate }}</label>\n        <input clrInput [(ngModel)]="group.name" name="name" [readonly]="!group.isNew" />\n    </div>\n    <div class="values">\n        <label>{{ \'catalog.option-values\' | translate }}</label>\n        <vdr-option-value-input\n            #optionValueInputComponent\n            [(ngModel)]="group.values"\n            (ngModelChange)="generateVariants()"\n            [groupName]="group.name"\n            [disabled]="group.name === \'\'"\n        ></vdr-option-value-input>\n    </div>\n</div>\n<button\n    class="btn btn-primary-outline btn-sm"\n    (click)="addOption()"\n    *ngIf="product?.variants.length === 1 && product?.optionGroups.length === 0"\n>\n    <clr-icon shape="plus"></clr-icon>\n    {{ \'catalog.add-option\' | translate }}\n</button>\n\n<div class="variants-preview">\n    <table class="table">\n        <thead>\n            <tr>\n                <th>{{ \'common.create\' | translate }}</th>\n                <th>{{ \'catalog.variant\' | translate }}</th>\n                <th>{{ \'catalog.sku\' | translate }}</th>\n                <th>{{ \'catalog.price\' | translate }}</th>\n                <th>{{ \'catalog.stock-on-hand\' | translate }}</th>\n                <th></th>\n            </tr>\n        </thead>\n        <tr *ngFor="let variant of generatedVariants" [class.disabled]="!variant.enabled || variant.existing">\n            <td>\n                <input\n                    type="checkbox"\n                    *ngIf="!variant.existing"\n                    [(ngModel)]="variant.enabled"\n                    name="enabled"\n                    clrCheckbox\n                    (ngModelChange)="formValueChanged = true"\n                />\n            </td>\n            <td>\n                {{ getVariantName(variant) | translate }}\n            </td>\n            <td>\n                <clr-input-container *ngIf="!variant.existing">\n                    <input\n                        clrInput\n                        type="text"\n                        [(ngModel)]="variant.sku"\n                        [placeholder]="\'catalog.sku\' | translate"\n                        name="sku"\n                        required\n                        (ngModelChange)="onFormChanged(variant)"\n                    />\n                </clr-input-container>\n                <span *ngIf="variant.existing">{{ variant.sku }}</span>\n            </td>\n            <td>\n                <clr-input-container *ngIf="!variant.existing">\n                    <vdr-currency-input\n                        clrInput\n                        [(ngModel)]="variant.price"\n                        name="price"\n                        [currencyCode]="currencyCode"\n                        (ngModelChange)="onFormChanged(variant)"\n                    ></vdr-currency-input>\n                </clr-input-container>\n                <span *ngIf="variant.existing">{{ variant.price | localeCurrency: currencyCode }}</span>\n            </td>\n            <td>\n                <clr-input-container *ngIf="!variant.existing">\n                    <input\n                        clrInput\n                        type="number"\n                        [(ngModel)]="variant.stock"\n                        name="stock"\n                        min="0"\n                        step="1"\n                        (ngModelChange)="onFormChanged(variant)"\n                    />\n                </clr-input-container>\n                <span *ngIf="variant.existing">{{ variant.stock }}</span>\n            </td>\n            <td>\n                <vdr-dropdown *ngIf="variant.productVariantId as productVariantId">\n                    <button class="icon-button" vdrDropdownTrigger>\n                        <clr-icon shape="ellipsis-vertical"></clr-icon>\n                    </button>\n                    <vdr-dropdown-menu vdrPosition="bottom-right">\n                        <button\n                            type="button"\n                            class="delete-button"\n                            (click)="deleteVariant(productVariantId)"\n                            vdrDropdownItem\n                        >\n                            <clr-icon shape="trash" class="is-danger"></clr-icon>\n                            {{ \'common.delete\' | translate }}\n                        </button>\n                    </vdr-dropdown-menu>\n                </vdr-dropdown>\n            </td>\n        </tr>\n    </table>\n</div>\n',changeDetection:t.ChangeDetectionStrategy.Default,styles:[".option-groups{display:flex}.option-groups:first-of-type{margin-top:24px}.values{flex:1;margin:0 6px}.variants-preview tr.disabled td{background-color:var(--color-component-bg-100);color:var(--color-grey-400)}"]}]}],E.ctorParameters=function(){return[{type:n.ActivatedRoute},{type:a.DataService},{type:O},{type:a.NotificationService},{type:a.ModalService}]};var N=function(e){function t(t,n){return e.call(this,t,{__typename:"Asset",id:"",createdAt:"",updatedAt:"",name:"",type:a.AssetType.IMAGE,fileSize:0,mimeType:"",width:0,height:0,source:"",preview:"",focalPoint:null},(function(e){return n.product.getAsset(e).mapStream((function(e){return e.asset}))}))||this}return y(t,e),t}(a.BaseEntityResolver);N.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new N(t.ɵɵinject(n.Router),t.ɵɵinject(a.DataService))},token:N,providedIn:"root"}),N.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],N.ctorParameters=function(){return[{type:n.Router},{type:a.DataService}]};var U=function(e){function t(t,n){return e.call(this,t,{__typename:"Collection",id:"",createdAt:"",updatedAt:"",languageCode:a.getDefaultUiLanguage(),name:"",slug:"",isPrivate:!1,description:"",featuredAsset:null,assets:[],translations:[],filters:[],parent:{},children:null},(function(e){return n.collection.getCollection(e).mapStream((function(e){return e.collection}))}))||this}return y(t,e),t}(a.BaseEntityResolver);U.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new U(t.ɵɵinject(n.Router),t.ɵɵinject(a.DataService))},token:U,providedIn:"root"}),U.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],U.ctorParameters=function(){return[{type:n.Router},{type:a.DataService}]};var j=function(e){function t(t,n){return e.call(this,t,{__typename:"Facet",id:"",createdAt:"",updatedAt:"",isPrivate:!1,languageCode:a.getDefaultUiLanguage(),name:"",code:"",translations:[],values:[]},(function(e){return n.facet.getFacet(e).mapStream((function(e){return e.facet}))}))||this}return y(t,e),t}(a.BaseEntityResolver);j.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new j(t.ɵɵinject(n.Router),t.ɵɵinject(a.DataService))},token:j,providedIn:"root"}),j.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],j.ctorParameters=function(){return[{type:n.Router},{type:a.DataService}]};var R=function(e){function t(t,n){return e.call(this,n,{__typename:"Product",id:"",createdAt:"",updatedAt:"",enabled:!0,languageCode:a.getDefaultUiLanguage(),name:"",slug:"",featuredAsset:null,assets:[],description:"",translations:[],optionGroups:[],facetValues:[],variants:[],channels:[]},(function(e){return t.product.getProduct(e).refetchOnChannelChange().mapStream((function(e){return e.product}))}))||this}return y(t,e),t}(a.BaseEntityResolver);R.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new R(t.ɵɵinject(a.DataService),t.ɵɵinject(n.Router))},token:R,providedIn:"root"}),R.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],R.ctorParameters=function(){return[{type:a.DataService},{type:n.Router}]};var B=function(e){function t(t,n){return e.call(this,t,{__typename:"Product",id:"",createdAt:"",updatedAt:"",name:"",optionGroups:[],variants:[]},(function(e){return n.product.getProductVariantsOptions(e).mapStream((function(e){return e.product}))}))||this}return y(t,e),t}(a.BaseEntityResolver);B.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new B(t.ɵɵinject(n.Router),t.ɵɵinject(a.DataService))},token:B,providedIn:"root"}),B.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],B.ctorParameters=function(){return[{type:n.Router},{type:a.DataService}]};var _={breadcrumb:r.marker("breadcrumb.products")},q={breadcrumb:X},z={breadcrumb:ee},W={breadcrumb:r.marker("breadcrumb.facets")},H={breadcrumb:te},J={breadcrumb:r.marker("breadcrumb.collections")},Y={breadcrumb:ne},Q={breadcrumb:r.marker("breadcrumb.assets")},K={breadcrumb:ae},Z=[{path:"products",component:G,data:_},{path:"products/:id",component:M,resolve:a.createResolveData(R),canDeactivate:[a.CanDeactivateDetailGuard],data:q},{path:"products/:id/manage-variants",component:E,resolve:a.createResolveData(B),canDeactivate:[a.CanDeactivateDetailGuard],data:z},{path:"facets",component:D,data:W},{path:"facets/:id",component:V,resolve:a.createResolveData(j),canDeactivate:[a.CanDeactivateDetailGuard],data:H},{path:"collections",component:S,data:J},{path:"collections/:id",component:w,resolve:a.createResolveData(U),canDeactivate:[a.CanDeactivateDetailGuard],data:Y},{path:"assets",component:k,data:Q},{path:"assets/:id",component:P,resolve:a.createResolveData(N),data:K}];function X(e,t){return a.detailBreadcrumb({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.products",getName:function(e){return e.name},route:"products"})}function ee(e,t){return e.entity.pipe(o.map((function(e){return[{label:r.marker("breadcrumb.products"),link:["../","products"]},{label:""+e.name,link:["../","products",t.id,{tab:"variants"}]},{label:r.marker("breadcrumb.manage-variants"),link:["manage-variants"]}]})))}function te(e,t){return a.detailBreadcrumb({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.facets",getName:function(e){return e.name},route:"facets"})}function ne(e,t){return a.detailBreadcrumb({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.collections",getName:function(e){return e.name},route:"collections"})}function ae(e,t){return a.detailBreadcrumb({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.assets",getName:function(e){return e.name},route:"assets"})}var re=function(){function e(e,t,n){this.route=e,this.router=t,this.dataService=n,this.filterTermControl=new i.FormControl(""),this.collectionIdChange$=new s.BehaviorSubject(""),this.refresh$=new s.BehaviorSubject(!0),this.destroy$=new s.Subject}return e.prototype.ngOnInit=function(){var e=this;this.contentsCurrentPage$=this.route.paramMap.pipe(o.map((function(e){return e.get("contentsPage")})),o.map((function(e){return e?+e:1})),o.startWith(1),o.distinctUntilChanged()),this.contentsItemsPerPage$=this.route.paramMap.pipe(o.map((function(e){return e.get("contentsPerPage")})),o.map((function(e){return e?+e:10})),o.startWith(10),o.distinctUntilChanged());var t=this.filterTermControl.valueChanges.pipe(o.debounceTime(250),o.tap((function(){return e.setContentsPageNumber(1)})),o.startWith("")),n=s.combineLatest(this.collectionIdChange$,this.contentsCurrentPage$,this.contentsItemsPerPage$,t,this.refresh$).pipe(o.takeUntil(this.destroy$),o.switchMap((function(t){var n=x(t,4),a=n[0],r=n[1],o=n[2],i=n[3],c=o,l=(r-1)*o;return a?e.dataService.collection.getCollectionContents(a,c,l,i).mapSingle((function(e){return e.collection})):s.of(null)})));this.contents$=n.pipe(o.map((function(e){return e?e.productVariants.items:[]}))),this.contentsTotalItems$=n.pipe(o.map((function(e){return e?e.productVariants.totalItems:0})))},e.prototype.ngOnChanges=function(e){"collectionId"in e&&this.collectionIdChange$.next(e.collectionId.currentValue)},e.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete()},e.prototype.setContentsPageNumber=function(e){this.setParam("contentsPage",e)},e.prototype.setContentsItemsPerPage=function(e){this.setParam("contentsPerPage",e)},e.prototype.refresh=function(){this.refresh$.next(!0)},e.prototype.setParam=function(e,t){var n;this.router.navigate(["./",Object.assign(Object.assign({},this.route.snapshot.params),(n={},n[e]=t,n))],{relativeTo:this.route,queryParamsHandling:"merge"})},e}();function oe(e,t){var n,a,r,o,i,s,c=[],l={},d=function(e){var t=new Map;function n(e){t.set(e.id,e),e.children.forEach(n)}e&&n(e);return t}(t);try{for(var u=F(e),p=u.next();!p.done;p=u.next()){var m=p.value;l[m.id]=Object.assign(Object.assign({},m),{children:[]})}}catch(e){n={error:e}}finally{try{p&&!p.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}try{for(var g=F(e.map((function(e){return e.id}))),v=g.next();!v.done;v=g.next()){var f=v.value;if(l.hasOwnProperty(f)){var h=l[f];h.expanded=null!==(s=null===(i=d.get(f))||void 0===i?void 0:i.expanded)&&void 0!==s&&s;var y=h.parent;if(!y)continue;!l[y.id]?c.push(h):l[y.id]?l[y.id].children.push(h):l[y.id]={children:[h]}}}}catch(e){r={error:e}}finally{try{v&&!v.done&&(o=g.return)&&o.call(g)}finally{if(r)throw r.error}}return{id:c.length?c[0].parent.id:void 0,children:c}}re.decorators=[{type:t.Component,args:[{selector:"vdr-collection-contents",template:'<div class="contents-header">\n    <div class="header-title-row">\n        <ng-container\n            *ngTemplateOutlet="headerTemplate; context: { $implicit: contentsTotalItems$ | async }"\n        ></ng-container>\n    </div>\n    <input\n        type="text"\n        [placeholder]="\'catalog.filter-by-name\' | translate"\n        [formControl]="filterTermControl"\n    />\n</div>\n<vdr-data-table\n    [items]="contents$ | async"\n    [itemsPerPage]="contentsItemsPerPage$ | async"\n    [totalItems]="contentsTotalItems$ | async"\n    [currentPage]="contentsCurrentPage$ | async"\n    (pageChange)="setContentsPageNumber($event)"\n    (itemsPerPageChange)="setContentsItemsPerPage($event)"\n>\n    <ng-template let-variant="item">\n        <td class="left align-middle">{{ variant.name }}</td>\n        <td class="right align-middle">\n            <vdr-table-row-action\n                iconShape="edit"\n                [label]="\'common.edit\' | translate"\n                [linkTo]="[\'/catalog/products\', variant.productId, { tab: \'variants\' }]"\n            ></vdr-table-row-action>\n        </td>\n    </ng-template>\n</vdr-data-table>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[".contents-header{background-color:var(--color-component-bg-100);position:sticky;top:0;padding:6px;z-index:1;border-bottom:1px solid var(--color-component-border-200)}.contents-header .header-title-row{display:flex;justify-content:space-between;align-items:center}.contents-header .clr-input{width:100%}:host ::ng-deep table{margin-top:-1px}"]}]}],re.ctorParameters=function(){return[{type:n.ActivatedRoute},{type:n.Router},{type:a.DataService}]},re.propDecorators={collectionId:[{type:t.Input}],headerTemplate:[{type:t.ContentChild,args:[t.TemplateRef,{static:!0}]}]};var ie=function(){function e(){this.expandAll=!1,this.rearrange=new t.EventEmitter,this.deleteCollection=new t.EventEmitter}return e.prototype.ngOnChanges=function(e){"collections"in e&&this.collections&&(this.collectionTree=oe(this.collections,this.collectionTree))},e.prototype.onDrop=function(e){var t=e.item.data,n=e.container.data.id;if(null==n)throw new Error("Could not determine the ID of the root Collection");this.rearrange.emit({collectionId:t.id,parentId:n,index:e.currentIndex})},e.prototype.onMove=function(e){this.rearrange.emit(e)},e.prototype.onDelete=function(e){this.deleteCollection.emit(e)},e.prototype.isRootNode=function(e){return!e.hasOwnProperty("parent")},e}();ie.decorators=[{type:t.Component,args:[{selector:"vdr-collection-tree",template:'<vdr-collection-tree-node\n    *ngIf="collectionTree"\n    cdkDropListGroup\n    [expandAll]="expandAll"\n    [collectionTree]="collectionTree"\n    [activeCollectionId]="activeCollectionId"\n></vdr-collection-tree-node>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[""]}]}],ie.propDecorators={collections:[{type:t.Input}],activeCollectionId:[{type:t.Input}],expandAll:[{type:t.Input}],rearrange:[{type:t.Output}],deleteCollection:[{type:t.Output}]};var se=function(){function e(e,t,n){this.parent=e,this.root=t,this.dataService=n,this.depth=0,this.expandAll=!1,e&&(this.depth=e.depth+1)}return e.prototype.ngOnInit=function(){this.parentName=this.collectionTree.name||"<root>";var e=this.dataService.client.userStatus().mapStream((function(e){return e.userStatus.permissions})).pipe(o.shareReplay(1));this.hasUpdatePermission$=e.pipe(o.map((function(e){return e.includes(a.Permission.UpdateCatalog)||e.includes(a.Permission.UpdateCollection)}))),this.hasDeletePermission$=e.pipe(o.map((function(e){return e.includes(a.Permission.DeleteCatalog)||e.includes(a.Permission.DeleteCollection)})))},e.prototype.ngOnChanges=function(e){var t=e.expandAll;t&&!0===t.previousValue&&!1===t.currentValue&&this.collectionTree.children.forEach((function(e){return e.expanded=!1}))},e.prototype.trackByFn=function(e,t){return t.id},e.prototype.getMoveListItems=function(e){var t=function(n,a,r){if(n.id!==e.id){var o=a.concat(n.name),i=e.parent&&e.parent.id;n.id!==i&&r.push({path:o.slice(1).join(" / ")||"root",id:n.id}),n.children.forEach((function(e){return t(e,o,r)}))}return r};return t(this.root.collectionTree,[],[])},e.prototype.move=function(e,t){this.root.onMove({index:0,parentId:t,collectionId:e.id})},e.prototype.moveUp=function(e,t){e.parent&&this.root.onMove({index:t-1,parentId:e.parent.id,collectionId:e.id})},e.prototype.moveDown=function(e,t){e.parent&&this.root.onMove({index:t+1,parentId:e.parent.id,collectionId:e.id})},e.prototype.drop=function(e){g.moveItemInArray(this.collectionTree.children,e.previousIndex,e.currentIndex),this.root.onDrop(e)},e.prototype.delete=function(e){this.root.onDelete(e)},e}();se.decorators=[{type:t.Component,args:[{selector:"vdr-collection-tree-node",template:'<div\n    cdkDropList\n    class="tree-node"\n    #dropList\n    [cdkDropListData]="collectionTree"\n    [cdkDropListDisabled]="!(hasUpdatePermission$ | async)"\n    (cdkDropListDropped)="drop($event)"\n>\n    <div\n        class="collection"\n        [class.private]="collection.isPrivate"\n        *ngFor="let collection of collectionTree.children; index as i; trackBy: trackByFn"\n        cdkDrag\n        [cdkDragData]="collection"\n    >\n        <div\n            class="collection-detail"\n            [ngClass]="\'depth-\' + depth"\n            [class.active]="collection.id === activeCollectionId"\n        >\n            <div class="name">\n                <button\n                    class="icon-button folder-button"\n                    [disabled]="expandAll"\n                    *ngIf="collection.children?.length; else folderSpacer"\n                    (click)="collection.expanded = !collection.expanded"\n                >\n                    <clr-icon shape="folder" *ngIf="!collection.expanded && !expandAll"></clr-icon>\n                    <clr-icon shape="folder-open" *ngIf="collection.expanded || expandAll"></clr-icon>\n                </button>\n                <ng-template #folderSpacer>\n                    <div class="folder-button-spacer"></div>\n                </ng-template>\n                {{ collection.name }}\n            </div>\n            <div class="flex-spacer"></div>\n            <vdr-chip *ngIf="collection.isPrivate">{{ \'catalog.private\' | translate }}</vdr-chip>\n            <a\n                class="btn btn-link btn-sm"\n                [routerLink]="[\'./\', { contents: collection.id }]"\n                queryParamsHandling="preserve"\n            >\n                <clr-icon shape="view-list"></clr-icon>\n                {{ \'catalog.view-contents\' | translate }}\n            </a>\n            <a class="btn btn-link btn-sm" [routerLink]="[\'/catalog/collections/\', collection.id]">\n                <clr-icon shape="edit"></clr-icon>\n                {{ \'common.edit\' | translate }}\n            </a>\n            <div class="drag-handle" cdkDragHandle *vdrIfPermissions="[\'UpdateCatalog\', \'UpdateCollection\']">\n                <clr-icon shape="drag-handle" size="24"></clr-icon>\n            </div>\n            <vdr-dropdown>\n                <button class="icon-button" vdrDropdownTrigger>\n                    <clr-icon shape="ellipsis-vertical"></clr-icon>\n                </button>\n                <vdr-dropdown-menu vdrPosition="bottom-right">\n                    <a\n                        class="dropdown-item"\n                        [routerLink]="[\'./\', \'create\', { parentId: collection.id }]"\n                        *vdrIfPermissions="[\'CreateCatalog\', \'CreateCollection\']"\n                    >\n                        <clr-icon shape="plus"></clr-icon>\n                        {{ \'catalog.create-new-collection\' | translate }}\n                    </a>\n                    <div class="dropdown-divider"></div>\n                    <button\n                        type="button"\n                        vdrDropdownItem\n                        [disabled]="i === 0 || !(hasUpdatePermission$ | async)"\n                        (click)="moveUp(collection, i)"\n                    >\n                        <clr-icon shape="caret up"></clr-icon>\n                        {{ \'catalog.move-up\' | translate }}\n                    </button>\n                    <button\n                        type="button"\n                        vdrDropdownItem\n                        [disabled]="\n                            i === collectionTree.children.length - 1 || !(hasUpdatePermission$ | async)\n                        "\n                        (click)="moveDown(collection, i)"\n                    >\n                        <clr-icon shape="caret down"></clr-icon>\n                        {{ \'catalog.move-down\' | translate }}\n                    </button>\n                    <h4 class="dropdown-header">{{ \'catalog.move-to\' | translate }}</h4>\n                    <button\n                        type="button"\n                        vdrDropdownItem\n                        *ngFor="let item of getMoveListItems(collection)"\n                        (click)="move(collection, item.id)"\n                        [disabled]="!(hasUpdatePermission$ | async)"\n                    >\n                        <clr-icon shape="child-arrow"></clr-icon>\n                        {{ item.path }}\n                    </button>\n                    <div class="dropdown-divider"></div>\n                    <button\n                        class="button"\n                        vdrDropdownItem\n                        (click)="delete(collection.id)"\n                        [disabled]="!(hasDeletePermission$ | async)"\n                    >\n                        <clr-icon shape="trash" class="is-danger"></clr-icon>\n                        {{ \'common.delete\' | translate }}\n                    </button>\n                </vdr-dropdown-menu>\n            </vdr-dropdown>\n        </div>\n        <vdr-collection-tree-node\n            *ngIf="collection.expanded || expandAll"\n            [expandAll]="expandAll"\n            [collectionTree]="collection"\n            [activeCollectionId]="activeCollectionId"\n        ></vdr-collection-tree-node>\n    </div>\n</div>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[":host{display:block}.collection{background-color:var(--color-component-bg-100);font-size:.65rem;transition:transform .25s cubic-bezier(0,0,.2,1);margin-bottom:2px;border-left:2px solid transparent;transition:border-left-color .2s}.collection.private{background-color:var(--color-component-bg-200)}.collection .collection-detail{padding:6px 12px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--color-component-border-100)}.collection .collection-detail.active{background-color:var(--clr-global-selection-color)}.collection .collection-detail.depth-1{padding-left:36px}.collection .collection-detail.depth-2{padding-left:60px}.collection .collection-detail.depth-3{padding-left:84px}.collection .collection-detail.depth-4{padding-left:108px}.collection .collection-detail .folder-button-spacer{display:inline-block;width:28px}.tree-node{display:block;background:var(--color-component-bg-100);overflow:hidden}.tree-node.cdk-drop-list-dragging>.collection{border-left-color:var(--color-primary-300)}.drag-placeholder{min-height:120px;background-color:var(--color-component-bg-300);transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-preview{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.cdk-drag-placeholder{opacity:0}.cdk-drag-animating,.example-list.cdk-drop-list-dragging .tree-node:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]}]}],se.ctorParameters=function(){return[{type:se,decorators:[{type:t.SkipSelf},{type:t.Optional}]},{type:ie},{type:a.DataService}]},se.propDecorators={collectionTree:[{type:t.Input}],activeCollectionId:[{type:t.Input}],expandAll:[{type:t.Input}]};var ce="__DEFAULT_VARIANT__",le=function(){function e(e){this.dataService=e,this.variantsChange=new t.EventEmitter,this.optionGroups=[],this.variantFormValues={}}return e.prototype.ngOnInit=function(){var e=this;this.dataService.settings.getActiveChannel().single$.subscribe((function(t){e.currencyCode=t.activeChannel.currencyCode})),this.generateVariants()},e.prototype.addOption=function(){this.optionGroups.push({name:"",values:[]})},e.prototype.removeOption=function(e){this.optionGroups=this.optionGroups.filter((function(t){return t.name!==e})),this.generateVariants()},e.prototype.generateVariants=function(){var e=this,t=this.optionGroups.reduce((function(e,t){return e+t.values.length}),0)?this.optionGroups.map((function(e){return e.values.map((function(e){return e.name}))})):[[ce]];this.variants=l.generateAllCombinations(t).map((function(e){return{id:e.join("|"),values:e}})),this.variants.forEach((function(t){e.variantFormValues[t.id]||(e.variantFormValues[t.id]={optionValues:t.values,enabled:!0,price:e.copyFromDefault(t.id,"price",0),sku:e.copyFromDefault(t.id,"sku",""),stock:e.copyFromDefault(t.id,"stock",0)})})),this.onFormChange()},e.prototype.trackByFn=function(e,t){return t.values.join("|")},e.prototype.handleEnter=function(e,t){e.preventDefault(),e.stopPropagation(),t.focus()},e.prototype.onFormChange=function(){var e=this,t=this.variants.map((function(t){return e.variantFormValues[t.id]})).filter((function(e){return e.enabled}));this.variantsChange.emit({groups:this.optionGroups.map((function(e){return{name:e.name,values:e.values.map((function(e){return e.name}))}})),variants:t})},e.prototype.copyFromDefault=function(e,t,n){return e!==ce?this.variantFormValues.__DEFAULT_VARIANT__[t]:n},e}();le.decorators=[{type:t.Component,args:[{selector:"vdr-generate-product-variants",template:'<div *ngFor="let group of optionGroups" class="option-groups">\n    <div class="name">\n        <label>{{ \'catalog.option\' | translate }}</label>\n        <input\n            placeholder="e.g. Size"\n            clrInput\n            [(ngModel)]="group.name"\n            name="name"\n            required\n            (keydown.enter)="handleEnter($event, optionValueInputComponent)"\n        />\n    </div>\n    <div class="values">\n        <label>{{ \'catalog.option-values\' | translate }}</label>\n        <vdr-option-value-input\n            #optionValueInputComponent\n            [(ngModel)]="group.values"\n            (ngModelChange)="generateVariants()"\n            [groupName]="group.name"\n            [disabled]="group.name === \'\'"\n        ></vdr-option-value-input>\n    </div>\n    <div class="remove-group">\n        <button\n            class="btn btn-icon btn-warning-outline"\n            [title]="\'catalog.remove-option\' | translate"\n            (click)="removeOption(group.name)"\n        >\n            <clr-icon shape="trash"></clr-icon>\n        </button>\n    </div>\n</div>\n<button class="btn btn-primary-outline btn-sm" (click)="addOption()">\n    <clr-icon shape="plus"></clr-icon>\n    {{ \'catalog.add-option\' | translate }}\n</button>\n\n<div class="variants-preview">\n    <table class="table">\n        <thead>\n            <tr>\n                <th *ngIf="1 < variants.length">{{ \'common.create\' | translate }}</th>\n                <th *ngIf="1 < variants.length">{{ \'catalog.variant\' | translate }}</th>\n                <th>{{ \'catalog.sku\' | translate }}</th>\n                <th>{{ \'catalog.price\' | translate }}</th>\n                <th>{{ \'catalog.stock-on-hand\' | translate }}</th>\n            </tr>\n        </thead>\n        <tr\n            *ngFor="let variant of variants; trackBy: trackByFn"\n            [class.disabled]="!variantFormValues[variant.id].enabled"\n        >\n            <td *ngIf="1 < variants.length">\n                <input\n                    type="checkbox"\n                    (change)="onFormChange()"\n                    [(ngModel)]="variantFormValues[variant.id].enabled"\n                    clrCheckbox\n                />\n            </td>\n            <td *ngIf="1 < variants.length">\n                {{ variant.values.join(\' \') }}\n            </td>\n            <td>\n                <clr-input-container>\n                    <input\n                        clrInput\n                        type="text"\n                        (change)="onFormChange()"\n                        [(ngModel)]="variantFormValues[variant.id].sku"\n                        [placeholder]="\'catalog.sku\' | translate"\n                    />\n                </clr-input-container>\n            </td>\n            <td>\n                <clr-input-container>\n                    <vdr-currency-input\n                        clrInput\n                        [(ngModel)]="variantFormValues[variant.id].price"\n                        (ngModelChange)="onFormChange()"\n                        [currencyCode]="currencyCode"\n                    ></vdr-currency-input>\n                </clr-input-container>\n            </td>\n            <td>\n                <clr-input-container>\n                    <input\n                        clrInput\n                        type="number"\n                        [(ngModel)]="variantFormValues[variant.id].stock"\n                        (change)="onFormChange()"\n                        min="0"\n                        step="1"\n                    />\n                </clr-input-container>\n            </td>\n        </tr>\n    </table>\n</div>\n',styles:[":host{display:block;margin-bottom:120px}.option-groups{display:flex}.values{flex:1;margin:0 6px}.remove-group{padding-top:18px}.variants-preview tr.disabled td{background-color:var(--color-component-bg-100);color:var(--color-grey-400)}"]}]}],le.ctorParameters=function(){return[{type:a.DataService}]},le.propDecorators={variantsChange:[{type:t.Output}]};var de={provide:i.NG_VALUE_ACCESSOR,useExisting:t.forwardRef((function(){return ue})),multi:!0},ue=function(){function e(e){this.changeDetector=e,this.groupName="",this.disabled=!1,this.input="",this.isFocussed=!1,this.lastSelected=!1}return e.prototype.registerOnChange=function(e){this.onChangeFn=e},e.prototype.registerOnTouched=function(e){this.onTouchFn=e},e.prototype.setDisabledState=function(e){this.disabled=e,this.changeDetector.markForCheck()},e.prototype.writeValue=function(e){this.options=e||[]},e.prototype.focus=function(){this.textArea.nativeElement.focus()},e.prototype.removeOption=function(e){e.locked||(this.options=this.options.filter((function(t){return t.name!==e.name})),this.onChangeFn(this.options))},e.prototype.handleKey=function(e){switch(e.key){case",":case"Enter":this.addOptionValue(),e.preventDefault();break;case"Backspace":this.lastSelected?(this.removeLastOption(),this.lastSelected=!1):""===this.input&&(this.lastSelected=!0);break;default:this.lastSelected=!1}},e.prototype.handleBlur=function(){this.isFocussed=!1,this.addOptionValue()},e.prototype.addOptionValue=function(){this.options=p.unique(I(this.options,this.parseInputIntoOptions(this.input))),this.input="",this.onChangeFn(this.options)},e.prototype.parseInputIntoOptions=function(e){return e.split(/[,\n]/).map((function(e){return e.trim()})).filter((function(e){return""!==e})).map((function(e){return{name:e,locked:!1}}))},e.prototype.removeLastOption=function(){this.options[this.options.length-1].locked||(this.options=this.options.slice(0,this.options.length-1))},e}();ue.decorators=[{type:t.Component,args:[{selector:"vdr-option-value-input",template:'<div class="input-wrapper" [class.focus]="isFocussed" (click)="textArea.focus()">\n    <div class="chips" *ngIf="0 < options.length">\n        <vdr-chip\n            *ngFor="let option of options; last as isLast"\n            [icon]="option.locked ? \'lock\' : \'times\'"\n            [class.selected]="isLast && lastSelected"\n            [class.locked]="option.locked"\n            [colorFrom]="groupName"\n            (iconClick)="removeOption(option)"\n        >\n            {{ option.name }}\n        </vdr-chip>\n    </div>\n    <textarea\n        #textArea\n        (keyup)="handleKey($event)"\n        (focus)="isFocussed = true"\n        (blur)="handleBlur()"\n        [(ngModel)]="input"\n        [disabled]="disabled"\n    ></textarea>\n</div>\n',changeDetection:t.ChangeDetectionStrategy.Default,providers:[de],styles:[".input-wrapper{background-color:#fff;border-radius:3px!important;border:1px solid var(--color-grey-300)!important;cursor:text}.input-wrapper.focus{border-color:var(--color-primary-500)!important;box-shadow:0 0 1px 1px var(--color-primary-100)}.input-wrapper .chips{padding:5px}.input-wrapper textarea{border:none;width:100%;height:24px;margin-top:3px;padding:0 6px}.input-wrapper textarea:focus{outline:none}.input-wrapper textarea:disabled{background-color:var(--color-component-bg-100)}vdr-chip ::ng-deep .wrapper{margin:0 3px}vdr-chip.locked{opacity:.8}vdr-chip.selected ::ng-deep .wrapper{border-color:var(--color-warning-500)!important;box-shadow:0 0 1px 1px var(--color-warning-400);opacity:.6}"]}]}],ue.ctorParameters=function(){return[{type:t.ChangeDetectorRef}]},ue.propDecorators={groupName:[{type:t.Input}],textArea:[{type:t.ViewChild,args:["textArea",{static:!0}]}]};var pe=function(){function e(e,n,r,o){var i=this;this.modalService=e,this.changeDetector=n,this.viewportRuler=r,this.collectionDetailComponent=o,this.compact=!1,this.change=new t.EventEmitter,this.assets=[],this.updateCollectionPermissions=[a.Permission.UpdateCatalog,a.Permission.UpdateCollection],this.updateProductPermissions=[a.Permission.UpdateCatalog,a.Permission.UpdateProduct],this.dropListEnterPredicate=function(e,t){if(t===i.placeholder)return!0;if(t!==i.activeContainer)return!1;var n=i.placeholder.element.nativeElement,a=e.dropContainer.element.nativeElement,r=t.element.nativeElement,o=r.parentElement&&r.parentElement.children,s=me(o,i.source?n:a),c=me(o,r);return i.source||(i.sourceIndex=s,i.source=e.dropContainer,n.style.width=a.clientWidth+"px",n.style.height=a.clientHeight+"px",a.parentElement&&a.parentElement.removeChild(a)),i.targetIndex=c,i.target=t,n.style.display="",r.parentElement&&r.parentElement.insertBefore(n,c>s?r.nextSibling:r),i.placeholder._dropListRef.enter(e._dragRef,e.element.nativeElement.offsetLeft,e.element.nativeElement.offsetTop),!1}}return Object.defineProperty(e.prototype,"assetsSetter",{set:function(e){this.assets=e.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updatePermissions",{get:function(){return this.collectionDetailComponent?this.updateCollectionPermissions:this.updateProductPermissions},enumerable:!1,configurable:!0}),e.prototype.ngAfterViewInit=function(){var e=this.placeholder.element.nativeElement;e.style.display="none",e.parentElement&&e.parentElement.removeChild(e)},e.prototype.selectAssets=function(){var e=this;this.modalService.fromComponent(a.AssetPickerDialogComponent,{size:"xl"}).subscribe((function(t){t&&t.length&&(e.assets=p.unique(e.assets.concat(t),"id"),e.featuredAsset||(e.featuredAsset=t[0]),e.emitChangeEvent(e.assets,e.featuredAsset),e.changeDetector.markForCheck())}))},e.prototype.setAsFeatured=function(e){this.featuredAsset=e,this.emitChangeEvent(this.assets,e)},e.prototype.isFeatured=function(e){return!!this.featuredAsset&&this.featuredAsset.id===e.id},e.prototype.previewAsset=function(e){this.modalService.fromComponent(a.AssetPreviewDialogComponent,{size:"xl",closable:!0,locals:{asset:e}}).subscribe()},e.prototype.removeAsset=function(e){this.assets=this.assets.filter((function(t){return t.id!==e.id})),this.featuredAsset&&this.featuredAsset.id===e.id&&(this.featuredAsset=this.assets.length>0?this.assets[0]:void 0),this.emitChangeEvent(this.assets,this.featuredAsset)},e.prototype.emitChangeEvent=function(e,t){this.change.emit({assets:e,featuredAsset:t})},e.prototype.dragMoved=function(e){var t=this,n=this.getPointerPositionOnPage(e.event);this.listGroup._items.forEach((function(e){(function(e,t,n){var a=e.element.nativeElement.getBoundingClientRect(),r=a.top,o=a.bottom,i=a.left,s=a.right;return n>=r&&n<=o&&t>=i&&t<=s})(e,n.x,n.y)&&(t.activeContainer=e)}))},e.prototype.dropListDropped=function(){if(this.target&&this.source){var e=this.placeholder.element.nativeElement,t=e.parentElement;e.style.display="none",t.removeChild(e),t.appendChild(e),t.insertBefore(this.source.element.nativeElement,t.children[this.sourceIndex]),this.target=null,this.source=null,this.sourceIndex!==this.targetIndex&&(g.moveItemInArray(this.assets,this.sourceIndex,this.targetIndex),this.emitChangeEvent(this.assets,this.featuredAsset))}},e.prototype.getPointerPositionOnPage=function(e){var t=function(e){return e.type.startsWith("touch")}(e)?e.touches[0]||e.changedTouches[0]:e,n=this.viewportRuler.getViewportScrollPosition();return{x:t.pageX-n.left,y:t.pageY-n.top}},e}();function me(e,t){return e?Array.prototype.indexOf.call(e,t):-1}pe.decorators=[{type:t.Component,args:[{selector:"vdr-product-assets",template:'<div class="card" *ngIf="!compact; else compactView">\n    <div class="card-img">\n        <div class="featured-asset">\n            <img\n                *ngIf="featuredAsset"\n                [src]="featuredAsset | assetPreview:\'small\'"\n                (click)="previewAsset(featuredAsset)"\n            />\n            <div class="placeholder" *ngIf="!featuredAsset" (click)="selectAssets()">\n                <clr-icon shape="image" size="128"></clr-icon>\n                <div>{{ \'catalog.no-featured-asset\' | translate }}</div>\n            </div>\n        </div>\n    </div>\n    <div class="card-block"><ng-container *ngTemplateOutlet="assetList"></ng-container></div>\n    <div class="card-footer" *vdrIfPermissions="updatePermissions">\n        <button class="btn" (click)="selectAssets()">\n            <clr-icon shape="attachment"></clr-icon>\n            {{ \'asset.add-asset\' | translate }}\n        </button>\n    </div>\n</div>\n\n<ng-template #compactView>\n    <div class="featured-asset compact">\n        <img\n            *ngIf="featuredAsset"\n            [src]="featuredAsset | assetPreview:\'thumb\'"\n            (click)="previewAsset(featuredAsset)"\n        />\n\n        <div class="placeholder" *ngIf="!featuredAsset" (click)="selectAssets()"><clr-icon shape="image" size="150"></clr-icon></div>\n    </div>\n    <ng-container *ngTemplateOutlet="assetList"></ng-container>\n    <button\n        *vdrIfPermissions="updatePermissions"\n        class="compact-select btn btn-icon btn-sm btn-block"\n        [title]="\'asset.add-asset\' | translate"\n        (click)="selectAssets()"\n    >\n        <clr-icon shape="attachment"></clr-icon>\n        {{ \'asset.add-asset\' | translate }}\n    </button>\n</ng-template>\n\n<ng-template #assetList>\n    <div class="all-assets" [class.compact]="compact" cdkDropListGroup #dlg>\n        <div\n            cdkDropList\n            #dl\n            [cdkDropListDisabled]="!(updatePermissions | hasPermission)"\n            [cdkDropListEnterPredicate]="dropListEnterPredicate"\n            (cdkDropListDropped)="dropListDropped()"\n        ></div>\n        <div\n            *ngFor="let asset of assets"\n            cdkDropList\n            [cdkDropListDisabled]="!(updatePermissions | hasPermission)"\n            [cdkDropListEnterPredicate]="dropListEnterPredicate"\n            (cdkDropListDropped)="dropListDropped()"\n        >\n            <vdr-dropdown cdkDrag (cdkDragMoved)="dragMoved($event)">\n                <div\n                    class="asset-thumb"\n                    vdrDropdownTrigger\n                    [class.featured]="isFeatured(asset)"\n                    [title]=""\n                    tabindex="0"\n                >\n                    <img [src]="asset | assetPreview:\'tiny\'" />\n                </div>\n                <vdr-dropdown-menu vdrPosition="bottom-right">\n                    <button type="button" vdrDropdownItem (click)="previewAsset(asset)">\n                        {{ \'asset.preview\' | translate }}\n                    </button>\n                    <button\n                        type="button"\n                        [disabled]="isFeatured(asset) || !(updatePermissions | hasPermission)"\n                        vdrDropdownItem\n                        (click)="setAsFeatured(asset)"\n                    >\n                        {{ \'asset.set-as-featured-asset\' | translate }}\n                    </button>\n                    <div class="dropdown-divider"></div>\n                    <button\n                        type="button"\n                        class="remove-asset"\n                        vdrDropdownItem\n                        [disabled]="!(updatePermissions | hasPermission)"\n                        (click)="removeAsset(asset)"\n                    >\n                        {{ \'asset.remove-asset\' | translate }}\n                    </button>\n                </vdr-dropdown-menu>\n            </vdr-dropdown>\n        </div>\n    </div>\n</ng-template>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[":host{width:340px;display:block}:host.compact{width:162px}.placeholder{text-align:center;color:var(--color-grey-300)}.featured-asset{text-align:center;background:var(--color-component-bg-200);padding:6px;cursor:pointer}.featured-asset.compact{width:100%;min-height:40px;position:relative;padding:6px}.featured-asset .compact-select{position:absolute;bottom:6px;right:6px;margin:0}.all-assets{display:flex;flex-wrap:wrap}.all-assets .asset-thumb{margin:3px;padding:0;border:2px solid var(--color-component-border-100);cursor:pointer}.all-assets .asset-thumb.featured{border-color:var(--color-primary-500)}.all-assets .remove-asset{color:var(--color-warning-500)}.all-assets.compact .asset-thumb{margin:1px;border-width:1px}.cdk-drag-preview{display:flex;align-items:center;justify-content:center;width:50px;background-color:var(--color-component-bg-100);opacity:.9;box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.cdk-drag-placeholder{opacity:.8;width:60px;height:50px}.cdk-drag-placeholder .asset-thumb{background-color:var(--color-component-bg-300);height:100%;width:54px}.cdk-drag-placeholder img{display:none}.all-assets.compact .cdk-drag-placeholder,.all-assets.compact .cdk-drag-placeholder .asset-thumb{width:50px}.cdk-drag-animating{transition:transform .25s cubic-bezier(0,0,.2,1)}.example-box:last-child{border:none}.all-assets.cdk-drop-list-dragging vdr-dropdown:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]}]}],pe.ctorParameters=function(){return[{type:a.ModalService},{type:t.ChangeDetectorRef},{type:v.ViewportRuler},{type:w,decorators:[{type:t.Optional}]}]},pe.propDecorators={assetsSetter:[{type:t.Input,args:["assets"]}],featuredAsset:[{type:t.Input}],compact:[{type:t.HostBinding,args:["class.compact"]},{type:t.Input}],change:[{type:t.Output}],listGroup:[{type:t.ViewChild,args:["dlg",{static:!1,read:g.CdkDropListGroup}]}],placeholder:[{type:t.ViewChild,args:["dl",{static:!1,read:g.CdkDropList}]}]};var ge=a.SingleSearchSelectionModelFactory,ve=function(){function e(){var e=this;this.searchTermChange=new t.EventEmitter,this.facetValueChange=new t.EventEmitter,this.lastTerm="",this.lastFacetValueIds=[],this.filterFacetResults=function(t,n){return!!e.isFacetValueItem(n)&&(n.facetValue.name.toLowerCase().startsWith(t.toLowerCase())||n.facetValue.facet.name.toLowerCase().startsWith(t.toLowerCase()))},this.isFacetValueItem=function(e){return"object"==typeof e&&!!e&&e.hasOwnProperty("facetValue")}}return e.prototype.setSearchTerm=function(e){var t=this;if(e)this.selectComponent.select({label:e,value:{label:e}});else{var n=this.selectComponent.selectedItems.find((function(e){return!t.isFacetValueItem(e.value)}));n&&this.selectComponent.unselect(n)}},e.prototype.setFacetValues=function(e){var t=this,n=this.selectComponent.items;this.selectComponent.selectedItems.forEach((function(n){t.isFacetValueItem(n.value)&&!e.includes(n.value.facetValue.id)&&t.selectComponent.unselect(n)})),e.map((function(e){return n.find((function(n){return t.isFacetValueItem(n)&&n.facetValue.id===e}))})).filter(l.notNullOrUndefined).forEach((function(e){t.selectComponent.selectedItems.find((function(n){var a=n.value;return!!t.isFacetValueItem(a)&&a.facetValue.id===e.facetValue.id}))||t.selectComponent.select({label:"",value:e})}))},e.prototype.onSelectChange=function(e){var t=this;Array.isArray(e)||(e=[e]);var n=e.find((function(e){return!t.isFacetValueItem(e)})),a=n?n.label:"",r=e.filter(this.isFacetValueItem).map((function(e){return e.facetValue.id}));a!==this.lastTerm&&(this.searchTermChange.emit(a),this.lastTerm=a),this.lastFacetValueIds.join(",")!==r.join(",")&&(this.facetValueChange.emit(r),this.lastFacetValueIds=r)},e.prototype.addTagFn=function(e){return{label:e}},e.prototype.isSearchHeaderSelected=function(){return-1===this.selectComponent.itemsList.markedIndex},e}();ve.decorators=[{type:t.Component,args:[{selector:"vdr-product-search-input",template:'<ng-select\n    [addTag]="addTagFn"\n    [placeholder]="\'catalog.search-product-name-or-code\' | translate"\n    [items]="facetValueResults"\n    [searchFn]="filterFacetResults"\n    [hideSelected]="true"\n    [multiple]="true"\n    [markFirst]="false"\n    (change)="onSelectChange($event)"\n    #selectComponent\n>\n    <ng-template ng-header-tmp>\n        <div\n            class="search-header"\n            *ngIf="selectComponent.searchTerm"\n            [class.selected]="isSearchHeaderSelected()"\n            (click)="selectComponent.selectTag()"\n        >\n            {{ \'catalog.search-for-term\' | translate }}: {{ selectComponent.searchTerm }}\n        </div>\n    </ng-template>\n    <ng-template ng-label-tmp let-item="item" let-clear="clear">\n        <ng-container *ngIf="item.facetValue">\n            <vdr-facet-value-chip\n                [facetValue]="item.facetValue"\n                [removable]="true"\n                (remove)="clear(item)"\n            ></vdr-facet-value-chip>\n        </ng-container>\n        <ng-container *ngIf="!item.facetValue">\n            <vdr-chip [icon]="\'times\'" (iconClick)="clear(item)">"{{ item.label }}"</vdr-chip>\n        </ng-container>\n    </ng-template>\n    <ng-template ng-option-tmp let-item="item" let-index="index" let-search="searchTerm">\n        <ng-container *ngIf="item.facetValue">\n            <vdr-facet-value-chip [facetValue]="item.facetValue" [removable]="false"></vdr-facet-value-chip>\n        </ng-container>\n    </ng-template>\n</ng-select>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,providers:[{provide:f.SELECTION_MODEL_FACTORY,useValue:ge}],styles:[":host{margin-top:6px;display:block;width:100%}:host ::ng-deep .ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-value{background:none;margin:0}:host ::ng-deep .ng-dropdown-panel-items div.ng-option:last-child{display:none}:host ::ng-deep .ng-dropdown-panel .ng-dropdown-header{border:none;padding:0}:host ::ng-deep .ng-select.ng-select-multiple .ng-select-container .ng-value-container{padding:0}:host ::ng-deep .ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-placeholder{padding-left:8px}ng-select{width:100%;min-width:300px;margin-right:12px}.search-header{padding:8px 10px;border-bottom:1px solid var(--color-component-border-100);cursor:pointer}.search-header.selected,.search-header:hover{background-color:var(--color-component-bg-200)}"]}]}],ve.propDecorators={facetValueResults:[{type:t.Input}],searchTermChange:[{type:t.Output}],facetValueChange:[{type:t.Output}],selectComponent:[{type:t.ViewChild,args:["selectComponent",{static:!0}]}]};var fe=function(){function e(){this.updateVariantName=!0,this.codeInputTouched=!1}return e.prototype.ngOnInit=function(){var e,t,n,a=this,r=this.productOption.translations.find((function(e){return e.languageCode===a.activeLanguage}));if(this.name=null!==(n=null==r?void 0:r.name)&&void 0!==n?n:"",this.code=this.productOption.code,this.customFieldsForm=new i.FormGroup({}),this.customFields){var o=r&&r.customFields||{};try{for(var s=F(this.customFields),c=s.next();!c.done;c=s.next()){var l=c.value,d=l.name,u="localeString"===l.type?o[d]:this.productOption.customFields[d];this.customFieldsForm.addControl(l.name,new i.FormControl(u))}}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}}},e.prototype.update=function(){var e=a.createUpdatedTranslatable({translatable:this.productOption,languageCode:this.activeLanguage,updatedFields:{code:this.code,name:this.name,customFields:this.customFieldsForm.value},customFieldConfig:this.customFields,defaultTranslation:{languageCode:this.activeLanguage,name:""}});this.resolveWith(Object.assign(Object.assign({},e),{autoUpdate:this.updateVariantName}))},e.prototype.cancel=function(){this.resolveWith()},e.prototype.updateCode=function(e){this.codeInputTouched||this.productOption.code||(this.code=c.normalizeString(e,"-"))},e}();fe.decorators=[{type:t.Component,args:[{selector:"vdr-update-product-option-dialog",template:'<ng-template vdrDialogTitle>{{ \'catalog.update-product-option\' | translate }}</ng-template>\n<vdr-form-field [label]="\'catalog.option-name\' | translate" for="name">\n    <input\n        id="name"\n        type="text"\n        #nameInput="ngModel"\n        [(ngModel)]="name"\n        required\n        (input)="updateCode($event.target.value)"\n    />\n</vdr-form-field>\n<vdr-form-field [label]="\'common.code\' | translate" for="code">\n    <input id="code" type="text" #codeInput="ngModel" required [(ngModel)]="code" pattern="[a-z0-9_-]+" />\n</vdr-form-field>\n<clr-checkbox-wrapper>\n    <input type="checkbox" clrCheckbox [(ngModel)]="updateVariantName" />\n    <label>{{ \'catalog.auto-update-option-variant-name\' | translate }}</label>\n</clr-checkbox-wrapper>\n<section *ngIf="customFields.length">\n    <label>{{ \'common.custom-fields\' | translate }}</label>\n    <ng-container *ngFor="let customField of customFields">\n        <vdr-custom-field-control\n            *ngIf="customFieldsForm.get(customField.name)"\n            entityName="ProductOption"\n            [customFieldsFormGroup]="customFieldsForm"\n            [customField]="customField"\n            [readonly]="!([\'UpdateCatalog\', \'UpdateProduct\'] | hasPermission)"\n        ></vdr-custom-field-control>\n    </ng-container>\n</section>\n\n<ng-template vdrDialogButtons>\n    <button type="button" class="btn" (click)="cancel()">{{ \'common.cancel\' | translate }}</button>\n    <button\n        type="submit"\n        (click)="update()"\n        [disabled]="\n            nameInput.invalid ||\n            codeInput.invalid ||\n            (nameInput.pristine && codeInput.pristine && customFieldsForm.pristine)\n        "\n        class="btn btn-primary"\n    >\n        {{ \'catalog.update-product-option\' | translate }}\n    </button>\n</ng-template>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[""]}]}];var he=function(){function e(e,n,r){this.changeDetector=e,this.modalService=n,this.dataService=r,this.assignToChannel=new t.EventEmitter,this.removeFromChannel=new t.EventEmitter,this.assetChange=new t.EventEmitter,this.selectionChange=new t.EventEmitter,this.selectFacetValueClick=new t.EventEmitter,this.updateProductOption=new t.EventEmitter,this.selectedVariantIds=[],this.pagination={currentPage:1,itemsPerPage:10},this.formGroupMap=new Map,this.GlobalFlag=a.GlobalFlag,this.updatePermission=[a.Permission.UpdateCatalog,a.Permission.UpdateProduct]}return e.prototype.ngOnInit=function(){var e=this;this.dataService.settings.getGlobalSettings("cache-first").single$.subscribe((function(t){var n=t.globalSettings;e.globalTrackInventory=n.trackInventory,e.globalOutOfStockThreshold=n.outOfStockThreshold,e.changeDetector.markForCheck()})),this.subscription=this.formArray.valueChanges.subscribe((function(){return e.changeDetector.markForCheck()})),this.subscription.add(this.formArray.valueChanges.pipe(o.map((function(e){return e.length})),o.debounceTime(1),o.distinctUntilChanged()).subscribe((function(){e.buildFormGroupMap()}))),this.buildFormGroupMap()},e.prototype.ngOnChanges=function(e){var t,n;"facets"in e&&e.facets.currentValue&&(this.facetValues=a.flattenFacetValues(this.facets)),"variants"in e&&(null===(t=e.variants.currentValue)||void 0===t?void 0:t.length)!==(null===(n=e.variants.previousValue)||void 0===n?void 0:n.length)&&(this.pagination.currentPage=1)},e.prototype.ngOnDestroy=function(){this.subscription&&this.subscription.unsubscribe()},e.prototype.isDefaultChannel=function(e){return e===u.DEFAULT_CHANNEL_CODE},e.prototype.trackById=function(e,t){return t.id},e.prototype.inventoryIsNotTracked=function(e){var t,n=null===(t=e.get("trackInventory"))||void 0===t?void 0:t.value;return n===a.GlobalFlag.FALSE||n===a.GlobalFlag.INHERIT&&!1===this.globalTrackInventory},e.prototype.getTaxCategoryName=function(e){var t=e.get(["taxCategoryId"]);if(t&&this.taxCategories){var n=this.taxCategories.find((function(e){return e.id===t.value}));return n?n.name:""}return""},e.prototype.getSaleableStockLevel=function(e){var t=e.useGlobalOutOfStockThreshold?this.globalOutOfStockThreshold:e.outOfStockThreshold;return e.stockOnHand-e.stockAllocated-t},e.prototype.areAllSelected=function(){return!!this.variants&&this.selectedVariantIds.length===this.variants.length},e.prototype.onAssetChange=function(e,t){this.assetChange.emit(Object.assign({variantId:e},t));var n=this.variants.findIndex((function(t){return t.id===e}));this.formArray.at(n).markAsDirty()},e.prototype.toggleSelectAll=function(){this.areAllSelected()?this.selectedVariantIds=[]:this.selectedVariantIds=this.variants.map((function(e){return e.id})),this.selectionChange.emit(this.selectedVariantIds)},e.prototype.toggleSelectVariant=function(e){var t=this.selectedVariantIds.indexOf(e);-1<t?this.selectedVariantIds.splice(t,1):this.selectedVariantIds.push(e),this.selectionChange.emit(this.selectedVariantIds)},e.prototype.optionGroupName=function(e){var t,n=this,a=this.optionGroups.find((function(t){return t.id===e}));if(a)return(null!==(t=null==a?void 0:a.translations.find((function(e){return e.languageCode===n.activeLanguage})))&&void 0!==t?t:a.translations[0]).name},e.prototype.optionName=function(e){var t,n=this;return(null!==(t=e.translations.find((function(e){return e.languageCode===n.activeLanguage})))&&void 0!==t?t:e.translations[0]).name},e.prototype.pendingFacetValues=function(e){var t=this;if(this.facets){var n=this.getFacetValueIds(e.id),a=e.facetValues.map((function(e){return e.id}));return n.filter((function(e){return!a.includes(e)})).map((function(e){return t.facetValues.find((function(t){return t.id===e}))})).filter(l.notNullOrUndefined)}return[]},e.prototype.existingFacetValues=function(e){return I(this.getFacetValueIds(e.id)).filter((function(t){return e.facetValues.map((function(e){return e.id})).includes(t)})).map((function(t){return e.facetValues.find((function(e){return e.id===t}))})).filter(l.notNullOrUndefined)},e.prototype.removeFacetValue=function(e,t){var n=this.formGroupMap.get(e.id);if(n){var a=n.value.facetValueIds.filter((function(e){return e!==t}));n.patchValue({facetValueIds:a}),n.markAsDirty()}},e.prototype.isVariantSelected=function(e){return-1<this.selectedVariantIds.indexOf(e)},e.prototype.editOption=function(e){var t=this;this.modalService.fromComponent(fe,{size:"md",locals:{productOption:e,activeLanguage:this.activeLanguage,customFields:this.customOptionFields}}).subscribe((function(e){e&&t.updateProductOption.emit(e)}))},e.prototype.buildFormGroupMap=function(){var e,t;this.formGroupMap.clear();try{for(var n=F(this.formArray.controls),a=n.next();!a.done;a=n.next()){var r=a.value;this.formGroupMap.set(r.value.id,r)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.changeDetector.markForCheck()},e.prototype.getFacetValueIds=function(e){var t;return(null===(t=this.formGroupMap.get(e))||void 0===t?void 0:t.value).facetValueIds},e}();he.decorators=[{type:t.Component,args:[{selector:"vdr-product-variants-list",template:'<div class="variants-list">\n    <div\n        class="variant-container card"\n        *ngFor="let variant of variants | paginate: pagination; trackBy: trackById; let i = index"\n        [class.disabled]="!formGroupMap.get(variant.id)?.get(\'enabled\')?.value"\n    >\n        <ng-container *ngIf="formGroupMap.get(variant.id) as formGroup" [formGroup]="formGroup">\n            <div class="card-block header-row">\n                <div class="details">\n                    <vdr-title-input class="sku" [readonly]="!(updatePermission | hasPermission)">\n                        <clr-input-container>\n                            <input\n                                clrInput\n                                type="text"\n                                formControlName="sku"\n                                [readonly]="!(updatePermission | hasPermission)"\n                                [placeholder]="\'catalog.sku\' | translate"\n                            />\n                        </clr-input-container>\n                    </vdr-title-input>\n                    <vdr-title-input class="name" [readonly]="!(updatePermission | hasPermission)">\n                        <clr-input-container>\n                            <input\n                                clrInput\n                                type="text"\n                                formControlName="name"\n                                [readonly]="!(updatePermission | hasPermission)"\n                                [placeholder]="\'common.name\' | translate"\n                            />\n                        </clr-input-container>\n                    </vdr-title-input>\n                </div>\n                <div class="right-controls">\n                    <clr-toggle-wrapper *vdrIfPermissions="updatePermission">\n                        <input type="checkbox" clrToggle name="enabled" formControlName="enabled" />\n                        <label>{{ \'common.enabled\' | translate }}</label>\n                    </clr-toggle-wrapper>\n                </div>\n            </div>\n            <div class="card-block">\n                <div class="variant-body">\n                    <div class="assets">\n                        <vdr-product-assets\n                            [compact]="true"\n                            [assets]="pendingAssetChanges[variant.id]?.assets || variant.assets"\n                            [featuredAsset]="pendingAssetChanges[variant.id]?.featuredAsset || variant.featuredAsset"\n                            (change)="onAssetChange(variant.id, $event)"\n                        ></vdr-product-assets>\n                    </div>\n                    <div class="variant-form-inputs">\n                        <div class="standard-fields">\n                            <div class="variant-form-input-row">\n                                <div class="tax-category">\n                                    <clr-select-container\n                                        *vdrIfPermissions="updatePermission; else taxCategoryLabel"\n                                    >\n                                        <label>{{ \'catalog.tax-category\' | translate }}</label>\n                                        <select clrSelect name="options" formControlName="taxCategoryId">\n                                            <option\n                                                *ngFor="let taxCategory of taxCategories"\n                                                [value]="taxCategory.id"\n                                            >\n                                                {{ taxCategory.name }}\n                                            </option>\n                                        </select>\n                                    </clr-select-container>\n                                    <ng-template #taxCategoryLabel>\n                                        <label class="clr-control-label">{{\n                                            \'catalog.tax-category\' | translate\n                                        }}</label>\n                                        <div class="tax-category-label">\n                                            {{ getTaxCategoryName(formGroup) }}\n                                        </div>\n                                    </ng-template>\n                                </div>\n                                <div class="price">\n                                    <clr-input-container>\n                                        <label>{{ \'catalog.price\' | translate }}</label>\n                                        <vdr-currency-input\n                                            *ngIf="!channelPriceIncludesTax"\n                                            clrInput\n                                            [currencyCode]="variant.currencyCode"\n                                            [readonly]="!(updatePermission | hasPermission)"\n                                            formControlName="price"\n                                        ></vdr-currency-input>\n                                        <vdr-currency-input\n                                            *ngIf="channelPriceIncludesTax"\n                                            clrInput\n                                            [currencyCode]="variant.currencyCode"\n                                            [readonly]="!(updatePermission | hasPermission)"\n                                            formControlName="priceWithTax"\n                                        ></vdr-currency-input>\n                                    </clr-input-container>\n                                </div>\n                                <vdr-variant-price-detail\n                                    [price]="formGroup.get(\'price\')!.value"\n                                    [currencyCode]="variant.currencyCode"\n                                    [priceIncludesTax]="channelPriceIncludesTax"\n                                    [taxCategoryId]="formGroup.get(\'taxCategoryId\')!.value"\n                                ></vdr-variant-price-detail>\n                            </div>\n                            <div class="variant-form-input-row">\n                                <clr-select-container *vdrIfPermissions="updatePermission">\n                                    <label\n                                        >{{ \'catalog.track-inventory\' | translate }}\n                                        <vdr-help-tooltip\n                                            [content]="\'catalog.track-inventory-tooltip\' | translate"\n                                        ></vdr-help-tooltip>\n                                    </label>\n                                    <select clrSelect name="options" formControlName="trackInventory">\n                                        <option [value]="GlobalFlag.TRUE">\n                                            {{ \'catalog.track-inventory-true\' | translate }}\n                                        </option>\n                                        <option [value]="GlobalFlag.FALSE">\n                                            {{ \'catalog.track-inventory-false\' | translate }}\n                                        </option>\n                                        <option [value]="GlobalFlag.INHERIT">\n                                            {{ \'catalog.track-inventory-inherit\' | translate }}\n                                        </option>\n                                    </select>\n                                </clr-select-container>\n                                <clr-input-container>\n                                    <label\n                                        >{{ \'catalog.stock-on-hand\' | translate }}\n                                        <vdr-help-tooltip\n                                            [content]="\'catalog.stock-on-hand-tooltip\' | translate"\n                                        ></vdr-help-tooltip\n                                    ></label>\n                                    <input\n                                        [class.inventory-untracked]="inventoryIsNotTracked(formGroup)"\n                                        clrInput\n                                        type="number"\n                                        min="0"\n                                        step="1"\n                                        formControlName="stockOnHand"\n                                        [readonly]="!(updatePermission | hasPermission)"\n                                        [vdrDisabled]="inventoryIsNotTracked(formGroup)"\n                                    />\n                                </clr-input-container>\n                                <div [class.inventory-untracked]="inventoryIsNotTracked(formGroup)">\n                                    <label class="clr-control-label"\n                                        >{{ \'catalog.stock-allocated\' | translate }}\n                                        <vdr-help-tooltip\n                                            [content]="\'catalog.stock-allocated-tooltip\' | translate"\n                                        ></vdr-help-tooltip\n                                    ></label>\n                                    <div class="value">\n                                        {{ variant.stockAllocated }}\n                                    </div>\n                                </div>\n                                <div [class.inventory-untracked]="inventoryIsNotTracked(formGroup)">\n                                    <label class="clr-control-label"\n                                        >{{ \'catalog.stock-saleable\' | translate }}\n                                        <vdr-help-tooltip\n                                            [content]="\'catalog.stock-saleable-tooltip\' | translate"\n                                        ></vdr-help-tooltip\n                                    ></label>\n                                    <div class="value">\n                                        {{ getSaleableStockLevel(variant) }}\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="variant-form-input-row">\n                                <div\n                                    class="out-of-stock-threshold-wrapper"\n                                    [class.inventory-untracked]="inventoryIsNotTracked(formGroup)"\n                                >\n                                    <label class="clr-control-label"\n                                        >{{ \'catalog.out-of-stock-threshold\' | translate\n                                        }}<vdr-help-tooltip\n                                            [content]="\'catalog.out-of-stock-threshold-tooltip\' | translate"\n                                        ></vdr-help-tooltip\n                                    ></label>\n                                    <div class="flex">\n                                        <clr-input-container>\n                                            <input\n                                                clrInput\n                                                type="number"\n                                                [formControl]="formGroup.get(\'outOfStockThreshold\')"\n                                                [readonly]="!(updatePermission | hasPermission)"\n                                                [vdrDisabled]="\n                                                    formGroup.get(\'useGlobalOutOfStockThreshold\')?.value !==\n                                                        false || inventoryIsNotTracked(formGroup)\n                                                "\n                                            />\n                                        </clr-input-container>\n                                        <clr-toggle-wrapper>\n                                            <input\n                                                type="checkbox"\n                                                clrToggle\n                                                name="useGlobalOutOfStockThreshold"\n                                                formControlName="useGlobalOutOfStockThreshold"\n                                                [vdrDisabled]="\n                                                    !(updatePermission | hasPermission) ||\n                                                    inventoryIsNotTracked(formGroup)\n                                                "\n                                            />\n                                            <label\n                                                >{{ \'catalog.use-global-value\' | translate }} ({{\n                                                    globalOutOfStockThreshold\n                                                }})</label\n                                            >\n                                        </clr-toggle-wrapper>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="custom-fields">\n                            <div class="variant-form-input-row">\n                                <section formGroupName="customFields" *ngIf="customFields.length">\n                                    \x3c!--<label>{{ \'common.custom-fields\' | translate }}</label>--\x3e\n                                    <ng-container *ngFor="let customField of customFields">\n                                        <vdr-custom-field-control\n                                            *ngIf="formGroup.get([\'customFields\', customField.name])"\n                                            entityName="ProductVariant"\n                                            [compact]="true"\n                                            [customFieldsFormGroup]="formGroup.get(\'customFields\')"\n                                            [readonly]="!(updatePermission | hasPermission)"\n                                            [customField]="customField"\n                                        ></vdr-custom-field-control>\n                                    </ng-container>\n                                </section>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class="card-block">\n                <div class="options-facets">\n                    <vdr-entity-info [entity]="variant"></vdr-entity-info>\n                    <div *ngIf="variant.options.length">\n                        <div class="options">\n                            <vdr-chip\n                                *ngFor="let option of variant.options | sort: \'groupId\'"\n                                [colorFrom]="optionGroupName(option.groupId)"\n                                [invert]="true"\n                                (iconClick)="editOption(option)"\n                                [icon]="(updatePermission | hasPermission) && \'pencil\'"\n                            >\n                                <span class="option-group-name">{{ optionGroupName(option.groupId) }}</span>\n                                {{ optionName(option) }}\n                            </vdr-chip>\n                        </div>\n                    </div>\n                    <div class="flex-spacer"></div>\n                    <div class="facets">\n                        <vdr-facet-value-chip\n                            *ngFor="let facetValue of existingFacetValues(variant)"\n                            [facetValue]="facetValue"\n                            [removable]="updatePermission | hasPermission"\n                            (remove)="removeFacetValue(variant, facetValue.id)"\n                        ></vdr-facet-value-chip>\n                        <vdr-facet-value-chip\n                            *ngFor="let facetValue of pendingFacetValues(variant)"\n                            [facetValue]="facetValue"\n                            [removable]="updatePermission | hasPermission"\n                            (remove)="removeFacetValue(variant, facetValue.id)"\n                        ></vdr-facet-value-chip>\n                        <button\n                            *vdrIfPermissions="updatePermission"\n                            class="btn btn-sm btn-secondary"\n                            (click)="selectFacetValueClick.emit([variant.id])"\n                        >\n                            <clr-icon shape="plus"></clr-icon>\n                            {{ \'catalog.add-facets\' | translate }}\n                        </button>\n                    </div>\n                </div>\n            </div>\n            <ng-container *vdrIfMultichannel>\n                <div class="card-block" *vdrIfDefaultChannelActive>\n                    <div class="flex channel-assignment">\n                        <ng-container *ngFor="let channel of variant.channels">\n                            <vdr-chip\n                                *ngIf="!isDefaultChannel(channel.code)"\n                                icon="times-circle"\n                                [title]="\'catalog.remove-from-channel\' | translate"\n                                (iconClick)="\n                                    removeFromChannel.emit({ channelId: channel.id, variant: variant })\n                                "\n                            >\n                                <vdr-channel-badge [channelCode]="channel.code"></vdr-channel-badge>\n                                {{ channel.code | channelCodeToLabel }}\n                            </vdr-chip>\n                        </ng-container>\n                        <button class="btn btn-sm" (click)="assignToChannel.emit(variant)">\n                            <clr-icon shape="layers"></clr-icon>\n                            {{ \'catalog.assign-to-channel\' | translate }}\n                        </button>\n                    </div>\n                </div>\n            </ng-container>\n        </ng-container>\n    </div>\n    <div class="table-footer">\n        <vdr-items-per-page-controls [(itemsPerPage)]="pagination.itemsPerPage"></vdr-items-per-page-controls>\n\n        <vdr-pagination-controls\n            [currentPage]="pagination.currentPage"\n            [itemsPerPage]="pagination.itemsPerPage"\n            (pageChange)="pagination.currentPage = $event"\n        ></vdr-pagination-controls>\n    </div>\n</div>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[".with-selected{display:flex;min-height:52px;align-items:center;border:1px solid var(--color-component-border-100);border-radius:3px;padding:6px 18px}.with-selected>label,.with-selected vdr-select-toggle{margin-right:12px}.variant-container{transition:background-color .2s;min-height:330px}.variant-container.disabled{background-color:var(--color-component-bg-200)}.variant-container .header-row{display:flex;align-items:center;flex-wrap:wrap}.variant-container .variant-body{display:flex;flex-direction:column}@media screen and (min-width:768px){.variant-container .variant-body{flex-direction:row}}.variant-container .details{display:flex;flex-direction:column;flex:1;margin-right:12px}@media screen and (min-width:768px){.variant-container .details{flex-direction:row;height:36px}}.variant-container .details .name{flex:1}.variant-container .details .name ::ng-deep .clr-control-container{width:100%}.variant-container .details .name ::ng-deep .clr-control-container input.clr-input{min-width:100%}.variant-container .details .sku{width:160px;margin-right:20px;flex:0}.variant-container .details ::ng-deep .name input{min-width:300px}.variant-container .right-controls{display:flex}.variant-container .tax-category-label{margin-top:3px}.variant-container .variant-form-inputs{flex:1;display:flex;flex-direction:column}@media screen and (min-width:768px){.variant-container .variant-form-inputs{flex-direction:row}}.variant-container .variant-form-input-row{display:flex;flex-wrap:wrap}@media screen and (min-width:768px){.variant-container .variant-form-input-row{margin:0 6px 8px 24px}}.variant-container .variant-form-input-row>*{margin-right:24px;margin-bottom:24px}.variant-container .track-inventory-toggle{margin-top:22px}.variant-container .clr-form-control{margin-top:0}.variant-container .facets{display:flex;align-items:center}.variant-container .pricing{display:flex}.variant-container .pricing>div{margin-right:12px}.variant-container .option-group-name{color:var(--color-text-200);text-transform:uppercase;font-size:10px;margin-right:3px;height:11px}.variant-container .options-facets{display:flex;color:var(--color-grey-400)}.channel-assignment{justify-content:flex-end}.channel-assignment .btn{margin:6px 12px 6px 0}.out-of-stock-threshold-wrapper{display:flex;flex-direction:column}.out-of-stock-threshold-wrapper clr-toggle-wrapper{margin-left:24px}.inventory-untracked{opacity:.5}.table-footer{display:flex;align-items:baseline;justify-content:space-between;margin-top:6px}"]}]}],he.ctorParameters=function(){return[{type:t.ChangeDetectorRef},{type:a.ModalService},{type:a.DataService}]},he.propDecorators={formArray:[{type:t.Input,args:["productVariantsFormArray"]}],variants:[{type:t.Input}],channelPriceIncludesTax:[{type:t.Input}],taxCategories:[{type:t.Input}],facets:[{type:t.Input}],optionGroups:[{type:t.Input}],customFields:[{type:t.Input}],customOptionFields:[{type:t.Input}],activeLanguage:[{type:t.Input}],pendingAssetChanges:[{type:t.Input}],assignToChannel:[{type:t.Output}],removeFromChannel:[{type:t.Output}],assetChange:[{type:t.Output}],selectionChange:[{type:t.Output}],selectFacetValueClick:[{type:t.Output}],updateProductOption:[{type:t.Output}]};var ye=function(){function e(e){this.changeDetector=e,this.formGroupMap=new Map,this.updatePermission=[a.Permission.UpdateCatalog,a.Permission.UpdateProduct]}return e.prototype.ngOnInit=function(){var e=this;this.subscription=this.formArray.valueChanges.pipe(o.map((function(e){return e.length})),o.debounceTime(1),o.distinctUntilChanged()).subscribe((function(){e.buildFormGroupMap()})),this.buildFormGroupMap()},e.prototype.ngOnDestroy=function(){this.subscription&&this.subscription.unsubscribe()},e.prototype.getFeaturedAsset=function(e){var t;return(null===(t=this.pendingAssetChanges[e.id])||void 0===t?void 0:t.featuredAsset)||e.featuredAsset},e.prototype.optionGroupName=function(e){var t=this.optionGroups.find((function(t){return t.id===e}));return t&&t.name},e.prototype.buildFormGroupMap=function(){var e,t;this.formGroupMap.clear();try{for(var n=F(this.formArray.controls),a=n.next();!a.done;a=n.next()){var r=a.value;this.formGroupMap.set(r.value.id,r)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.changeDetector.markForCheck()},e}();ye.decorators=[{type:t.Component,args:[{selector:"vdr-product-variants-table",template:'<vdr-data-table [items]="variants">\n    <vdr-dt-column></vdr-dt-column>\n    <vdr-dt-column>{{ \'common.name\' | translate }}</vdr-dt-column>\n    <vdr-dt-column>{{ \'catalog.sku\' | translate }}</vdr-dt-column>\n    <ng-container *ngFor="let optionGroup of optionGroups | sort: \'id\'">\n        <vdr-dt-column>{{ optionGroup.name }}</vdr-dt-column>\n    </ng-container>\n    <vdr-dt-column>{{ \'catalog.price\' | translate }}</vdr-dt-column>\n    <vdr-dt-column>{{ \'catalog.stock-on-hand\' | translate }}</vdr-dt-column>\n    <vdr-dt-column>{{ \'common.enabled\' | translate }}</vdr-dt-column>\n    <ng-template let-variant="item" let-i="index">\n        <ng-container *ngIf="formGroupMap.get(variant.id) as formGroup" [formGroup]="formGroup">\n            <td class="left align-middle" [class.disabled]="!formGroup.get(\'enabled\')!.value">\n                <div class="card-img">\n                    <div class="featured-asset">\n                        <img\n                            *ngIf="getFeaturedAsset(variant) as featuredAsset; else placeholder"\n                            [src]="featuredAsset | assetPreview: \'tiny\'"\n                        />\n                        <ng-template #placeholder>\n                            <div class="placeholder">\n                                <clr-icon shape="image" size="48"></clr-icon>\n                            </div>\n                        </ng-template>\n                    </div>\n                </div>\n            </td>\n            <td class="left align-middle" [class.disabled]="!formGroup.get(\'enabled\')!.value">\n                <clr-input-container>\n                    <input\n                        clrInput\n                        type="text"\n                        formControlName="name"\n                        [readonly]="!(updatePermission | hasPermission)"\n                        [placeholder]="\'common.name\' | translate"\n                    />\n                </clr-input-container>\n            </td>\n            <td class="left align-middle" [class.disabled]="!formGroup.get(\'enabled\')!.value">\n                <clr-input-container>\n                    <input\n                        clrInput\n                        type="text"\n                        formControlName="sku"\n                        [readonly]="!(updatePermission | hasPermission)"\n                        [placeholder]="\'catalog.sku\' | translate"\n                    />\n                </clr-input-container>\n            </td>\n            <ng-container *ngFor="let option of variant.options | sort: \'groupId\'">\n                <td\n                    class="left align-middle"\n                    [class.disabled]="!formGroup.get(\'enabled\')!.value"\n                    [style.color]="optionGroupName(option.groupId) | stringToColor"\n                >\n                    {{ option.name }}\n                </td>\n            </ng-container>\n            <td class="left align-middle price" [class.disabled]="!formGroup.get(\'enabled\')!.value">\n                <clr-input-container>\n                    <vdr-currency-input\n                        *ngIf="!channelPriceIncludesTax"\n                        clrInput\n                        [currencyCode]="variant.currencyCode"\n                        [readonly]="!(updatePermission | hasPermission)"\n                        formControlName="price"\n                    ></vdr-currency-input>\n                    <vdr-currency-input\n                        *ngIf="channelPriceIncludesTax"\n                        clrInput\n                        [currencyCode]="variant.currencyCode"\n                        [readonly]="!(updatePermission | hasPermission)"\n                        formControlName="priceWithTax"\n                    ></vdr-currency-input>\n                </clr-input-container>\n            </td>\n            <td class="left align-middle stock" [class.disabled]="!formGroup.get(\'enabled\')!.value">\n                <clr-input-container>\n                    <input\n                        clrInput\n                        type="number"\n                        min="0"\n                        step="1"\n                        formControlName="stockOnHand"\n                        [readonly]="!(updatePermission | hasPermission)"\n                    />\n                </clr-input-container>\n            </td>\n            <td class="left align-middle stock" [class.disabled]="!formGroup.get(\'enabled\')!.value">\n                <clr-toggle-wrapper>\n                    <input\n                        type="checkbox"\n                        clrToggle\n                        name="enabled"\n                        formControlName="enabled"\n                        [vdrDisabled]="!(updatePermission | hasPermission)"\n                    />\n                </clr-toggle-wrapper>\n            </td>\n        </ng-container>\n    </ng-template>\n</vdr-data-table>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[".placeholder{color:var(--color-grey-300)}.price input,.stock input{max-width:96px}td{transition:background-color .2s}td.disabled{background-color:var(--color-component-bg-200)}"]}]}],ye.ctorParameters=function(){return[{type:t.ChangeDetectorRef}]},ye.propDecorators={formArray:[{type:t.Input,args:["productVariantsFormArray"]}],variants:[{type:t.Input}],channelPriceIncludesTax:[{type:t.Input}],optionGroups:[{type:t.Input}],pendingAssetChanges:[{type:t.Input}]};var be=function(){function e(e){this.dataService=e,this.priceChange$=new s.BehaviorSubject(0),this.taxCategoryIdChange$=new s.BehaviorSubject("")}return e.prototype.ngOnInit=function(){var e=this.dataService.settings.getTaxRates(999,0,"cache-first").mapStream((function(e){return e.taxRates.items})),t=this.dataService.settings.getActiveChannel("cache-first").refetchOnChannelChange().mapStream((function(e){return e.activeChannel}));this.taxRate$=s.combineLatest(t,e,this.taxCategoryIdChange$).pipe(o.map((function(e){var t=x(e,3),n=t[0],a=t[1],r=t[2],o=n.defaultTaxZone;if(!o)return 0;var i=a.find((function(e){return e.zone.id===o.id&&e.category.id===r}));return i?i.value:0}))),this.grossPrice$=s.combineLatest(this.taxRate$,this.priceChange$).pipe(o.map((function(e){var t=x(e,2),n=t[0],a=t[1];return Math.round(a*((100+n)/100))})))},e.prototype.ngOnChanges=function(e){"price"in e&&this.priceChange$.next(e.price.currentValue),"taxCategoryId"in e&&this.taxCategoryIdChange$.next(e.taxCategoryId.currentValue)},e}();be.decorators=[{type:t.Component,args:[{selector:"vdr-variant-price-detail",template:'<label class="clr-control-label">{{ \'catalog.taxes\' | translate }}</label>\n<div *ngIf="priceIncludesTax" class="value">\n    {{ \'catalog.price-includes-tax-at\' | translate: { rate: taxRate$ | async } }}\n</div>\n<div *ngIf="!priceIncludesTax" class="value">\n    {{\n        \'catalog.price-with-tax-in-default-zone\'\n            | translate: { price: grossPrice$ | async | localeCurrency: currencyCode, rate: taxRate$ | async }\n    }}\n</div>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[":host{display:flex;flex-direction:column}.value{margin-top:3px}"]}]}],be.ctorParameters=function(){return[{type:a.DataService}]},be.propDecorators={priceIncludesTax:[{type:t.Input}],price:[{type:t.Input}],currencyCode:[{type:t.Input}],taxCategoryId:[{type:t.Input}]};var Ce=function(){};Ce.decorators=[{type:t.NgModule,args:[{imports:[a.SharedModule,n.RouterModule.forChild(Z)],exports:[],declarations:[G,M,D,V,le,he,A,k,pe,be,S,w,ie,se,re,ye,ve,ue,fe,E,$,P]}]}],e.ApplyFacetDialogComponent=A,e.AssetDetailComponent=P,e.AssetListComponent=k,e.AssetResolver=N,e.AssignProductsToChannelDialogComponent=$,e.CatalogModule=Ce,e.CollectionContentsComponent=re,e.CollectionDetailComponent=w,e.CollectionListComponent=S,e.CollectionResolver=U,e.CollectionTreeComponent=ie,e.CollectionTreeNodeComponent=se,e.FacetDetailComponent=V,e.FacetListComponent=D,e.FacetResolver=j,e.GenerateProductVariantsComponent=le,e.GeneratedVariant=L,e.OPTION_VALUE_INPUT_VALUE_ACCESSOR=de,e.OptionValueInputComponent=ue,e.ProductAssetsComponent=pe,e.ProductDetailComponent=M,e.ProductDetailService=O,e.ProductListComponent=G,e.ProductResolver=R,e.ProductSearchInputComponent=ve,e.ProductVariantsEditorComponent=E,e.ProductVariantsListComponent=he,e.ProductVariantsResolver=B,e.ProductVariantsTableComponent=ye,e.UpdateProductOptionDialogComponent=fe,e.VariantPriceDetailComponent=be,e.arrayToTree=oe,e.assetBreadcrumb=ae,e.catalogRoutes=Z,e.collectionBreadcrumb=ne,e.facetBreadcrumb=te,e.productBreadcrumb=X,e.productVariantEditorBreadcrumb=ee,e.replaceLast=T,e.ɵ0=_,e.ɵ1=q,e.ɵ2=z,e.ɵ3=W,e.ɵ4=H,e.ɵ5=J,e.ɵ6=Y,e.ɵ7=Q,e.ɵ8=K,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=vendure-admin-ui-catalog.umd.min.js.map
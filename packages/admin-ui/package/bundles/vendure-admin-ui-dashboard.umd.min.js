!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@vendure/admin-ui/core"),require("@vendure/common/lib/shared-utils"),require("rxjs/operators"),require("@angular/router"),require("@biesbjerg/ngx-translate-extract-marker"),require("dayjs"),require("rxjs")):"function"==typeof define&&define.amd?define("@vendure/admin-ui/dashboard",["exports","@angular/core","@vendure/admin-ui/core","@vendure/common/lib/shared-utils","rxjs/operators","@angular/router","@biesbjerg/ngx-translate-extract-marker","dayjs","rxjs"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).vendure=e.vendure||{},e.vendure["admin-ui"]=e.vendure["admin-ui"]||{},e.vendure["admin-ui"].dashboard={}),e.ng.core,e.vendure["admin-ui"].core,e.sharedUtils,e.rxjs.operators,e.ng.router,e.ngxTranslateExtractMarker,e.dayjs,e.rxjs)}(this,(function(e,t,r,n,a,o,i,d,s){"use strict";function c(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l=c(d);
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function u(e,t,r,n){return new(r||(r=Promise))((function(a,o){function i(e){try{s(n.next(e))}catch(e){o(e)}}function d(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,d)}s((n=n.apply(e,t||[])).next())}))}function p(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:d(0),throw:d(1),return:d(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function d(o){return function(d){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,d])}}}Object.create;function g(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,a,o=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)i.push(n.value)}catch(e){a={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(a)throw a.error}}return i}Object.create;var h=function(){function e(e,t,r,n){this.dashboardWidgetService=e,this.localStorageService=t,this.changedDetectorRef=r,this.dataService=n,this.deletionMarker="__delete__"}return e.prototype.ngOnInit=function(){var e=this;this.availableWidgetIds$=this.dataService.client.userStatus().stream$.pipe(a.map((function(e){return e.userStatus.permissions})),a.map((function(t){return e.dashboardWidgetService.getAvailableIds(t)})),a.tap((function(t){return e.widgetLayout=e.initLayout(t)})))},e.prototype.getClassForWidth=function(e){switch(e){case 3:return"clr-col-12 clr-col-sm-6 clr-col-lg-3";case 4:return"clr-col-12 clr-col-sm-6 clr-col-lg-4";case 6:return"clr-col-12 clr-col-lg-6";case 8:return"clr-col-12 clr-col-lg-8";case 12:return"clr-col-12";default:n.assertNever(e)}},e.prototype.getSupportedWidths=function(e){return e.supportedWidths||[3,4,6,8,12]},e.prototype.setWidgetWidth=function(e,t){e.width=t,this.recalculateLayout()},e.prototype.trackRow=function(e,t){return t.map((function(e){return e.id+":"+e.width})).join("|")},e.prototype.trackRowItem=function(e,t){return t.config},e.prototype.addWidget=function(e){var t,r=this.dashboardWidgetService.getWidgetById(e);if(r){var n={id:e,config:r,width:this.getSupportedWidths(r)[0]},a=void 0;this.widgetLayout&&this.widgetLayout.length?a=this.widgetLayout[this.widgetLayout.length-1]:(a=[],null===(t=this.widgetLayout)||void 0===t||t.push(a)),a.push(n),this.recalculateLayout()}},e.prototype.removeWidget=function(e){e.id=this.deletionMarker,this.recalculateLayout()},e.prototype.drop=function(e){var t=e.currentIndex,r=e.previousIndex,n=e.previousContainer,a=e.container;if((r!==t||n.data.index!==a.data.index)&&this.widgetLayout){var o=this.widgetLayout[n.data.index],i=this.widgetLayout[a.data.index];o.splice(r,1),i.splice(t,0,e.item.data),this.recalculateLayout()}},e.prototype.initLayout=function(e){var t,r=this.localStorageService.get("dashboardWidgetLayout");return r&&(t=r.filter((function(t){return e.includes(t.id)}))),this.dashboardWidgetService.getWidgetLayout(t)},e.prototype.recalculateLayout=function(){var e=this;if(this.widgetLayout){var t=this.widgetLayout.reduce((function(e,t){return function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(g(arguments[t]));return e}(e,t)}),[]).filter((function(t){return t.id!==e.deletionMarker})).map((function(e){return{id:e.id,width:e.width}}));this.widgetLayout=this.dashboardWidgetService.getWidgetLayout(t),this.localStorageService.set("dashboardWidgetLayout",t),setTimeout((function(){return e.changedDetectorRef.markForCheck()}))}},e}();h.decorators=[{type:t.Component,args:[{selector:"vdr-dashboard",template:'<div class="widget-header">\n    <vdr-dropdown>\n        <button class="btn btn-secondary btn-sm" vdrDropdownTrigger>\n            <clr-icon shape="plus"></clr-icon>\n            {{ \'dashboard.add-widget\' | translate }}\n        </button>\n        <vdr-dropdown-menu vdrPosition="bottom-right">\n            <button\n                class="button"\n                vdrDropdownItem\n                *ngFor="let id of availableWidgetIds$ | async"\n                (click)="addWidget(id)"\n            >\n                {{ id }}\n            </button>\n        </vdr-dropdown-menu>\n    </vdr-dropdown>\n</div>\n<div cdkDropListGroup>\n    <div\n        class="clr-row dashboard-row"\n        *ngFor="let row of widgetLayout; index as rowIndex; trackBy: trackRow"\n        cdkDropList\n        (cdkDropListDropped)="drop($event)"\n        cdkDropListOrientation="horizontal"\n        [cdkDropListData]="{ index: rowIndex }"\n    >\n        <div\n            *ngFor="let widget of row; trackBy: trackRowItem"\n            class="dashboard-item"\n            [ngClass]="getClassForWidth(widget.width)"\n            cdkDrag\n            [cdkDragData]="widget"\n        >\n            <vdr-dashboard-widget\n                *vdrIfPermissions="widget.config.requiresPermissions || null"\n                [widgetConfig]="widget.config"\n            >\n                <div class="flex">\n                    <div class="drag-handle" cdkDragHandle>\n                        <clr-icon shape="drag-handle" size="24"></clr-icon>\n                    </div>\n                    <vdr-dropdown>\n                        <button class="icon-button" vdrDropdownTrigger>\n                            <clr-icon shape="ellipsis-vertical"></clr-icon>\n                        </button>\n                        <vdr-dropdown-menu vdrPosition="bottom-right">\n                            <h4 class="dropdown-header">{{ \'dashboard.widget-resize\' | translate }}</h4>\n                            <button\n                                class="button"\n                                vdrDropdownItem\n                                [disabled]="width === widget.width"\n                                *ngFor="let width of getSupportedWidths(widget.config)"\n                                (click)="setWidgetWidth(widget, width)"\n                            >\n                                {{ \'dashboard.widget-width\' | translate: { width: width } }}\n                            </button>\n                            <div class="dropdown-divider" role="separator"></div>\n                            <button class="button" vdrDropdownItem (click)="removeWidget(widget)">\n                                <clr-icon shape="trash" class="is-danger"></clr-icon>\n                                {{ \'dashboard.remove-widget\' | translate }}\n                            </button>\n                        </vdr-dropdown-menu>\n                    </vdr-dropdown>\n                </div>\n            </vdr-dashboard-widget>\n        </div>\n    </div>\n</div>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[".widget-header{display:flex;justify-content:flex-end}.placeholder{color:var(--color-grey-300);text-align:center}.placeholder .version{font-size:3em;margin:24px;line-height:1em}.placeholder ::ng-deep .clr-i-outline{fill:var(--color-grey-200)}vdr-dashboard-widget{margin-bottom:24px}.cdk-drag-preview{box-sizing:border-box;border-radius:4px}.cdk-drag-placeholder{opacity:0}.cdk-drag-animating{transition:transform .25s cubic-bezier(0,0,.2,1)}.dashboard-row{padding:0;border-width:1;margin-bottom:6px;transition:padding .2s,margin .2s}.dashboard-row.cdk-drop-list-dragging,.dashboard-row.cdk-drop-list-receiving{border:1px dashed var(--color-component-border-200);padding:6px}.dashboard-row.cdk-drop-list-dragging .dashboard-item:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]}]}],h.ctorParameters=function(){return[{type:r.DashboardWidgetService},{type:r.LocalStorageService},{type:t.ChangeDetectorRef},{type:r.DataService}]};var m=function(){function e(e){this.componentFactoryResolver=e}return e.prototype.ngAfterViewInit=function(){this.loadWidget()},e.prototype.loadWidget=function(){return u(this,void 0,void 0,(function(){var e,t,r;return p(this,(function(n){switch(n.label){case 0:return(e=this.widgetConfig.loadComponent())instanceof Promise?[4,e]:[3,2];case 1:return r=n.sent(),[3,3];case 2:r=e,n.label=3;case 3:return t=r,this.componentRef=this.portal.createComponent(this.componentFactoryResolver.resolveComponentFactory(t)),this.componentRef.changeDetectorRef.markForCheck(),[2]}}))}))},e.prototype.ngOnDestroy=function(){this.componentRef&&this.componentRef.destroy()},e}();m.decorators=[{type:t.Component,args:[{selector:"vdr-dashboard-widget",template:'<div class="card">\n    <div class="card-header">\n        <div class="title">\n            <ng-container *ngIf="widgetConfig.title as title">{{ title | translate }}</ng-container>\n        </div>\n        <div class="controls">\n            <ng-content></ng-content>\n        </div>\n    </div>\n    <div class="card-block">\n        <ng-template #portal></ng-template>\n    </div>\n</div>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[":host{display:block}.card{margin-top:0;min-height:200px}.card-header{display:flex;justify-content:space-between}"]}]}],m.ctorParameters=function(){return[{type:t.ComponentFactoryResolver}]},m.propDecorators={widgetConfig:[{type:t.Input}],portal:[{type:t.ViewChild,args:["portal",{read:t.ViewContainerRef}]}]};var f=[{path:"",component:h,pathMatch:"full"}],v=function(){function e(e){this.dataService=e}return e.prototype.ngOnInit=function(){this.latestOrders$=this.dataService.order.getOrders({take:10,filter:{active:{eq:!1}},sort:{orderPlacedAt:r.SortOrder.DESC}}).refetchOnChannelChange().mapStream((function(e){return e.orders.items}))},e}();v.decorators=[{type:t.Component,args:[{selector:"vdr-latest-orders-widget",template:'<vdr-data-table [items]="latestOrders$ | async">\n    <ng-template let-order="item">\n        <td class="left align-middle">\n            {{ order.code }}\n            <vdr-order-state-label [state]="order.state"></vdr-order-state-label>\n        </td>\n        <td class="left align-middle">\n            <vdr-customer-label [customer]="order.customer"></vdr-customer-label>\n        </td>\n        <td class="left align-middle">{{ order.total | localeCurrency: order.currencyCode }}</td>\n        <td class="left align-middle">{{ order.orderPlacedAt | timeAgo }}</td>\n        <td class="right align-middle">\n            <vdr-table-row-action\n                iconShape="shopping-cart"\n                [label]="\'common.open\' | translate"\n                [linkTo]="[\'/orders/\', order.id]"\n            ></vdr-table-row-action>\n        </td>\n    </ng-template>\n</vdr-data-table>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:["vdr-data-table ::ng-deep table{margin-top:0}"]}]}],v.ctorParameters=function(){return[{type:r.DataService}]};var y=function(){};y.decorators=[{type:t.NgModule,args:[{imports:[r.CoreModule,r.SharedModule],declarations:[v]}]}];var b=function(){function e(e){this.dataService=e,this.today=new Date,this.yesterday=new Date((new Date).setDate(this.today.getDate()-1)),this.selection$=new s.BehaviorSubject({timeframe:"day",date:this.today})}return e.prototype.ngOnInit=function(){var e=this;this.dateRange$=this.selection$.pipe(a.distinctUntilChanged(),a.map((function(e){return{start:l.default(e.date).startOf(e.timeframe).toDate(),end:l.default(e.date).endOf(e.timeframe).toDate()}})),a.shareReplay(1));var t=this.dateRange$.pipe(a.switchMap((function(t){var r=t.start,n=t.end;return e.dataService.order.getOrderSummary(r,n).refetchOnChannelChange().mapStream((function(e){return e.orders}))})),a.shareReplay(1));this.totalOrderCount$=t.pipe(a.map((function(e){return e.totalItems}))),this.totalOrderValue$=t.pipe(a.map((function(e){return e.items.reduce((function(e,t){return e+t.total}),0)/100}))),this.currencyCode$=this.dataService.settings.getActiveChannel().refetchOnChannelChange().mapStream((function(e){return e.activeChannel.currencyCode||void 0}))},e}();b.decorators=[{type:t.Component,args:[{selector:"vdr-order-summary-widget",template:'<div class="stats">\n    <div class="stat">\n        <div class="stat-figure">{{ totalOrderCount$ | async }}</div>\n        <div class="stat-label">{{ \'dashboard.total-orders\' | translate }}</div>\n    </div>\n    <div class="stat">\n        <div class="stat-figure">\n            {{ totalOrderValue$ | async | currency: (currencyCode$ | async) || undefined }}\n        </div>\n        <div class="stat-label">{{ \'dashboard.total-order-value\' | translate }}</div>\n    </div>\n</div>\n<div class="footer">\n    <div class="btn-group btn-outline-primary btn-sm" *ngIf="selection$ | async as selection">\n        <button class="btn" [class.btn-primary]="selection.date === today" (click)="selection$.next({timeframe: \'day\', date: today})">\n            {{ \'dashboard.today\' | translate }}\n        </button>\n        <button class="btn" [class.btn-primary]="selection.date === yesterday" (click)="selection$.next({timeframe: \'day\', date: yesterday})">\n            {{ \'dashboard.yesterday\' | translate }}\n        </button>\n        <button class="btn" [class.btn-primary]="selection.timeframe === \'week\'" (click)="selection$.next({timeframe: \'week\'})">\n            {{ \'dashboard.thisWeek\' | translate }}\n        </button>\n        <button class="btn" [class.btn-primary]="selection.timeframe === \'month\'" (click)="selection$.next({timeframe: \'month\'})">\n            {{ \'dashboard.thisMonth\' | translate }}\n        </button>\n    </div>\n\n    <div class="date-range p5" *ngIf="dateRange$ | async as range">\n        {{ range.start | localeDate }} - {{ range.end | localeDate }}\n    </div>\n</div>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[".stats{display:flex;justify-content:space-evenly}.stat{text-align:center}.stat-figure{font-size:2rem;line-height:3rem}.stat-label{text-transform:uppercase}.date-range{margin-top:0}.footer{margin-top:24px;display:flex;flex-direction:column;justify-content:space-between}@media screen and (min-width:768px){.footer{flex-direction:row}}"]}]}],b.ctorParameters=function(){return[{type:r.DataService}]};var w=function(){};w.decorators=[{type:t.NgModule,args:[{imports:[r.CoreModule],declarations:[b]}]}];var C=function(){};C.decorators=[{type:t.Component,args:[{selector:"vdr-test-widget",template:"<p>This is a test widget!</p>\n",changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[""]}]}];var D=function(){};D.decorators=[{type:t.NgModule,args:[{declarations:[C]}]}];var S=function(){function e(e){this.dataService=e,this.version=r.ADMIN_UI_VERSION,this.brand=r.getAppConfig().brand,this.hideVendureBranding=r.getAppConfig().hideVendureBranding,this.hideVersion=r.getAppConfig().hideVersion}return e.prototype.ngOnInit=function(){this.administrator$=this.dataService.administrator.getActiveAdministrator().mapStream((function(e){return e.activeAdministrator||null}))},e}();S.decorators=[{type:t.Component,args:[{selector:"vdr-welcome-widget",template:'<div *ngIf="administrator$ | async as administrator">\n    <h4 class="h4">\n        Welcome, {{ administrator.firstName }} {{ administrator.lastName }}<br />\n        <small class="p5">Last login: {{ administrator.user.lastLogin | timeAgo }}</small>\n    </h4>\n\n    <p class="p5" *ngIf="!hideVendureBranding || !hideVersion">\n        {{ hideVendureBranding ? \'\' : \'Vendure\' }} {{ hideVersion ? \'\' : (\'Admin UI v\' + version) }}\n    </p>\n</div>\n<div class="placeholder">\n    <clr-icon shape="line-chart" size="128"></clr-icon>\n</div>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[":host{display:flex;justify-content:space-between}.placeholder{color:var(--color-grey-200)}"]}]}],S.ctorParameters=function(){return[{type:r.DataService}]};var x=function(){};x.decorators=[{type:t.NgModule,args:[{imports:[r.CoreModule],declarations:[S]}]}];var k=[{id:"welcome",width:12},{id:"orderSummary",width:6},{id:"latestOrders",width:6}],W=function(){return S},O=function(){return b},L=function(){return v},I=function(){return C},R={welcome:{loadComponent:W},orderSummary:{title:i.marker("dashboard.orders-summary"),loadComponent:O,requiresPermissions:[r.Permission.ReadOrder]},latestOrders:{title:i.marker("dashboard.latest-orders"),loadComponent:L,supportedWidths:[6,8,12],requiresPermissions:[r.Permission.ReadOrder]},testWidget:{title:"Test Widget",loadComponent:I}},M=function(e){Object.entries(R).map((function(t){var r=g(t,2),n=r[0],a=r[1];return e.registerWidget(n,a)})),0===e.getDefaultLayout().length&&e.setDefaultLayout(k)};M.decorators=[{type:t.NgModule,args:[{imports:[r.SharedModule,o.RouterModule.forChild(f)],declarations:[h,m]}]}],M.ctorParameters=function(){return[{type:r.DashboardWidgetService}]},e.DEFAULT_DASHBOARD_WIDGET_LAYOUT=k,e.DEFAULT_WIDGETS=R,e.DashboardComponent=h,e.DashboardModule=M,e.DashboardWidgetComponent=m,e.LatestOrdersWidgetComponent=v,e.LatestOrdersWidgetModule=y,e.OrderSummaryWidgetComponent=b,e.OrderSummaryWidgetModule=w,e.TestWidgetComponent=C,e.TestWidgetModule=D,e.WelcomeWidgetComponent=S,e.WelcomeWidgetModule=x,e.dashboardRoutes=f,e.ɵ0=W,e.ɵ1=O,e.ɵ2=L,e.ɵ3=I,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=vendure-admin-ui-dashboard.umd.min.js.map
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@vendure/admin-ui/core"),require("rxjs"),require("rxjs/operators"),require("@angular/forms"),require("@angular/router"),require("@biesbjerg/ngx-translate-extract-marker"),require("@vendure/common/lib/shared-utils"),require("@vendure/common/lib/generated-shop-types")):"function"==typeof define&&define.amd?define("@vendure/admin-ui/customer",["exports","@angular/core","@vendure/admin-ui/core","rxjs","rxjs/operators","@angular/forms","@angular/router","@biesbjerg/ngx-translate-extract-marker","@vendure/common/lib/shared-utils","@vendure/common/lib/generated-shop-types"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).vendure=e.vendure||{},e.vendure["admin-ui"]=e.vendure["admin-ui"]||{},e.vendure["admin-ui"].customer={}),e.ng.core,e.vendure["admin-ui"].core,e.rxjs,e.rxjs.operators,e.ng.forms,e.ng.router,e.ngxTranslateExtractMarker,e.sharedUtils,e.generatedShopTypes)}(this,(function(e,t,r,n,o,s,a,i,c,d){"use strict";var l=function(){function e(e){this.dataService=e,this.selectedCustomerIds=[],this.fetchGroupMembers$=new n.BehaviorSubject({skip:0,take:10,filterTerm:""})}return e.prototype.ngOnInit=function(){var e=this,t=this.fetchGroupMembers$.pipe(o.switchMap((function(t){var r=t.skip,n=t.take,o=t.filterTerm;return e.dataService.customer.getCustomerList(n,r,o).mapStream((function(e){return e.customers}))})));this.customers$=t.pipe(o.map((function(e){return e.items}))),this.customersTotal$=t.pipe(o.map((function(e){return e.totalItems})))},e.prototype.cancel=function(){this.resolveWith()},e.prototype.add=function(){this.resolveWith(this.selectedCustomerIds)},e}();l.decorators=[{type:t.Component,args:[{selector:"vdr-add-customer-to-group-dialog",template:'<ng-template vdrDialogTitle>\n    {{ \'customer.add-customers-to-group-with-name\' | translate: {groupName: group.name} }}\n</ng-template>\n\n<vdr-customer-group-member-list\n    [members]="customers$ | async"\n    [totalItems]="customersTotal$ | async"\n    [route]="route"\n    [selectedMemberIds]="selectedCustomerIds"\n    (fetchParamsChange)="fetchGroupMembers$.next($event)"\n    (selectionChange)="selectedCustomerIds = $event"\n>\n\n</vdr-customer-group-member-list>\n\n<ng-template vdrDialogButtons>\n    <button type="button" class="btn" (click)="cancel()">{{ \'common.cancel\' | translate }}</button>\n    <button type="submit" (click)="add()" [disabled]="!selectedCustomerIds.length" class="btn btn-primary">\n        {{ \'customer.add-customers-to-group-with-count\' | translate: {count: selectedCustomerIds.length} }}\n    </button>\n</ng-template>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[""]}]}],l.ctorParameters=function(){return[{type:r.DataService}]};var u=function(){function e(e){this.changeDetector=e,this.availableCountries=[]}return e.prototype.ngOnInit=function(){var e=this;this.addressForm.valueChanges.subscribe((function(){return e.changeDetector.markForCheck()}))},e.prototype.cancel=function(){this.resolveWith()},e.prototype.save=function(){this.resolveWith(this.addressForm)},e}();u.decorators=[{type:t.Component,args:[{selector:"vdr-address-detail-dialog",template:'<ng-template vdrDialogTitle>\n    <span *ngIf="addressForm.get(\'streetLine1\')?.value as streetLine1">{{ streetLine1 }},</span>\n    <span *ngIf="addressForm.get(\'countryCode\')?.value as countryCode"> {{ countryCode }}</span>\n</ng-template>\n\n<vdr-address-form\n    [formGroup]="addressForm"\n    [availableCountries]="availableCountries"\n    [customFields]="customFields"\n></vdr-address-form>\n\n<ng-template vdrDialogButtons>\n    <button type="button" class="btn" (click)="cancel()">{{ \'common.cancel\' | translate }}</button>\n    <button\n        type="submit"\n        (click)="save()"\n        [disabled]="!addressForm.valid || !addressForm.touched"\n        class="btn btn-primary"\n    >\n        {{ \'common.update\' | translate }}\n    </button>\n</ng-template>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:["clr-input-container{margin-bottom:12px}"]}]}],u.ctorParameters=function(){return[{type:t.ChangeDetectorRef}]};var m=function(){function e(e,r){this.modalService=e,this.changeDetector=r,this.availableCountries=[],this.editable=!0,this.setAsDefaultShipping=new t.EventEmitter,this.setAsDefaultBilling=new t.EventEmitter,this.dataDependenciesPopulated=new n.BehaviorSubject(!1)}return e.prototype.ngOnInit=function(){var e=this;this.addressForm.get("streetLine1").value||this.dataDependenciesPopulated.pipe(o.filter((function(e){return e})),o.take(1)).subscribe((function(){e.editAddress()}))},e.prototype.ngOnChanges=function(e){null!=this.customFields&&null!=this.availableCountries&&this.dataDependenciesPopulated.next(!0)},e.prototype.getCountryName=function(e){if(!this.availableCountries)return"";var t=this.availableCountries.find((function(t){return t.code===e}));return t?t.name:""},e.prototype.setAsDefaultBillingAddress=function(){this.setAsDefaultBilling.emit(this.addressForm.value.id),this.addressForm.markAsDirty()},e.prototype.setAsDefaultShippingAddress=function(){this.setAsDefaultShipping.emit(this.addressForm.value.id),this.addressForm.markAsDirty()},e.prototype.editAddress=function(){var e=this;this.modalService.fromComponent(u,{locals:{addressForm:this.addressForm,customFields:this.customFields,availableCountries:this.availableCountries},size:"md",closable:!0}).subscribe((function(){e.changeDetector.markForCheck()}))},e}();m.decorators=[{type:t.Component,args:[{selector:"vdr-address-card",template:'<div class="card" *ngIf="addressForm.value as address">\n    <div class="card-header">\n        <div class="address-title">\n            <span class="street-line" *ngIf="address.streetLine1">{{ address.streetLine1 }},</span>\n            {{ address.countryCode }}\n        </div>\n        <div class="default-controls">\n            <vdr-chip class="is-default p8" *ngIf="isDefaultShipping">\n                <clr-icon shape="truck"></clr-icon>\n                {{ \'customer.default-shipping-address\' | translate }}\n            </vdr-chip>\n            <vdr-chip class="is-default p8" *ngIf="isDefaultBilling">\n                <clr-icon shape="credit-card"></clr-icon>\n                {{ \'customer.default-billing-address\' | translate }}\n            </vdr-chip>\n        </div>\n    </div>\n    <div class="card-block">\n        <div class="card-text">\n            <vdr-formatted-address [address]="address"></vdr-formatted-address>\n        </div>\n    </div>\n    <div class="card-footer">\n        <vdr-entity-info [entity]="address"></vdr-entity-info>\n        <ng-container *ngIf="editable">\n            <button class="btn btn-sm btn-link" (click)="editAddress()">\n                {{ \'common.edit\' | translate }}\n            </button>\n            <vdr-dropdown>\n                <button type="button" class="btn btn-sm btn-link" vdrDropdownTrigger>\n                    {{ \'common.more\' | translate }}\n                    <clr-icon shape="caret down"></clr-icon>\n                </button>\n                <vdr-dropdown-menu>\n                    <button\n                        vdrDropdownItem\n                        class="button"\n                        [disabled]="isDefaultShipping"\n                        (click)="setAsDefaultShippingAddress()"\n                    >\n                        {{ \'customer.set-as-default-shipping-address\' | translate }}\n                    </button>\n                    <button\n                        vdrDropdownItem\n                        class="button"\n                        [disabled]="isDefaultBilling"\n                        (click)="setAsDefaultBillingAddress()"\n                    >\n                        {{ \'customer.set-as-default-billing-address\' | translate }}\n                    </button>\n                </vdr-dropdown-menu>\n            </vdr-dropdown>\n        </ng-container>\n    </div>\n</div>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[":host{display:block;max-width:360px}clr-input-container{margin-bottom:12px}.defaul-controls{display:flex}.is-default{margin:0;color:var(--color-success-500)}"]}]}],m.ctorParameters=function(){return[{type:r.ModalService},{type:t.ChangeDetectorRef}]},m.propDecorators={addressForm:[{type:t.Input}],customFields:[{type:t.Input}],availableCountries:[{type:t.Input}],isDefaultBilling:[{type:t.Input}],isDefaultShipping:[{type:t.Input}],editable:[{type:t.Input}],setAsDefaultShipping:[{type:t.Output}],setAsDefaultBilling:[{type:t.Output}]};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var p=function(e,t){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function v(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r}Object.create;function h(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function f(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,s=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}return a}function y(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(f(arguments[t]));return e}Object.create;var b=function(){function e(e){this.dataService=e,this.selectedGroupIds=[]}return e.prototype.ngOnInit=function(){this.groups$=this.dataService.customer.getCustomerGroupList().mapStream((function(e){return e.customerGroups.items}))},e.prototype.cancel=function(){this.resolveWith()},e.prototype.add=function(){this.resolveWith(this.selectedGroupIds)},e}();b.decorators=[{type:t.Component,args:[{selector:"vdr-select-customer-group-dialog",template:'<ng-template vdrDialogTitle>\n    {{ \'customer.add-customer-to-group\' | translate }}\n</ng-template>\n\n<ng-select\n    [items]="groups$ | async"\n    appendTo="body"\n    [addTag]="false"\n    [multiple]="true"\n    bindValue="id"\n    [(ngModel)]="selectedGroupIds"\n    [clearable]="true"\n    [searchable]="false"\n>\n    <ng-template ng-label-tmp let-item="item" let-clear="clear">\n        <span aria-hidden="true" class="ng-value-icon left" (click)="clear(item)"> × </span>\n        <vdr-chip [colorFrom]="item.id">{{ item.name }}</vdr-chip>\n    </ng-template>\n    <ng-template ng-option-tmp let-item="item">\n        <vdr-chip [colorFrom]="item.id">{{ item.name }}</vdr-chip>\n    </ng-template>\n</ng-select>\n\n\n<ng-template vdrDialogButtons>\n    <button type="button" class="btn" (click)="cancel()">{{ \'common.cancel\' | translate }}</button>\n    <button type="submit" (click)="add()" [disabled]="!selectedGroupIds.length" class="btn btn-primary">\n        {{ \'customer.add-customer-to-groups-with-count\' | translate: {count: selectedGroupIds.length} }}\n    </button>\n</ng-template>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[""]}]}],b.ctorParameters=function(){return[{type:r.DataService}]};var C=function(e){function t(t,r,o,a,i,c,d,l){var u=e.call(this,t,r,o,c)||this;return u.changeDetector=a,u.formBuilder=i,u.dataService=c,u.modalService=d,u.notificationService=l,u.fetchHistory=new n.Subject,u.addressDefaultsUpdated=!1,u.ordersPerPage=10,u.currentOrdersPage=1,u.orderListUpdates$=new n.Subject,u.customFields=u.getCustomFieldConfig("Customer"),u.addressCustomFields=u.getCustomFieldConfig("Address"),u.detailForm=u.formBuilder.group({customer:u.formBuilder.group({title:"",firstName:["",s.Validators.required],lastName:["",s.Validators.required],phoneNumber:"",emailAddress:["",[s.Validators.required,s.Validators.email]],password:"",customFields:u.formBuilder.group(u.customFields.reduce((function(e,t){var r;return Object.assign(Object.assign({},e),((r={})[t.name]="",r))}),{}))}),addresses:new s.FormArray([])}),u}return g(t,e),t.prototype.ngOnInit=function(){var e=this;this.init(),this.availableCountries$=this.dataService.settings.getAvailableCountries().mapSingle((function(e){return e.countries.items})).pipe(o.shareReplay(1));var t=this.entity$.pipe(o.merge(this.orderListUpdates$));this.orders$=t.pipe(o.map((function(e){return e.orders.items}))),this.ordersCount$=this.entity$.pipe(o.map((function(e){return e.orders.totalItems}))),this.history$=this.fetchHistory.pipe(o.startWith(null),o.switchMap((function(){return e.dataService.customer.getCustomerHistory(e.id,{sort:{createdAt:r.SortOrder.DESC}}).mapStream((function(e){var t;return null===(t=e.customer)||void 0===t?void 0:t.history.items}))})))},t.prototype.ngOnDestroy=function(){this.destroy(),this.orderListUpdates$.complete()},t.prototype.customFieldIsSet=function(e){return!!this.detailForm.get(["customer","customFields",e])},t.prototype.getAddressFormControls=function(){return this.detailForm.get(["addresses"]).controls},t.prototype.setDefaultBillingAddressId=function(e){this.defaultBillingAddressId=e,this.addressDefaultsUpdated=!0},t.prototype.setDefaultShippingAddressId=function(e){this.defaultShippingAddressId=e,this.addressDefaultsUpdated=!0},t.prototype.addAddress=function(){var e,t,r=this.detailForm.get("addresses"),n=this.formBuilder.group({fullName:"",company:"",streetLine1:["",s.Validators.required],streetLine2:"",city:"",province:"",postalCode:"",countryCode:["",s.Validators.required],phoneNumber:"",defaultShippingAddress:!1,defaultBillingAddress:!1});if(this.addressCustomFields.length){var o=this.formBuilder.group({});try{for(var a=h(this.addressCustomFields),i=a.next();!i.done;i=a.next()){var c=i.value;o.addControl(c.name,new s.FormControl(""))}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}n.addControl("customFields",o)}r.push(n)},t.prototype.setOrderItemsPerPage=function(e){this.ordersPerPage=+e,this.fetchOrdersList()},t.prototype.setOrderCurrentPage=function(e){this.currentOrdersPage=+e,this.fetchOrdersList()},t.prototype.create=function(){var e,t=this,r=this.detailForm.get("customer");if(r){var n=r.value,o=null===(e=r.get("customFields"))||void 0===e?void 0:e.value,s={title:n.title,emailAddress:n.emailAddress,firstName:n.firstName,lastName:n.lastName,phoneNumber:n.phoneNumber,customFields:o};this.dataService.customer.createCustomer(s,n.password).subscribe((function(e){var r=e.createCustomer;switch(r.__typename){case"Customer":t.notificationService.success(i.marker("common.notify-create-success"),{entity:"Customer"}),r.emailAddress&&!n.password&&t.notificationService.notify({message:i.marker("customer.email-verification-sent"),translationVars:{emailAddress:n.emailAddress},type:"info",duration:1e4}),t.detailForm.markAsPristine(),t.addressDefaultsUpdated=!1,t.changeDetector.markForCheck(),t.router.navigate(["../",r.id],{relativeTo:t.route});break;case"EmailAddressConflictError":t.notificationService.error(r.message)}}))}},t.prototype.save=function(){var e=this;this.entity$.pipe(o.take(1),o.mergeMap((function(t){var r,s,a,i=t.id,c=[],d=e.detailForm.get("customer");if(d&&d.dirty){var l=d.value,u=null===(a=d.get("customFields"))||void 0===a?void 0:a.value,m={id:i,title:l.title,emailAddress:l.emailAddress,firstName:l.firstName,lastName:l.lastName,phoneNumber:l.phoneNumber,customFields:u};c.push(e.dataService.customer.updateCustomer(m).pipe(o.map((function(e){return e.updateCustomer}))))}var p=e.detailForm.get("addresses");if(p&&p.dirty||e.addressDefaultsUpdated)try{for(var g=h(p.controls),v=g.next();!v.done;v=g.next()){var f=v.value;if(f.dirty||e.addressDefaultsUpdated){var y=f.value,b={fullName:y.fullName,company:y.company,streetLine1:y.streetLine1,streetLine2:y.streetLine2,city:y.city,province:y.province,postalCode:y.postalCode,countryCode:y.countryCode,phoneNumber:y.phoneNumber,defaultShippingAddress:e.defaultShippingAddressId===y.id,defaultBillingAddress:e.defaultBillingAddressId===y.id,customFields:y.customFields};y.id?c.push(e.dataService.customer.updateCustomerAddress(Object.assign(Object.assign({},b),{id:y.id})).pipe(o.map((function(e){return e.updateCustomerAddress})))):c.push(e.dataService.customer.createCustomerAddress(i,b).pipe(o.map((function(e){return e.createCustomerAddress}))))}}}catch(e){r={error:e}}finally{try{v&&!v.done&&(s=g.return)&&s.call(g)}finally{if(r)throw r.error}}return n.forkJoin(c)}))).subscribe((function(t){var r,n;try{for(var o=h(t),s=o.next();!s.done;s=o.next()){var a=s.value;switch(a.__typename){case"Customer":case"Address":e.notificationService.success(i.marker("common.notify-update-success"),{entity:"Customer"}),e.detailForm.markAsPristine(),e.addressDefaultsUpdated=!1,e.changeDetector.markForCheck(),e.fetchHistory.next();break;case"EmailAddressConflictError":e.notificationService.error(a.message)}}}catch(e){r={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}}),(function(t){e.notificationService.error(i.marker("common.notify-update-error"),{entity:"Customer"})}))},t.prototype.addToGroup=function(){var e=this;this.modalService.fromComponent(b,{size:"md"}).pipe(o.switchMap((function(e){return e?n.from(e):n.EMPTY})),o.concatMap((function(t){return e.dataService.customer.addCustomersToGroup(t,[e.id])}))).subscribe({next:function(t){e.notificationService.success(i.marker("customer.add-customers-to-group-success"),{customerCount:1,groupName:t.addCustomersToGroup.name})},complete:function(){e.dataService.customer.getCustomer(e.id,{take:0}).single$.subscribe(),e.fetchHistory.next()}})},t.prototype.removeFromGroup=function(e){var t=this;this.modalService.dialog({title:i.marker("customer.confirm-remove-customer-from-group"),buttons:[{type:"secondary",label:i.marker("common.cancel")},{type:"danger",label:i.marker("common.delete"),returnValue:!0}]}).pipe(o.switchMap((function(r){return r?t.dataService.customer.removeCustomersFromGroup(e.id,[t.id]):n.EMPTY})),o.switchMap((function(){return t.dataService.customer.getCustomer(t.id,{take:0}).single$}))).subscribe((function(r){t.notificationService.success(i.marker("customer.remove-customers-from-group-success"),{customerCount:1,groupName:e.name}),t.fetchHistory.next()}))},t.prototype.addNoteToCustomer=function(e){var t=this,r=e.note;this.dataService.customer.addNoteToCustomer(this.id,r).subscribe((function(){t.fetchHistory.next(),t.notificationService.success(i.marker("common.notify-create-success"),{entity:"Note"})}))},t.prototype.updateNote=function(e){var t=this;this.modalService.fromComponent(r.EditNoteDialogComponent,{closable:!0,locals:{displayPrivacyControls:!1,note:e.data.note}}).pipe(o.switchMap((function(r){return r?t.dataService.customer.updateCustomerNote({noteId:e.id,note:r.note}):n.EMPTY}))).subscribe((function(e){t.fetchHistory.next(),t.notificationService.success(i.marker("common.notify-update-success"),{entity:"Note"})}))},t.prototype.deleteNote=function(e){var t=this;return this.modalService.dialog({title:i.marker("common.confirm-delete-note"),body:e.data.note,buttons:[{type:"secondary",label:i.marker("common.cancel")},{type:"danger",label:i.marker("common.delete"),returnValue:!0}]}).pipe(o.switchMap((function(r){return r?t.dataService.customer.deleteCustomerNote(e.id):n.EMPTY}))).subscribe((function(){t.fetchHistory.next(),t.notificationService.success(i.marker("common.notify-delete-success"),{entity:"Note"})}))},t.prototype.setFormValues=function(e){var t,r,n,o,a,i,c,d,l=this.detailForm.get("customer");if(l&&l.patchValue({title:e.title,firstName:e.firstName,lastName:e.lastName,phoneNumber:e.phoneNumber,emailAddress:e.emailAddress}),e.addresses){var u=new s.FormArray([]);try{for(var m=h(e.addresses),p=m.next();!p.done;p=m.next()){var g=p.value,f=g,y=(f.customFields,v(f,["customFields"])),b=this.formBuilder.group(Object.assign(Object.assign({},y),{countryCode:g.country.code}));if(u.push(b),g.defaultShippingAddress&&(this.defaultShippingAddressId=g.id),g.defaultBillingAddress&&(this.defaultBillingAddressId=g.id),this.addressCustomFields.length){var C=this.formBuilder.group({});try{for(var S=(n=void 0,h(this.addressCustomFields)),w=S.next();!w.done;w=S.next()){var D=w.value.name,I=null===(c=g.customFields)||void 0===c?void 0:c[D],E=new s.FormControl(I);C.addControl(D,E)}}catch(e){n={error:e}}finally{try{w&&!w.done&&(o=S.return)&&o.call(S)}finally{if(n)throw n.error}}b.addControl("customFields",C)}}}catch(e){t={error:e}}finally{try{p&&!p.done&&(r=m.return)&&r.call(m)}finally{if(t)throw t.error}}this.detailForm.setControl("addresses",u)}if(this.customFields.length){C=this.detailForm.get(["customer","customFields"]);try{for(var P=h(this.customFields),T=P.next();!T.done;T=P.next()){D=T.value.name,I=null===(d=e.customFields)||void 0===d?void 0:d[D];(E=C.get(D))&&E.patchValue(I)}}catch(e){a={error:e}}finally{try{T&&!T.done&&(i=P.return)&&i.call(P)}finally{if(a)throw a.error}}}this.changeDetector.markForCheck()},t.prototype.fetchOrdersList=function(){var e=this;this.dataService.customer.getCustomer(this.id,{take:this.ordersPerPage,skip:(this.currentOrdersPage-1)*this.ordersPerPage}).single$.pipe(o.map((function(e){return e.customer})),o.filter(c.notNullOrUndefined)).subscribe((function(t){return e.orderListUpdates$.next(t)}))},t}(r.BaseDetailComponent);C.decorators=[{type:t.Component,args:[{selector:"vdr-customer-detail",template:'<vdr-action-bar>\n    <vdr-ab-left>\n        <div class="flex clr-align-items-center">\n            <vdr-entity-info [entity]="entity$ | async"></vdr-entity-info>\n            <vdr-customer-status-label [customer]="entity$ | async"></vdr-customer-status-label>\n            <div class="last-login" *ngIf="(entity$ | async)?.user?.lastLogin as lastLogin" [title]="lastLogin | localeDate:\'medium\'">\n                {{ \'customer.last-login\' | translate }}: {{ lastLogin | timeAgo }}\n            </div>\n        </div>\n    </vdr-ab-left>\n\n    <vdr-ab-right>\n        <vdr-action-bar-items locationId="customer-detail"></vdr-action-bar-items>\n        <button\n            class="btn btn-primary"\n            *ngIf="isNew$ | async; else updateButton"\n            (click)="create()"\n            [disabled]="!(addressDefaultsUpdated || (detailForm.valid && detailForm.dirty))"\n        >\n            {{ \'common.create\' | translate }}\n        </button>\n        <ng-template #updateButton>\n            <button\n                *vdrIfPermissions="\'UpdateCustomer\'"\n                class="btn btn-primary"\n                (click)="save()"\n                [disabled]="!(addressDefaultsUpdated || (detailForm.valid && detailForm.dirty))"\n            >\n                {{ \'common.update\' | translate }}\n            </button>\n        </ng-template>\n    </vdr-ab-right>\n</vdr-action-bar>\n\n<form class="form" [formGroup]="detailForm.get(\'customer\')">\n    <vdr-form-field [label]="\'customer.title\' | translate" for="title" [readOnlyToggle]="!(isNew$ | async)">\n        <input id="title" type="text" formControlName="title" />\n    </vdr-form-field>\n    <vdr-form-field\n        [label]="\'customer.first-name\' | translate"\n        for="firstName"\n        [readOnlyToggle]="!(isNew$ | async)"\n    >\n        <input id="firstName" type="text" formControlName="firstName" />\n    </vdr-form-field>\n    <vdr-form-field\n        [label]="\'customer.last-name\' | translate"\n        for="lastName"\n        [readOnlyToggle]="!(isNew$ | async)"\n    >\n        <input id="lastName" type="text" formControlName="lastName" />\n    </vdr-form-field>\n    <vdr-form-field\n        [label]="\'customer.email-address\' | translate"\n        for="emailAddress"\n        [readOnlyToggle]="!(isNew$ | async)"\n    >\n        <input id="emailAddress" type="text" formControlName="emailAddress" />\n    </vdr-form-field>\n    <vdr-form-field\n           [label]="\'customer.phone-number\' | translate"\n           for="phoneNumber"\n           [readOnlyToggle]="!(isNew$ | async)"\n       >\n           <input id="phoneNumber" type="text" formControlName="phoneNumber" />\n       </vdr-form-field>\n    <vdr-form-field [label]="\'customer.password\' | translate" for="password" *ngIf="isNew$ | async">\n        <input id="password" type="password" formControlName="password" />\n    </vdr-form-field>\n\n    <section formGroupName="customFields" *ngIf="customFields.length">\n        <label>{{ \'common.custom-fields\' | translate }}</label>\n        <ng-container *ngFor="let customField of customFields">\n            <vdr-custom-field-control\n                *ngIf="customFieldIsSet(customField.name)"\n                entityName="Customer"\n                [customFieldsFormGroup]="detailForm.get([\'customer\', \'customFields\'])"\n                [customField]="customField"\n            ></vdr-custom-field-control>\n        </ng-container>\n    </section>\n</form>\n\n<div class="groups" *ngIf="(entity$ | async)?.groups as groups">\n    <label class="clr-control-label">{{ \'customer.customer-groups\' | translate }}</label>\n    <ng-container *ngIf="groups.length; else noGroups">\n        <vdr-chip\n            *ngFor="let group of groups"\n            [colorFrom]="group.id"\n            icon="times"\n            (iconClick)="removeFromGroup(group)"\n            >{{ group.name }}</vdr-chip\n        >\n    </ng-container>\n    <ng-template #noGroups>\n        {{ \'customer.not-a-member-of-any-groups\' | translate }}\n    </ng-template>\n    <div>\n        <button class="btn btn-sm btn-secondary" (click)="addToGroup()" *vdrIfPermissions="\'UpdateCustomerGroup\'">\n            <clr-icon shape="plus"></clr-icon>\n            {{ \'customer.add-customer-to-group\' | translate }}\n        </button>\n    </div>\n</div>\n\n<div class="clr-row" *ngIf="!(isNew$ | async)">\n    <div class="clr-col-md-4">\n        <h3>{{ \'customer.addresses\' | translate }}</h3>\n        <vdr-address-card\n            *ngFor="let addressForm of getAddressFormControls()"\n            [availableCountries]="availableCountries$ | async"\n            [isDefaultBilling]="defaultBillingAddressId === addressForm.value.id"\n            [isDefaultShipping]="defaultShippingAddressId === addressForm.value.id"\n            [addressForm]="addressForm"\n            [customFields]="addressCustomFields"\n            [editable]="[\'UpdateCustomer\'] | hasPermission"\n            (setAsDefaultBilling)="setDefaultBillingAddressId($event)"\n            (setAsDefaultShipping)="setDefaultShippingAddressId($event)"\n        ></vdr-address-card>\n        <button class="btn btn-secondary" (click)="addAddress()" *vdrIfPermissions="\'UpdateCustomer\'">\n            <clr-icon shape="plus"></clr-icon>\n            {{ \'customer.create-new-address\' | translate }}\n        </button>\n    </div>\n    <div class="clr-col-md-8">\n        <h3>{{ \'customer.orders\' | translate }}</h3>\n        <vdr-data-table\n            [items]="orders$ | async"\n            [itemsPerPage]="ordersPerPage"\n            [totalItems]="ordersCount$ | async"\n            [currentPage]="currentOrdersPage"\n            [emptyStateLabel]="\'customer.no-orders-placed\' | translate"\n            (itemsPerPageChange)="setOrderItemsPerPage($event)"\n            (pageChange)="setOrderCurrentPage($event)"\n        >\n            <vdr-dt-column>{{ \'common.code\' | translate }}</vdr-dt-column>\n            <vdr-dt-column>{{ \'order.state\' | translate }}</vdr-dt-column>\n            <vdr-dt-column>{{ \'order.total\' | translate }}</vdr-dt-column>\n            <vdr-dt-column>{{ \'common.updated-at\' | translate }}</vdr-dt-column>\n            <vdr-dt-column></vdr-dt-column>\n            <ng-template let-order="item">\n                <td class="left">{{ order.code }}</td>\n                <td class="left">{{ order.state }}</td>\n                <td class="left">{{ order.total | localeCurrency: order.currencyCode }}</td>\n                <td class="left">{{ order.updatedAt | localeDate: \'medium\' }}</td>\n                <td class="right">\n                    <vdr-table-row-action\n                        iconShape="shopping-cart"\n                        [label]="\'common.open\' | translate"\n                        [linkTo]="[\'/orders/\', order.id]"\n                    ></vdr-table-row-action>\n                </td>\n            </ng-template>\n        </vdr-data-table>\n    </div>\n</div>\n<div class="clr-row" *ngIf="!(isNew$ | async)">\n    <div class="clr-col-md-6">\n        <vdr-customer-history\n            [customer]="entity$ | async"\n            [history]="history$ | async"\n            (addNote)="addNoteToCustomer($event)"\n            (updateNote)="updateNote($event)"\n            (deleteNote)="deleteNote($event)"\n        ></vdr-customer-history>\n    </div>\n</div>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[".last-login{margin-left:6px;color:var(--color-grey-500)}"]}]}],C.ctorParameters=function(){return[{type:a.ActivatedRoute},{type:a.Router},{type:r.ServerConfigService},{type:t.ChangeDetectorRef},{type:s.FormBuilder},{type:r.DataService},{type:r.ModalService},{type:r.NotificationService}]};var S=function(){function e(){}return e.prototype.cancel=function(){this.resolveWith()},e.prototype.save=function(){this.resolveWith(this.group.name)},e}();S.decorators=[{type:t.Component,args:[{selector:"vdr-customer-group-detail-dialog",template:'<ng-template vdrDialogTitle>\n    <span *ngIf="group.id">{{ \'customer.update-customer-group\' | translate }}</span>\n    <span *ngIf="!group.id">{{ \'customer.create-customer-group\' | translate }}</span>\n</ng-template>\n\n<vdr-form-field [label]="\'common.name\' | translate" for="name">\n    <input id="name" type="text" [(ngModel)]="group.name" [readonly]="!([\'CreateCustomerGroup\', \'UpdateCustomerGroup\'] | hasPermission)" />\n</vdr-form-field>\n\n<ng-template vdrDialogButtons>\n    <button type="button" class="btn" (click)="cancel()">{{ \'common.cancel\' | translate }}</button>\n    <button type="submit" (click)="save()" [disabled]="!group.name" class="btn btn-primary">\n        <span *ngIf="group.id">{{ \'customer.update-customer-group\' | translate }}</span>\n        <span *ngIf="!group.id">{{ \'customer.create-customer-group\' | translate }}</span>\n    </button>\n</ng-template>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[""]}]}];var w=function(){function e(e,t,r,o,s){this.dataService=e,this.notificationService=t,this.modalService=r,this.route=o,this.router=s,this.selectedCustomerIds=[],this.fetchGroupMembers$=new n.BehaviorSubject({skip:0,take:0,filterTerm:""}),this.refreshActiveGroupMembers$=new n.BehaviorSubject(void 0)}return e.prototype.ngOnInit=function(){var e=this;this.groups$=this.dataService.customer.getCustomerGroupList().mapStream((function(e){return e.customerGroups.items}));var t=this.route.paramMap.pipe(o.map((function(e){return e.get("contents")})),o.distinctUntilChanged(),o.tap((function(){return e.selectedCustomerIds=[]})));this.listIsEmpty$=this.groups$.pipe(o.map((function(e){return 0===e.length}))),this.activeGroup$=n.combineLatest(this.groups$,t).pipe(o.map((function(e){var t=f(e,2),r=t[0],n=t[1];if(n)return r.find((function(e){return e.id===n}))})));var r=n.combineLatest(this.activeGroup$,this.fetchGroupMembers$,this.refreshActiveGroupMembers$).pipe(o.switchMap((function(t){var r=f(t,2),o=r[0],s=r[1],a=s.skip,i=s.take,c=s.filterTerm;return o?e.dataService.customer.getCustomerGroupWithCustomers(o.id,{skip:a,take:i,filter:{emailAddress:{contains:c}}}).mapStream((function(e){var t;return null===(t=e.customerGroup)||void 0===t?void 0:t.customers})):n.of(void 0)})));this.members$=r.pipe(o.map((function(e){var t;return null!==(t=null==e?void 0:e.items)&&void 0!==t?t:[]}))),this.membersTotal$=r.pipe(o.map((function(e){var t;return null!==(t=null==e?void 0:e.totalItems)&&void 0!==t?t:0})))},e.prototype.create=function(){var e=this;this.modalService.fromComponent(S,{locals:{group:{name:""}}}).pipe(o.switchMap((function(t){return t?e.dataService.customer.createCustomerGroup({name:t,customerIds:[]}):n.EMPTY})),o.switchMap((function(){return e.dataService.customer.getCustomerGroupList().single$}))).subscribe((function(){e.notificationService.success(i.marker("common.notify-create-success"),{entity:"CustomerGroup"})}),(function(t){e.notificationService.error(i.marker("common.notify-create-error"),{entity:"CustomerGroup"})}))},e.prototype.delete=function(e){var t=this;this.modalService.dialog({title:i.marker("customer.confirm-delete-customer-group"),buttons:[{type:"secondary",label:i.marker("common.cancel")},{type:"danger",label:i.marker("common.delete"),returnValue:!0}]}).pipe(o.switchMap((function(r){return r?t.dataService.customer.deleteCustomerGroup(e):n.EMPTY})),o.switchMap((function(e){return e.deleteCustomerGroup.result===r.DeletionResult.DELETED?t.dataService.customer.getCustomerGroupList().mapSingle((function(){return{errorMessage:!1}})):n.of({errorMessage:e.deleteCustomerGroup.message})}))).subscribe((function(e){"string"==typeof e.errorMessage?t.notificationService.error(e.errorMessage):t.notificationService.success(i.marker("common.notify-delete-success"),{entity:"CustomerGroup"})}),(function(e){t.notificationService.error(i.marker("common.notify-delete-error"),{entity:"CustomerGroup"})}))},e.prototype.update=function(e){var t=this;this.modalService.fromComponent(S,{locals:{group:e}}).pipe(o.switchMap((function(r){return r?t.dataService.customer.updateCustomerGroup({id:e.id,name:r}):n.EMPTY}))).subscribe((function(){t.notificationService.success(i.marker("common.notify-update-success"),{entity:"CustomerGroup"})}),(function(e){t.notificationService.error(i.marker("common.notify-update-error"),{entity:"CustomerGroup"})}))},e.prototype.closeMembers=function(){var e=Object.assign({},this.route.snapshot.params);delete e.contents,this.router.navigate(["./",e],{relativeTo:this.route,queryParamsHandling:"preserve"})},e.prototype.addToGroup=function(e){var t=this;this.modalService.fromComponent(l,{locals:{group:e,route:this.route},size:"md",verticalAlign:"top"}).pipe(o.switchMap((function(r){return r?t.dataService.customer.addCustomersToGroup(e.id,r).pipe(o.mapTo(r)):n.EMPTY}))).subscribe({next:function(r){t.notificationService.success(i.marker("customer.add-customers-to-group-success"),{customerCount:r.length,groupName:e.name}),t.refreshActiveGroupMembers$.next(),t.selectedCustomerIds=[]}})},e.prototype.removeFromGroup=function(e,t){var r=this;this.dataService.customer.removeCustomersFromGroup(e.id,t).subscribe({complete:function(){r.notificationService.success(i.marker("customer.remove-customers-from-group-success"),{customerCount:t.length,groupName:e.name}),r.refreshActiveGroupMembers$.next(),r.selectedCustomerIds=[]}})},e}();w.decorators=[{type:t.Component,args:[{selector:"vdr-customer-group-list",template:'<vdr-action-bar>\n    <vdr-ab-left> </vdr-ab-left>\n    <vdr-ab-right>\n        <vdr-action-bar-items locationId="customer-group-list"></vdr-action-bar-items>\n        <button class="btn btn-primary" *vdrIfPermissions="\'CreateCustomerGroup\'" (click)="create()">\n            <clr-icon shape="plus"></clr-icon>\n            {{ \'customer.create-new-customer-group\' | translate }}\n        </button>\n    </vdr-ab-right>\n</vdr-action-bar>\n<div class="group-wrapper">\n    <table class="table group-list" [class.expanded]="activeGroup$ | async" *ngIf="!(listIsEmpty$ | async); else emptyPlaceholder">\n        <tbody>\n            <tr *ngFor="let group of groups$ | async" [class.active]="group.id === (activeGroup$ | async)?.id">\n                <td class="left align-middle"><vdr-entity-info [entity]="group"></vdr-entity-info></td>\n                <td class="left align-middle"><vdr-chip [colorFrom]="group.id">{{ group.name }}</vdr-chip></td>\n                <td class="text-right align-middle">\n                    <a\n                        class="btn btn-link btn-sm"\n                        [routerLink]="[\'./\', { contents: group.id }]"\n                        queryParamsHandling="preserve"\n                    >\n                        <clr-icon shape="view-list"></clr-icon>\n                        {{ \'customer.view-group-members\' | translate }}\n                    </a>\n                </td>\n                <td class="align-middle">\n                    <button class="btn btn-link btn-sm" (click)="update(group)">\n                        <clr-icon shape="edit"></clr-icon>\n                        {{ \'common.edit\' | translate }}\n                    </button>\n                </td>\n                <td class="align-middle">\n                    <vdr-dropdown>\n                        <button type="button" class="btn btn-link btn-sm" vdrDropdownTrigger>\n                            {{ \'common.actions\' | translate }}\n                            <clr-icon shape="caret down"></clr-icon>\n                        </button>\n                        <vdr-dropdown-menu vdrPosition="bottom-right">\n                            <button\n                                class="button"\n                                vdrDropdownItem\n                                (click)="delete(group.id)"\n                                [disabled]="!(\'DeleteCustomerGroup\' | hasPermission)"\n                            >\n                                <clr-icon shape="trash" class="is-danger"></clr-icon>\n                                {{ \'common.delete\' | translate }}\n                            </button>\n                        </vdr-dropdown-menu>\n                    </vdr-dropdown>\n                </td>\n            </tr>\n        </tbody>\n    </table>\n    <ng-template #emptyPlaceholder>\n        <vdr-empty-placeholder></vdr-empty-placeholder>\n    </ng-template>\n    <div class="group-members" [class.expanded]="activeGroup$ | async">\n        <ng-container *ngIf="activeGroup$ | async as activeGroup">\n            <div class="flex">\n                <div class="header-title-row">\n                    {{ activeGroup.name }} ({{ membersTotal$ | async }})\n                </div>\n                <div class="flex-spacer"></div>\n                <button type="button" class="close-button" (click)="closeMembers()">\n                    <clr-icon shape="close"></clr-icon>\n                </button>\n            </div>\n            <div class="controls">\n                <vdr-dropdown>\n                    <button\n                        type="button"\n                        class="btn btn-secondary btn-sm"\n                        vdrDropdownTrigger\n                        [disabled]="selectedCustomerIds.length === 0"\n                    >\n                        {{ \'common.with-selected\' | translate }}\n                        <clr-icon shape="caret down"></clr-icon>\n                    </button>\n                    <vdr-dropdown-menu vdrPosition="bottom-right">\n                        <button\n                            type="button"\n                            class="delete-button"\n                            (click)="removeFromGroup(activeGroup, selectedCustomerIds)"\n                            vdrDropdownItem\n                            [disabled]="!(\'UpdateCustomerGroup\' | hasPermission)"\n                        >\n                            <clr-icon shape="trash" class="is-danger"></clr-icon>\n                            {{ \'customer.remove-from-group\' | translate }}\n                        </button>\n                    </vdr-dropdown-menu>\n                </vdr-dropdown>\n                <button class="btn btn-secondary btn-sm" (click)="addToGroup(activeGroup)">\n                    {{ \'customer.add-customers-to-group\' | translate: { groupName: activeGroup.name } }}\n                </button>\n            </div>\n            <vdr-customer-group-member-list\n                [members]="members$ | async"\n                [route]="route"\n                [totalItems]="membersTotal$ | async"\n                [selectedMemberIds]="selectedCustomerIds"\n                (selectionChange)="selectedCustomerIds = $event"\n                (fetchParamsChange)="fetchGroupMembers$.next($event)"\n            ></vdr-customer-group-member-list>\n        </ng-container>\n    </div>\n</div>\n\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[".group-wrapper{display:flex;height:calc(100% - 50px)}.group-wrapper .group-list{flex:1;overflow:auto;margin-top:0}.group-wrapper .group-list tr.active{background-color:var(--color-component-bg-200)}.group-wrapper .group-list.expanded{width:calc(100% - 40vw)}.group-members{height:100%;width:0;opacity:0;visibility:hidden;overflow:auto;transition:width .3s,opacity .2s .3s,visibility 0s .3s}.group-members.expanded{width:40vw;visibility:visible;opacity:1;padding-left:12px}.group-members .close-button{margin:0;background:none;border:none;cursor:pointer}.group-members ::ng-deep table.table{margin-top:0}.group-members ::ng-deep table.table th{top:0}.group-members .controls{display:flex;justify-content:space-between}vdr-empty-placeholder{flex:1}"]}]}],w.ctorParameters=function(){return[{type:r.DataService},{type:r.NotificationService},{type:r.ModalService},{type:a.ActivatedRoute},{type:a.Router}]};var D=function(){function e(e,r){var o=this;this.router=e,this.dataService=r,this.selectedMemberIds=[],this.selectionChange=new t.EventEmitter,this.fetchParamsChange=new t.EventEmitter,this.filterTermControl=new s.FormControl(""),this.refresh$=new n.BehaviorSubject(!0),this.destroy$=new n.Subject,this.isMemberSelected=function(e){return-1<o.selectedMemberIds.indexOf(e.id)}}return e.prototype.ngOnInit=function(){var e=this;this.membersCurrentPage$=this.route.paramMap.pipe(o.map((function(e){return e.get("membersPage")})),o.map((function(e){return e?+e:1})),o.startWith(1),o.distinctUntilChanged()),this.membersItemsPerPage$=this.route.paramMap.pipe(o.map((function(e){return e.get("membersPerPage")})),o.map((function(e){return e?+e:10})),o.startWith(10),o.distinctUntilChanged());var t=this.filterTermControl.valueChanges.pipe(o.debounceTime(250),o.tap((function(){return e.setContentsPageNumber(1)})),o.startWith(""));n.combineLatest(this.membersCurrentPage$,this.membersItemsPerPage$,t,this.refresh$).pipe(o.takeUntil(this.destroy$)).subscribe((function(t){var r=f(t,3),n=r[0],o=r[1],s=r[2],a=o,i=(n-1)*o;e.fetchParamsChange.emit({filterTerm:s,skip:i,take:a})}))},e.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete()},e.prototype.setContentsPageNumber=function(e){this.setParam("membersPage",e)},e.prototype.setContentsItemsPerPage=function(e){this.setParam("membersPerPage",e)},e.prototype.refresh=function(){this.refresh$.next(!0)},e.prototype.setParam=function(e,t){var r;this.router.navigate(["./",Object.assign(Object.assign({},this.route.snapshot.params),(r={},r[e]=t,r))],{relativeTo:this.route,queryParamsHandling:"merge"})},e.prototype.areAllSelected=function(){return!!this.members&&this.selectedMemberIds.length===this.members.length},e.prototype.toggleSelectAll=function(){this.areAllSelected()?this.selectionChange.emit([]):this.selectionChange.emit(this.members.map((function(e){return e.id})))},e.prototype.toggleSelectMember=function(e){this.selectedMemberIds.includes(e.id)?this.selectionChange.emit(this.selectedMemberIds.filter((function(t){return t!==e.id}))):this.selectionChange.emit(y(this.selectedMemberIds,[e.id]))},e}();D.decorators=[{type:t.Component,args:[{selector:"vdr-customer-group-member-list",template:'<input\n    type="text"\n    name="searchTerm"\n    [formControl]="filterTermControl"\n    [placeholder]="\'customer.search-customers-by-email\' | translate"\n    class="search-input"\n/>\n\n<vdr-data-table\n    [items]="members"\n    [itemsPerPage]="membersItemsPerPage$ | async"\n    [totalItems]="totalItems"\n    [currentPage]="membersCurrentPage$ | async"\n    (pageChange)="setContentsPageNumber($event)"\n    (itemsPerPageChange)="setContentsItemsPerPage($event)"\n    [allSelected]="areAllSelected()"\n    [isRowSelectedFn]="(\'UpdateCustomerGroup\' | hasPermission) && isMemberSelected"\n    (rowSelectChange)="toggleSelectMember($event)"\n    (allSelectChange)="toggleSelectAll()"\n>\n    <vdr-dt-column [expand]="true">{{ \'customer.name\' | translate }}</vdr-dt-column>\n    <vdr-dt-column [expand]="true">{{ \'customer.email-address\' | translate }}</vdr-dt-column>\n    <vdr-dt-column></vdr-dt-column>\n    <ng-template let-customer="item">\n        <td class="left align-middle">\n            {{ customer.title }} {{ customer.firstName }} {{ customer.lastName }}\n        </td>\n        <td class="left align-middle">{{ customer.emailAddress }}</td>\n        <td class="right align-middle">\n            <vdr-table-row-action\n                iconShape="edit"\n                [label]="\'common.edit\' | translate"\n                [linkTo]="[\'/customer\', \'customers\', customer.id]"\n            ></vdr-table-row-action>\n        </td>\n    </ng-template>\n</vdr-data-table>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[""]}]}],D.ctorParameters=function(){return[{type:a.Router},{type:r.DataService}]},D.propDecorators={members:[{type:t.Input}],totalItems:[{type:t.Input}],route:[{type:t.Input}],selectedMemberIds:[{type:t.Input}],selectionChange:[{type:t.Output}],fetchParamsChange:[{type:t.Output}]};var I=function(){function e(){this.addNote=new t.EventEmitter,this.updateNote=new t.EventEmitter,this.deleteNote=new t.EventEmitter,this.note="",this.type=r.HistoryEntryType}return e.prototype.getDisplayType=function(e){switch(e.type){case r.HistoryEntryType.CUSTOMER_VERIFIED:case r.HistoryEntryType.CUSTOMER_EMAIL_UPDATE_VERIFIED:case r.HistoryEntryType.CUSTOMER_PASSWORD_RESET_VERIFIED:return"success";case r.HistoryEntryType.CUSTOMER_REGISTERED:return"muted";case r.HistoryEntryType.CUSTOMER_REMOVED_FROM_GROUP:return"error";default:return"default"}},e.prototype.getTimelineIcon=function(e){switch(e.type){case r.HistoryEntryType.CUSTOMER_REGISTERED:return"user";case r.HistoryEntryType.CUSTOMER_VERIFIED:return["assign-user","is-solid"];case r.HistoryEntryType.CUSTOMER_NOTE:return"note";case r.HistoryEntryType.CUSTOMER_ADDED_TO_GROUP:case r.HistoryEntryType.CUSTOMER_REMOVED_FROM_GROUP:return"users"}},e.prototype.isFeatured=function(e){switch(e.type){case r.HistoryEntryType.CUSTOMER_REGISTERED:case r.HistoryEntryType.CUSTOMER_VERIFIED:return!0;default:return!1}},e.prototype.getName=function(e){var t=e.administrator;return t?t.firstName+" "+t.lastName:this.customer.firstName+" "+this.customer.lastName},e.prototype.addNoteToCustomer=function(){this.addNote.emit({note:this.note}),this.note=""},e}();I.decorators=[{type:t.Component,args:[{selector:"vdr-customer-history",template:'<h4>{{ \'customer.customer-history\' | translate }}</h4>\n<div class="entry-list">\n    <vdr-timeline-entry iconShape="note" displayType="muted" *vdrIfPermissions="\'UpdateCustomer\'">\n        <div class="note-entry">\n            <textarea [(ngModel)]="note" name="note" class="note"></textarea>\n            <button class="btn btn-secondary" [disabled]="!note" (click)="addNoteToCustomer()">\n                {{ \'order.add-note\' | translate }}\n            </button>\n        </div>\n    </vdr-timeline-entry>\n    <vdr-timeline-entry\n        *ngFor="let entry of history"\n        [displayType]="getDisplayType(entry)"\n        [iconShape]="getTimelineIcon(entry)"\n        [createdAt]="entry.createdAt"\n        [name]="getName(entry)"\n        [featured]="isFeatured(entry)"\n    >\n        <ng-container [ngSwitch]="entry.type">\n            <ng-container *ngSwitchCase="type.CUSTOMER_REGISTERED">\n                <div class="title">\n                    {{ \'customer.history-customer-registered\' | translate }}\n                </div>\n                <ng-container *ngIf="entry.data.strategy === \'native\'; else namedStrategy">\n                    {{ \'customer.history-using-native-auth-strategy\' | translate }}\n                </ng-container>\n                <ng-template #namedStrategy>\n                    {{\n                    \'customer.history-using-external-auth-strategy\'\n                        | translate: { strategy: entry.data.strategy }\n                    }}\n                </ng-template>\n            </ng-container>\n            <ng-container *ngSwitchCase="type.CUSTOMER_VERIFIED">\n                <div class="title">\n                    {{ \'customer.history-customer-verified\' | translate }}\n                </div>\n                <ng-container *ngIf="entry.data.strategy === \'native\'; else namedStrategy">\n                    {{ \'customer.history-using-native-auth-strategy\' | translate }}\n                </ng-container>\n                <ng-template #namedStrategy>\n                    {{\n                        \'customer.history-using-external-auth-strategy\'\n                            | translate: { strategy: entry.data.strategy }\n                    }}\n                </ng-template>\n            </ng-container>\n            <ng-container *ngSwitchCase="type.CUSTOMER_DETAIL_UPDATED">\n                <div class="flex">\n                    {{ \'customer.history-customer-detail-updated\' | translate }}\n                    <vdr-history-entry-detail>\n                        <vdr-object-tree [value]="entry.data.input"></vdr-object-tree>\n                    </vdr-history-entry-detail>\n                </div>\n            </ng-container>\n            <ng-container *ngSwitchCase="type.CUSTOMER_ADDED_TO_GROUP">\n                {{\n                    \'customer.history-customer-added-to-group\'\n                        | translate: { groupName: entry.data.groupName }\n                }}\n            </ng-container>\n            <ng-container *ngSwitchCase="type.CUSTOMER_REMOVED_FROM_GROUP">\n                {{\n                    \'customer.history-customer-removed-from-group\'\n                        | translate: { groupName: entry.data.groupName }\n                }}\n            </ng-container>\n            <ng-container *ngSwitchCase="type.CUSTOMER_ADDRESS_CREATED">\n                {{ \'customer.history-customer-address-created\' | translate }}\n                <div class="flex">\n                    <div class="address-string">{{ entry.data.address }}</div>\n                </div>\n            </ng-container>\n            <ng-container *ngSwitchCase="type.CUSTOMER_ADDRESS_UPDATED">\n                {{ \'customer.history-customer-address-updated\' | translate }}\n                <div class="flex">\n                    <div class="address-string">{{ entry.data.address }}</div>\n                    <vdr-history-entry-detail>\n                        <vdr-object-tree [value]="entry.data.input"></vdr-object-tree>\n                    </vdr-history-entry-detail>\n                </div>\n            </ng-container>\n            <ng-container *ngSwitchCase="type.CUSTOMER_ADDRESS_DELETED">\n                {{ \'customer.history-customer-address-deleted\' | translate }}\n                <div class="address-string">{{ entry.data.address }}</div>\n            </ng-container>\n            <ng-container *ngSwitchCase="type.CUSTOMER_PASSWORD_UPDATED">\n                {{ \'customer.history-customer-password-updated\' | translate }}\n            </ng-container>\n            <ng-container *ngSwitchCase="type.CUSTOMER_PASSWORD_RESET_REQUESTED">\n                {{ \'customer.history-customer-password-reset-requested\' | translate }}\n            </ng-container>\n            <ng-container *ngSwitchCase="type.CUSTOMER_PASSWORD_RESET_VERIFIED">\n                {{ \'customer.history-customer-password-reset-verified\' | translate }}\n            </ng-container>\n            <ng-container *ngSwitchCase="type.CUSTOMER_EMAIL_UPDATE_REQUESTED">\n                <div class="flex">\n                    {{ \'customer.history-customer-email-update-requested\' | translate }}\n                    <vdr-history-entry-detail>\n                        <vdr-labeled-data [label]="\'customer.old-email-address\' | translate">{{\n                            entry.data.oldEmailAddress\n                        }}</vdr-labeled-data>\n                        <vdr-labeled-data [label]="\'customer.new-email-address\' | translate">{{\n                            entry.data.newEmailAddress\n                        }}</vdr-labeled-data>\n                    </vdr-history-entry-detail>\n                </div>\n            </ng-container>\n            <ng-container *ngSwitchCase="type.CUSTOMER_EMAIL_UPDATE_VERIFIED">\n                <div class="flex">\n                    {{ \'customer.history-customer-email-update-verified\' | translate }}\n                    <vdr-history-entry-detail>\n                        <vdr-labeled-data [label]="\'customer.old-email-address\' | translate">{{\n                            entry.data.oldEmailAddress\n                        }}</vdr-labeled-data>\n                        <vdr-labeled-data [label]="\'customer.new-email-address\' | translate">{{\n                            entry.data.newEmailAddress\n                        }}</vdr-labeled-data>\n                    </vdr-history-entry-detail>\n                </div>\n            </ng-container>\n            <ng-container *ngSwitchCase="type.CUSTOMER_NOTE">\n                <div class="flex">\n                    <div class="note-text">\n                        {{ entry.data.note }}\n                    </div>\n                    <div class="flex-spacer"></div>\n                    <vdr-dropdown>\n                        <button class="icon-button" vdrDropdownTrigger>\n                            <clr-icon shape="ellipsis-vertical"></clr-icon>\n                        </button>\n                        <vdr-dropdown-menu vdrPosition="bottom-right">\n                            <button\n                                class="button"\n                                vdrDropdownItem\n                                (click)="updateNote.emit(entry)"\n                                [disabled]="!(\'UpdateCustomer\' | hasPermission)"\n                            >\n                                <clr-icon shape="edit"></clr-icon>\n                                {{ \'common.edit\' | translate }}\n                            </button>\n                            <div class="dropdown-divider"></div>\n                            <button\n                                class="button"\n                                vdrDropdownItem\n                                (click)="deleteNote.emit(entry)"\n                                [disabled]="!(\'UpdateCustomer\' | hasPermission)"\n                            >\n                                <clr-icon shape="trash" class="is-danger"></clr-icon>\n                                {{ \'common.delete\' | translate }}\n                            </button>\n                        </vdr-dropdown-menu>\n                    </vdr-dropdown>\n                </div>\n            </ng-container>\n        </ng-container>\n    </vdr-timeline-entry>\n    <vdr-timeline-entry [isLast]="true"></vdr-timeline-entry>\n</div>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[".entry-list{margin-top:24px;margin-left:24px;margin-right:12px}.note-entry{display:flex;align-items:center}.note-entry .note{flex:1}.note-entry button{margin:0}textarea.note{flex:1;height:36px;border-radius:3px;margin-right:6px}.note-text{color:var(--color-text-100);white-space:pre-wrap}.address-string{font-size:smaller;color:var(--color-text-200)}"]}]}],I.propDecorators={customer:[{type:t.Input}],history:[{type:t.Input}],addNote:[{type:t.Output}],updateNote:[{type:t.Output}],deleteNote:[{type:t.Output}]};var E=function(e){function t(t,r,n,o,a){var i=e.call(this,r,n)||this;return i.dataService=t,i.modalService=o,i.notificationService=a,i.emailSearchTerm=new s.FormControl(""),i.lastNameSearchTerm=new s.FormControl(""),e.prototype.setQueryFn.call(i,(function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return(e=i.dataService.customer).getCustomerList.apply(e,y(t)).refetchOnChannelChange()}),(function(e){return e.customers}),(function(e,t){return{options:{skip:e,take:t,filter:{emailAddress:{contains:i.emailSearchTerm.value},lastName:{contains:i.lastNameSearchTerm.value}},sort:{createdAt:d.SortOrder.DESC}}}})),i}return g(t,e),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),n.merge(this.emailSearchTerm.valueChanges,this.lastNameSearchTerm.valueChanges).pipe(o.filter((function(e){return 2<e.length||0===e.length})),o.debounceTime(250),o.takeUntil(this.destroy$)).subscribe((function(){return t.refresh()}))},t.prototype.deleteCustomer=function(e){var t=this;return this.modalService.dialog({title:i.marker("catalog.confirm-delete-customer"),body:e.firstName+" "+e.lastName,buttons:[{type:"secondary",label:i.marker("common.cancel")},{type:"danger",label:i.marker("common.delete"),returnValue:!0}]}).pipe(o.switchMap((function(r){return r?t.dataService.customer.deleteCustomer(e.id):n.EMPTY}))).subscribe((function(){t.notificationService.success(i.marker("common.notify-delete-success"),{entity:"Customer"}),t.refresh()}),(function(e){t.notificationService.error(i.marker("common.notify-delete-error"),{entity:"Customer"})}))},t}(r.BaseListComponent);E.decorators=[{type:t.Component,args:[{selector:"vdr-customer-list",template:'<vdr-action-bar>\n    <vdr-ab-left>\n        <input\n            type="text"\n            name="emailSearchTerm"\n            [formControl]="emailSearchTerm"\n            [placeholder]="\'customer.search-customers-by-email\' | translate"\n            class="search-input ml3"\n        />\n        <input\n            type="text"\n            name="lastNameSearchTerm"\n            [formControl]="lastNameSearchTerm"\n            [placeholder]="\'customer.search-customers-by-last-name\' | translate"\n            class="search-input ml3"\n        />\n    </vdr-ab-left>\n    <vdr-ab-right>\n        <vdr-action-bar-items locationId="customer-list"></vdr-action-bar-items>\n        <a class="btn btn-primary" [routerLink]="[\'./create\']" *vdrIfPermissions="\'CreateCustomer\'">\n            <clr-icon shape="plus"></clr-icon>\n            {{ \'customer.create-new-customer\' | translate }}\n        </a>\n    </vdr-ab-right>\n</vdr-action-bar>\n\n<vdr-data-table\n    [items]="items$ | async"\n    [itemsPerPage]="itemsPerPage$ | async"\n    [totalItems]="totalItems$ | async"\n    [currentPage]="currentPage$ | async"\n    (pageChange)="setPageNumber($event)"\n    (itemsPerPageChange)="setItemsPerPage($event)"\n>\n    <vdr-dt-column [expand]="true">{{ \'customer.name\' | translate }}</vdr-dt-column>\n    <vdr-dt-column [expand]="true">{{ \'customer.email-address\' | translate }}</vdr-dt-column>\n    <vdr-dt-column>{{ \'customer.customer-type\' | translate }}</vdr-dt-column>\n    <vdr-dt-column></vdr-dt-column>\n    <vdr-dt-column></vdr-dt-column>\n    <ng-template let-customer="item">\n        <td class="left align-middle">\n            {{ customer.title }} {{ customer.firstName }} {{ customer.lastName }}\n        </td>\n        <td class="left align-middle">{{ customer.emailAddress }}</td>\n        <td class="left align-middle">\n            <vdr-customer-status-label [customer]="customer"></vdr-customer-status-label>\n        </td>\n        <td class="right align-middle">\n            <vdr-table-row-action\n                iconShape="edit"\n                [label]="\'common.edit\' | translate"\n                [linkTo]="[\'./\', customer.id]"\n            ></vdr-table-row-action>\n        </td>\n        <td>\n            <vdr-dropdown>\n                <button type="button" class="btn btn-link btn-sm" vdrDropdownTrigger>\n                    {{ \'common.actions\' | translate }}\n                    <clr-icon shape="caret down"></clr-icon>\n                </button>\n                <vdr-dropdown-menu vdrPosition="bottom-right">\n                    <button\n                        type="button"\n                        class="delete-button"\n                        (click)="deleteCustomer(customer)"\n                        [disabled]="!(\'DeleteCustomer\' | hasPermission)"\n                        vdrDropdownItem\n                    >\n                        <clr-icon shape="trash" class="is-danger"></clr-icon>\n                        {{ \'common.delete\' | translate }}\n                    </button>\n                </vdr-dropdown-menu>\n            </vdr-dropdown>\n        </td>\n    </ng-template>\n</vdr-data-table>\n',styles:[".search-input{margin-top:6px;min-width:300px}"]}]}],E.ctorParameters=function(){return[{type:r.DataService},{type:a.Router},{type:a.ActivatedRoute},{type:r.ModalService},{type:r.NotificationService}]};var P=function(){};P.decorators=[{type:t.Component,args:[{selector:"vdr-customer-status-label",template:'<vdr-chip *ngIf="customer.user?.id">\n    <ng-container *ngIf="customer.user?.verified">\n        <clr-icon shape="check-circle" class="verified-user-icon"></clr-icon>\n        {{ \'customer.verified\' | translate }}\n    </ng-container>\n    <ng-container *ngIf="!customer.user?.verified">\n        <clr-icon shape="check-circle" class="registered-user-icon"></clr-icon>\n        {{ \'customer.registered\' | translate }}\n    </ng-container>\n</vdr-chip>\n<vdr-chip *ngIf="!customer.user?.id">{{ \'customer.guest\' | translate }}</vdr-chip>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,styles:[".registered-user-icon{color:var(--color-grey-300)}.verified-user-icon{color:var(--color-success-500)}"]}]}],P.propDecorators={customer:[{type:t.Input}]};var T=function(e){function t(t,r){return e.call(this,t,{__typename:"Customer",id:"",createdAt:"",updatedAt:"",title:"",firstName:"",lastName:"",emailAddress:"",phoneNumber:null,addresses:null,user:null},(function(e){return r.customer.getCustomer(e).mapStream((function(e){return e.customer}))}))||this}return g(t,e),t}(r.BaseEntityResolver);T.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new T(t.ɵɵinject(a.Router),t.ɵɵinject(r.DataService))},token:T,providedIn:"root"}),T.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],T.ctorParameters=function(){return[{type:a.Router},{type:r.DataService}]};var F={breadcrumb:i.marker("breadcrumb.customers")},N={breadcrumb:k},A={breadcrumb:i.marker("breadcrumb.customer-groups")},O=[{path:"customers",component:E,pathMatch:"",data:F},{path:"customers/:id",component:C,resolve:r.createResolveData(T),canDeactivate:[r.CanDeactivateDetailGuard],data:N},{path:"groups",component:w,data:A}];function k(e,t){return r.detailBreadcrumb({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.customers",getName:function(e){return e.firstName+" "+e.lastName},route:"customers"})}var x=function(){};x.decorators=[{type:t.NgModule,args:[{imports:[r.SharedModule,a.RouterModule.forChild(O)],declarations:[E,C,P,m,w,S,l,D,b,I,u],exports:[m]}]}],e.AddCustomerToGroupDialogComponent=l,e.AddressCardComponent=m,e.AddressDetailDialogComponent=u,e.CustomerDetailComponent=C,e.CustomerGroupDetailDialogComponent=S,e.CustomerGroupListComponent=w,e.CustomerGroupMemberListComponent=D,e.CustomerHistoryComponent=I,e.CustomerListComponent=E,e.CustomerModule=x,e.CustomerResolver=T,e.CustomerStatusLabelComponent=P,e.SelectCustomerGroupDialogComponent=b,e.customerBreadcrumb=k,e.customerRoutes=O,e.ɵ0=F,e.ɵ1=N,e.ɵ2=A,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=vendure-admin-ui-customer.umd.min.js.map
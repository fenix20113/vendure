import { GET_NEWTORK_STATUS, GET_UI_STATE, GET_USER_STATUS } from '../definitions/client-definitions';
const ɵ0 = (_, args, { cache }) => {
    return updateRequestsInFlight(cache, 1);
}, ɵ1 = (_, args, { cache }) => {
    return updateRequestsInFlight(cache, -1);
}, ɵ2 = (_, args, { cache }) => {
    const { input: { username, loginTime, channels, activeChannelId }, } = args;
    // tslint:disable-next-line:no-non-null-assertion
    const permissions = channels.find(c => c.id === activeChannelId).permissions;
    const data = {
        userStatus: {
            __typename: 'UserStatus',
            username,
            loginTime,
            isLoggedIn: true,
            permissions,
            channels,
            activeChannelId,
        },
    };
    cache.writeQuery({ query: GET_USER_STATUS, data });
    return data.userStatus;
}, ɵ3 = (_, args, { cache }) => {
    const data = {
        userStatus: {
            __typename: 'UserStatus',
            username: '',
            loginTime: '',
            isLoggedIn: false,
            permissions: [],
            channels: [],
            activeChannelId: null,
        },
    };
    cache.writeQuery({ query: GET_USER_STATUS, data });
    return data.userStatus;
}, ɵ4 = (_, args, { cache }) => {
    // tslint:disable-next-line:no-non-null-assertion
    const previous = cache.readQuery({ query: GET_UI_STATE });
    const data = {
        uiState: {
            __typename: 'UiState',
            language: args.languageCode,
            theme: previous.uiState.theme,
        },
    };
    cache.writeQuery({ query: GET_UI_STATE, data });
    return args.languageCode;
}, ɵ5 = (_, args, { cache }) => {
    // tslint:disable-next-line:no-non-null-assertion
    const previous = cache.readQuery({ query: GET_UI_STATE });
    const data = {
        uiState: {
            __typename: 'UiState',
            language: previous.uiState.language,
            theme: args.theme,
        },
    };
    cache.writeQuery({ query: GET_UI_STATE, data });
    return args.theme;
}, ɵ6 = (_, args, { cache }) => {
    // tslint:disable-next-line:no-non-null-assertion
    const previous = cache.readQuery({ query: GET_USER_STATUS });
    const activeChannel = previous.userStatus.channels.find(c => c.id === args.channelId);
    if (!activeChannel) {
        throw new Error('setActiveChannel: Could not find Channel with ID ' + args.channelId);
    }
    const permissions = activeChannel.permissions;
    const data = {
        userStatus: Object.assign(Object.assign({}, previous.userStatus), { permissions, activeChannelId: activeChannel.id }),
    };
    cache.writeQuery({ query: GET_USER_STATUS, data });
    return data.userStatus;
}, ɵ7 = (_, args, { cache }) => {
    // tslint:disable-next-line:no-non-null-assertion
    const previous = cache.readQuery({ query: GET_USER_STATUS });
    const data = {
        userStatus: Object.assign(Object.assign({}, previous.userStatus), { channels: Array.isArray(args.channels) ? args.channels : [args.channels] }),
    };
    cache.writeQuery({ query: GET_USER_STATUS, data });
    return data.userStatus;
};
export const clientResolvers = {
    Mutation: {
        requestStarted: ɵ0,
        requestCompleted: ɵ1,
        setAsLoggedIn: ɵ2,
        setAsLoggedOut: ɵ3,
        setUiLanguage: ɵ4,
        setUiTheme: ɵ5,
        setActiveChannel: ɵ6,
        updateUserChannels: ɵ7,
    },
};
function updateRequestsInFlight(cache, increment) {
    const previous = cache.readQuery({ query: GET_NEWTORK_STATUS });
    const inFlightRequests = previous ? previous.networkStatus.inFlightRequests + increment : increment;
    const data = {
        networkStatus: {
            __typename: 'NetworkStatus',
            inFlightRequests,
        },
    };
    cache.writeQuery({ query: GET_NEWTORK_STATUS, data });
    return inFlightRequests;
}
export { ɵ0, ɵ1, ɵ2, ɵ3, ɵ4, ɵ5, ɵ6, ɵ7 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpZW50LXJlc29sdmVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9saWIvY29yZS9zcmMvZGF0YS9jbGllbnQtc3RhdGUvY2xpZW50LXJlc29sdmVycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFjQSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsWUFBWSxFQUFFLGVBQWUsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO1dBZ0I5RSxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsRUFBRSxLQUFLLEVBQUUsRUFBVSxFQUFFO0lBQzNDLE9BQU8sc0JBQXNCLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQzVDLENBQUMsT0FDaUIsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLEVBQUUsS0FBSyxFQUFFLEVBQVUsRUFBRTtJQUM3QyxPQUFPLHNCQUFzQixDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzdDLENBQUMsT0FDYyxDQUFDLENBQUMsRUFBRSxJQUE2QixFQUFFLEVBQUUsS0FBSyxFQUFFLEVBQTRCLEVBQUU7SUFDckYsTUFBTSxFQUNGLEtBQUssRUFBRSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLGVBQWUsRUFBRSxHQUM1RCxHQUFHLElBQUksQ0FBQztJQUNULGlEQUFpRDtJQUNqRCxNQUFNLFdBQVcsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxlQUFlLENBQUUsQ0FBQyxXQUFXLENBQUM7SUFDOUUsTUFBTSxJQUFJLEdBQStCO1FBQ3JDLFVBQVUsRUFBRTtZQUNSLFVBQVUsRUFBRSxZQUFZO1lBQ3hCLFFBQVE7WUFDUixTQUFTO1lBQ1QsVUFBVSxFQUFFLElBQUk7WUFDaEIsV0FBVztZQUNYLFFBQVE7WUFDUixlQUFlO1NBQ2xCO0tBQ0osQ0FBQztJQUNGLEtBQUssQ0FBQyxVQUFVLENB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UUFBUSxDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztJQUNwRyxNQUFNLElBQUksR0FBMkI7UUFDakMsYUFBYSxFQUFFO1lBQ1gsVUFBVSxFQUFFLGVBQWU7WUFDM0IsZ0JBQWdCO1NBQ25CO0tBQ0osQ0FBQztJQUNGLEtBQUssQ0FBQyxVQUFVLENBQUMsRUFBRSxLQUFLLEVBQUUsa0JBQWtCLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUN0RCxPQUFPLGdCQUFnQixDQUFDO0FBQzVCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbk1lbW9yeUNhY2hlIH0gZnJvbSAnQGFwb2xsby9jbGllbnQvY29yZSc7XG5cbmltcG9ydCB7XG4gICAgR2V0TmV0d29ya1N0YXR1cyxcbiAgICBHZXRVaVN0YXRlLFxuICAgIEdldFVzZXJTdGF0dXMsXG4gICAgTGFuZ3VhZ2VDb2RlLFxuICAgIFNldEFjdGl2ZUNoYW5uZWwsXG4gICAgU2V0QXNMb2dnZWRJbixcbiAgICBTZXRVaUxhbmd1YWdlLFxuICAgIFNldFVpVGhlbWUsXG4gICAgVXBkYXRlVXNlckNoYW5uZWxzLFxuICAgIFVzZXJTdGF0dXMsXG59IGZyb20gJy4uLy4uL2NvbW1vbi9nZW5lcmF0ZWQtdHlwZXMnO1xuaW1wb3J0IHsgR0VUX05FV1RPUktfU1RBVFVTLCBHRVRfVUlfU1RBVEUsIEdFVF9VU0VSX1NUQVRVUyB9IGZyb20gJy4uL2RlZmluaXRpb25zL2NsaWVudC1kZWZpbml0aW9ucyc7XG5cbmV4cG9ydCB0eXBlIFJlc29sdmVyQ29udGV4dCA9IHtcbiAgICBjYWNoZTogSW5NZW1vcnlDYWNoZTtcbiAgICBvcHRpbWlzdGljUmVzcG9uc2U6IGFueTtcbiAgICBnZXRDYWNoZUtleTogKHN0b3JlT2JqOiBhbnkpID0+IHN0cmluZztcbn07XG5cbmV4cG9ydCB0eXBlIFJlc29sdmVyRGVmaW5pdGlvbiA9IHtcbiAgICBNdXRhdGlvbjoge1xuICAgICAgICBbbmFtZTogc3RyaW5nXTogKHJvb3RWYWx1ZTogYW55LCBhcmdzOiBhbnksIGNvbnRleHQ6IFJlc29sdmVyQ29udGV4dCwgaW5mbz86IGFueSkgPT4gYW55O1xuICAgIH07XG59O1xuXG5leHBvcnQgY29uc3QgY2xpZW50UmVzb2x2ZXJzOiBSZXNvbHZlckRlZmluaXRpb24gPSB7XG4gICAgTXV0YXRpb246IHtcbiAgICAgICAgcmVxdWVzdFN0YXJ0ZWQ6IChfLCBhcmdzLCB7IGNhY2hlIH0pOiBudW1iZXIgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZVJlcXVlc3RzSW5GbGlnaHQoY2FjaGUsIDEpO1xuICAgICAgICB9LFxuICAgICAgICByZXF1ZXN0Q29tcGxldGVkOiAoXywgYXJncywgeyBjYWNoZSB9KTogbnVtYmVyID0+IHtcbiAgICAgICAgICAgIHJldHVybiB1cGRhdGVSZXF1ZXN0c0luRmxpZ2h0KGNhY2hlLCAtMSk7XG4gICAgICAgIH0sXG4gICAgICAgIHNldEFzTG9nZ2VkSW46IChfLCBhcmdzOiBTZXRBc0xvZ2dlZEluLlZhcmlhYmxlcywgeyBjYWNoZSB9KTogR2V0VXNlclN0YXR1cy5Vc2VyU3RhdHVzID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHtcbiAgICAgICAgICAgICAgICBpbnB1dDogeyB1c2VybmFtZSwgbG9naW5UaW1lLCBjaGFubmVscywgYWN0aXZlQ2hhbm5lbElkIH0sXG4gICAgICAgICAgICB9ID0gYXJncztcbiAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1ub24tbnVsbC1hc3NlcnRpb25cbiAgICAgICAgICAgIGNvbnN0IHBlcm1pc3Npb25zID0gY2hhbm5lbHMuZmluZChjID0+IGMuaWQgPT09IGFjdGl2ZUNoYW5uZWxJZCkhLnBlcm1pc3Npb25zO1xuICAgICAgICAgICAgY29uc3QgZGF0YTogeyB1c2VyU3RhdHVzOiBVc2VyU3RhdHVzIH0gPSB7XG4gICAgICAgICAgICAgICAgdXNlclN0YXR1czoge1xuICAgICAgICAgICAgICAgICAgICBfX3R5cGVuYW1lOiAnVXNlclN0YXR1cycsXG4gICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lLFxuICAgICAgICAgICAgICAgICAgICBsb2dpblRpbWUsXG4gICAgICAgICAgICAgICAgICAgIGlzTG9nZ2VkSW46IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb25zLFxuICAgICAgICAgICAgICAgICAgICBjaGFubmVscyxcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlQ2hhbm5lbElkLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY2FjaGUud3JpdGVRdWVyeSh7IHF1ZXJ5OiBHRVRfVVNFUl9TVEFUVVMsIGRhdGEgfSk7XG4gICAgICAgICAgICByZXR1cm4gZGF0YS51c2VyU3RhdHVzO1xuICAgICAgICB9LFxuICAgICAgICBzZXRBc0xvZ2dlZE91dDogKF8sIGFyZ3MsIHsgY2FjaGUgfSk6IEdldFVzZXJTdGF0dXMuVXNlclN0YXR1cyA9PiB7XG4gICAgICAgICAgICBjb25zdCBkYXRhOiBHZXRVc2VyU3RhdHVzLlF1ZXJ5ID0ge1xuICAgICAgICAgICAgICAgIHVzZXJTdGF0dXM6IHtcbiAgICAgICAgICAgICAgICAgICAgX190eXBlbmFtZTogJ1VzZXJTdGF0dXMnLFxuICAgICAgICAgICAgICAgICAgICB1c2VybmFtZTogJycsXG4gICAgICAgICAgICAgICAgICAgIGxvZ2luVGltZTogJycsXG4gICAgICAgICAgICAgICAgICAgIGlzTG9nZ2VkSW46IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBwZXJtaXNzaW9uczogW10sXG4gICAgICAgICAgICAgICAgICAgIGNoYW5uZWxzOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlQ2hhbm5lbElkOiBudWxsLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY2FjaGUud3JpdGVRdWVyeSh7IHF1ZXJ5OiBHRVRfVVNFUl9TVEFUVVMsIGRhdGEgfSk7XG4gICAgICAgICAgICByZXR1cm4gZGF0YS51c2VyU3RhdHVzO1xuICAgICAgICB9LFxuICAgICAgICBzZXRVaUxhbmd1YWdlOiAoXywgYXJnczogU2V0VWlMYW5ndWFnZS5WYXJpYWJsZXMsIHsgY2FjaGUgfSk6IExhbmd1YWdlQ29kZSA9PiB7XG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tbm9uLW51bGwtYXNzZXJ0aW9uXG4gICAgICAgICAgICBjb25zdCBwcmV2aW91cyA9IGNhY2hlLnJlYWRRdWVyeTxHZXRVaVN0YXRlLlF1ZXJ5Pih7IHF1ZXJ5OiBHRVRfVUlfU1RBVEUgfSkhO1xuICAgICAgICAgICAgY29uc3QgZGF0YTogR2V0VWlTdGF0ZS5RdWVyeSA9IHtcbiAgICAgICAgICAgICAgICB1aVN0YXRlOiB7XG4gICAgICAgICAgICAgICAgICAgIF9fdHlwZW5hbWU6ICdVaVN0YXRlJyxcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IGFyZ3MubGFuZ3VhZ2VDb2RlLFxuICAgICAgICAgICAgICAgICAgICB0aGVtZTogcHJldmlvdXMudWlTdGF0ZS50aGVtZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNhY2hlLndyaXRlUXVlcnkoeyBxdWVyeTogR0VUX1VJX1NUQVRFLCBkYXRhIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGFyZ3MubGFuZ3VhZ2VDb2RlO1xuICAgICAgICB9LFxuICAgICAgICBzZXRVaVRoZW1lOiAoXywgYXJnczogU2V0VWlUaGVtZS5WYXJpYWJsZXMsIHsgY2FjaGUgfSk6IHN0cmluZyA9PiB7XG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tbm9uLW51bGwtYXNzZXJ0aW9uXG4gICAgICAgICAgICBjb25zdCBwcmV2aW91cyA9IGNhY2hlLnJlYWRRdWVyeTxHZXRVaVN0YXRlLlF1ZXJ5Pih7IHF1ZXJ5OiBHRVRfVUlfU1RBVEUgfSkhO1xuICAgICAgICAgICAgY29uc3QgZGF0YTogR2V0VWlTdGF0ZS5RdWVyeSA9IHtcbiAgICAgICAgICAgICAgICB1aVN0YXRlOiB7XG4gICAgICAgICAgICAgICAgICAgIF9fdHlwZW5hbWU6ICdVaVN0YXRlJyxcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IHByZXZpb3VzLnVpU3RhdGUubGFuZ3VhZ2UsXG4gICAgICAgICAgICAgICAgICAgIHRoZW1lOiBhcmdzLnRoZW1lLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY2FjaGUud3JpdGVRdWVyeSh7IHF1ZXJ5OiBHRVRfVUlfU1RBVEUsIGRhdGEgfSk7XG4gICAgICAgICAgICByZXR1cm4gYXJncy50aGVtZTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0QWN0aXZlQ2hhbm5lbDogKF8sIGFyZ3M6IFNldEFjdGl2ZUNoYW5uZWwuVmFyaWFibGVzLCB7IGNhY2hlIH0pOiBVc2VyU3RhdHVzID0+IHtcbiAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1ub24tbnVsbC1hc3NlcnRpb25cbiAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzID0gY2FjaGUucmVhZFF1ZXJ5PEdldFVzZXJTdGF0dXMuUXVlcnk+KHsgcXVlcnk6IEdFVF9VU0VSX1NUQVRVUyB9KSE7XG4gICAgICAgICAgICBjb25zdCBhY3RpdmVDaGFubmVsID0gcHJldmlvdXMudXNlclN0YXR1cy5jaGFubmVscy5maW5kKGMgPT4gYy5pZCA9PT0gYXJncy5jaGFubmVsSWQpO1xuICAgICAgICAgICAgaWYgKCFhY3RpdmVDaGFubmVsKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdzZXRBY3RpdmVDaGFubmVsOiBDb3VsZCBub3QgZmluZCBDaGFubmVsIHdpdGggSUQgJyArIGFyZ3MuY2hhbm5lbElkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHBlcm1pc3Npb25zID0gYWN0aXZlQ2hhbm5lbC5wZXJtaXNzaW9ucztcbiAgICAgICAgICAgIGNvbnN0IGRhdGE6IHsgdXNlclN0YXR1czogVXNlclN0YXR1cyB9ID0ge1xuICAgICAgICAgICAgICAgIHVzZXJTdGF0dXM6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4ucHJldmlvdXMudXNlclN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnMsXG4gICAgICAgICAgICAgICAgICAgIGFjdGl2ZUNoYW5uZWxJZDogYWN0aXZlQ2hhbm5lbC5pZCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNhY2hlLndyaXRlUXVlcnkoeyBxdWVyeTogR0VUX1VTRVJfU1RBVFVTLCBkYXRhIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGEudXNlclN0YXR1cztcbiAgICAgICAgfSxcbiAgICAgICAgdXBkYXRlVXNlckNoYW5uZWxzOiAoXywgYXJnczogVXBkYXRlVXNlckNoYW5uZWxzLlZhcmlhYmxlcywgeyBjYWNoZSB9KTogVXNlclN0YXR1cyA9PiB7XG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tbm9uLW51bGwtYXNzZXJ0aW9uXG4gICAgICAgICAgICBjb25zdCBwcmV2aW91cyA9IGNhY2hlLnJlYWRRdWVyeTxHZXRVc2VyU3RhdHVzLlF1ZXJ5Pih7IHF1ZXJ5OiBHRVRfVVNFUl9TVEFUVVMgfSkhO1xuICAgICAgICAgICAgY29uc3QgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICB1c2VyU3RhdHVzOiB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnByZXZpb3VzLnVzZXJTdGF0dXMsXG4gICAgICAgICAgICAgICAgICAgIGNoYW5uZWxzOiBBcnJheS5pc0FycmF5KGFyZ3MuY2hhbm5lbHMpID8gYXJncy5jaGFubmVscyA6IFthcmdzLmNoYW5uZWxzXSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNhY2hlLndyaXRlUXVlcnkoeyBxdWVyeTogR0VUX1VTRVJfU1RBVFVTLCBkYXRhIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGEudXNlclN0YXR1cztcbiAgICAgICAgfSxcbiAgICB9LFxufTtcblxuZnVuY3Rpb24gdXBkYXRlUmVxdWVzdHNJbkZsaWdodChjYWNoZTogSW5NZW1vcnlDYWNoZSwgaW5jcmVtZW50OiAxIHwgLTEpOiBudW1iZXIge1xuICAgIGNvbnN0IHByZXZpb3VzID0gY2FjaGUucmVhZFF1ZXJ5PEdldE5ldHdvcmtTdGF0dXMuUXVlcnk+KHsgcXVlcnk6IEdFVF9ORVdUT1JLX1NUQVRVUyB9KTtcbiAgICBjb25zdCBpbkZsaWdodFJlcXVlc3RzID0gcHJldmlvdXMgPyBwcmV2aW91cy5uZXR3b3JrU3RhdHVzLmluRmxpZ2h0UmVxdWVzdHMgKyBpbmNyZW1lbnQgOiBpbmNyZW1lbnQ7XG4gICAgY29uc3QgZGF0YTogR2V0TmV0d29ya1N0YXR1cy5RdWVyeSA9IHtcbiAgICAgICAgbmV0d29ya1N0YXR1czoge1xuICAgICAgICAgICAgX190eXBlbmFtZTogJ05ldHdvcmtTdGF0dXMnLFxuICAgICAgICAgICAgaW5GbGlnaHRSZXF1ZXN0cyxcbiAgICAgICAgfSxcbiAgICB9O1xuICAgIGNhY2hlLndyaXRlUXVlcnkoeyBxdWVyeTogR0VUX05FV1RPUktfU1RBVFVTLCBkYXRhIH0pO1xuICAgIHJldHVybiBpbkZsaWdodFJlcXVlc3RzO1xufVxuIl19
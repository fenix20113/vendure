import { pick } from '@vendure/common/lib/pick';
import { SortOrder, } from '../../common/generated-types';
import { ADD_OPTION_GROUP_TO_PRODUCT, ADD_OPTION_TO_GROUP, ASSIGN_PRODUCTS_TO_CHANNEL, ASSIGN_VARIANTS_TO_CHANNEL, CREATE_ASSETS, CREATE_PRODUCT, CREATE_PRODUCT_OPTION_GROUP, CREATE_PRODUCT_VARIANTS, CREATE_TAG, DELETE_ASSETS, DELETE_PRODUCT, DELETE_PRODUCT_VARIANT, DELETE_TAG, GET_ASSET, GET_ASSET_LIST, GET_PRODUCT_LIST, GET_PRODUCT_OPTION_GROUP, GET_PRODUCT_OPTION_GROUPS, GET_PRODUCT_SIMPLE, GET_PRODUCT_VARIANT, GET_PRODUCT_VARIANT_LIST, GET_PRODUCT_VARIANT_OPTIONS, GET_PRODUCT_WITH_VARIANTS, GET_TAG, GET_TAG_LIST, PRODUCT_SELECTOR_SEARCH, REMOVE_OPTION_GROUP_FROM_PRODUCT, REMOVE_PRODUCTS_FROM_CHANNEL, REMOVE_VARIANTS_FROM_CHANNEL, SEARCH_PRODUCTS, UPDATE_ASSET, UPDATE_PRODUCT, UPDATE_PRODUCT_OPTION, UPDATE_PRODUCT_VARIANTS, UPDATE_TAG, } from '../definitions/product-definitions';
import { REINDEX } from '../definitions/settings-definitions';
export class ProductDataService {
    constructor(baseDataService) {
        this.baseDataService = baseDataService;
    }
    searchProducts(term, take = 10, skip = 0) {
        return this.baseDataService.query(SEARCH_PRODUCTS, {
            input: {
                term,
                take,
                skip,
                groupByProduct: true,
            },
        });
    }
    productSelectorSearch(term, take) {
        return this.baseDataService.query(PRODUCT_SELECTOR_SEARCH, {
            take,
            term,
        });
    }
    reindex() {
        return this.baseDataService.mutate(REINDEX);
    }
    getProducts(options) {
        return this.baseDataService.query(GET_PRODUCT_LIST, {
            options,
        });
    }
    getProduct(id) {
        return this.baseDataService.query(GET_PRODUCT_WITH_VARIANTS, {
            id,
        });
    }
    getProductSimple(id) {
        return this.baseDataService.query(GET_PRODUCT_SIMPLE, {
            id,
        });
    }
    getProductVariants(options) {
        return this.baseDataService.query(GET_PRODUCT_VARIANT_LIST, { options });
    }
    getProductVariant(id) {
        return this.baseDataService.query(GET_PRODUCT_VARIANT, { id });
    }
    getProductVariantsOptions(id) {
        return this.baseDataService.query(GET_PRODUCT_VARIANT_OPTIONS, {
            id,
        });
    }
    getProductOptionGroup(id) {
        return this.baseDataService.query(GET_PRODUCT_OPTION_GROUP, {
            id,
        });
    }
    createProduct(product) {
        const input = {
            input: pick(product, [
                'enabled',
                'translations',
                'customFields',
                'assetIds',
                'featuredAssetId',
                'facetValueIds',
            ]),
        };
        return this.baseDataService.mutate(CREATE_PRODUCT, input);
    }
    updateProduct(product) {
        const input = {
            input: pick(product, [
                'id',
                'enabled',
                'translations',
                'customFields',
                'assetIds',
                'featuredAssetId',
                'facetValueIds',
            ]),
        };
        return this.baseDataService.mutate(UPDATE_PRODUCT, input);
    }
    deleteProduct(id) {
        return this.baseDataService.mutate(DELETE_PRODUCT, {
            id,
        });
    }
    createProductVariants(input) {
        return this.baseDataService.mutate(CREATE_PRODUCT_VARIANTS, {
            input,
        });
    }
    updateProductVariants(variants) {
        const input = {
            input: variants.map(pick([
                'id',
                'enabled',
                'translations',
                'sku',
                'price',
                'taxCategoryId',
                'facetValueIds',
                'featuredAssetId',
                'assetIds',
                'trackInventory',
                'outOfStockThreshold',
                'useGlobalOutOfStockThreshold',
                'stockOnHand',
                'customFields',
            ])),
        };
        return this.baseDataService.mutate(UPDATE_PRODUCT_VARIANTS, input);
    }
    deleteProductVariant(id) {
        return this.baseDataService.mutate(DELETE_PRODUCT_VARIANT, {
            id,
        });
    }
    createProductOptionGroups(productOptionGroup) {
        const input = {
            input: productOptionGroup,
        };
        return this.baseDataService.mutate(CREATE_PRODUCT_OPTION_GROUP, input);
    }
    addOptionGroupToProduct(variables) {
        return this.baseDataService.mutate(ADD_OPTION_GROUP_TO_PRODUCT, variables);
    }
    addOptionToGroup(input) {
        return this.baseDataService.mutate(ADD_OPTION_TO_GROUP, { input });
    }
    removeOptionGroupFromProduct(variables) {
        return this.baseDataService.mutate(REMOVE_OPTION_GROUP_FROM_PRODUCT, variables);
    }
    updateProductOption(input) {
        return this.baseDataService.mutate(UPDATE_PRODUCT_OPTION, {
            input: pick(input, ['id', 'code', 'translations', 'customFields']),
        });
    }
    getProductOptionGroups(filterTerm) {
        return this.baseDataService.query(GET_PRODUCT_OPTION_GROUPS, {
            filterTerm,
        });
    }
    getAssetList(take = 10, skip = 0) {
        return this.baseDataService.query(GET_ASSET_LIST, {
            options: {
                skip,
                take,
                sort: {
                    createdAt: SortOrder.DESC,
                },
            },
        });
    }
    getAsset(id) {
        return this.baseDataService.query(GET_ASSET, {
            id,
        });
    }
    createAssets(files) {
        return this.baseDataService.mutate(CREATE_ASSETS, {
            input: files.map(file => ({ file })),
        });
    }
    updateAsset(input) {
        return this.baseDataService.mutate(UPDATE_ASSET, {
            input,
        });
    }
    deleteAssets(ids, force) {
        return this.baseDataService.mutate(DELETE_ASSETS, {
            input: {
                assetIds: ids,
                force,
            },
        });
    }
    assignProductsToChannel(input) {
        return this.baseDataService.mutate(ASSIGN_PRODUCTS_TO_CHANNEL, {
            input,
        });
    }
    removeProductsFromChannel(input) {
        return this.baseDataService.mutate(REMOVE_PRODUCTS_FROM_CHANNEL, {
            input,
        });
    }
    assignVariantsToChannel(input) {
        return this.baseDataService.mutate(ASSIGN_VARIANTS_TO_CHANNEL, {
            input,
        });
    }
    removeVariantsFromChannel(input) {
        return this.baseDataService.mutate(REMOVE_VARIANTS_FROM_CHANNEL, {
            input,
        });
    }
    getTag(id) {
        return this.baseDataService.query(GET_TAG, { id });
    }
    getTagList(options) {
        return this.baseDataService.query(GET_TAG_LIST, { options });
    }
    createTag(input) {
        return this.baseDataService.mutate(CREATE_TAG, { input });
    }
    updateTag(input) {
        return this.baseDataService.mutate(UPDATE_TAG, { input });
    }
    deleteTag(id) {
        return this.baseDataService.mutate(DELETE_TAG, { id });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZHVjdC1kYXRhLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvbGliL2NvcmUvc3JjL2RhdGEvcHJvdmlkZXJzL3Byb2R1Y3QtZGF0YS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUVoRCxPQUFPLEVBMkNILFNBQVMsR0FZWixNQUFNLDhCQUE4QixDQUFDO0FBQ3RDLE9BQU8sRUFDSCwyQkFBMkIsRUFDM0IsbUJBQW1CLEVBQ25CLDBCQUEwQixFQUMxQiwwQkFBMEIsRUFDMUIsYUFBYSxFQUNiLGNBQWMsRUFDZCwyQkFBMkIsRUFDM0IsdUJBQXVCLEVBQ3ZCLFVBQVUsRUFDVixhQUFhLEVBQ2IsY0FBYyxFQUNkLHNCQUFzQixFQUN0QixVQUFVLEVBQ1YsU0FBUyxFQUNULGNBQWMsRUFDZCxnQkFBZ0IsRUFDaEIsd0JBQXdCLEVBQ3hCLHlCQUF5QixFQUN6QixrQkFBa0IsRUFDbEIsbUJBQW1CLEVBQ25CLHdCQUF3QixFQUN4QiwyQkFBMkIsRUFDM0IseUJBQXlCLEVBQ3pCLE9BQU8sRUFDUCxZQUFZLEVBQ1osdUJBQXVCLEVBQ3ZCLGdDQUFnQyxFQUNoQyw0QkFBNEIsRUFDNUIsNEJBQTRCLEVBQzVCLGVBQWUsRUFDZixZQUFZLEVBQ1osY0FBYyxFQUNkLHFCQUFxQixFQUNyQix1QkFBdUIsRUFDdkIsVUFBVSxHQUNiLE1BQU0sb0NBQW9DLENBQUM7QUFDNUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLHFDQUFxQyxDQUFDO0FBSTlELE1BQU0sT0FBTyxrQkFBa0I7SUFDM0IsWUFBb0IsZUFBZ0M7UUFBaEMsb0JBQWUsR0FBZixlQUFlLENBQWlCO0lBQUcsQ0FBQztJQUV4RCxjQUFjLENBQUMsSUFBWSxFQUFFLE9BQWUsRUFBRSxFQUFFLE9BQWUsQ0FBQztRQUM1RCxPQUFPLElBQUksQ0FBQyxlQUFl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QUUsRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDO0lBQ3pHLENBQUM7SUFFRCxTQUFTLENBQUMsS0FBcUI7UUFDM0IsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBMEMsVUFBVSxFQUFFLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztJQUN2RyxDQUFDO0lBRUQsU0FBUyxDQUFDLEtBQXFCO1FBQzNCLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQTBDLFVBQVUsRUFBRSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7SUFDdkcsQ0FBQztJQUVELFNBQVMsQ0FBQyxFQUFVO1FBQ2hCLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQTBDLFVBQVUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDcEcsQ0FBQztDQUNKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcGljayB9IGZyb20gJ0B2ZW5kdXJlL2NvbW1vbi9saWIvcGljayc7XG5cbmltcG9ydCB7XG4gICAgQWRkT3B0aW9uR3JvdXBUb1Byb2R1Y3QsXG4gICAgQWRkT3B0aW9uVG9Hcm91cCxcbiAgICBBc3NpZ25Qcm9kdWN0c1RvQ2hhbm5lbCxcbiAgICBBc3NpZ25Qcm9kdWN0c1RvQ2hhbm5lbElucHV0LFxuICAgIEFzc2lnblByb2R1Y3RWYXJpYW50c1RvQ2hhbm5lbElucHV0LFxuICAgIEFzc2lnblZhcmlhbnRzVG9DaGFubmVsLFxuICAgIENyZWF0ZUFzc2V0cyxcbiAgICBDcmVhdGVQcm9kdWN0LFxuICAgIENyZWF0ZVByb2R1Y3RJbnB1dCxcbiAgICBDcmVhdGVQcm9kdWN0T3B0aW9uR3JvdXAsXG4gICAgQ3JlYXRlUHJvZHVjdE9wdGlvbkdyb3VwSW5wdXQsXG4gICAgQ3JlYXRlUHJvZHVjdE9wdGlvbklucHV0LFxuICAgIENyZWF0ZVByb2R1Y3RWYXJpYW50SW5wdXQsXG4gICAgQ3JlYXRlUHJvZHVjdFZhcmlhbnRzLFxuICAgIENyZWF0ZVRhZyxcbiAgICBDcmVhdGVUYWdJbnB1dCxcbiAgICBEZWxldGVBc3NldHMsXG4gICAgRGVsZXRlUHJvZHVjdCxcbiAgICBEZWxldGVQcm9kdWN0VmFyaWFudCxcbiAgICBEZWxldGVUYWcsXG4gICAgR2V0QXNzZXQsXG4gICAgR2V0QXNzZXRMaXN0LFxuICAgIEdldFByb2R1Y3RMaXN0LFxuICAgIEdldFByb2R1Y3RPcHRpb25Hcm91cCxcbiAgICBHZXRQcm9kdWN0T3B0aW9uR3JvdXBzLFxuICAgIEdldFByb2R1Y3RTaW1wbGUsXG4gICAgR2V0UHJvZHVjdFZhcmlhbnQsXG4gICAgR2V0UHJvZHVjdFZhcmlhbnRMaXN0LFxuICAgIEdldFByb2R1Y3RWYXJpYW50T3B0aW9ucyxcbiAgICBHZXRQcm9kdWN0V2l0aFZhcmlhbnRzLFxuICAgIEdldFRhZyxcbiAgICBHZXRUYWdMaXN0LFxuICAgIFByb2R1Y3RMaXN0T3B0aW9ucyxcbiAgICBQcm9kdWN0U2VsZWN0b3JTZWFyY2gsXG4gICAgUHJvZHVjdFZhcmlhbnRMaXN0T3B0aW9ucyxcbiAgICBSZWluZGV4LFxuICAgIFJlbW92ZU9wdGlvbkdyb3VwRnJvbVByb2R1Y3QsXG4gICAgUmVtb3ZlUHJvZHVjdHNGcm9tQ2hhbm5lbCxcbiAgICBSZW1vdmVQcm9kdWN0c0Zyb21DaGFubmVsSW5wdXQsXG4gICAgUmVtb3ZlUHJvZHVjdFZhcmlhbnRzRnJvbUNoYW5uZWxJbnB1dCxcbiAgICBSZW1vdmVWYXJpYW50c0Zyb21DaGFubmVsLFxuICAgIFNlYXJjaFByb2R1Y3RzLFxuICAgIFNvcnRPcmRlcixcbiAgICBUYWdMaXN0T3B0aW9ucyxcbiAgICBVcGRhdGVBc3NldCxcbiAgICBVcGRhdGVBc3NldElucHV0LFxuICAgIFVwZGF0ZVByb2R1Y3QsXG4gICAgVXBkYXRlUHJvZHVjdElucHV0LFxuICAgIFVwZGF0ZVByb2R1Y3RPcHRpb24sXG4gICAgVXBkYXRlUHJvZHVjdE9wdGlvbklucHV0LFxuICAgIFVwZGF0ZVByb2R1Y3RWYXJpYW50SW5wdXQsXG4gICAgVXBkYXRlUHJvZHVjdFZhcmlhbnRzLFxuICAgIFVwZGF0ZVRhZyxcbiAgICBVcGRhdGVUYWdJbnB1dCxcbn0gZnJvbSAnLi4vLi4vY29tbW9uL2dlbmVyYXRlZC10eXBlcyc7XG5pbXBvcnQge1xuICAgIEFERF9PUFRJT05fR1JPVVBfVE9fUFJPRFVDVCxcbiAgICBBRERfT1BUSU9OX1RPX0dST1VQLFxuICAgIEFTU0lHTl9QUk9EVUNUU19UT19DSEFOTkVMLFxuICAgIEFTU0lHTl9WQVJJQU5UU19UT19DSEFOTkVMLFxuICAgIENSRUFURV9BU1NFVFMsXG4gICAgQ1JFQVRFX1BST0RVQ1QsXG4gICAgQ1JFQVRFX1BST0RVQ1RfT1BUSU9OX0dST1VQLFxuICAgIENSRUFURV9QUk9EVUNUX1ZBUklBTlRTLFxuICAgIENSRUFURV9UQUcsXG4gICAgREVMRVRFX0FTU0VUUyxcbiAgICBERUxFVEVfUFJPRFVDVCxcbiAgICBERUxFVEVfUFJPRFVDVF9WQVJJQU5ULFxuICAgIERFTEVURV9UQUcsXG4gICAgR0VUX0FTU0VULFxuICAgIEdFVF9BU1NFVF9MSVNULFxuICAgIEdFVF9QUk9EVUNUX0xJU1QsXG4gICAgR0VUX1BST0RVQ1RfT1BUSU9OX0dST1VQLFxuICAgIEdFVF9QUk9EVUNUX09QVElPTl9HUk9VUFMsXG4gICAgR0VUX1BST0RVQ1RfU0lNUExFLFxuICAgIEdFVF9QUk9EVUNUX1ZBUklBTlQsXG4gICAgR0VUX1BST0RVQ1RfVkFSSUFOVF9MSVNULFxuICAgIEdFVF9QUk9EVUNUX1ZBUklBTlRfT1BUSU9OUyxcbiAgICBHRVRfUFJPRFVDVF9XSVRIX1ZBUklBTlRTLFxuICAgIEdFVF9UQUcsXG4gICAgR0VUX1RBR19MSVNULFxuICAgIFBST0RVQ1RfU0VMRUNUT1JfU0VBUkNILFxuICAgIFJFTU9WRV9PUFRJT05fR1JPVVBfRlJPTV9QUk9EVUNULFxuICAgIFJFTU9WRV9QUk9EVUNUU19GUk9NX0NIQU5ORUwsXG4gICAgUkVNT1ZFX1ZBUklBTlRTX0ZST01fQ0hBTk5FTCxcbiAgICBTRUFSQ0hfUFJPRFVDVFMsXG4gICAgVVBEQVRFX0FTU0VULFxuICAgIFVQREFURV9QUk9EVUNULFxuICAgIFVQREFURV9QUk9EVUNUX09QVElPTixcbiAgICBVUERBVEVfUFJPRFVDVF9WQVJJQU5UUyxcbiAgICBVUERBVEVfVEFHLFxufSBmcm9tICcuLi9kZWZpbml0aW9ucy9wcm9kdWN0LWRlZmluaXRpb25zJztcbmltcG9ydCB7IFJFSU5ERVggfSBmcm9tICcuLi9kZWZpbml0aW9ucy9zZXR0aW5ncy1kZWZpbml0aW9ucyc7XG5cbmltcG9ydCB7IEJhc2VEYXRhU2VydmljZSB9IGZyb20gJy4vYmFzZS1kYXRhLnNlcnZpY2UnO1xuXG5leHBvcnQgY2xhc3MgUHJvZHVjdERhdGFTZXJ2aWNlIHtcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGJhc2VEYXRhU2VydmljZTogQmFzZURhdGFTZXJ2aWNlKSB7fVxuXG4gICAgc2VhcmNoUHJvZHVjdHModGVybTogc3RyaW5nLCB0YWtlOiBudW1iZXIgPSAxMCwgc2tpcDogbnVtYmVyID0gMCkge1xuICAgICAgICByZXR1cm4gdGhpcy5iYXNlRGF0YVNlcnZpY2UucXVlcnk8U2VhcmNoUHJvZHVjdHMuUXVlcnksIFNlYXJjaFByb2R1Y3RzLlZhcmlhYmxlcz4oU0VBUkNIX1BST0RVQ1RTLCB7XG4gICAgICAgICAgICBpbnB1dDoge1xuICAgICAgICAgICAgICAgIHRlcm0sXG4gICAgICAgICAgICAgICAgdGFrZSxcbiAgICAgICAgICAgICAgICBza2lwLFxuICAgICAgICAgICAgICAgIGdyb3VwQnlQcm9kdWN0OiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJvZHVjdFNlbGVjdG9yU2VhcmNoKHRlcm06IHN0cmluZywgdGFrZTogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5xdWVyeTxQcm9kdWN0U2VsZWN0b3JTZWFyY2guUXVlcnksIFByb2R1Y3RTZWxlY3RvclNlYXJjaC5WYXJpYWJsZXM+KFxuICAgICAgICAgICAgUFJPRFVDVF9TRUxFQ1RPUl9TRUFSQ0gsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdGFrZSxcbiAgICAgICAgICAgICAgICB0ZXJtLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICByZWluZGV4KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5iYXNlRGF0YVNlcnZpY2UubXV0YXRlPFJlaW5kZXguTXV0YXRpb24+KFJFSU5ERVgpO1xuICAgIH1cblxuICAgIGdldFByb2R1Y3RzKG9wdGlvbnM6IFByb2R1Y3RMaXN0T3B0aW9ucykge1xuICAgICAgICByZXR1cm4gdGhpcy5iYXNlRGF0YVNlcnZpY2UucXVlcnk8R2V0UHJvZHVjdExpc3QuUXVlcnksIEdldFByb2R1Y3RMaXN0LlZhcmlhYmxlcz4oR0VUX1BST0RVQ1RfTElTVCwge1xuICAgICAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZ2V0UHJvZHVjdChpZDogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5xdWVyeTxHZXRQcm9kdWN0V2l0aFZhcmlhbnRzLlF1ZXJ5LCBHZXRQcm9kdWN0V2l0aFZhcmlhbnRzLlZhcmlhYmxlcz4oXG4gICAgICAgICAgICBHRVRfUFJPRFVDVF9XSVRIX1ZBUklBTlRTLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBnZXRQcm9kdWN0U2ltcGxlKGlkOiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLnF1ZXJ5PEdldFByb2R1Y3RTaW1wbGUuUXVlcnksIEdldFByb2R1Y3RTaW1wbGUuVmFyaWFibGVzPihcbiAgICAgICAgICAgIEdFVF9QUk9EVUNUX1NJTVBMRSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgZ2V0UHJvZHVjdFZhcmlhbnRzKG9wdGlvbnM6IFByb2R1Y3RWYXJpYW50TGlzdE9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLnF1ZXJ5PEdldFByb2R1Y3RWYXJpYW50TGlzdC5RdWVyeSwgR2V0UHJvZHVjdFZhcmlhbnRMaXN0LlZhcmlhYmxlcz4oXG4gICAgICAgICAgICBHRVRfUFJPRFVDVF9WQVJJQU5UX0xJU1QsXG4gICAgICAgICAgICB7IG9wdGlvbnMgfSxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBnZXRQcm9kdWN0VmFyaWFudChpZDogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5xdWVyeTxHZXRQcm9kdWN0VmFyaWFudC5RdWVyeSwgR2V0UHJvZHVjdFZhcmlhbnQuVmFyaWFibGVzPihcbiAgICAgICAgICAgIEdFVF9QUk9EVUNUX1ZBUklBTlQsXG4gICAgICAgICAgICB7IGlkIH0sXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgZ2V0UHJvZHVjdFZhcmlhbnRzT3B0aW9ucyhpZDogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5xdWVyeTxHZXRQcm9kdWN0VmFyaWFudE9wdGlvbnMuUXVlcnksIEdldFByb2R1Y3RWYXJpYW50T3B0aW9ucy5WYXJpYWJsZXM+KFxuICAgICAgICAgICAgR0VUX1BST0RVQ1RfVkFSSUFOVF9PUFRJT05TLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBnZXRQcm9kdWN0T3B0aW9uR3JvdXAoaWQ6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gdGhpcy5iYXNlRGF0YVNlcnZpY2UucXVlcnk8R2V0UHJvZHVjdE9wdGlvbkdyb3VwLlF1ZXJ5LCBHZXRQcm9kdWN0T3B0aW9uR3JvdXAuVmFyaWFibGVzPihcbiAgICAgICAgICAgIEdFVF9QUk9EVUNUX09QVElPTl9HUk9VUCxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpZCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgY3JlYXRlUHJvZHVjdChwcm9kdWN0OiBDcmVhdGVQcm9kdWN0SW5wdXQpIHtcbiAgICAgICAgY29uc3QgaW5wdXQ6IENyZWF0ZVByb2R1Y3QuVmFyaWFibGVzID0ge1xuICAgICAgICAgICAgaW5wdXQ6IHBpY2socHJvZHVjdCwgW1xuICAgICAgICAgICAgICAgICdlbmFibGVkJyxcbiAgICAgICAgICAgICAgICAndHJhbnNsYXRpb25zJyxcbiAgICAgICAgICAgICAgICAnY3VzdG9tRmllbGRzJyxcbiAgICAgICAgICAgICAgICAnYXNzZXRJZHMnLFxuICAgICAgICAgICAgICAgICdmZWF0dXJlZEFzc2V0SWQnLFxuICAgICAgICAgICAgICAgICdmYWNldFZhbHVlSWRzJyxcbiAgICAgICAgICAgIF0pLFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gdGhpcy5iYXNlRGF0YVNlcnZpY2UubXV0YXRlPENyZWF0ZVByb2R1Y3QuTXV0YXRpb24sIENyZWF0ZVByb2R1Y3QuVmFyaWFibGVzPihcbiAgICAgICAgICAgIENSRUFURV9QUk9EVUNULFxuICAgICAgICAgICAgaW5wdXQsXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgdXBkYXRlUHJvZHVjdChwcm9kdWN0OiBVcGRhdGVQcm9kdWN0SW5wdXQpIHtcbiAgICAgICAgY29uc3QgaW5wdXQ6IFVwZGF0ZVByb2R1Y3QuVmFyaWFibGVzID0ge1xuICAgICAgICAgICAgaW5wdXQ6IHBpY2socHJvZHVjdCwgW1xuICAgICAgICAgICAgICAgICdpZCcsXG4gICAgICAgICAgICAgICAgJ2VuYWJsZWQnLFxuICAgICAgICAgICAgICAgICd0cmFuc2xhdGlvbnMnLFxuICAgICAgICAgICAgICAgICdjdXN0b21GaWVsZHMnLFxuICAgICAgICAgICAgICAgICdhc3NldElkcycsXG4gICAgICAgICAgICAgICAgJ2ZlYXR1cmVkQXNzZXRJZCcsXG4gICAgICAgICAgICAgICAgJ2ZhY2V0VmFsdWVJZHMnLFxuICAgICAgICAgICAgXSksXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5tdXRhdGU8VXBkYXRlUHJvZHVjdC5NdXRhdGlvbiwgVXBkYXRlUHJvZHVjdC5WYXJpYWJsZXM+KFxuICAgICAgICAgICAgVVBEQVRFX1BST0RVQ1QsXG4gICAgICAgICAgICBpbnB1dCxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBkZWxldGVQcm9kdWN0KGlkOiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLm11dGF0ZTxEZWxldGVQcm9kdWN0Lk11dGF0aW9uLCBEZWxldGVQcm9kdWN0LlZhcmlhYmxlcz4oREVMRVRFX1BST0RVQ1QsIHtcbiAgICAgICAgICAgIGlkLFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBjcmVhdGVQcm9kdWN0VmFyaWFudHMoaW5wdXQ6IENyZWF0ZVByb2R1Y3RWYXJpYW50SW5wdXRbXSkge1xuICAgICAgICByZXR1cm4gdGhpcy5iYXNlRGF0YVNlcnZpY2UubXV0YXRlPENyZWF0ZVByb2R1Y3RWYXJpYW50cy5NdXRhdGlvbiwgQ3JlYXRlUHJvZHVjdFZhcmlhbnRzLlZhcmlhYmxlcz4oXG4gICAgICAgICAgICBDUkVBVEVfUFJPRFVDVF9WQVJJQU5UUyxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBpbnB1dCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgdXBkYXRlUHJvZHVjdFZhcmlhbnRzKHZhcmlhbnRzOiBVcGRhdGVQcm9kdWN0VmFyaWFudElucHV0W10pIHtcbiAgICAgICAgY29uc3QgaW5wdXQ6IFVwZGF0ZVByb2R1Y3RWYXJpYW50cy5WYXJpYWJsZXMgPSB7XG4gICAgICAgICAgICBpbnB1dDogdmFyaWFudHMubWFwKFxuICAgICAgICAgICAgICAgIHBpY2soW1xuICAgICAgICAgICAgICAgICAgICAnaWQnLFxuICAgICAgICAgICAgICAgICAgICAnZW5hYmxlZCcsXG4gICAgICAgICAgICAgICAgICAgICd0cmFuc2xhdGlvbnMnLFxuICAgICAgICAgICAgICAgICAgICAnc2t1JyxcbiAgICAgICAgICAgICAgICAgICAgJ3ByaWNlJyxcbiAgICAgICAgICAgICAgICAgICAgJ3RheENhdGVnb3J5SWQnLFxuICAgICAgICAgICAgICAgICAgICAnZmFjZXRWYWx1ZUlkcycsXG4gICAgICAgICAgICAgICAgICAgICdmZWF0dXJlZEFzc2V0SWQnLFxuICAgICAgICAgICAgICAgICAgICAnYXNzZXRJZHMnLFxuICAgICAgICAgICAgICAgICAgICAndHJhY2tJbnZlbnRvcnknLFxuICAgICAgICAgICAgICAgICAgICAnb3V0T2ZTdG9ja1RocmVzaG9sZCcsXG4gICAgICAgICAgICAgICAgICAgICd1c2VHbG9iYWxPdXRPZlN0b2NrVGhyZXNob2xkJyxcbiAgICAgICAgICAgICAgICAgICAgJ3N0b2NrT25IYW5kJyxcbiAgICAgICAgICAgICAgICAgICAgJ2N1c3RvbUZpZWxkcycsXG4gICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICApLFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gdGhpcy5iYXNlRGF0YVNlcnZpY2UubXV0YXRlPFVwZGF0ZVByb2R1Y3RWYXJpYW50cy5NdXRhdGlvbiwgVXBkYXRlUHJvZHVjdFZhcmlhbnRzLlZhcmlhYmxlcz4oXG4gICAgICAgICAgICBVUERBVEVfUFJPRFVDVF9WQVJJQU5UUyxcbiAgICAgICAgICAgIGlucHV0LFxuICAgICAgICApO1xuICAgIH1cblxuICAgIGRlbGV0ZVByb2R1Y3RWYXJpYW50KGlkOiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLm11dGF0ZTxEZWxldGVQcm9kdWN0VmFyaWFudC5NdXRhdGlvbiwgRGVsZXRlUHJvZHVjdFZhcmlhbnQuVmFyaWFibGVzPihcbiAgICAgICAgICAgIERFTEVURV9QUk9EVUNUX1ZBUklBTlQsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICB9LFxuICAgICAgICApO1xuICAgIH1cblxuICAgIGNyZWF0ZVByb2R1Y3RPcHRpb25Hcm91cHMocHJvZHVjdE9wdGlvbkdyb3VwOiBDcmVhdGVQcm9kdWN0T3B0aW9uR3JvdXBJbnB1dCkge1xuICAgICAgICBjb25zdCBpbnB1dDogQ3JlYXRlUHJvZHVjdE9wdGlvbkdyb3VwLlZhcmlhYmxlcyA9IHtcbiAgICAgICAgICAgIGlucHV0OiBwcm9kdWN0T3B0aW9uR3JvdXAsXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5tdXRhdGU8XG4gICAgICAgICAgICBDcmVhdGVQcm9kdWN0T3B0aW9uR3JvdXAuTXV0YXRpb24sXG4gICAgICAgICAgICBDcmVhdGVQcm9kdWN0T3B0aW9uR3JvdXAuVmFyaWFibGVzXG4gICAgICAgID4oQ1JFQVRFX1BST0RVQ1RfT1BUSU9OX0dST1VQLCBpbnB1dCk7XG4gICAgfVxuXG4gICAgYWRkT3B0aW9uR3JvdXBUb1Byb2R1Y3QodmFyaWFibGVzOiBBZGRPcHRpb25Hcm91cFRvUHJvZHVjdC5WYXJpYWJsZXMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLm11dGF0ZTxcbiAgICAgICAgICAgIEFkZE9wdGlvbkdyb3VwVG9Qcm9kdWN0Lk11dGF0aW9uLFxuICAgICAgICAgICAgQWRkT3B0aW9uR3JvdXBUb1Byb2R1Y3QuVmFyaWFibGVzXG4gICAgICAgID4oQUREX09QVElPTl9HUk9VUF9UT19QUk9EVUNULCB2YXJpYWJsZXMpO1xuICAgIH1cblxuICAgIGFkZE9wdGlvblRvR3JvdXAoaW5wdXQ6IENyZWF0ZVByb2R1Y3RPcHRpb25JbnB1dCkge1xuICAgICAgICByZXR1cm4gdGhpcy5iYXNlRGF0YVNlcnZpY2UubXV0YXRlPEFkZE9wdGlvblRvR3JvdXAuTXV0YXRpb24sIEFkZE9wdGlvblRvR3JvdXAuVmFyaWFibGVzPihcbiAgICAgICAgICAgIEFERF9PUFRJT05fVE9fR1JPVVAsXG4gICAgICAgICAgICB7IGlucHV0IH0sXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcmVtb3ZlT3B0aW9uR3JvdXBGcm9tUHJvZHVjdCh2YXJpYWJsZXM6IFJlbW92ZU9wdGlvbkdyb3VwRnJvbVByb2R1Y3QuVmFyaWFibGVzKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5tdXRhdGU8XG4gICAgICAgICAgICBSZW1vdmVPcHRpb25Hcm91cEZyb21Qcm9kdWN0Lk11dGF0aW9uLFxuICAgICAgICAgICAgUmVtb3ZlT3B0aW9uR3JvdXBGcm9tUHJvZHVjdC5WYXJpYWJsZXNcbiAgICAgICAgPihSRU1PVkVfT1BUSU9OX0dST1VQX0ZST01fUFJPRFVDVCwgdmFyaWFibGVzKTtcbiAgICB9XG5cbiAgICB1cGRhdGVQcm9kdWN0T3B0aW9uKGlucHV0OiBVcGRhdGVQcm9kdWN0T3B0aW9uSW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLm11dGF0ZTxVcGRhdGVQcm9kdWN0T3B0aW9uLk11dGF0aW9uLCBVcGRhdGVQcm9kdWN0T3B0aW9uLlZhcmlhYmxlcz4oXG4gICAgICAgICAgICBVUERBVEVfUFJPRFVDVF9PUFRJT04sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaW5wdXQ6IHBpY2soaW5wdXQsIFsnaWQnLCAnY29kZScsICd0cmFuc2xhdGlvbnMnLCAnY3VzdG9tRmllbGRzJ10pLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBnZXRQcm9kdWN0T3B0aW9uR3JvdXBzKGZpbHRlclRlcm0/OiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLnF1ZXJ5PEdldFByb2R1Y3RPcHRpb25Hcm91cHMuUXVlcnksIEdldFByb2R1Y3RPcHRpb25Hcm91cHMuVmFyaWFibGVzPihcbiAgICAgICAgICAgIEdFVF9QUk9EVUNUX09QVElPTl9HUk9VUFMsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmlsdGVyVGVybSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgZ2V0QXNzZXRMaXN0KHRha2U6IG51bWJlciA9IDEwLCBza2lwOiBudW1iZXIgPSAwKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5xdWVyeTxHZXRBc3NldExpc3QuUXVlcnksIEdldEFzc2V0TGlzdC5WYXJpYWJsZXM+KEdFVF9BU1NFVF9MSVNULCB7XG4gICAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgc2tpcCxcbiAgICAgICAgICAgICAgICB0YWtlLFxuICAgICAgICAgICAgICAgIHNvcnQ6IHtcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0OiBTb3J0T3JkZXIuREVTQyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZ2V0QXNzZXQoaWQ6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gdGhpcy5iYXNlRGF0YVNlcnZpY2UucXVlcnk8R2V0QXNzZXQuUXVlcnksIEdldEFzc2V0LlZhcmlhYmxlcz4oR0VUX0FTU0VULCB7XG4gICAgICAgICAgICBpZCxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgY3JlYXRlQXNzZXRzKGZpbGVzOiBGaWxlW10pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLm11dGF0ZTxDcmVhdGVBc3NldHMuTXV0YXRpb24sIENyZWF0ZUFzc2V0cy5WYXJpYWJsZXM+KENSRUFURV9BU1NFVFMsIHtcbiAgICAgICAgICAgIGlucHV0OiBmaWxlcy5tYXAoZmlsZSA9PiAoeyBmaWxlIH0pKSxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgdXBkYXRlQXNzZXQoaW5wdXQ6IFVwZGF0ZUFzc2V0SW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLm11dGF0ZTxVcGRhdGVBc3NldC5NdXRhdGlvbiwgVXBkYXRlQXNzZXQuVmFyaWFibGVzPihVUERBVEVfQVNTRVQsIHtcbiAgICAgICAgICAgIGlucHV0LFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBkZWxldGVBc3NldHMoaWRzOiBzdHJpbmdbXSwgZm9yY2U6IGJvb2xlYW4pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLm11dGF0ZTxEZWxldGVBc3NldHMuTXV0YXRpb24sIERlbGV0ZUFzc2V0cy5WYXJpYWJsZXM+KERFTEVURV9BU1NFVFMsIHtcbiAgICAgICAgICAgIGlucHV0OiB7XG4gICAgICAgICAgICAgICAgYXNzZXRJZHM6IGlkcyxcbiAgICAgICAgICAgICAgICBmb3JjZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGFzc2lnblByb2R1Y3RzVG9DaGFubmVsKGlucHV0OiBBc3NpZ25Qcm9kdWN0c1RvQ2hhbm5lbElucHV0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5tdXRhdGU8XG4gICAgICAgICAgICBBc3NpZ25Qcm9kdWN0c1RvQ2hhbm5lbC5NdXRhdGlvbixcbiAgICAgICAgICAgIEFzc2lnblByb2R1Y3RzVG9DaGFubmVsLlZhcmlhYmxlc1xuICAgICAgICA+KEFTU0lHTl9QUk9EVUNUU19UT19DSEFOTkVMLCB7XG4gICAgICAgICAgICBpbnB1dCxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmVtb3ZlUHJvZHVjdHNGcm9tQ2hhbm5lbChpbnB1dDogUmVtb3ZlUHJvZHVjdHNGcm9tQ2hhbm5lbElucHV0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5tdXRhdGU8XG4gICAgICAgICAgICBSZW1vdmVQcm9kdWN0c0Zyb21DaGFubmVsLk11dGF0aW9uLFxuICAgICAgICAgICAgUmVtb3ZlUHJvZHVjdHNGcm9tQ2hhbm5lbC5WYXJpYWJsZXNcbiAgICAgICAgPihSRU1PVkVfUFJPRFVDVFNfRlJPTV9DSEFOTkVMLCB7XG4gICAgICAgICAgICBpbnB1dCxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYXNzaWduVmFyaWFudHNUb0NoYW5uZWwoaW5wdXQ6IEFzc2lnblByb2R1Y3RWYXJpYW50c1RvQ2hhbm5lbElucHV0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5tdXRhdGU8XG4gICAgICAgICAgICBBc3NpZ25WYXJpYW50c1RvQ2hhbm5lbC5NdXRhdGlvbixcbiAgICAgICAgICAgIEFzc2lnblZhcmlhbnRzVG9DaGFubmVsLlZhcmlhYmxlc1xuICAgICAgICA+KEFTU0lHTl9WQVJJQU5UU19UT19DSEFOTkVMLCB7XG4gICAgICAgICAgICBpbnB1dCxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmVtb3ZlVmFyaWFudHNGcm9tQ2hhbm5lbChpbnB1dDogUmVtb3ZlUHJvZHVjdFZhcmlhbnRzRnJvbUNoYW5uZWxJbnB1dCkge1xuICAgICAgICByZXR1cm4gdGhpcy5iYXNlRGF0YVNlcnZpY2UubXV0YXRlPFxuICAgICAgICAgICAgUmVtb3ZlVmFyaWFudHNGcm9tQ2hhbm5lbC5NdXRhdGlvbixcbiAgICAgICAgICAgIFJlbW92ZVZhcmlhbnRzRnJvbUNoYW5uZWwuVmFyaWFibGVzXG4gICAgICAgID4oUkVNT1ZFX1ZBUklBTlRTX0ZST01fQ0hBTk5FTCwge1xuICAgICAgICAgICAgaW5wdXQsXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGdldFRhZyhpZDogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5xdWVyeTxHZXRUYWcuUXVlcnksIEdldFRhZy5WYXJpYWJsZXM+KEdFVF9UQUcsIHsgaWQgfSk7XG4gICAgfVxuXG4gICAgZ2V0VGFnTGlzdChvcHRpb25zPzogVGFnTGlzdE9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLnF1ZXJ5PEdldFRhZ0xpc3QuUXVlcnksIEdldFRhZ0xpc3QuVmFyaWFibGVzPihHRVRfVEFHX0xJU1QsIHsgb3B0aW9ucyB9KTtcbiAgICB9XG5cbiAgICBjcmVhdGVUYWcoaW5wdXQ6IENyZWF0ZVRhZ0lucHV0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJhc2VEYXRhU2VydmljZS5tdXRhdGU8Q3JlYXRlVGFnLk11dGF0aW9uLCBDcmVhdGVUYWcuVmFyaWFibGVzPihDUkVBVEVfVEFHLCB7IGlucHV0IH0pO1xuICAgIH1cblxuICAgIHVwZGF0ZVRhZyhpbnB1dDogVXBkYXRlVGFnSW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLm11dGF0ZTxVcGRhdGVUYWcuTXV0YXRpb24sIFVwZGF0ZVRhZy5WYXJpYWJsZXM+KFVQREFURV9UQUcsIHsgaW5wdXQgfSk7XG4gICAgfVxuXG4gICAgZGVsZXRlVGFnKGlkOiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZURhdGFTZXJ2aWNlLm11dGF0ZTxEZWxldGVUYWcuTXV0YXRpb24sIERlbGV0ZVRhZy5WYXJpYWJsZXM+KERFTEVURV9UQUcsIHsgaWQgfSk7XG4gICAgfVxufVxuIl19
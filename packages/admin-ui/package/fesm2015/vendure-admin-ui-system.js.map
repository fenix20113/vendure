{"version":3,"file":"vendure-admin-ui-system.js","sources":["../../src/lib/system/src/components/health-check/health-check.component.ts","../../src/lib/system/src/components/job-list/job-list.component.ts","../../src/lib/system/src/components/job-state-label/job-state-label.component.ts","../../src/lib/system/src/system.routes.ts","../../src/lib/system/src/system.module.ts","../../src/lib/system/src/public_api.ts","../../src/lib/system/src/vendure-admin-ui-system.ts"],"sourcesContent":["import { ChangeDetectionStrategy, Component } from '@angular/core';\nimport { HealthCheckService } from '@vendure/admin-ui/core';\n\n@Component({\n    selector: 'vdr-health-check',\n    templateUrl: './health-check.component.html',\n    styleUrls: ['./health-check.component.scss'],\n    changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class HealthCheckComponent {\n    constructor(public healthCheckService: HealthCheckService) {}\n}\n","import { ChangeDetectionStrategy, Component, OnInit } from '@angular/core';\nimport { FormControl } from '@angular/forms';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport {\n    BaseListComponent,\n    DataService,\n    GetAllJobs,\n    GetFacetList,\n    GetJobQueueList,\n    ModalService,\n    NotificationService,\n    SortOrder,\n} from '@vendure/admin-ui/core';\nimport { Observable, timer } from 'rxjs';\nimport { filter, map, takeUntil } from 'rxjs/operators';\n\n@Component({\n    selector: 'vdr-job-list',\n    templateUrl: './job-list.component.html',\n    styleUrls: ['./job-list.component.scss'],\n    changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class JobListComponent\n    extends BaseListComponent<GetAllJobs.Query, GetAllJobs.Items>\n    implements OnInit {\n    queues$: Observable<GetJobQueueList.JobQueues[]>;\n    liveUpdate = new FormControl(true);\n    hideSettled = new FormControl(true);\n    queueFilter = new FormControl('all');\n\n    constructor(\n        private dataService: DataService,\n        private modalService: ModalService,\n        private notificationService: NotificationService,\n        router: Router,\n        route: ActivatedRoute,\n    ) {\n        super(router, route);\n        super.setQueryFn(\n            (...args: any[]) => this.dataService.settings.getAllJobs(...args),\n            data => data.jobs,\n            (skip, take) => {\n                const queueFilter =\n                    this.queueFilter.value === 'all' ? null : { queueName: { eq: this.queueFilter.value } };\n                const hideSettled = this.hideSettled.value;\n                return {\n                    options: {\n                        skip,\n                        take,\n                        filter: {\n                            ...queueFilter,\n                            ...(hideSettled ? { isSettled: { eq: false } } : {}),\n                        },\n                        sort: {\n                            createdAt: SortOrder.DESC,\n                        },\n                    },\n                };\n            },\n        );\n    }\n\n    ngOnInit(): void {\n        super.ngOnInit();\n        timer(5000, 2000)\n            .pipe(\n                takeUntil(this.destroy$),\n                filter(() => this.liveUpdate.value),\n            )\n            .subscribe(() => {\n                this.refresh();\n            });\n        this.queues$ = this.dataService.settings\n            .getJobQueues()\n            .mapStream(res => res.jobQueues)\n            .pipe(\n                map(queues => {\n                    return [{ name: 'all', running: true }, ...queues];\n                }),\n            );\n    }\n\n    hasResult(job: GetAllJobs.Items): boolean {\n        const result = job.result;\n        if (result == null) {\n            return false;\n        }\n        if (typeof result === 'object') {\n            return Object.keys(result).length > 0;\n        }\n        return true;\n    }\n\n    cancelJob(id: string) {\n        this.dataService.settings.cancelJob(id).subscribe(() => this.refresh());\n    }\n}\n","import { ChangeDetectionStrategy, Component, Input } from '@angular/core';\nimport { JobInfoFragment, JobState } from '@vendure/admin-ui/core';\n\n@Component({\n    selector: 'vdr-job-state-label',\n    templateUrl: './job-state-label.component.html',\n    styleUrls: ['./job-state-label.component.scss'],\n    changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class JobStateLabelComponent {\n    @Input()\n    job: JobInfoFragment;\n\n    get iconShape(): string {\n        switch (this.job.state) {\n            case JobState.COMPLETED:\n                return 'check-circle';\n            case JobState.FAILED:\n                return 'exclamation-circle';\n            case JobState.CANCELLED:\n                return 'ban';\n            case JobState.PENDING:\n            case JobState.RETRYING:\n                return 'hourglass';\n            case JobState.RUNNING:\n                return 'sync';\n        }\n    }\n\n    get colorType(): string {\n        switch (this.job.state) {\n            case JobState.COMPLETED:\n                return 'success';\n            case JobState.FAILED:\n            case JobState.CANCELLED:\n                return 'error';\n            case JobState.PENDING:\n            case JobState.RETRYING:\n                return '';\n            case JobState.RUNNING:\n                return 'warning';\n        }\n    }\n}\n","import { Route } from '@angular/router';\nimport { marker as _ } from '@biesbjerg/ngx-translate-extract-marker';\n\nimport { HealthCheckComponent } from './components/health-check/health-check.component';\nimport { JobListComponent } from './components/job-list/job-list.component';\n\nexport const systemRoutes: Route[] = [\n    {\n        path: 'jobs',\n        component: JobListComponent,\n        data: {\n            breadcrumb: _('breadcrumb.job-queue'),\n        },\n    },\n    {\n        path: 'system-status',\n        component: HealthCheckComponent,\n        data: {\n            breadcrumb: _('breadcrumb.system-status'),\n        },\n    },\n];\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { RouterModule } from '@angular/router';\nimport { SharedModule } from '@vendure/admin-ui/core';\n\nimport { HealthCheckComponent } from './components/health-check/health-check.component';\nimport { JobListComponent } from './components/job-list/job-list.component';\nimport { JobStateLabelComponent } from './components/job-state-label/job-state-label.component';\nimport { systemRoutes } from './system.routes';\n\n@NgModule({\n    declarations: [HealthCheckComponent, JobListComponent, JobStateLabelComponent],\n    imports: [SharedModule, RouterModule.forChild(systemRoutes)],\n})\nexport class SystemModule {}\n","// This file was generated by the build-public-api.ts script\nexport * from './components/health-check/health-check.component';\nexport * from './components/job-list/job-list.component';\nexport * from './components/job-state-label/job-state-label.component';\nexport * from './system.module';\nexport * from './system.routes';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":["_"],"mappings":"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"}